(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/webgl/Texture":1560,"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":1561,"esri/views/webgl/FramebufferObject":1562,"esri/views/3d/webgl-engine/lib/Geometry":1570,"esri/views/3d/webgl-engine/Stage":1575,"esri/views/3d/webgl-engine/lib/GeometryData":1576,"esri/views/3d/webgl-engine/lib/IdGen":1577,"esri/views/3d/webgl-engine/lib/glUtil3D":1578,"esri/views/webgl/capabilities/isWebGL2Context":1580,"esri/views/3d/webgl-engine/lib/Object3D":1581,"esri/views/3d/webgl-engine/lib/ModelContentType":1586,"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":1587,"esri/views/3d/support/debugFlags":1589,"esri/views/3d/webgl-engine/lib/Material":1591,"esri/views/3d/webgl-engine/materials/DefaultMaterial":1592,"esri/views/3d/webgl-engine/lib/Camera":1594,"esri/views/3d/webgl-engine/materials/internal/bufferWriters":1595,"esri/views/3d/webgl-engine/lib/GeometryUtil":1596,"esri/views/3d/webgl-engine/lighting/Lightsources":1597,"esri/views/3d/webgl-engine/shaders/MiscPrograms":1598,"esri/views/3d/webgl-engine/lib/Texture":1600,"esri/views/3d/support/imageUtils":1601,"esri/views/3d/webgl-engine/lib/GLMaterial":1604,"esri/views/3d/webgl-engine/lib/RenderGeometry":1607,"esri/views/3d/webgl-engine/parts/Model":1608,"esri/views/3d/webgl-engine/lib/depthRange":1609,"esri/views/3d/webgl-engine/lib/HighlightUtils":1610,"esri/views/3d/webgl-engine/lib/GLMaterialTexture":1611,"esri/views/webgl/Renderbuffer":1612,"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":1613,"esri/views/3d/support/buffer/utils":1614,"esri/views/3d/webgl-engine/materials/HUDMaterial":1615,"esri/views/layers/RefreshableLayerView":1617,"esri/views/3d/webgl-engine/lib/Renderer":1622,"esri/views/3d/webgl-engine/lib/localOriginHelper":1623,"esri/views/3d/webgl-engine/lib/SliceHelper":1624,"esri/views/3d/webgl-engine/lib/Layer":1630,"esri/views/3d/webgl-engine/lib/Octree":1631,"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":1632,"esri/views/3d/webgl-engine/lib/Performance":1639,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":1644,"esri/views/3d/webgl-engine/lib/PerformanceTimer":1645,"esri/views/webgl/RenderingContext":1648,"esri/views/webgl/enums":1649,"esri/views/webgl/InstanceCounter":1650,"esri/views/webgl/capabilities/load":1651,"esri/views/webgl/capabilities/DisjointTimerQuery":1652,"esri/views/webgl/capabilities/Instancing":1653,"esri/views/webgl/capabilities/VertexArrayObjects":1654,"esri/views/3d/webgl-engine/lib/ModelDirtySet":1661,"esri/views/3d/webgl-engine/parts/View":1662,"esri/views/3d/webgl-engine/lib/DrapedRenderer":1663,"esri/views/3d/webgl-engine/lib/BoundingInfo":1664,"esri/views/3d/webgl-engine/lib/GeometryRecord":1665,"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":1666,"esri/views/3d/webgl-engine/lib/RenderContext":1667,"esri/views/3d/webgl-engine/lib/Float32ArrayList":1668,"esri/views/3d/webgl-engine/lib/FxaaRenderPass":1669,"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":1670,"esri/views/3d/webgl-engine/lib/InstanceBufferData":1671,"esri/views/3d/webgl-engine/lib/IntervalUtilities":1672,"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":1673,"esri/views/3d/webgl-engine/lib/NormalTextureHelper":1674,"esri/views/3d/webgl-engine/lib/RenderPluginManager":1675,"esri/views/3d/webgl-engine/lib/SmaaRenderPass":1676,"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":1677,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":1678,"esri/views/3d/support/buffer/utils/mat3":1679,"esri/views/3d/support/buffer/utils/mat4":1680,"esri/views/3d/support/buffer/utils/scalar":1681,"esri/views/3d/support/buffer/utils/vec2":1682,"esri/views/3d/support/buffer/utils/vec3":1683,"esri/views/3d/support/buffer/utils/vec4":1684,"esri/views/3d/webgl-engine/lib/LocalOriginManager":1685,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":1686,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":1687,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":1688,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":1689,"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":1690,"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":1691,"esri/views/3d/webgl-engine/lib/edgeRendering/util":1692,"esri/views/3d/webgl-engine/lighting/SceneLighting":1693,"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":1694,"esri/views/3d/webgl-engine/lib/LongVectorMath":1695,"esri/core/libs/gl-matrix-2/types/mat4":1696,"esri/views/3d/webgl-engine/shaders/HUDPrograms":1697,"esri/views/webgl/Profiling":1698,"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":1699,"esri/views/3d/webgl-engine/lib/GLMaterialRep":1700,"esri/views/3d/webgl-engine/lib/GLTextureRep":1701,"esri/views/3d/webgl-engine/lib/tracer":1702,"esri/views/3d/webgl-engine/lib/webgl-debug":1703,"esri/views/3d/webgl-engine/parts/Viewport":1704,"esri/views/3d/webgl-engine/parts/Visualizer":1705,"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":1706,"esri/views/3d/webgl-engine/lib/RenderTargetHelper":1707,"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":1708,"esri/core/TimeProfiler":1709,"esri/views/3d/webgl-engine/lib/depthRangeUtils":1710,"esri/views/3d/webgl-engine/lib/HighlightHelper":1711,"esri/views/3d/webgl-engine/shaders/HighlightPrograms":1712,"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":1713,"esri/views/3d/webgl-engine/shaders/OccludedPrograms":1714,"esri/views/3d/webgl-engine/lib/ShadowMap":1715,"esri/views/3d/webgl-engine/lib/SSAOHelper":1716,"esri/views/3d/webgl-engine/shaders/SSAOPrograms":1717,"esri/views/3d/webgl-engine/lib/DDSUtil":1718,"esri/views/3d/webgl-engine/shaders/DefaultPrograms":1719,"esri/views/3d/layers/support/projectExtentUtils":1834,"esri/views/3d/layers/DynamicLayerView3D":1942,"esri/views/3d/layers/support/overlayImageUtils":1943,"esri/views/layers/WMSLayerView":2020,"esri/views/3d/layers/WMSLayerView3D":2512})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{1560:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19)],void 0===(n=function(e,t,r){return function(){function e(t,i,n){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:i.pixelFormat,internalFormat:i.internalFormat,dataType:i.dataType,target:i.target?i.target:3553,samplingMode:i.samplingMode?i.samplingMode:9729,wrapMode:i.wrapMode?i.wrapMode:10497,maxAnisotropy:i.maxAnisotropy,flipped:void 0!==i.flipped&&i.flipped,hasMipmap:void 0!==i.hasMipmap&&i.hasMipmap,unpackAlignment:i.unpackAlignment?i.unpackAlignment:4,width:i.width,height:i.height,preMultiplyAlpha:void 0!==i.preMultiplyAlpha&&i.preMultiplyAlpha},this._id=++e._nextId,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var r=this._desc;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var i=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var n=this._desc;e._validateTexture(n),r.pixelStorei(r.UNPACK_ALIGNMENT,n.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,n.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.preMultiplyAlpha?1:0);var a=n.pixelFormat,o=n.internalFormat?n.internalFormat:a;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)n.width&&n.height&&console.assert(t.width===n.width&&t.height===n.height),r.texImage2D(r.TEXTURE_2D,0,o,a,n.dataType,t),n.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=n.width&&null!=n.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&o===r.DEPTH_STENCIL&&(o=r.DEPTH24_STENCIL8);var s=n.width,l=n.height;if(function(e){return null!=e&&"type"in e&&"compressed"===e.type}(t))for(var h=0;;++h){var c=t.levels[Math.min(h,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,h,o,s,l,0,c),1===s&&1===l||!n.hasMipmap)break;s=Math.max(1,s>>1),l=Math.max(1,l>>1)}else if(t)r.texImage2D(r.TEXTURE_2D,0,o,s,l,0,a,n.dataType,t),n.hasMipmap&&this.generateMipmap();else for(h=0;r.texImage2D(r.TEXTURE_2D,h,o,s,l,0,a,n.dataType,null),(1!==s||1!==l)&&n.hasMipmap;++h)s=Math.max(1,s>>1),l=Math.max(1,l>>1)}e._applySamplingMode(r,this._desc),e._applyWrapMode(r,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(i,0)},e.prototype.updateData=function(e,t,r,i,n,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var o=this._context.gl,s=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||r<0||i>s.width||n>s.height||t+i>s.width||r+n>s.height)&&console.error("An attempt to update out of bounds of the texture!"),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(console.assert(a.width===i&&a.height===n),o.texSubImage2D(o.TEXTURE_2D,e,t,r,s.pixelFormat,s.dataType,a)):o.texSubImage2D(o.TEXTURE_2D,e,t,r,i,n,s.pixelFormat,s.dataType,a),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!"),e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))},e._applySamplingMode=function(e,t){var r=t.samplingMode;9985===r||9987===r?r=9729:9984!==r&&9986!==r||(r=9728),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.samplingMode)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var i=e.gl;i.texParameterf(i.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1561:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,i))||(e.exports=n)},1562:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(1612),r(1560)],void 0===(n=function(e,t,r,i,n){return function(){function e(t,a,o,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:a.colorTarget,depthStencilTarget:a.depthStencilTarget,width:a.width,height:a.height,multisampled:a.multisampled},this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(4),o){var l=void 0;o instanceof n?(this._colorAttachment=o,l=o.descriptor):(l=o,this._colorAttachment=new n(this._context,l)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),e._validateTextureDimensions(l,this._desc)}if(s instanceof i)2===a.depthStencilTarget?this._stencilAttachment=s:1===a.depthStencilTarget||3===a.depthStencilTarget?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var h=void 0;s instanceof n?(this._depthStencilTexture=s,h=this._depthStencilTexture.descriptor):(h=s,this._depthStencilTexture=new n(this._context,h)),e._validateTextureDimensions(h,this._desc)}}return e.create=function(t,r){return new e(t,r)},e.createWithAttachments=function(t,r,i,n){return new e(t,i,r,n)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof n?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(4),this._context=null)},e.prototype.attachColorTexture=function(t){if(t){var r=t.descriptor;if(e._validateTextureDimensions(r,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){var e=void 0;if(this._colorAttachment instanceof n){if(e=this._colorAttachment,this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}this._colorAttachment=null}return e},e.prototype.attachDepthStencilTexture=function(t){if(t){var r=t.descriptor;if(34041!==r.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==r.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),e._validateTextureDimensions(r,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var r=t.descriptor;if(34041!==r.internalFormat&&33189!==r.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),e._validateBufferDimensions(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===r.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl,n=1===this._desc.depthStencilTarget?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(i.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,r,i,n,a,o){(e<0||t<0||n<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");var s=this._desc,l=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>s.width||t+i>s.height||n+r>l.width||a+i>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");var h=this._context;h.bindTexture(o),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(3553,0,n,a,e,t,r,i)},e.prototype.readPixels=function(e,t,r,i,n,a,o){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,a,o)},e.prototype.resize=function(t,r){var i=this._desc;if(i.width!==t||i.height!==r){if(!this._initialized){if(i.width=t,i.height=r,this._colorAttachment instanceof n)(a=this._colorAttachment).resize(t,r);return void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r))}var a,o;if(i.width=t,i.height=r,this._colorAttachment instanceof n)(o=(a=this._colorAttachment).descriptor).width=t,o.height=r,this._colorAttachment.dispose(),this._colorAttachment=new n(this._context,o),e._validateTextureDimensions(a.descriptor,this._desc);else this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)(o=this._depthStencilTexture.descriptor).width=t,o.height=r,this._depthStencilTexture.dispose(),this._depthStencilTexture=new n(this._context,o);else(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments();this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),r=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===r.colorTarget){var a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._colorAttachment=new n(this._context,a)}else{var o=new i(this._context,{internalFormat:32854,width:r.width,height:r.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,o.glName),this._colorAttachment=o}if(this._colorAttachment instanceof n){var s=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glName,0)}switch(r.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new i(this._context,{internalFormat:1===r.depthStencilTarget?33189:34041,width:r.width,height:r.height}));var l=1===r.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new i(this._context,{internalFormat:36168,width:r.width,height:r.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var h={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._depthStencilTexture=new n(this._context,h)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof n){var e=this._colorAttachment;if(this._initialized)this._context.bindFramebuffer(this),(r=this._context.gl).framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0);e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1570:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1664),r(1572),r(1626),r(1577),r(1559),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(t,r,i){this.singleUse=!1,this._boundingInfo=null,this._componentAABB=null,this.id=e.__idGen.gen(r),this._data=t,this._boundingInfo=i}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return i.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var r=0;r<6;r++)t[r]=this._componentAABB[6*e+r];return t},e.prototype._computeComponentAABB=function(){for(var e=this.componentCount,t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var i=this.data.getIndices(s.VertexAttrConstants.POSITION),n=this.data.getAttribute(s.VertexAttrConstants.POSITION),a=this.data.componentOffsets,o=a.length?a[e]:0,l=a.length?a[e+1]:i.length,h=1/0,c=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0,g=n.offsetIdx,m=n.strideIdx,v=o;v<l;v++){var _=g+m*i[v],y=n.data[_],b=n.data[_+1],x=n.data[_+2];h=Math.min(h,y),c=Math.min(c,b),u=Math.min(u,x),d=Math.max(d,y),p=Math.max(p,b),f=Math.max(f,x)}return t?(t[r]=h,t[r+1]=c,t[r+2]=u,t[r+3]=d,t[r+4]=p,t[r+5]=f):t=[h,c,u,d,p,f],t},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var a=0;a<i;++a)e[a]=a}var l=e.length;o.assert(l%i==0);var h=n.generateDefaultIndexArray(l/i);return new r(h,i,e,t)},e.__idGen=new a,e}()}.apply(null,i))||(e.exports=n)},1575:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1586),r(1597),r(1608),r(1662)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(e,t,i,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new a,this.view=new o(t,this,this.model.getDirtySet(),i),this.view.setLighting({lights:[new n.MainLight(r.vec3f64.fromValues(.7,.7,.7)),new n.AmbientLight(r.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return"function"==typeof r.removeParentStage&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,i){this.model.notifyDirty(e,t,r,i)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var i=t.commitLayers(this._viewContent);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+i[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+i[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),i=t.commitLayers([e]);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(i.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var i=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(i,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,i=[],n=0;n<e.length;n++){var a=r.indexOf(e[n]);a>-1&&(r[a]=r[r.length-1],r.pop(),i.push(e[n]))}var o=t.getResidentRenderGeometriesFilteredByLayers(i);this.view.modify([],o,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"intersect"in t&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return"intersect"in e&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var i in r+="<table>",t)r+="<tr><td>"+i+'</td><td style="text-align: right">'+Math.round(t[i])+"</td></tr>";r+="</table>"}else for(var i in t)r+=i+": "+t[i]+"\n";return r},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=i,e}()}.apply(null,i))||(e.exports=n)},1576:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1572),r(1626),r(1559)],void 0===(n=function(e,t,r,i,n){function a(e){var t=n.getFirstObjectValue(e);return t.data.length/t.size}return function(){function e(t,n,o,s){void 0===n&&(n=e.DefaultIndices),void 0===o&&(o=e.DefaultOffsets),void 0===s&&(s="triangle"),this.preinterleaved=!1;var l={};for(var h in t){var c=t[h],u=c.data,d=c.size;l[h]={data:u,size:d,offsetIdx:0,strideIdx:d}}if(n===e.DefaultIndices){var p=a(l),f=i.generateDefaultIndexArray(p);for(var g in n={},l)n[g]=f}this._id=i.getNewId(),this._vertexAttributes=l,this._indices=n,this._componentOffsets=r.createOffsets(o),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return n.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices.position){var t=3;e+=this._indices.position.length*t*4}if(this._indices.normal){t=3;e+=this._indices.normal.length*t*4}if(this._indices.uv0){t=2;e+=this._indices.uv0.length*t*4}if(this._indices.color){t=1;e+=this._indices.color.length*t*4}return e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}()}.apply(null,i))||(e.exports=n)},1577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,i))||(e.exports=n)},1578:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1587),r(1564),r(1560),r(1567)],void 0===(n=function(e,t,r,i,n,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=i.Pos2);var a=null;switch(t){case i.Pos3Tex:a=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case i.Pos3:a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case i.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case i.Pos2:default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new o(e,r.Default3D,{geometry:t},{geometry:n.createVertex(e,35044,a)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var i=new Uint8Array(r*r*4),n=0;n<i.length;n+=4)i[n+0]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},i)}}.apply(null,i))||(e.exports=n)},1580:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,i))||(e.exports=n)},1581:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1572),r(1665),r(1610),r(1577),r(1586),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h){var c=h.assert,u=r.mat4f64.create(),d=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new p,this._bvWorldSpace=new p,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=r.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return e.prototype._initializeGeometryRecords=function(e,t,i,n){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);c(t.length===e.length,"Object3D: materials don't match geometries"),c(i.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var o=0;o<e.length;o++){this.geometryRecords[o]=new a(e[o],t[o],r.mat4f64.clone(i[o]),{},n&&n[o])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){c(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return c(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return c(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,i,n,o,s){void 0===i&&(i=u),this.geometries.push(e);var l=new a(e,t,r.mat4f64.clone(i),n||{},o,s);return this.geometryRecords.push(l),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this._notifyDirty("objGeometryAdded",l),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,l},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!n.isAllHidden(i,a)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!n.isAllVisible(i,a))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t];if(e=n.hasComponents(r.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var i=e.geometry,a=e.instanceParameters.componentVisibilities,o=i.data.componentOffsets,s=n.updateVisibility(a,o,t,r);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return n.getVisibility(r,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.hideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.unhideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,r,i){var a=e.instanceParameters.componentHighlights,o=n.addHighlight(a,t,r,i);e.instanceParameters.componentHighlights=o},e.prototype.setComponentHighlight=function(e,t,r){var i=o.generateHighlightId();return this._setComponentHighlight(e,t,r,i),this._notifyDirty("componentHighlightChanged"),i},e.prototype.highlightAllComponents=function(e){for(var t=o.generateHighlightId(),r=0,i=this.geometryRecords;r<i.length;r++){var n=i[r];this._setComponentHighlight(n,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var i=r[t].instanceParameters,a=i.componentHighlights,o=n.removeHighlight(a,e);i.componentHighlights=o}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.data.componentOffsets;return n.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var i=this.geometryRecords[e],n=new a(i.geometry,i.material,r.mat4f64.clone(t),i.instanceParameters);this.geometryRecords[e]=n,this._notifyDirty("objGeometryReplaced",[i,n]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return r.mat4f64.clone(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){r.mat4.copy(this.objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||r.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getStaticTransformation()),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||r.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],n=this.geometryRecords[e],a=t.boundingInfo;this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}r.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),r.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var o=r.vec3f64.create(),s=r.vec3f64.create(),l=i.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var h=this.geometryRecords[e].getShaderTransformation(),c=i.maxScale(h);a=t.boundingInfo;r.vec3.transformMat4(o,a.getCenter(),h);var u=r.vec3.distance(o,this._bvObjectSpace.center),d=a.getBSRadius()*c;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,u+d),r.vec3.transformMat4(s,o,this.objectTransformation);var p=r.vec3.distance(s,this._bvWorldSpace.center),f=d*l;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+f)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,i){var n=e.getBBMin(),a=e.getBBMax(),o=r.vec3f64.clone(n),s=r.vec3f64.clone(a);r.vec3.transformMat4(o,o,i),r.vec3.transformMat4(s,s,i);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],o[l],s[l]),t.bbMax[l]=Math.max(t.bbMax[l],o[l],s[l]);for(l=0;l<3;++l){r.vec3.copy(o,n),r.vec3.copy(s,a),o[l]=a[l],s[l]=n[l],r.vec3.transformMat4(o,o,i),r.vec3.transformMat4(s,s,i);for(var h=0;h<3;++h)t.bbMin[h]=Math.min(t.bbMin[h],o[h],s[h]),t.bbMax[h]=Math.max(t.bbMax[h],o[h],s[h])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,i){if(this._parentLayer){r=r||l.OBJECT;var n=i||this;this._parentLayer.notifyDirty(e,t,r,n)}},e._idGen=new s,e}(),p=function(){function e(){this.bbMin=r.vec3f64.create(),this.bbMax=r.vec3f64.create(),this.center=r.vec3f64.create(),this.bsRadius=0}return e.prototype.init=function(){r.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.vec3.set(this.center,0,0,0),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return d}.apply(null,i))||(e.exports=n)},1586:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,i))||(e.exports=n)},1587:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,i))||(e.exports=n)},1589:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(1)],void 0===(n=function(e,t,r,i,n,a){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t}return r(t,e),i([a.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),i([a.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),i([a.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),i([a.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),i([a.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),i([a.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),i([a.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),i([a.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),i([a.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),i([a.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),i([a.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),i([a.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),i([a.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),i([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),i([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),i([a.subclass()],t)}(a.declared(n)))}.apply(null,i))||(e.exports=n)},1591:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577),r(1586)],void 0===(n=function(e,t,r,i){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(i.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},1592:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(19),r(38),r(1590),r(1611),r(1591),r(1559),r(1595),r(1568),r(1568),r(1719)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d){function p(e,t,r){!function(e,t){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}(t)?e.setFaceCullingEnabled(!1):(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029))}function f(e){e.setFaceCullingEnabled(!1)}function g(e,t,r){return e?t?6:9:r?2:4}function m(e,t){var r=t.vvSizeEnabled;if(t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r){e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor);var i=t.vvSymbolRotation[2]||0,a=t.vvSymbolRotation[0]||0,o=t.vvSymbolRotation[1]||0;n.mat4.identity(M),0!==i&&n.mat4.rotateZ(M,M,-i/180*Math.PI),0!==a&&n.mat4.rotateX(M,M,a/180*Math.PI),0!==o&&n.mat4.rotateY(M,M,o/180*Math.PI),e.setUniformMatrix3fv("vvSymbolRotation",n.mat3.fromMat4(P,M))}t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}var v=l.assert,_=1,y=function(e){function t(r,i){var n=e.call(this,i)||this;return n.supportsEdges=!0,n.params=u.copyParameters(r,R),n.instanced=!!r.instanced,n.vertexBufferLayout=t.getVertexBufferLayout(n.params),n.instanceBufferLayout=n.instanced?t.getInstanceBufferLayout(n.params):null,n.bufferWriter=new E(n.vertexBufferLayout,n.instanceBufferLayout),n}return r(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,i=t.vertexColors,n=t.symbolColors,a=!!r&&r.indexOf("color")>-1,o=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,h=t.externalColor&&t.externalColor[3]>0;return i&&(a||o||n)?!!s||l:i?s?h:l:a||o||n?!!s||l:s?h:l},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return u.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&v(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&v(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,a,o,s,l){if(null!==this.params.verticalOffset){var h=i.camera;n.vec3.set(V,r[12],r[13],r[14]);var c=n.vec3.subtract(L,V,h.eye),d=n.vec3.length(c),p=n.vec3.scale(c,c,1/d),f=null,g=null;switch(i.viewingMode){case"global":g=n.vec3.normalize(F,V);break;case"local":g=n.vec3.copy(F,I)}this.params.screenSizePerspective&&(f=n.vec3.dot(g,p));var m=u.verticalOffsetAtDistance(h,d,this.params.verticalOffset,f,this.params.screenSizePerspective);n.vec3.scale(g,g,m),n.vec3.transformMat3(B,g,i.transformInverseRotation),a=n.vec3.subtract(C,a,B),o=n.vec3.subtract(D,o,B)}u.intersectTriangleGeometry(e,t,r,i,a,o,s)},t.prototype.getGLMaterials=function(){return{color:b,depthShadowMap:this.params.castShadows?T:null,normal:w,depth:x,highlight:S}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=a.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),t},t.getInstanceBufferLayout=function(e){var t=a.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(s),b=function(e){function t(t,r,i){var n=this,a=t.getParams();(n=e.call(this,t,r,i,a.textureId,a.textureInitTransparent)||this).params=u.copyParameters(a);var o=n.params;n.slot=g(o.transparent,o.writeDepth,o.writeStencil),n.texturing=o.textureId?o.atlasRegions?"AtlasTextured":"Textured":"none";var s=o.instanced;return n.instanced=!!s,n.instancedColor=!!s&&s.indexOf("color")>-1,n._createPrograms(),n}return r(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=c.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(d.colorPass,{treeRendering:!!t.treeRendering,viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,groundNormalShading:t.groundNormalShading,compressedNormals:t.compressedNormals,componentColor:null!=t.componentColorBuffer,textureAlphaTest:t.textureAlphaTest,alphaCoverageCorrection:A,iosSafariFix:O})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return c.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.slot=g(this.params.transparent,this.params.writeDepth,this.params.writeStencil),this.updateTexture(this.params.textureId),this._createPrograms()},t.prototype.bind=function(e,t){var r=this.params,i=this.program=c.BindParametersMap.lookup(this.programs,t);e.bindProgram(i),i.setUniform3fv("ambient",r.ambient),i.setUniform3fv("diffuse",r.diffuse),i.setUniform3fv("specular",r.specular),i.setUniform4fv("externalColor",r.externalColor),i.setUniform1i("colorMixMode",u.colorMixModes[r.colorMixMode]),i.setUniform1f("opacity",r.opacity),i.setUniform1f("layerOpacity",r.layerOpacity),u.bindVerticalOffset(r.verticalOffset,t,i),u.bindScreenSizePerspective(r.screenSizePerspective,t,i),m(i,r),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(770,771,1,771),r.inverseWindingOrder&&e.setFrontFace(2304),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(1,1),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(770,771,1,771)):e.setBlendingEnabled(!1),e.setDepthWriteEnabled(r.writeDepth),r.textureAlphaTest&&i.setUniform1f("textureAlphaCutoff",r.textureAlphaCutoff),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),p(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:_}))},t.prototype.release=function(e,t){e.setPolygonOffsetFillEnabled(!1),f(e),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthWriteEnabled(!0),e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program=c.BindParametersMap.lookup(this.programs,t),i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;u.bindView(a,t.view,r),u.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&u.bindViewOriginDouble(a,r),i.slicePlaneEnabled&&u.bindSlicePlane(a,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,a)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),x=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=u.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.biased=n,a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:A,iosSafariFix:O})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(2304),u.bindVerticalOffset(i.verticalOffset,t,r),u.bindScreenSizePerspective(i.screenSizePerspective,t,r),m(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),this.bindTexture(e,r),p(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;u.bindView(a,t.view,r),i.slicePlaneEnabled&&u.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&u.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&u.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(o),T=function(e){function t(t,r,i){return e.call(this,t,r,i,!0)||this}return r(t,e),t}(x),w=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=u.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:A,iosSafariFix:O})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),u.bindVerticalOffset(i.verticalOffset,t,r),u.bindScreenSizePerspective(i.screenSizePerspective,t,r),m(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),p(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;u.bindView(a,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.slicePlaneEnabled&&u.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&u.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&u.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),S=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=u.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:A,iosSafariFix:O})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),u.bindVerticalOffset(i.verticalOffset,t,r),u.bindScreenSizePerspective(i.screenSizePerspective,t,r),m(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),p(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2304)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;u.bindView(a,t.view,r),i.slicePlaneEnabled&&u.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&u.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&u.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),R={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,writeDepth:!0,textureAlphaTest:!0,textureAlphaCutoff:.1,polygonOffset:!1,atlasRegions:!1},E=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,i,n){h.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)},e}(),O=!!i("ios")&&!!i("safari"),A=!1,P=n.mat3f64.create(),M=n.mat4f64.create(),C=n.vec3f64.create(),D=n.vec3f64.create(),I=n.vec3f64.fromValues(0,0,1),F=n.vec3f64.create(),B=n.vec3f64.create(),V=n.vec3f64.create(),L=n.vec3f64.create();return y}.apply(null,i))||(e.exports=n)},1594:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1571),r(92),r(1559)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function l(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var h=function(){function e(e,t,n){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.create()),void 0===n&&(n=r.vec3f64.fromValues(0,0,1)),this._viewUp=r.vec3f64.create(),this._viewForward=r.vec3f64.create(),this._viewRight=r.vec3f64.create(),this._ray=i.ray.createWrapper(),this._viewport=r.vec4f64.fromValues(0,0,1,1),this._padding=r.vec4f64.create(),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4f64.create(),this._frustumDirty=!0,this._frustum=i.frustum.create(),this._fullViewport=null,this.relativeElevation=0,this._eye=r.vec3f64.clone(e),this._center=r.vec3f64.clone(t),this._up=r.vec3f64.clone(n),this._padding=r.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=r.vec3f64.create()),r.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){r.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=r.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),r.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(r.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;r.mat4.frustum(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){r.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return a.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return a.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return r.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4f64.create()),r.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),r.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return r.vec3.copy(this._eye,e._eye),r.vec3.copy(this._center,e._center),r.vec3.copy(this._up,e._up),r.vec4.copy(this._viewport,e._viewport),r.vec4.copy(this._padding,e._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(r.mat4.copy(this._viewMatrix,e._viewMatrix),r.vec3.copy(this._viewRight,e._viewRight),r.vec3.copy(this._viewUp,e._viewUp),r.vec3.copy(this._viewForward,e._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(r.mat4.copy(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumDirty?this._frustumDirty=!0:(i.frustum.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?r.mat4.copy(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4f64.clone(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?r.vec4.copy(this._fullViewport,e._fullViewport):this._fullViewport=r.vec4f64.clone(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return s(this._eye,e._eye)&&s(this._center,e._center)&&s(this._up,e._up)&&l(this._viewport,e._viewport)&&l(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,i){void 0===i&&(i=!1);var a,s=r.vec3.distance(this._eye,this._center)*(t||5e-4),l=s*s;return i?(n.directionFromTo(d,e._eye,e._center),n.directionFromTo(p,this._eye,this._center),a=1e-10):(r.vec3.copy(d,e._center),r.vec3.copy(p,this._center),a=l),r.vec3.squaredDistance(e._eye,this._eye)<l&&r.vec3.squaredDistance(d,p)<a&&Math.abs(e._fov-this._fov)<.001&&o(e._padding,this._padding)<.5&&o(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(r.vec3.distance(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,i){void 0===i&&(i=!1),e!==c&&r.vec3.copy(c,e),c[3]=1,i&&(t[2]=-c[2]),r.vec4.transformMat4(c,c,this.projectionMatrix),r.vec3.scale(c,c,1/Math.abs(c[3]));var a=this.fullViewport;return t[0]=n.lerp(0,a[0]+a[2],.5+.5*c[0]),t[1]=n.lerp(0,a[1]+a[3],.5+.5*c[1]),i||(t[2]=.5*(c[2]+1)),t},e.prototype.projectPoint=function(e,t){if(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,r.vec4.transformMat4(c,c,this.viewProjectionMatrix),0===c[3])return null;r.vec3.scale(c,c,1/Math.abs(c[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*c[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*c[1]),t[2]=.5*(c[2]+1),t},e.prototype.unprojectPoint=function(e,t){if(r.mat4.multiply(u,this.projectionMatrix,this.viewMatrix),!r.mat4.invert(u,u))return null;var i=this.fullViewport;return c[0]=2*(e[0]-i[0])/i[2]-1,c[1]=2*(e[1]-i[1])/i[3]-1,c[2]=2*e[2]-1,c[3]=1,r.vec4.transformMat4(c,c,u),0===c[3]?null:(t[0]=c[0]/c[3],t[1]=c[1]/c[3],t[2]=c[2]/c[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){r.vec3.subtract(d,this.center,this.eye);var e=r.vec3.length(this.center);e<1?(r.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(r.vec3.dot(d,this.center))>.9999*r.vec3.length(d)*e||(r.vec3.cross(this.up,d,this.center),r.vec3.cross(this.up,this.up,d),r.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){n.directionFromTo(d,this.eye,this.center),Math.abs(d[2])<=.9999&&(r.vec3.scale(d,d,d[2]),r.vec3.set(this.up,-d[0],-d[1],1-d[2]),r.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){s(e,t)||(r.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(i.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(r.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),r.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),r.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),r.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),c=r.vec4f64.create(),u=r.mat4f64.create(),d=r.vec3f64.create(),p=r.vec3f64.create();return h}.apply(null,i))||(e.exports=n)},1595:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1588),r(1559)],void 0===(n=function(e,t,r,i){function n(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var h=2*e[l];a[i]=t[h],a[i+1]=t[h+1],i+=o}else for(l=0;l<s;++l){h=2*e[l];for(var c=0;c<n;++c)a[i]=t[h],a[i+1]=t[h+1],i+=o}}function a(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var h=3*e[l];a[i]=t[h],a[i+1]=t[h+1],a[i+2]=t[h+2],i+=o}else for(l=0;l<s;++l){h=3*e[l];for(var c=0;c<n;++c)a[i]=t[h],a[i+1]=t[h+1],a[i+2]=t[h+2],i+=o}}function o(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var h=4*e[l];a[i]=t[h],a[i+1]=t[h+1],a[i+2]=t[h+2],a[i+3]=t[h+3],i+=o}else for(l=0;l<s;++l){h=4*e[l];for(var c=0;c<n;++c)a[i]=t[h],a[i+1]=t[h+1],a[i+2]=t[h+2],a[i+3]=t[h+3],i+=o}}function s(e,t,r,i,n,o){if(r){var s=r,l=i.typedBuffer,h=i.typedBufferStride,c=e.length;if(n*=h,null==o||1===o)for(var u=0;u<c;++u){var d=t[g=3*e[u]],p=t[g+1],f=t[g+2];l[n]=s[0]*d+s[4]*p+s[8]*f+s[12],l[n+1]=s[1]*d+s[5]*p+s[9]*f+s[13],l[n+2]=s[2]*d+s[6]*p+s[10]*f+s[14],n+=h}else for(u=0;u<c;++u){d=t[g=3*e[u]],p=t[g+1],f=t[g+2];for(var g,m=s[0]*d+s[4]*p+s[8]*f+s[12],v=s[1]*d+s[5]*p+s[9]*f+s[13],_=s[2]*d+s[6]*p+s[10]*f+s[14],y=0;y<o;++y)l[n]=m,l[n+1]=v,l[n+2]=_,n+=h}}else a(e,t,i,n,o)}function l(e,t,r,i,n,o){if(r){var s=r,l=i.typedBuffer,h=i.typedBufferStride,c=e.length;if(n*=h,null==o||1===o)for(var u=0;u<c;++u){var d=t[g=3*e[u]],p=t[g+1],f=t[g+2];l[n]=s[0]*d+s[4]*p+s[8]*f,l[n+1]=s[1]*d+s[5]*p+s[9]*f,l[n+2]=s[2]*d+s[6]*p+s[10]*f,n+=h}else for(u=0;u<c;++u){d=t[g=3*e[u]],p=t[g+1],f=t[g+2];for(var g,m=s[0]*d+s[4]*p+s[8]*f,v=s[1]*d+s[5]*p+s[9]*f,_=s[2]*d+s[6]*p+s[10]*f,y=0;y<o;++y)l[n]=m,l[n+1]=v,l[n+2]=_,n+=h}}else a(e,t,i,n,o)}function h(e,t,r,i,n,a){var o=i.typedBuffer,s=i.typedBufferStride,l=e.length;if(n*=s,null==a||1===a){if(4===r)for(var h=0;h<l;++h){var c=4*e[h];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=s}else if(3===r)for(h=0;h<l;++h){c=3*e[h];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=255,n+=s}}else if(4===r)for(h=0;h<l;++h){c=4*e[h];for(var u=0;u<a;++u)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=s}else if(3===r)for(h=0;h<l;++h)for(c=3*e[h],u=0;u<a;++u)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=255,n+=s}function c(e,t,r,i,n,a,o){var s=n.typedBuffer,l=n.typedBufferStride,h=e.length;if(a*=l,null==o||1===o){if(4===r)for(var c=0;c<h;++c){var u=4*e[c];s[a]=t[u]*i[0],s[a+1]=t[u+1]*i[1],s[a+2]=t[u+2]*i[2],s[a+3]=t[u+3]*i[3],a+=l}else if(3===r){var d=255*i[3];for(c=0;c<h;++c){u=3*e[c];s[a]=t[u]*i[0],s[a+1]=t[u+1]*i[1],s[a+2]=t[u+2]*i[2],s[a+3]=d,a+=l}}}else if(4===r)for(c=0;c<h;++c){u=4*e[c];for(var p=0;p<o;++p)s[a]=t[u]*i[0],s[a+1]=t[u+1]*i[1],s[a+2]=t[u+2]*i[2],s[a+3]=t[u+3]*i[3],a+=l}else if(3===r)for(d=255*i[3],c=0;c<h;++c)for(u=3*e[c],p=0;p<o;++p)s[a]=t[u]*i[0],s[a+1]=t[u+1]*i[1],s[a+2]=t[u+2]*i[2],s[a+3]=d,a+=l}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=n,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writePosition=s,t.writeNormal=l,t.writeColor=h,t.writeMultipliedColor=c,t.writeDefaultAttributes=function(e,t,a,u,d,p,f){for(var g=0,m=a.fieldNames;g<m.length;g++){var v=m[g],_=e.vertexAttr[v],y=e.indices[v];if(_&&y)switch(v){case i.VertexAttrConstants.POSITION:i.assert(3===_.size);var b=p.getField(v,r.BufferViewVec3f);b&&s(y,_.data,u,b,f);break;case i.VertexAttrConstants.NORMAL:i.assert(3===_.size);var x=p.getField(v,r.BufferViewVec3f);x&&l(y,_.data,d,x,f);break;case i.VertexAttrConstants.UV0:i.assert(2===_.size);var T=p.getField(v,r.BufferViewVec2f);T&&n(y,_.data,T,f);break;case i.VertexAttrConstants.REGION:i.assert(4===_.size);var w=p.getField(v,r.BufferViewVec4u16);w&&o(y,_.data,w,f);break;case i.VertexAttrConstants.COLOR:i.assert(3===_.size||4===_.size);var S=p.getField(v,r.BufferViewVec4u8);S&&(t&&t.color?c(y,_.data,_.size,t.color,S,f):h(y,_.data,_.size,S,f));break;case i.VertexAttrConstants.SYMBOLCOLOR:i.assert(3===_.size||4===_.size);var R=p.getField(v,r.BufferViewVec4u8);R&&h(y,_.data,_.size,R,f)}}}}.apply(null,i))||(e.exports=n)},1596:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1571),r(523),r(1576),r(1559)],void 0===(n=function(e,t,r,i,n,a,o){var s,l,h,c,u=n.Vec3Compact;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],s=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=new Array(36),h=0;h<6;h++)for(var c=0;c<6;c++)l[6*h+c]=h;var u=new Array(36);for(h=0;h<6;h++)u[6*h+0]=0,u[6*h+1]=1,u[6*h+2]=2,u[6*h+3]=2,u[6*h+4]=3,u[6*h+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),h=0;h<8;h++)t[3*h]=r[h][0]*e[0],t[3*h+1]=r[h][1]*e[1],t[3*h+2]=r[h][2]*e[2];var c={};c[o.VertexAttrConstants.POSITION]=new Uint32Array(s),c[o.VertexAttrConstants.NORMAL]=new Uint32Array(l),c[o.VertexAttrConstants.UV0]=new Uint32Array(u);var d={};return d[o.VertexAttrConstants.POSITION]={size:3,data:t},d[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},d[o.VertexAttrConstants.UV0]={size:2,data:new Float32Array(n)},new a(d,c)}}(s||(s={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],s=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];(l||(l={})).createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),l=0;l<6;l++)t[3*l]=r[l][0]*e[0],t[3*l+1]=r[l][1]*e[1],t[3*l+2]=r[l][2]*e[2];var h={};h[o.VertexAttrConstants.POSITION]=new Uint32Array(n),h[o.VertexAttrConstants.NORMAL]=new Uint32Array(s);var c={};return c[o.VertexAttrConstants.POSITION]={size:3,data:t},c[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},new a(c,h)}}(),function(e){var t=r.vec3f32.fromValues(-.5,0,-.5),i=r.vec3f32.fromValues(.5,0,-.5),n=r.vec3f32.fromValues(0,0,.5),s=r.vec3f32.fromValues(0,.5,0),l=r.vec3f32.create(),h=r.vec3f32.create(),c=r.vec3f32.create(),u=r.vec3f32.create(),d=r.vec3f32.create();r.vec3.subtract(l,t,s),r.vec3.subtract(h,t,i),r.vec3.cross(c,l,h),r.vec3.normalize(c,c),r.vec3.subtract(l,i,s),r.vec3.subtract(h,i,n),r.vec3.cross(u,l,h),r.vec3.normalize(u,u),r.vec3.subtract(l,n,s),r.vec3.subtract(h,n,t),r.vec3.cross(d,l,h),r.vec3.normalize(d,d);var p=[t,i,n,s],f=[0,-1,0,c[0],c[1],c[2],u[0],u[1],u[2],d[0],d[1],d[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),r=0;r<4;r++)t[3*r]=p[r][0]*e[0],t[3*r+1]=p[r][1]*e[1],t[3*r+2]=p[r][2]*e[2];var i={};i[o.VertexAttrConstants.POSITION]=new Uint32Array(g),i[o.VertexAttrConstants.NORMAL]=new Uint32Array(m);var n={};return n[o.VertexAttrConstants.POSITION]={size:3,data:t},n[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(f)},new a(n,i)}}(h||(h={})),function(e){function t(e,t,i,n,a){return!(Math.abs(r.vec3.dot(t,e))>a||(r.vec3.cross(i,e,t),r.vec3.normalize(i,i),r.vec3.cross(n,i,e),r.vec3.normalize(n,n),0))}function c(e,r,i,n,a,o,s){return t(e,r,a,o,s)||t(e,i,a,o,s)||t(e,n,a,o,s)}e.createBoxGeometry=s.createGeometry,e.createDiamondGeometry=l.createGeometry,e.createTetrahedronGeometry=h.createGeometry,e.createSphereGeometry=function(e,t,r,i,n,s,l){e=e||50,i=void 0!==i?i:-Math.PI,n=void 0!==n?n:2*Math.PI,s=void 0!==s?s:.5*-Math.PI,l=void 0!==l?l:Math.PI;for(var h=Math.max(3,Math.floor(t)||8),c=Math.max(2,Math.floor(r)||6),u=(h+1)*(c+1),d=new Float32Array(3*u),p=new Float32Array(3*u),f=new Float32Array(2*u),g=[],m=0,v=0;v<=c;v++){for(var _=[],y=v/c,b=s+y*l,x=Math.cos(b),T=0;T<=h;T++){var w=T/h,S=i+w*n,R=Math.cos(S)*x,E=Math.sin(b),O=-Math.sin(S)*x;d[3*m]=R*e,d[3*m+1]=E*e,d[3*m+2]=O*e,p[3*m]=R,p[3*m+1]=E,p[3*m+2]=O,f[2*m]=w,f[2*m+1]=y,_.push(m),++m}g.push(_)}var A=new Uint32Array(2*h*(c-1)*3);for(m=0,v=0;v<c;v++)for(T=0;T<h;T++){var P=g[v][T],M=g[v][T+1],C=g[v+1][T+1],D=g[v+1][T];0===v?(A[m++]=P,A[m++]=C,A[m++]=D):v===c-1?(A[m++]=P,A[m++]=M,A[m++]=C):(A[m++]=P,A[m++]=M,A[m++]=C,A[m++]=C,A[m++]=D,A[m++]=P)}o.assert(m===A.length);var I={};I[o.VertexAttrConstants.POSITION]=A,I[o.VertexAttrConstants.NORMAL]=A,I[o.VertexAttrConstants.UV0]=A;var F={};return F[o.VertexAttrConstants.POSITION]={size:3,data:d},F[o.VertexAttrConstants.NORMAL]={size:3,data:p},F[o.VertexAttrConstants.UV0]={size:2,data:f},new a(F,I)},e.createPolySphereGeometry=function(e,t,r){function i(t,r){var i;t>r&&(t=(i=[r,t])[0],r=i[1]);var a=t.toString()+"."+r.toString();if(d[a])return d[a];var o=n.length;return n.length+=3,u.add(n,3*t,n,3*r,n,o),u.scale(n,o,e/u.length(n,o)),o/=3,d[a]=o,o}var n,s,l=e;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var h=l*(1+Math.sqrt(5))/2;n=[-l,h,0,l,h,0,-l,-h,0,l,-h,0,0,-l,h,0,l,h,0,-l,-h,0,l,-h,h,0,-l,h,0,l,-h,0,-l,-h,0,l],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<n.length;c+=3)u.scale(n,c,e/u.length(n,c));var d={};for(c=0;c<t;c++){for(var p=s.length,f=new Uint32Array(4*p),g=0;g<p;g+=3){var m=s[g],v=s[g+1],_=s[g+2],y=i(m,v),b=i(v,_),x=i(_,m),T=4*g;f[T]=m,f[T+1]=y,f[T+2]=x,f[T+3]=v,f[T+4]=b,f[T+5]=y,f[T+6]=_,f[T+7]=x,f[T+8]=b,f[T+9]=y,f[T+10]=b,f[T+11]=x}s=f,d={}}var w=new Float32Array(n);for(c=0;c<w.length;c+=3)u.normalize(w,c);var S={};S[o.VertexAttrConstants.POSITION]=s,S[o.VertexAttrConstants.NORMAL]=s;var R={};return R[o.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(n)},R[o.VertexAttrConstants.NORMAL]={size:3,data:w},new a(R,S)},e.createPointGeometry=function(e,t,r,i,n,s,l){var h=t?new Float32Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),c=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),u=s?new Float32Array(s):new Float32Array([0,0]),d=r?new Uint8Array([255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]):new Uint8Array([255,255,255,255]),p=null!=i&&2===i.length?new Float32Array(i):new Float32Array([1,1]),f=new Uint32Array([0]),g={};g[o.VertexAttrConstants.POSITION]=f,g[o.VertexAttrConstants.NORMAL]=f,g[o.VertexAttrConstants.UV0]=f,g[o.VertexAttrConstants.COLOR]=f,g[o.VertexAttrConstants.SIZE]=f;var m={};if(m[o.VertexAttrConstants.POSITION]={size:3,data:h},m[o.VertexAttrConstants.NORMAL]={size:3,data:c},m[o.VertexAttrConstants.UV0]={size:u.length,data:u},m[o.VertexAttrConstants.COLOR]={size:4,data:d},m[o.VertexAttrConstants.SIZE]={size:2,data:p},null!=n){var v=new Float32Array([n[0],n[1],n[2],n[3]]);g[o.VertexAttrConstants.AUXPOS1]=f,m[o.VertexAttrConstants.AUXPOS1]={size:4,data:v}}if(null!=l){var _=new Float32Array([l[0],l[1],l[2],l[3]]);g[o.VertexAttrConstants.AUXPOS2]=f,m[o.VertexAttrConstants.AUXPOS2]={size:4,data:_}}return new a(m,g,a.DefaultOffsets,"point")},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),s=new Uint32Array(e.length),l=0;l<e.length;l++)r[3*l]=e[l][0],r[3*l+1]=e[l][1],r[3*l+2]=e[l][2],t&&(i[3*l]=t[l][0],i[3*l+1]=t[l][1],i[3*l+2]=t[l][2]),n[l]=l,s[l]=0;t||(i[0]=0,i[1]=1,i[2]=0);var h=new Float32Array(2);h[0]=0,h[1]=0;var c={};c[o.VertexAttrConstants.POSITION]=n,c[o.VertexAttrConstants.NORMAL]=t?n:s,c[o.VertexAttrConstants.UV0]=s;var u={};return u[o.VertexAttrConstants.POSITION]={size:3,data:r},u[o.VertexAttrConstants.NORMAL]={size:3,data:i},u[o.VertexAttrConstants.UV0]={size:2,data:h},new a(u,c,a.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),r=new Float32Array([0,1,0]),i=new Uint32Array([0,0,0]),n=new Float32Array([0,0]),s=new Uint32Array([0,0,0]),l={};l[o.VertexAttrConstants.POSITION]=t,l[o.VertexAttrConstants.NORMAL]=i,l[o.VertexAttrConstants.UV0]=s;var h={};return h[o.VertexAttrConstants.POSITION]={size:3,data:e},h[o.VertexAttrConstants.NORMAL]={size:3,data:r},h[o.VertexAttrConstants.UV0]={size:2,data:n},new a(h,l)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var r=0;r<4;r++)for(var i=0;i<3;i++)t[3*r+i]=e[r][i];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var n=new Uint32Array([0,1,2,2,3,0]),s=new Float32Array([0,0,1]),l=new Uint32Array([0,0,0,0,0,0]),h=new Float32Array([0,0,1,0,1,1,0,1]),c=new Uint8Array([255,255,255,255]),u={};u[o.VertexAttrConstants.POSITION]=n,u[o.VertexAttrConstants.NORMAL]=l,u[o.VertexAttrConstants.UV0]=n,u[o.VertexAttrConstants.COLOR]=l;var d={};return d[o.VertexAttrConstants.POSITION]={size:3,data:t},d[o.VertexAttrConstants.NORMAL]={size:3,data:s},d[o.VertexAttrConstants.UV0]={size:2,data:h},d[o.VertexAttrConstants.COLOR]={size:4,data:c},new a(d,u)},e.createConeGeometry=function(e,t,i,n,s,l){void 0===s&&(s=!0),void 0===l&&(l=!0);var h=0,c=t,u=e,d=r.vec3f32.fromValues(0,h,0),p=r.vec3f32.fromValues(0,h+u,0),f=r.vec3f32.fromValues(0,-1,0),g=r.vec3f32.fromValues(0,1,0);n&&(h=u,p=r.vec3f32.fromValues(0,0,0),d=r.vec3f32.fromValues(0,h,0),f=r.vec3f32.fromValues(0,1,0),g=r.vec3f32.fromValues(0,-1,0));var m=[p,d],v=[f,g],_=i+2,y=Math.sqrt(u*u+c*c);if(n)for(var b=i-1;b>=0;b--){var x=b*(2*Math.PI/i),T=r.vec3f32.fromValues(Math.cos(x)*c,h,Math.sin(x)*c);m.push(T);var w=r.vec3f32.fromValues(u*Math.cos(x)/y,-c/y,u*Math.sin(x)/y);v.push(w)}else for(b=0;b<i;b++)x=b*(2*Math.PI/i),T=r.vec3f32.fromValues(Math.cos(x)*c,h,Math.sin(x)*c),m.push(T),w=r.vec3f32.fromValues(u*Math.cos(x)/y,c/y,u*Math.sin(x)/y),v.push(w);var S=new Uint32Array(2*(i+2)*3),R=new Uint32Array(2*(i+2)*3),E=0,O=0;if(s){for(b=3;b<m.length;b++)S[E++]=1,S[E++]=b-1,S[E++]=b,R[O++]=0,R[O++]=0,R[O++]=0;S[E++]=m.length-1,S[E++]=2,S[E++]=1,R[O++]=0,R[O++]=0,R[O++]=0}if(l){for(b=3;b<m.length;b++)S[E++]=b,S[E++]=b-1,S[E++]=0,R[O++]=b,R[O++]=b-1,R[O++]=1;S[E++]=0,S[E++]=2,S[E++]=m.length-1,R[O++]=1,R[O++]=2,R[O++]=v.length-1}var A=new Float32Array(3*_);for(b=0;b<_;b++)A[3*b]=m[b][0],A[3*b+1]=m[b][1],A[3*b+2]=m[b][2];var P=new Float32Array(3*_);for(b=0;b<_;b++)P[3*b]=v[b][0],P[3*b+1]=v[b][1],P[3*b+2]=v[b][2];var M={};M[o.VertexAttrConstants.POSITION]=S,M[o.VertexAttrConstants.NORMAL]=R;var C={};return C[o.VertexAttrConstants.POSITION]={size:3,data:A},C[o.VertexAttrConstants.NORMAL]={size:3,data:P},new a(C,M)},e.createCylinderGeometry=function(e,t,i,n,s,l){var h=n?r.vec3f32.clone(n):r.vec3f32.fromValues(1,0,0),c=s?r.vec3f32.clone(s):r.vec3f32.fromValues(0,0,0),u=void 0===l||l,d=r.vec3f32.create();r.vec3.normalize(d,h);var p=r.vec3f32.create();r.vec3.scale(p,d,Math.abs(e));var f=r.vec3f32.create();r.vec3.scale(f,p,-.5),r.vec3.add(f,f,c);var g=r.vec3f32.fromValues(0,1,0);Math.abs(1-r.vec3.dot(d,g))<.2&&r.vec3.set(g,0,0,1);var m=r.vec3f32.create();r.vec3.cross(m,d,g),r.vec3.normalize(m,m),r.vec3.cross(g,m,d);var v=2*i+(u?2:0),_=i+(u?2:0),y=new Float32Array(3*v),b=new Float32Array(3*_),x=new Float32Array(2*v),T=new Uint32Array(3*i*(u?4:2)),w=new Uint32Array(3*i*(u?4:2));u&&(y[3*(v-2)+0]=f[0],y[3*(v-2)+1]=f[1],y[3*(v-2)+2]=f[2],x[2*(v-2)]=0,x[2*(v-2)+1]=0,y[3*(v-1)+0]=y[3*(v-2)+0]+p[0],y[3*(v-1)+1]=y[3*(v-2)+1]+p[1],y[3*(v-1)+2]=y[3*(v-2)+2]+p[2],x[2*(v-1)]=1,x[2*(v-1)+1]=1,b[3*(_-2)+0]=-d[0],b[3*(_-2)+1]=-d[1],b[3*(_-2)+2]=-d[2],b[3*(_-1)+0]=d[0],b[3*(_-1)+1]=d[1],b[3*(_-1)+2]=d[2]);for(var S=function(e,t,r){T[e]=t,w[e]=r},R=0,E=r.vec3f32.create(),O=r.vec3f32.create(),A=0;A<i;A++){var P=A*(2*Math.PI/i);r.vec3.scale(E,g,Math.sin(P)),r.vec3.scale(O,m,Math.cos(P)),r.vec3.add(E,E,O),b[3*A+0]=E[0],b[3*A+1]=E[1],b[3*A+2]=E[2],r.vec3.scale(E,E,t),r.vec3.add(E,E,f),y[3*A+0]=E[0],y[3*A+1]=E[1],y[3*A+2]=E[2],x[2*A+0]=A/i,x[2*A+1]=0,y[3*(A+i)+0]=y[3*A+0]+p[0],y[3*(A+i)+1]=y[3*A+1]+p[1],y[3*(A+i)+2]=y[3*A+2]+p[2],x[2*(A+i)+0]=A/i,x[2*A+1]=1;var M=(A+1)%i;S(R++,A,A),S(R++,A+i,A),S(R++,M,M),S(R++,M,M),S(R++,A+i,A),S(R++,M+i,M)}if(u){for(A=0;A<i;A++)M=(A+1)%i,S(R++,v-2,_-2),S(R++,A,_-2),S(R++,M,_-2);for(A=0;A<i;A++)M=(A+1)%i,S(R++,A+i,_-1),S(R++,v-1,_-1),S(R++,M+i,_-1)}var C={};C[o.VertexAttrConstants.POSITION]=T,C[o.VertexAttrConstants.NORMAL]=w,C[o.VertexAttrConstants.UV0]=T;var D={};return D[o.VertexAttrConstants.POSITION]={size:3,data:y},D[o.VertexAttrConstants.NORMAL]={size:3,data:b},D[o.VertexAttrConstants.UV0]={size:2,data:x},new a(D,C)},e.createTubeGeometry=function(t,r,i,n,a){i=i||10,n=null==n||n,o.assert(t.length>1);for(var s=[],l=[],h=0;h<i;h++){s.push([0,-h-1,-(h+1)%i-1]);var c=h/i*2*Math.PI;l.push([Math.cos(c)*r,Math.sin(c)*r])}return e.createPathExtrusionGeometry(l,t,[[0,0,0]],s,n,a)},e.createPathExtrusionGeometry=function(e,t,n,s,l,h){void 0===h&&(h=r.vec3f32.fromValues(0,0,0));var u=e.length,p=new Float32Array(t.length*u*3+(6*n.length||0)),f=new Float32Array(t.length*u+(2*n.length||0)),g=new Float32Array(t.length*u*3+(n?6:0)),m=(t.length-1)*u*6+3*s.length*2,v=new Uint32Array(m),_=new Uint32Array(m),y=0,b=0,x=0,T=0,w=0,S=r.vec3f32.create(),R=r.vec3f32.create(),E=r.vec3f32.create(),O=r.vec3f32.create(),A=r.vec3f32.create(),P=r.vec3f32.create(),M=r.vec3f32.create(),C=r.vec3f64.create(),D=r.vec3f32.create(),I=r.vec3f32.create(),F=r.vec3f32.create(),B=r.vec3f32.create(),V=r.vec3f32.create(),L=i.plane.create();r.vec3.set(D,0,1,0),r.vec3.subtract(R,t[1],t[0]),r.vec3.normalize(R,R),l?(r.vec3.add(C,t[0],h),r.vec3.normalize(E,C)):r.vec3.set(E,0,0,1),c(R,E,D,D,A,E,d),r.vec3.copy(O,E),r.vec3.copy(B,A);for(var N=0;N<n.length;N++)r.vec3.scale(P,A,n[N][0]),r.vec3.scale(C,E,n[N][2]),r.vec3.add(P,P,C),r.vec3.add(P,P,t[0]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2],f[x++]=0;for(g[b++]=-R[0],g[b++]=-R[1],g[b++]=-R[2],N=0;N<s.length;N++)v[T++]=s[N][0]>0?s[N][0]:-s[N][0]-1+n.length,v[T++]=s[N][1]>0?s[N][1]:-s[N][1]-1+n.length,v[T++]=s[N][2]>0?s[N][2]:-s[N][2]-1+n.length,_[w++]=0,_[w++]=0,_[w++]=0;for(var U=n.length,j=n.length-1,z=0;z<t.length;z++){var G=!1;z>0&&(r.vec3.copy(S,R),z<t.length-1?(r.vec3.subtract(R,t[z+1],t[z]),r.vec3.normalize(R,R)):G=!0,r.vec3.add(I,S,R),r.vec3.normalize(I,I),r.vec3.add(F,t[z-1],O),i.plane.fromPositionAndNormal(t[z],I,L),i.plane.intersectRay(L,i.ray.wrap(F,S),C)?(r.vec3.subtract(C,C,t[z]),r.vec3.normalize(E,C),r.vec3.cross(A,I,E),r.vec3.normalize(A,A)):c(I,O,B,D,A,E,d),r.vec3.copy(O,E),r.vec3.copy(B,A)),l&&(r.vec3.add(C,t[z],h),r.vec3.normalize(V,C));for(var H=0;H<u;H++)if(r.vec3.scale(P,A,e[H][0]),r.vec3.scale(C,E,e[H][1]),r.vec3.add(P,P,C),r.vec3.normalize(M,P),g[b++]=M[0],g[b++]=M[1],g[b++]=M[2],f[x++]=l?r.vec3.dot(P,V):P[2],r.vec3.add(P,P,t[z]),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2],!G){var k=(H+1)%u;v[T++]=U+H,v[T++]=U+u+H,v[T++]=U+k,v[T++]=U+k,v[T++]=U+u+H,v[T++]=U+u+k;for(var W=0;W<6;W++)_[w++]=v[T-6+W]-j}U+=u}var X=t[t.length-1];for(N=0;N<n.length;N++)r.vec3.scale(P,A,n[N][0]),r.vec3.scale(C,E,n[N][1]),r.vec3.add(P,P,C),r.vec3.add(P,P,X),p[y++]=P[0],p[y++]=P[1],p[y++]=P[2],f[x++]=0;var q=b/3;g[b++]=R[0],g[b++]=R[1],g[b++]=R[2];var Y=U-u;for(N=0;N<s.length;N++)v[T++]=s[N][0]>=0?U+s[N][0]:-s[N][0]-1+Y,v[T++]=s[N][2]>=0?U+s[N][2]:-s[N][2]-1+Y,v[T++]=s[N][1]>=0?U+s[N][1]:-s[N][1]-1+Y,_[w++]=q,_[w++]=q,_[w++]=q;var Q={};Q[o.VertexAttrConstants.POSITION]=v,Q[o.VertexAttrConstants.NORMAL]=_;var K={};return K[o.VertexAttrConstants.POSITION]={size:3,data:p},K.zOffset={size:1,data:f},K[o.VertexAttrConstants.NORMAL]={size:3,data:g},new a(K,Q)},e.createPolylineGeometry=function(e,t){o.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),o.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),o.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),o.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var r=new Float32Array(3*e.length),i=new Uint32Array(2*(e.length-1)),n=0,s=0,l=0;l<e.length;l++){for(var h=0;h<3;h++)r[n++]=e[l][h];l>0&&(i[s++]=l-1,i[s++]=l)}var c={},u={};if(c[o.VertexAttrConstants.POSITION]=i,u[o.VertexAttrConstants.POSITION]={size:3,data:r},t){var d=new Float32Array(3*t.length),p=0;for(l=0;l<e.length;l++)for(h=0;h<3;h++)d[p++]=t[l][h];c[o.VertexAttrConstants.NORMAL]=i,u[o.VertexAttrConstants.NORMAL]={size:3,data:d}}return new a(u,c,a.DefaultOffsets,"line")},e.addVertexColors=function(e,t){var r=t||[1,1,1,1],i=new Uint8Array(4);i[0]=255*r[0],i[1]=255*r[1],i[2]=255*r[2],i[3]=255*(r.length>3?r[3]:1);var n={},s=e.getVertexAttr();for(var l in s)n[l]=s[l];n[o.VertexAttrConstants.COLOR]={size:4,data:i};var h={};for(var l in e.indices)h[l]=e.indices[l];var c=h[o.VertexAttrConstants.POSITION].length;return h[o.VertexAttrConstants.COLOR]=new Uint32Array(c),new a(n,h,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),i=e.indices,a=n.Vec3Compact.subtract,s=i.position.length/3,l=new Float32Array(3*s),h=t.position.data,c=0,u=i.position,d=new Uint32Array(u.length),g=0;g<u.length;g+=3){a(h,3*u[g],h,3*u[g+2],f,0),a(h,3*u[g],h,3*u[g+1],p,0),r.vec3.cross(p,p,f),r.vec3.normalize(p,p);var m=c/3;l[c++]=p[0],l[c++]=p[1],l[c++]=p[2],d[g]=m,d[g+1]=m,d[g+2]=m}t[o.VertexAttrConstants.NORMAL]={size:3,data:l,offsetIdx:0,strideIdx:3},i[o.VertexAttrConstants.NORMAL]=d},e.cgToGIS=function(e,t){void 0===t&&(t=e);var r=e.getVertexAttr(),i=r.position.data,n=r.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(n)for(var l=0;l<n.length;l+=3){var h=n[l+1];s[l+1]=-n[l+2],s[l+2]=h}if(i)for(l=0;l<i.length;l+=3)h=i[l+1],o[l+1]=-i[l+2],o[l+2]=h;return t},e.makeOrthoBasisDirUp=t,e.makeOrthoBasisDirUpFallback=c}(c||(c={}));var d=.99619469809,p=r.vec3f32.create(),f=r.vec3f32.create();return c}.apply(null,i))||(e.exports=n)},1597:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,i){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),void 0===i&&(i=!0),this.intensity=e,this.direction=t,this.castShadows=i}}();t.MainLight=i;var n=function(){return function(e,t){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=r.vec3f64.create(),this.direction=r.vec3f64.create(),this.intensity=e,this.direction=t}}();t.FillLight=n;var a=function(){return function(e){void 0===e&&(e=r.vec3f64.create()),this.intensity=e}}();t.AmbientLight=a;var o=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=o}.apply(null,i))||(e.exports=n)},1598:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:i.resolveIncludes("misc/blendLayers.vert"),fragmentShader:i.resolveIncludes("misc/blendLayers.frag")},attributes:r.Default3D},t.simple={name:"simple",shaders:{vertexShader:i.resolveIncludes("misc/simple.vert"),fragmentShader:i.resolveIncludes("misc/simple.frag")},attributes:r.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:i.resolveIncludes("misc/texOnly.vert"),fragmentShader:i.resolveIncludes("misc/texOnly.frag")},attributes:r.Default3D},t.showDepth={name:"show-depth",shaders:{vertexShader:i.resolveIncludes("misc/showDepth.vert"),fragmentShader:i.resolveIncludes("misc/showDepth.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1600:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(38),r(1601),r(92),r(1583),r(1718),r(1587),r(1578),r(1577),r(1559),r(1598),r(1562),r(1560),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g){function m(e,t,r,i,o,s,l){l=!1!==l,n.requestImage(t).then(function(t){if(u.assert(t.width>=1&&t.height>=1),r.samplingMode=l?9987:9729,r.hasMipmap=l,!l&&33071===r.wrapMode||a.isPowerOfTwo(t.width)&&a.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var n=new f(e,r,t);e.bindTexture(n),s(n)}else{n=v(e,t,r,i,o);e.bindTexture(n),s(n)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;_.error("Failed to load image from uri",r,e),s(null)})}function v(e,t,r,n,o){var s=a.nextHighestPowerOfTwo(t.width),c=a.nextHighestPowerOfTwo(t.height);u.assert(s!==t.width||c!==t.height),r.width=s,r.height=c;var m=new f(e,r),v=p.createWithAttachments(e,m,{colorTarget:0,depthStencilTarget:0}),_=new f(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(v),void 0===o){var y=e.getViewport();o=[y.x,y.y,y.width,y.height]}e.setViewport(0,0,s,c);var b=n.getProgram(d.texOnly),x=i.mat4f64.create();e.bindProgram(b),b.setUniformMatrix4fv("model",x),b.setUniformMatrix4fv("view",x),b.setUniformMatrix4fv("proj",x),b.setUniform4f("color",1,1,1,1),b.setUniform1i("tex",0);var T=h.createQuadVAO(e,l.Pos3Tex);return e.bindTexture(_,0),e.bindVAO(T),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,g.vertexCount(T,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(o[0],o[1],o[2],o[3]),T.dispose(!0),_.dispose(),e.bindFramebuffer(null),v.detachColorTexture(),v.dispose(),r.hasMipmap&&m.generateMipmap(),m}var _=r.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function e(t,r,i){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=i||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:o.isArrayBuffer(e)||o.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4:(t.mipmap?4/3:1)*t.width*t.height*4||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,i,n,l){var h=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrap,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof h)m(t,h,r,i,n,l,this.params.mipmap);else if(h instanceof Image||h instanceof ImageData||h instanceof HTMLCanvasElement){this.params.width=h.width,this.params.height=h.height;var c=33071===this.params.wrap.s&&33071===this.params.wrap.t;if(!(this.params.mipmap||!c)||a.isPowerOfTwo(h.width)&&a.isPowerOfTwo(h.height)){r.width=h.width,r.height=h.height;var d=new f(t,r,h);t.bindTexture(d),l(d)}else{d=v(t,h,r,i,n);t.bindTexture(d),l(d)}}else if(o.isArrayBuffer(h)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,h,this.params.mipmap);t.bindTexture(d),l(d)}else if(o.isUint8Array(h)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,h.buffer,this.params.mipmap);t.bindTexture(d),l(d)}else if(o.isUint8Array(h)){u.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:6408,r.width=this.params.width,r.height=this.params.height;d=new f(t,r,h);t.bindTexture(d),l(d)}else{if(null!==h)throw console.warn("Unsupported image data"),new Error("Unsupported image data");d=new f(t,r,null);t.bindTexture(d),l(d)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrap:{s:33071,t:33071}})},e.idGen=new c,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,i))||(e.exports=n)},1601:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(21)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Blob([i],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,i))||(e.exports=n)},1604:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,i))||(e.exports=n)},1607:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92)],void 0===(n=function(e,t,r,i){return function(){function e(e,t,i,n,a,o,s,l,h,c,u){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=i,this.origin=null,this.center=r.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=a,n&&this.updateTransformation(n,o),this.castShadow=s,this.singleUse=l,this.name=h,this.uniqueName=c,this.idx=u,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||i.maxScale(e),r.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=r.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,i))||(e.exports=n)},1608:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(183),r(92),r(1636),r(1586),r(1661),r(1607),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var h=l.assert,c=l.logWithBase;return function(){function e(){for(var e in this.dirtySet=new o(this),this._uniqueIdx=0,this._id2origin={},this.content={},a)this.content[a[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return h(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];h(void 0!==r);var i=t.id;h(null==r[i],"Model/Stage already contains object to be added"),r[i]=t,e===a.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];h(void 0!==r);var i=r[t];return h(void 0!==i,"Model/Stage doesn't contain object to be removed"),delete r[t],e===a.TEXTURE&&i.unload(),e===a.LAYER&&this.notifyDirty(e,i,"layerRemoved"),i},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,i){this.dirtySet.handleUpdate(t,r,i)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var i=0,a=t*r/1e4;a>1&&(i=Math.ceil(c(a,2)));var o=1e4*Math.pow(2,i),s=Math.round(e[0]/o),l=Math.round(e[1]/o),h=Math.round(e[2]/o),u=i+"_"+s+"_"+l+"_"+h,d=this._id2origin[u];return null==d&&(d=n.fromValues(s*o,l*o,h*o,u),this._id2origin[u]=d),d},e.prototype.getGeometryRenderGeometries=function(e,t,r){var n=e.id,a=t.geometry,o=e.getCombinedStaticTransformation(t),l=i.maxScale(o),h=t.origin,c=t.id,u=this._uniqueIdx++,d=new s(a.data,a.boundingInfo,t.material,o,t.shaderTransformation,l,e.getCastShadow(),!!a.singleUse,n,c,u);d.origin=h||this.getOrigin(d.center,d.bsRadius),d.instanceParameters=t.instanceParameters,r.push(d)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var i in t[0]="<table>",a){var n=a[i];t[0]+="<tr><td>"+n+'</td><td style="text-align: right">'+Object.keys(this.getAll(n)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var i in t[0]="",a){n=a[i];t[0]+=r.pad(String(Object.keys(this.getAll(n)).length),6," ")+" "+n+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(a.OBJECT);for(var t in e)this.validateObject(e[t]);var r=this.getAll(a.LAYER);for(var i in r)this.validateLayer(r[i]);var n=this.getAll(a.MATERIAL);for(var o in n)this.validateMaterial(n[o])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var i=t[r];h(null!=this.get(a.GEOMETRY,i.geometry.id)),h(null!=this.get(a.MATERIAL,i.material.id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var i=this.get(a.OBJECT,t[r].id);h(null!=i)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),r=0;r<t.length;++r){var i=this.get(a.TEXTURE,t[r]);h(null!=i)}},e.ContentType=a,e}()}.apply(null,i))||(e.exports=n)},1609:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return{near:e,far:t}}function i(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?i(e,1/0,-1/0):r(1/0,-1/0)},t.set=i,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,i))||(e.exports=n)},1610:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r;t.generateHighlightId=function(){return i.gen("highlight")}}.apply(null,i))||(e.exports=n)},1611:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1604),r(1568)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r,i,a,o){void 0===o&&(o=!1);var s=e.call(this,t,r)||this;return s.textureRep=i,s.textureId=a,s.initTransparent=o,s.glTextureRef=n.aquireIfNotUndefined(s.textureId,i,s.initTransparent),s}return r(t,e),t.prototype.dispose=function(){n.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(n.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=n.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t}(i)}.apply(null,i))||(e.exports=n)},1612:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19)],void 0===(n=function(e,t,r){return function(){function e(t,i){this._context=t,this._desc=i,this._glName=null,this._id=-1;var n=this._context.gl;r("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5),this._id=++e._nextId,this._glName=n.createRenderbuffer(),this._context.bindRenderbuffer(this),n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var r=this._context.gl,i=this._desc;i.width===e&&i.height===t||(i.width=e,i.height=t,this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5),this._context=null},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1613:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(38),r(20),r(93),r(1570),r(1576),r(1630),r(1636),r(1581),r(1559),r(1632),r(1608)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p){var f=0,g="rg_",m=function(){function e(){if(this.ROOT_ORIGIN_ID=g+"root_"+f++,this._origins=new Map,this._gridSize=42e5,r.isSome(e.testOrigin)){var t=e.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,h.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID))}}return e.prototype.getOrigin=function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){var r=h.fromValues(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,r),r}i.vec3.subtract(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]);var n=this._gridSize;if(_[0]<n&&_[1]<n&&_[2]<n)return t;var a=Math.round(e[0]/n),o=Math.round(e[1]/n),s=Math.round(e[2]/n),l=""+g+a+"/"+o+"/"+s,c=this._origins.get(l);return c||(c=h.fromValues(a*n,o*n,s*n,l),this._origins.set(l,c)),c},e.prototype._drawOriginBox=function(e){var t=window.view,r=t._stage;if(null==this._object){this._material=new d({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),r.add(p.ContentType.MATERIAL,this._material);var i=new l("GridLocalOrigin",{isPickable:!1},"GridLocalOrigin");r.add(p.ContentType.LAYER,i),this._object=new c({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1}),r.add(p.ContentType.OBJECT,this._object),i.addObject(this._object),r.addToViewContent([i.id])}for(var h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],f=h.length,g=new Float32Array(3*f),m=new Uint32Array(2*(f-1)),_=.5*this._gridSize,y=0;y<f;y++)g[3*y+0]=e[0]+(1&h[y]?_:-_),g[3*y+1]=e[1]+(2&h[y]?_:-_),g[3*y+2]=e[2]+(4&h[y]?_:-_),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);a.bufferToBuffer(g,n.WebMercator,0,g,t.spatialReference,0,f);var b={};b[u.VertexAttrConstants.POSITION]={size:3,data:g};var x={};x[u.VertexAttrConstants.POSITION]=m;var T=new s(b,x,void 0,"line"),w=new o(T,"GridLocalOriginBox");r.add(p.ContentType.GEOMETRY,w),this._object.addGeometry(w,this._material,v),console.log(this._origins.size,e)},e}(),v=i.mat4f64.create(),_=i.vec3f64.create();return(m||(m={})).testOrigin=null,m}.apply(null,i))||(e.exports=n)},1614:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1655),r(1679),r(1680),r(1681),r(1682),r(1683),r(1684)],void 0===(n=function(e,t,r,i,n,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=i,t.mat4=n,t.scalar=a,t.vec2=o,t.vec3=s,t.vec4=l,t.createBuffer=function(e,t){return new e(new ArrayBuffer(t*e.ElementCount*r.elementTypeSize(e.ElementType)))}}.apply(null,i))||(e.exports=n)},1615:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(1696),r(72),r(1590),r(1572),r(1611),r(1591),r(1808),r(1559),r(1595),r(1568),r(1697)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f){function g(e,t){return void 0===t&&(t=T),e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):i.vec2.copy(t,e.anchorPos),t}var m={"bottom-left":i.vec2f64.fromValues(0,0),bottom:i.vec2f64.fromValues(.5,0),"bottom-right":i.vec2f64.fromValues(1,0),left:i.vec2f64.fromValues(0,.5),center:i.vec2f64.fromValues(.5,.5),right:i.vec2f64.fromValues(1,.5),"top-left":i.vec2f64.fromValues(0,1),top:i.vec2f64.fromValues(.5,1),"top-right":i.vec2f64.fromValues(1,1)},v=function(e){function t(t,r){var i=e.call(this,r)||this;return i._textureDirty=!1,i.params=p.copyParameters(t,B),"string"==typeof i.params.anchorPos&&(i.params.anchorPos=m[i.params.anchorPos]),i.bufferWriter=new L(i),i}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){return this.params},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&u.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.intersect=function(e,t,r,n,a,o,l,h){if(n.isSelection&&n.enableHUDSelection&&!s.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var d=e.data,p=this.params,f=1,m=1;if(i.mat3.fromMat4(A,r),h){var v=h(C);f=v[0],m=v[5],function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],h=e[8],c=1/Math.sqrt(t*t+r*r+i*i),u=1/Math.sqrt(n*n+a*a+o*o),d=1/Math.sqrt(s*s+l*l+h*h);e[0]=t*c,e[1]=r*c,e[2]=i*c,e[3]=n*u,e[4]=a*u,e[5]=o*u,e[6]=s*d,e[7]=l*d,e[8]=h*d}(A)}var _=d.getVertexAttr()[u.VertexAttrConstants.POSITION],y=d.getVertexAttr()[u.VertexAttrConstants.SIZE],b=d.getVertexAttr()[u.VertexAttrConstants.NORMAL];u.assert(_.size>=3);for(var T=n.point,E=n.camera,M=g(p),F=0;F<_.data.length/_.size;F++){var B=F*_.size;i.vec3.set(w,_.data[B],_.data[B+1],_.data[B+2]),i.vec3.transformMat4(w,w,r);var V=F*y.size;I[0]=y.data[V]*f,I[1]=y.data[V+1]*m,i.vec3.transformMat4(w,w,E.viewMatrix);var L=F*b.size;if(i.vec3.set(S,b.data[L],b.data[L+1],b.data[L+2]),this.applyVerticalOffsetTransformation(w,S,A,E,x),E.applyProjection(w,R),R[0]>-1){var N=Math.floor(R[0]),U=Math.floor(R[1]);c.applyPrecomputedScaleFactorVec2(I,x.factor,I);var j=N-D-(M[0]>0?I[0]*M[0]:0),z=j+I[0]+2*D,G=U-D-(M[1]>0?I[1]*M[1]:0),H=G+I[1]+2*D;if(p.textureIsSignedDistanceField){var k=p.outlineSize/2,W=p.distanceFieldBoundingBox;j+=I[0]*W[0],G+=I[1]*W[1],z-=I[0]*(1-W[2]),H-=I[1]*(1-W[3]),j-=k,z+=k,G-=k,H+=k}if(T[0]>j&&T[0]<z&&T[1]>G&&T[1]<H){var X=n.p0,q=n.p1;i.vec3.transformMat4(O,w,i.mat4.invert(P,E.viewMatrix)),R[0]=T[0],R[1]=T[1],E.unprojectPoint(R,w);var Y=i.vec3f64.create();i.vec3.subtract(Y,q,X);var Q=1/i.vec3.length(Y);i.vec3.scale(Y,Y,Q),l(i.vec3.distance(X,w)*Q,Y,-1,1,!0,O)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,n){return void 0===n&&(n=M),i.vec3.transformMat3(n.normal,e,t),i.vec3.transformMat4(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=i.vec3.dot(E,F),n},t.prototype.updateScaleInfo=function(e,t,r){var i=this.params;i.screenSizePerspective?e.factor=c.precomputeScaleFactor(M.cosAngle,r,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?(e.scaleAlignment=c.precomputeScale(M.cosAngle,r,i.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=i.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,a,o,s){var l=this.params;if(n.isMat4(r)&&(r=i.mat3.fromMat4(A,r)),!l.verticalOffset||!l.verticalOffset.screenLength){if(o&&(l.screenSizePerspective||l.screenSizePerspectiveAlignment)){var h=this.normalAndViewAngle(t,r,a),c=i.vec3.length(e);this.updateScaleInfo(o,h.cosAngle,c)}else o&&(o.factor.scale=1,o.scaleAlignment=1);return s?i.vec3.copy(s,e):e}var u=this.normalAndViewAngle(t,r,a),d=i.vec3.length(e),f=l.screenSizePerspectiveAlignment||l.screenSizePerspective,g=p.verticalOffsetAtDistance(a,d,l.verticalOffset,u.cosAngle,f);return o&&this.updateScaleInfo(o,u.cosAngle,d),i.vec3.add(s||e,e,i.vec3.scale(u.normal,u.normal,g))},t.prototype.getGLMaterials=function(){return{color:y,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:b}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=a.create()),function(e,t,r,n){void 0===n&&(n=T),i.vec2.copy(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return g(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(h),_=function(e){function t(t,r,i){var n=e.call(this,t,r,i,t.getParams().textureId)||this;return n.params=p.copyParameters(t.getParams()),n.selectProgram(),n.selectSlot(),n}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?20:19},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=p.copyParameters(this.material.getParameterValues()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,i=this.getProgram();this.bindTexture(e,i),i.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),i.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75);var n=t.pixelRatio||1;i.setUniform4fv("overrideColor",r.color),i.setUniform1f("pixelRatio",n),r.textureIsSignedDistanceField&&(i.setUniform4fv("outlineColor",r.outlineColor),i.setUniform1f("outlineSize",r.outlineSize*n)),r.vvSizeEnabled&&(i.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),i.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),i.setUniform3fv("vvSizeOffset",r.vvSizeOffset),i.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(i.setUniform1fv("vvColorValues",r.vvColorValues),i.setUniform4fv("vvColorColors",r.vvColorColors)),i.setUniform2fv("texScale",r.texCoordScale),i.setUniform2f("screenOffset",2*r.screenOffset[0]*n,2*r.screenOffset[1]*n),i.setUniform2fv("anchorPos",g(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,i=this.getProgram(),n=this.params;e.bindProgram(i),i.setUniform1f("cameraGroundRelative",r),i.setUniform1f("polygonOffset",n.shaderPolygonOffset),i.setUniform4fv("viewport",t.viewport),p.bindVerticalOffset(n.verticalOffset,t,i),i.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.screenSizePerspective&&(p.bindScreenSizePerspective(n.screenSizePerspective,t,i,"screenSizePerspective"),p.bindScreenSizePerspective(n.screenSizePerspectiveAlignment||n.screenSizePerspective,t,i,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,i=this.getProgram();p.bindView(r,t.view,i),p.bindCamPos(r,t.viewInvTransp,i),this.params.slicePlaneEnabled&&p.bindSlicePlane(t.origin,t.slicePlane,i)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(l),y=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.isOcclusionSlot=!1,n}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(f.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.program=this.programRep.getProgram(f.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder,slice:e.slicePlaneEnabled})},t.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4},t.prototype.release=function(e){e.setDepthFunction(513),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){this.bindProjection(e,t);var r=this.getProgram();if(e.setDepthTestEnabled(!0),e.setDepthFunction(515),this.isOcclusionSlot){r.setUniform4f("color",1,1,1,1);var i=t.pixelRatio||1;r.setUniform1f("pixelRatio",i)}else this.bindRender(e,t),this.bindTexture(e,r)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=14===e,14===e||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(_),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(f.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion,slice:e.slicePlaneEnabled})},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(_),x={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},T=i.vec2f64.create(),w=i.vec3f64.create(),S=i.vec3f64.create(),R=i.vec3f64.create(),E=i.vec3f64.create(),O=i.vec3f64.create(),A=i.mat3f64.create(),P=i.mat4f64.create(),M={normal:E,cosAngle:0},C=i.mat4f64.create();i.mat4.identity(C);var D=1,I=[0,0],F=i.vec3f64.fromValues(0,0,1),B={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:m.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},V=o.newLayout().vec3f(u.VertexAttrConstants.POSITION).vec3f(u.VertexAttrConstants.NORMAL).vec2f(u.VertexAttrConstants.UV0).vec4u8(u.VertexAttrConstants.COLOR).vec2f(u.VertexAttrConstants.SIZE).vec4f(u.VertexAttrConstants.AUXPOS1).vec4f(u.VertexAttrConstants.AUXPOS2),L=function(){function e(e){this.material=e,this.vertexBufferLayout=V}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[u.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){d.writePosition(t.indices[u.VertexAttrConstants.POSITION],t.vertexAttr[u.VertexAttrConstants.POSITION].data,e.transformation,i.position,n,6),d.writeNormal(t.indices[u.VertexAttrConstants.NORMAL],t.vertexAttr[u.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,i.normal,n,6);var a=t.vertexAttr[u.VertexAttrConstants.UV0].data,o=void 0,s=void 0,l=void 0,h=void 0;if(null==a||a.length<4){var c=this.material.getParameterValues();o=0,s=0,l=c.texCoordScale[0],h=c.texCoordScale[1]}else o=a[0],s=a[1],l=a[2],h=a[3];l=Math.min(1.99999,l+1),h=Math.min(1.99999,h+1);for(var p=t.indices[u.VertexAttrConstants.POSITION].length,f=i.uv0,g=n,m=0;m<p;++m)f.set(g,0,o),f.set(g,1,s),g+=1,f.set(g,0,l),f.set(g,1,s),g+=1,f.set(g,0,l),f.set(g,1,h),g+=1,f.set(g,0,l),f.set(g,1,h),g+=1,f.set(g,0,o),f.set(g,1,h),g+=1,f.set(g,0,o),f.set(g,1,s),g+=1;d.writeColor(t.indices[u.VertexAttrConstants.COLOR],t.vertexAttr[u.VertexAttrConstants.COLOR].data,4,i.color,n,6);var v=t.indices[u.VertexAttrConstants.SIZE],_=t.vertexAttr[u.VertexAttrConstants.SIZE].data,y=v.length,b=i.size;for(g=n,m=0;m<y;++m)for(var x=_[2*v[m]],T=_[2*v[m]+1],w=0;w<6;++w)b.set(g,0,x),b.set(g,1,T),g+=1;t.indices[u.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[u.VertexAttrConstants.AUXPOS1]&&d.writeBufferVec4(t.indices[u.VertexAttrConstants.AUXPOS1],t.vertexAttr[u.VertexAttrConstants.AUXPOS1].data,i.auxpos1,n,6),t.indices[u.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[u.VertexAttrConstants.AUXPOS2]&&d.writeBufferVec4(t.indices[u.VertexAttrConstants.AUXPOS2],t.vertexAttr[u.VertexAttrConstants.AUXPOS2].data,i.auxpos2,n,6)},e}();return v}.apply(null,i))||(e.exports=n)},1617:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(1)],void 0===(n=function(e,t,r,i,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t}return r(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([a.property()],t.prototype,"layer",void 0),i([a.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([a.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([a.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(a.declared(n))}.apply(null,i))||(e.exports=n)},1622:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(262),r(38),r(1642),r(1572),r(1561),r(1668),r(1669),r(1670),r(1671),r(1672),r(1673),r(1674),r(1667),r(1675),r(1676),r(1677),r(1559),r(1678),r(1693),r(1615),r(1564),r(1698),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g,m,v,_,y,b,x,T,w,S,R,E){function O(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return a.generateVisibleIndexRanges(t,r)}function A(e,t,r){var n=e.origin.vec3;_.setMatrixTranslation3(j,-n[0],-n[1],-n[2]),i.mat4.multiply(t,j,e.transformation),i.mat4.invert(r,t),i.mat4.transpose(r,r)}function P(e,t,r){for(var i in e){var n=e[i];t(i,n),n.origin2data.forEach(function(e,t){r(t,e)})}}function M(e){return C(e.data)>=1}function C(e){return!1===e.preinterleaved?_.getFirstObjectValue(e.indices).length:e.indexCount}var D=i.mat4f64.create(),I=1535,F=function(){function e(e,t,r,i,n){this._lighting=new b.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._renderContext=new f,this._isRendering=!1,this._highlights=[],this._threshold=I,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new V,this._edgeView=null,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=n,this._rctx=i,this._fxaaPass=new l(i),this._smaaPass=new m(i),this._renderContext.rctx=i,this._renderContext.lightingData=this._lighting.getOld(),i.setDepthTestEnabled(!0),i.setFaceCullingEnabled(!0),i.setBlendingEnabled(!1),i.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._linearDepthTextureHelper=new d(i),this._normalTextureHelper=new p(i),this._highlightTextureHelper=new h(i),this._stencilRenderingHelper=new v(i),this._renderPlugins=new g.RenderPluginManager({rctx:i,gl:i.gl,programRep:e,textureRep:r,materialRep:t}),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,r=new S(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:r}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},r=function(e,t){t.type===B.Preinterleaved?t.instances.forEach(function(e){return e.vao.dispose(!0)}):t.vao.dispose(!0)};P(this._mat2DataMerged,t,r),P(this._mat2DataInstanced,t,r),P(this._mat2DataPreinterleaved,t,r),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return null==this._edgeView&&(this._edgeView=new y.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},r=function(t,r){r.type===B.Preinterleaved?r.instances.forEach(function(t){var r=t.vao.size;e._stats.VBOallocatedSize+=r/4,e._stats.VBOusedSize+=r/4,e._stats.VBOoptimalSize+=r/4}):(e._stats.VBOallocatedSize+=r.buffer.getArray().length,e._stats.VBOusedSize+=r.buffer.getSize(),e._stats.VBOoptimalSize+=r.optimalCount)};return P(this._mat2DataMerged,t,r),P(this._mat2DataInstanced,t,r),P(this._mat2DataPreinterleaved,t,r),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;case"normals":return this._normalTextureHelper.framebuffer.colorTexture}return null},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,r=x.shouldRenderVisibilityDuringRenderPass(e.pass),i=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,n=!1;return r&&i&&e.offscreenRenderingHelper.renderHUDVisibility(function(){n=t._renderInternalSlot(14,e)}),n},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(1,e),this._renderInternalSlot(2,e),this._renderPlugins.render(3,e),this._renderInternalSlot(4,e),this._renderPlugins.render(5,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(16,this._renderContext),this._renderInternalSlot(6,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(21,this._renderContext)),this._renderPlugins.render(7,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(8,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(22,this._renderContext),this._renderInternalSlot(19,this._renderContext),this._renderInternalSlot(20,this._renderContext)},e.prototype._renderHighlights=function(e,t){if(t&&t.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var r=null;t.profilingCallback&&(r=w.startMeasurement(this._renderContext.rctx));var i=e.camera,n=e.fbo;this._highlightTextureHelper.prepareHighlightPass(i),this.renderGeometryPass(4,e,null,null,this._renderContext.sliceHelper);var a=this._rctx.gl;this._rctx.clear(a.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(n);var o=this._highlightTextureHelper.framebuffer;t.render(e,o),null!==r&&t.profilingCallback&&r.stop(function(e){t.profilingCallback&&t.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var r=this._mat2DataInstanced[t][0];if(r&&r.renderOccluded&&r.beginSlot(e)&&r.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,r){if(t&&r&&r.enabled){var i=this._needsRenderOccluded(4)||this._needsRenderOccluded(6)||this._needsRenderOccluded(9);if(t.enabled=i,i){var n=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),n.pass=0,n.renderOccludedOnly=!0,this._renderInternalSlot(4,n),this._renderInternalSlot(6,n),this._renderInternalSlot(9,n),n.renderOccludedOnly=!1,t.finish(r.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,r){var i=this,n=this._rctx;this._isRendering=!0,this._stats.reset();var a=e.camera,o=e.fbo,s=e.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=0,this._renderContext.camera=a,this._renderContext.pixelRatio=s,this._renderContext.shadowMap=t,this._renderContext.sliceHelper=r.slice,this._renderContext.ssaoHelper=r.ssao,this._renderContext.offscreenRenderingHelper=r.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,r.offscreenRendering.enabled=!0,r.offscreenRendering.initializeFrame(a,o),this._renderPlugins.render(0,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&r.offscreenRendering.renderSeparateAndComposite(function(){i._edgeView.render(i._bindParameters)},void 0,"alpha");var l={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(l.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(21,this._renderContext)),l.transparentTerrain=this.renderTransparentTerrain(this._renderContext),l.transparentTerrain&&l.hudVisibility&&(r.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),r.offscreenRendering.renderToTargets(function(){return i.renderHUD("occluded")},r.offscreenRendering.mainColor,r.offscreenRendering.tmpDepth,void 0,!0)),l.transparentTerrain&&r.offscreenRendering.compositeTransparentTerrainOntoMain(),r.offscreenRendering.renderToTargets(function(){i._renderInternalSlot(9,i._renderContext),i._renderPlugins.render(17,i._renderContext),i._renderPlugins.render(18,i._renderContext),i._renderOccluded(a,r.renderOccluded,r.offscreenRendering),r.slice&&r.slice.isEnabled&&(i._renderInternalSlot(10,i._renderContext),i._renderInternalSlot(11,i._renderContext),i._renderInternalSlot(12,i._renderContext),i._renderInternalSlot(13,i._renderContext))},r.offscreenRendering.mainColor,r.offscreenRendering.mainDepth);var h=this.renderOptions.antialiasing;"smaa"===h&&this._smaaPass.loadResources(function(){i._needsRender=!0}),"smaa"===h&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):"fxaa"===h&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):(r.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),n.bindFramebuffer(o),this._renderContext.framebufferTex=r.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,r.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights()},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,r=0;r<this._renderOrder.length;r++){var i,n,a=this._renderOrder[r][1];if(a.instanced)(n=(i=a.instanced||a.merged)[e.pass])&&n.isVisible()&&(this._renderInternalInstanced(i,n,this._bindParameters,1/0),t=null);if(a.merged)if((n=(i=a.merged)[e.pass])&&n.isVisible()){var o=n.getProgram();o!==t&&(o.setUniformMatrix4fv("model",D),o.hasUniform("modelNormal")&&o.setUniformMatrix4fv("modelNormal",D)),t=o,this._renderInternalMerged(i,n,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,U[0]=t.near,U[1]=t.far,this._bindParameters.nearFar=U,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t){this._orderedRendering?this._renderOrdered(0,e):this._renderUnordered(e,t.shadowMap,t)},e.prototype.renderAuxiliaryBuffers=function(e,t){var r=t.ssao,i=t.slice,n=t.shadowMap,a=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),o=e.camera,s=e.fbo;this._linearDepthTextureHelper.enabled=a,a&&(this._linearDepthTextureHelper.setupFBOs(o),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(1,e,n,r,i),this._linearDepthTextureHelper.finish(s)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(o),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(2,e,n,r,i),this._normalTextureHelper.finish(s),r.computeSSAO(o,s,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer)),r.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,r,i,n){this._isRendering=!0;var a=t.camera,o=t.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=a,this._renderContext.pixelRatio=o,this._renderContext.shadowMap=r,this._renderContext.ssaoHelper=i,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.sliceHelper=n,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e){void 0===e&&(e=null);for(var t=!1,r=0;r<this._highlights.length;++r){var i=this._highlights[r],n=i.matData[4];n&&(null===e||n.beginSlot(e))&&n.isVisible()&&(t=this._renderInternalHighlight(i,this._bindParameters,4)||t)}return t},e.prototype._renderInternalSlotOccluded=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){var n=this._mat2DataInstanced[i],a=n[t.pass];a&&a.renderOccluded&&a.beginSlot(e)&&a.isVisible()&&(r=this._renderInternalInstanced(n,a,this._bindParameters,e)||r)}return r},e.prototype._renderInternalSlotMaterial=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){(h=(l=this._mat2DataInstanced[i])[t.pass])&&h.beginSlot(e)&&h.isVisible()&&(r=this._renderInternalInstanced(l,h,this._bindParameters,e)||r)}for(var n=this._programRep.getProgramsUsingUniform("model"),a=this._programRep.getProgramsUsingUniform("modelNormal"),o=0;o<n.length;o++){var s=n[o];s.setUniformMatrix4fv("model",D),a.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",D)}for(var i in this._mat2DataMerged){(h=(l=this._mat2DataMerged[i])[t.pass])&&h.beginSlot(e)&&h.isVisible()&&(r=this._renderInternalMerged(l,h,this._bindParameters,e)||r)}for(var i in this._mat2DataPreinterleaved){var l,h;(h=(l=this._mat2DataPreinterleaved[i])[t.pass])&&h.beginSlot(e)&&h.isVisible()&&(r=this._renderInternalPreinterleaved(l,h,this._bindParameters,e)||r)}return 2===e&&this._stencilRenderingHelper.finish(),r},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,U[0]=t.camera.near,U[1]=t.camera.far;var r=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=U,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=r?r.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=r?r.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=t.getDrawMode(),h=a.capabilities.instancing,c=!1;return e.origin2data.forEach(function(e){r.origin=e.origin,2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass());var u=!1;if(t.instanced)for(var d in e.perGeometryDataInfo){var p=e.perGeometryDataInfo[d];s||(t.bind(a,r),s=!0),a.bindVAO(p.vao);var f=t.getProgram();R.assertCompatibleVertexAttributeLocations(p.vao,f),u||(t.bindView(a,r),u=!0);var g=p.to-p.from,m=p.refCount;l===o.TRIANGLES&&(n._stats.trianglesRendered+=m*g/3),h.drawArraysInstanced(l,p.from,g,m),c=!0,n._stats.drawCallsAngleInstanced++,n._stats.instancesDrawnAngle+=m}else e.instances.forEach(function(i){var h=i.displayedIndexRange;h&&0===h.length||(s||(t.bind(a,r),s=!0),u||(a.bindVAO(e.vao),t.bindView(a,r),u=!0),t.bindInstance(a,i),n._stats.drawCallsInstanced++,l===o.TRIANGLES&&(n._stats.trianglesRendered+=(i.to-i.from)/3),h?n._drawArraysFaceRange(h,i.from,l):a.drawArrays(l,i.from,i.to-i.from),c=!0)})}),a.bindVAO(null),s&&t.release(a,r),c},e.prototype._renderInternalHighlight=function(e,t,r){var i=this._rctx,n=i.gl,a=e.matData[r],o=a.getDrawMode(),s=e.instance,l=s.highlightedIndexRange,h=this._renderContext.offscreenRenderingHelper,c=(h?h.depthTexture:null)||this._getFallbackDepthTexture(),u=a.getProgram(),d=i.capabilities.instancing;t.origin=e.originData.origin;var p=!1;if(a.instanced&&e.type===B.Instanced){var f=e.instancedVAO;a.bind(i,t),i.bindVAO(f),R.assertCompatibleVertexAttributeLocations(f,u),a.bindView(i,t);for(var g=0;g<l.length;g++){var m=(b=l[g]).range?b.range[0]+s.from:s.from,v=b.range?b.range[1]-b.range[0]+1:s.to-s.from;i.bindTexture(c,5),u.setUniform1i("depthTex",5),u.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),d.drawArraysInstanced(o,m,v,1),o===n.TRIANGLES&&(this._stats.trianglesRendered+=1*v/3),this._stats.drawCallsHighlight++,p=!0}}else if(e.type===B.Instanced&&a.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{a.bind(i,t),a.bindView(i,t);var _=null;switch(e.type){case B.Merged:var y=e.originData;i.bindVAO(y.vao),u.setUniformMatrix4fv("model",D);break;case B.Instanced:y=e.originData;i.bindVAO(y.vao),a.bindInstance(i,s);break;case B.Preinterleaved:f=(y=e.originData).instances.get(e.uniqueName).vao;i.bindVAO(f),a.bindInstance(i,s),_=f.indexBuffer&&f.indexBuffer.indexType}for(g=0;g<l.length;g++){var b;m=(b=l[g]).range?b.range[0]+s.from:s.from,v=b.range?b.range[1]-b.range[0]+1:s.to-s.from;if(i.bindTexture(c,5),a.getProgram().setUniform1i("depthTex",5),u.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),_){var x=R.getBytesPerElement(_);i.drawElements(o,v,_,m*x)}else i.drawArrays(o,m,v);o===n.TRIANGLES&&(this._stats.trianglesRendered+=v/3),this._stats.drawCallsHighlight++,p=!0}}return i.bindVAO(null),a.release(i,t),p},e.prototype._drawArraysFaceRange=function(e,t,r){for(var i=this._rctx,n=0,a=e;n<a.length;n++){var o=a[n];i.drawArrays(r,o[0]+t,o[1]-o[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,r,i){for(var n=this._rctx,a=R.getBytesPerElement(i),o=0,s=e;o<s.length;o++){var l=s[o],h=l[1]-l[0]+1,c=l[0]+t;n.drawElements(r,h,i,c*a)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=!1;return e.origin2data.forEach(function(e){if(r.origin=e.origin,2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){l||(t.bind(a,r),l=!0);var h=t.getProgram();a.bindVAO(e.vao),R.assertCompatibleVertexAttributeLocations(e.vao,h),t.bindView(a,r),n._stats.drawCallsMerged++;var c=t.getDrawMode();c===o.TRIANGLES&&(n._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?n._drawArraysFaceRange(e.displayedIndexRange,0,c):a.drawArrays(c,0,R.vertexCount(e.vao,"geometry")),s=!0}}),l&&t.release(a,r),s},e.prototype._renderInternalPreinterleaved=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=!1,h=t.getDrawMode();return e.origin2data.forEach(function(e){r.origin=e.origin;var c=!1;2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),e.instances.forEach(function(e){var i=e.instance,u=e.vao,d=i.displayedIndexRange;if(!d||0!==d.length){l||(t.bind(a,r),l=!0);var p=t.getProgram();R.assertCompatibleVertexAttributeLocations(u,p),a.bindVAO(u),c||(t.bindView(a,r),c=!0),t.bindInstance(a,i),n._stats.drawCallsPreinterleaved++,h===o.TRIANGLES&&(n._stats.trianglesRendered+=(i.to-i.from)/3);var f=u.indexBuffer&&u.indexBuffer.indexType;if(d)f?n._drawElementsFaceRange(d,i.from,h,f):n._drawArraysFaceRange(d,i.from,h);else if(f){var g=R.getBytesPerElement(f);a.drawElements(h,i.to-i.from,f,i.from*g)}else a.drawArrays(h,i.from,i.to-i.from);s=!0}})}),a.bindVAO(null),l&&t.release(a,r),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,r=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+r);var i=0;P(this._mat2DataMerged,function(){},function(e,t){i+=t.instances.size});var n=0;P(this._mat2DataInstanced,function(){},function(e,t){n+=t.instances.size});var a=0;P(this._mat2DataPreinterleaved,function(){},function(e,t){a+=t.instances.size}),console.log("number of instances (merged/instanced/preinterleaved): "+i+"/"+n+"/"+a)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}return!0},e.prototype.modify=function(e,t,r,i){this._isRendering&&console.warn("Renderer.modify called while rendering");var n=[],a=[],o=[];this._classifyRenderGeometry(e,n,a,o);var s=[],l=[],h=[];this._classifyRenderGeometry(t,s,l,h);var c={};r&&this._performUpdates(r,c);var u=[];this._modifyMerged(n,s,u,c),this._modifyInstanced(a,l,u),this._modifyPreinterleaved(o,h,u),this._updateMergedFaceranges(c),this._releaseMaterials(u);var d=this._highlights.length;t&&t.length>0&&d>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),d!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),i&&this._modifyMaterials(i),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,r,i){for(var n=0,a=e;n<a.length;n++){var o=a[n];if(M(o))switch(this._getType(o)){case B.Merged:t.push(o);break;case B.Instanced:r.push(o);break;case B.Preinterleaved:i.push(o)}}},e.prototype._performUpdates=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r],a=n.updateType,o=n.renderGeometry,s=this._getType(o)===B.Merged;if(M(o)){if(2&a&&this._updateFaceranges(o,t),32&a){var l=this._getInstance(o);l&&this._updateHighlightFaceranges(o,l.instance)}4&a||s&&16&a?this._updateVertexAttributes(o,!s):!s&&16&a&&this._updateInstanceTransformation(o)}}},e.prototype._updateFaceranges=function(e,t){var r,i,n=e.material.id,a=e.origin.id,o=this._getType(e);o===B.Preinterleaved?r=(i=this._getOriginData(o,n,a)).instances.get(e.uniqueName).instance:(r=(i=this._getOriginData(o,n,a)).instances.get(e.uniqueName))&&o===B.Merged&&(t[this._modifiedMergedFacerangesKey(n,a)]=i);r&&(r.displayedIndexRange=O(e),this._updateHighlightFaceranges(e,r))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var r=t.highlightedIndexRange,i=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,i=e.componentOffsets;return a.generateHighlightedIndexRanges(t,r,i)}(e);t.highlightedIndexRange=i,i&&!r?this._addHighlight(e):!i&&r&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e)!function(t){var r=e[t];r.displayedIndexRange=[];var i=!0;r.instances.forEach(function(e){e.displayedIndexRange?(r.displayedIndexRange.push.apply(r.displayedIndexRange,u.offsetIntervals(e.displayedIndexRange,e.from)),i=!1):r.displayedIndexRange.push([e.from,e.to-1])}),r.displayedIndexRange=i?null:u.mergeIntervals(r.displayedIndexRange)}(t)},e.prototype._updateVertexAttributes=function(e,t){var r=e.material,i=r.bufferWriter,n=r.id,a=e.origin.id,o=i.vertexBufferLayout.stride/4,s=this._getType(e);if(s!==B.Preinterleaved){var l,h,c=this._getOriginData(s,n,a),u=c.instances.get(e.uniqueName),d=c.buffer.getArray(),p=c.vao;t||(A(e,z,G),l=z,h=G),i.write({transformation:l,invTranspTransformation:h},e.data,e.instanceParameters,i.vertexBufferLayout.createView(d.buffer),u.from),_.assert(u.from+i.elementCount(e.data)===u.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(d,u.from*o*4,u.from*o*4,u.to*o*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),r=e.material.id,i=e.origin.id;if(t===B.Preinterleaved){A(e,(a=(n=this._getOriginData(t,r,i)).instances.get(e.uniqueName).instance).transformation,a.transformationNormal)}else{var n,a=(n=this._getOriginData(t,r,i)).instances.get(e.uniqueName),o=n.perGeometryDataInfo[e.data.id],s=o.instanceBufferData;if(A(e,a.transformation,a.transformationNormal),s){var l=s.getSlot(e.idx);s.fill(l,0,a.transformation),s.fill(l,16,a.transformationNormal);var h=4*s.getOffset(l),c=R.getStride(o.vao.layout.instance);o.vao.vertexBuffers.instance.setSubData(s.getArray(),h,h,h+c)}}},e.prototype._modifyMerged=function(e,t,r,i){var n=this._compMatToDelta(e,t,B.Merged),a=this._mat2DataMerged;for(var o in n){var s=n[o];for(var l in s){var h=s[l],c=h.optimalCount,u=h.sparseCount,d=h.material,p=d.bufferWriter.vertexBufferLayout,f=p.stride/4,g=a[o];null==g&&(_.assert(c>0),g=this._initializeMatData(d),a[o]=g,this._orderedRendering&&this._insertIntoRenderOrder(g,d.renderPriority,"merged"));var m=g.origin2data.get(l);if(null==m&&(_.assert(c>0),m=this._createMergedData(p,c,h.origin),g.origin2data.set(l,m)),0===c)m.vao.dispose(!0),m.vao=null,g.origin2data.delete(l),0===g.origin2data.size&&(r.push(o),delete a[o],this._orderedRendering&&this._removeFromRenderOrder(g,"merged"));else{var v=c<h.sparseCount/2,y=v?c:u,b=N,x=m.buffer.getSize(),T=m.buffer.getArray(),w=m.buffer.resize(y);v||w?this._rebuildMerged(m,h.toRemove,f,T,b):h.toRemove.length>0?(this._removeMergedByErasing(m,h.toRemove,f,b),h.toAdd.length>0&&(b.end=x)):(b.begin=x,b.end=x);var S=j;_.setMatrixTranslation3(S,-h.origin[0],-h.origin[1],-h.origin[2]),this._appendMerged(m,d,h.toAdd,f,S,b);var R=m.vao.vertexBuffers.geometry;if(R.byteSize!==m.buffer.getArray().buffer.byteLength)R.setData(m.buffer.getArray());else{var E=b.begin,O=b.end;if(E<O){var A=m.buffer.getArray(),P=4*E,M=4*O;R.setSubData(A,P,P,M)}}(b.updatedDisplayedIndexRange||m.displayedIndexRange)&&(i[this._modifiedMergedFacerangesKey(o,l)]=m)}}}},e.prototype._createMergedData=function(e,t,r){return{type:B.Merged,instances:new Map,vao:new E(this._rctx,o.Default3D,{geometry:n.glLayout(e)},{geometry:T.createVertex(this._rctx,35044)}),buffer:new s(t),optimalCount:0,origin:r}},e.prototype._rebuildMerged=function(e,t,r,i,n){for(var a=0;a<t.length;++a){var o=e.instances.get(t[a].uniqueName);e.optimalCount-=(o.to-o.from)*r,e.instances.delete(t[a].uniqueName)}var s=0,l=e.buffer.getArray();n.begin=0,n.end=0;var h=-1,c=-1,u=0;e.instances.forEach(function(e){var t=e.from*r,n=e.to*r,a=n-t;h!==c&&c!==t?(l.set(i.subarray(h,c),u),u+=c-h,h=t):-1===h&&(h=t),c=n,e.from=s/r,s+=a,e.to=s/r}),h!==c&&l.set(i.subarray(h,c),u),n.end=s},e.prototype._removeMergedByErasing=function(e,t,r,i){if(0!==t.length){i.begin=1/0,i.end=-1/0;for(var n=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,h=e.instances.get(l),c=h.from*r,u=h.to*r;n!==a&&a!==c?(e.buffer.erase(n,a),n=c):-1===n&&(n=c),a=u,e.instances.delete(l),e.optimalCount-=u-c,c<i.begin&&(i.begin=c),u>i.end&&(i.end=u)}n!==a&&e.buffer.erase(n,a)}},e.prototype._appendMerged=function(e,t,r,n,a,o){o.updatedDisplayedIndexRange=!1;for(var s=t.bufferWriter,l=0,h=r;l<h.length;l++){var c=h[l],u=c.data;i.mat4.multiply(z,a,c.transformation),i.mat4.invert(G,z),i.mat4.transpose(G,G);var d=o.end;s.write({transformation:z,invTranspTransformation:G},u,c.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),o.end/n);var p=s.elementCount(u)*n,f=d+p;_.assert(null==e.instances.get(c.uniqueName));var g=O(c),m=new L(c.name,d/n,f/n,g,void 0,void 0,c.idx);e.instances.set(c.uniqueName,m),this._updateHighlightFaceranges(c,m),g&&(o.updatedDisplayedIndexRange=!0),e.optimalCount+=p,o.end+=p}},e.prototype._modifyInstanced=function(e,t,r){var a=this._rctx,l=B.Instanced,h=this._compMatToDelta(e,t,l),u=this._mat2DataInstanced;for(var d in h){var p=h[d],f=this;for(var g in p)!function(e){var t=p[e];if(0===t.optimalCount){var h=u[d];return h.origin2data.get(e).vao.dispose(!0),h.origin2data.delete(e),0===h.origin2data.size&&(r.push(d),delete u[d],f._orderedRendering&&f._removeFromRenderOrder(h,"instanced")),"continue"}var g=t.material,m=g.bufferWriter,v=u[d];if(null==v){var y=g.renderPriority;v=f._initializeMatData(g),u[d]=v,f._orderedRendering&&f._insertIntoRenderOrder(v,y,"instanced")}var b=m.vertexBufferLayout,x=v[0].instanced?m.instanceBufferLayout:void 0,w=x&&x.fields.get("instanceColor"),S=x&&x.fields.get("instanceFeatureAttribute"),R=b.stride/4,A=v.origin2data.get(e);null==A&&(A={type:l,instances:new Map,vao:new E(a,o.Default3D,{geometry:n.glLayout(b)},{geometry:T.createVertex(a,35044)}),buffer:new s(t.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:t.origin},v.origin2data.set(e,A));var P=A.buffer.getSize(),M=A.buffer.getArray(),C=t.optimalCount<t.sparseCount/2,D=A.buffer.resize(C?t.optimalCount:t.sparseCount);for(var I in t.perGeometryDelta){if((Q=A.perGeometryDataInfo[I])&&Q.instanceBufferData){var F=t.perGeometryDelta[I].removeCount;F>0&&Q.instanceBufferData.prepareFree(F)}}var B=t.toRemove;if(C||D){for(var V=0;V<B.length;++V){var N=B[V];A.instances.delete(N.uniqueName);I=N.data.id;0==--(H=Q=A.perGeometryDataInfo[I]).refCount&&null==t.dataId2refCount[I]?(A.optimalCount-=(H.to-H.from)*R,delete A.perGeometryDataInfo[I]):Q.instanceBufferData&&Q.instanceBufferData.free(N.idx)}P=0;var U=A.buffer.getArray(),z={};for(var G in A.perGeometryDataInfo){var H=A.perGeometryDataInfo[G];_.assert(null==z[H.from]),z[H.from]=H}for(var k in z){var W=(H=z[k]).from*R,X=H.to*R;U.set(M.subarray(W,X),P),H.from=P/R,P+=X-W,H.to=P/R}A.instances.forEach(function(e){e.from=A.perGeometryDataInfo[e.dataId].from,e.to=A.perGeometryDataInfo[e.dataId].to})}else for(V=0;V<B.length;++V){N=B[V];A.instances.delete(N.uniqueName);I=N.data.id;if(0==--(Q=A.perGeometryDataInfo[I]).refCount&&null==t.dataId2refCount[I]){W=Q.from*R,X=Q.to*R;A.buffer.erase(W,X),A.optimalCount-=X-W,delete A.perGeometryDataInfo[I]}else Q.instanceBufferData&&Q.instanceBufferData.free(N.idx)}for(var I in _.setMatrixTranslation3(j,-t.origin[0],-t.origin[1],-t.origin[2]),t.perGeometryDelta){if((Q=A.perGeometryDataInfo[I])&&Q.instanceBufferData){var q=t.perGeometryDelta[I].addCount;q>0&&Q.instanceBufferData.prepareAllocate(q)}}var Y=t.toAdd;for(V=0;V<Y.length;++V){var Q,K=(N=Y[V]).data;I=K.id;if(null==(Q=A.perGeometryDataInfo[I])){m.write({},K,void 0,m.vertexBufferLayout.createView(A.buffer.getArray().buffer),P/R);var Z=m.elementCount(K)*R;W=P/R,X=(P+=Z)/R;if(A.optimalCount+=Z,Q={refCount:1,from:W,to:X,vao:null,instanceBufferData:null},x){var J=x.stride/4;Q.vao=new E(a,o.Default3D,{geometry:n.glLayout(b),instance:n.glLayout(x,{divisor:1})},{geometry:A.vao.vertexBuffers.geometry,instance:T.createVertex(a,35044)}),Q.instanceBufferData=new c(J,t.perGeometryDelta[I].addCount)}A.perGeometryDataInfo[I]=Q}else++Q.refCount;_.assert(Q.from*R<=A.buffer.getSize()&&Q.to*R<=A.buffer.getSize());var $=i.mat4f64.create();i.mat4.multiply($,j,N.transformation);var ee=O(N),te=new L(N.name,Q.from,Q.to,ee,$,N.instanceParameters,N.idx,I);A.instances.set(N.uniqueName,te),f._updateHighlightFaceranges(N,te);var re=Q.instanceBufferData;if(re){var ie=re.allocate(N.idx);re.fill(ie,0,te.transformation),re.fill(ie,16,te.transformationNormal),w&&re.fill(ie,w.offset/4,N.instanceParameters.color),S&&re.fill(ie,S.offset/4,N.instanceParameters.featureAttribute)}}_.assert(A.optimalCount===t.optimalCount);var ne=new Float32Array(A.buffer.getArray().buffer,0,A.buffer.getSize());for(var I in A.vao.vertexBuffers.geometry.setData(ne),A.perGeometryDataInfo){var ae=A.perGeometryDataInfo[I];if(ae.vao){var oe=ae.vao.vertexBuffers.instance;if(oe){var se=t.perGeometryDelta[I];if(se.addCount+se.removeCount>0){var le=ae.instanceBufferData.compact();oe.setData(le)}}}}}(g)}},e.prototype._modifyPreinterleaved=function(e,t,r){for(var a=this._rctx,s=B.Preinterleaved,l=this._mat2DataPreinterleaved,h=0,c=e;h<c.length;h++){var u=(D=(C=c[h]).material).bufferWriter,d=D.id,p=C.origin.id,f=C.origin.vec3;null==(I=l[d])&&(I=this._initializeMatData(D),l[d]=I);var g=I.origin2data.get(p);null==g&&(g={type:s,origin:f,count:0,instances:new Map},I.origin2data.set(p,g)),_.setMatrixTranslation3(j,-f[0],-f[1],-f[2]);var m=i.mat4f64.create();i.mat4.multiply(m,j,C.transformation);var v=O(C),y=C.data;if(y.preinterleaved)if(null!=y.vertexData){var b=y.indexCount,x=y.id,w=new L(C.name,0,b,v,m,C.instanceParameters,C.idx,x),S=y.indexData?T.createIndex(a,35044,y.indexData):null,R=u.vertexBufferLayout,A=new E(a,o.Default3D,{geometry:n.glLayout(R)},{geometry:T.createVertex(a,35044)},S);A.vertexBuffers.geometry.setData(y.vertexData),y.indexData=null,y.vertexData=null,g.count+=1,g.instances.set(C.uniqueName,{instance:w,vao:A}),this._updateHighlightFaceranges(C,w)}else _.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else _.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var P=0,M=t;P<M.length;P++){var C,D,I,F=(C=M[P]).origin,V=(d=(D=C.material).id,p=F.id,C.uniqueName),N=(I=l[d]).origin2data.get(p);N.instances.get(V).vao.dispose(),N.instances.delete(V),N.count-=1,0===N.count&&I.origin2data.delete(p),0===I.origin2data.size&&(r.push(d),delete l[d])}},e.prototype._compMatToDelta=function(e,t,r){var i={};return this._updateMatToDelta(e,!0,r,i),this._updateMatToDelta(t,!1,r,i),i},e.prototype._updateMatToDelta=function(e,t,r,i){for(var n=r===B.Instanced,a=0,o=e;a<o.length;a++){var s=o[a],l=s.origin,h=s.material,c=h.bufferWriter,u=h.id,d=n?this._mat2DataInstanced[u]:this._mat2DataMerged[u],p=d&&d.origin2data.get(l.id),f=i[u];null==f&&(f={},i[u]=f);var g=f[l.id];if(null==g){if(g={optimalCount:null==p?0:p.optimalCount,sparseCount:null==p?0:p.buffer.getSize(),material:h,toAdd:[],toRemove:[],perGeometryDelta:null,origin:l.vec3},n){var m={};if(void 0!==p)for(var v in p.perGeometryDataInfo)m[v]=p.perGeometryDataInfo[v].refCount;g.dataId2refCount=m,g.perGeometryDelta={}}f[l.id]=g}var _=c.vertexBufferLayout.stride/4,y=c.elementCount(s.data)*_;if(n){var b=s.data.id,x=g.perGeometryDelta[b];x||(x={addCount:0,removeCount:0},g.perGeometryDelta[b]=x),t?(x.addCount++,null==g.dataId2refCount[b]&&(g.dataId2refCount[b]=0),1==++g.dataId2refCount[b]&&(g.optimalCount+=y,g.sparseCount+=y),g.toAdd.push(s)):(x.removeCount++,0==--g.dataId2refCount[b]&&(delete g.dataId2refCount[b],g.optimalCount-=y),g.toRemove.push(s))}else t?(g.optimalCount+=y,g.sparseCount+=y,g.toAdd.push(s)):(g.optimalCount-=y,g.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return B.Preinterleaved;var t=!1,r=C(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||r>this._threshold),t?B.Instanced:B.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case B.Merged:return this._mat2DataMerged;case B.Instanced:return this._mat2DataInstanced;case B.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,r){return this._getTargetMat2Data(e)[t].origin2data.get(r)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,r){for(var i=e[0].materialId,n=this._renderOrder.length,a=0;a<n&&this._renderOrder[a][0]>=t;){var o=this._renderOrder[a][1];if(o.id===i)return _.assert(!o[r],"matData for type already exists"),void(o[r]=e);a++}var s={id:i,instanced:null,merged:null};s[r]=e,this._renderOrder.splice(a,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var r=e[0].materialId,i=0;this._renderOrder[i][1].id!==r;)i++;var n=this._renderOrder[i][1];n[t]=null,n.instanced||n.merged||this._renderOrder.splice(i,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var r=e.matData[0].renderPriority,i=t.matData[0].renderPriority;return r>i?-1:i>r?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var r=t.length,i=0;i<r&&t[i][1].id!==e;)i++;if(i<r){var n=t[i][1],a=(n.merged||n.instanced)[0].renderPriority,o=t[i][0];if(a!==t[i][0]){t[i][0]=a;var s=a>o?-1:1;for(i+=s;i>-1&&i<r&&s*t[i][0]>s*a;){var l=t[i];t[i]=t[i-s],t[i-s]=l,i+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[0]=this._materialRep.aquire(e),t[3]=this._materialRep.aquireDepthShadowMap(e),t[2]=this._materialRep.aquireNormal(e),t[1]=this._materialRep.aquireDepth(e),t[4]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,r=0;r<t.length;r++)this._materialRep.release(t[r]),this._materialRep.releaseDepthShadowMap(t[r]),this._materialRep.releaseNormal(t[r]),this._materialRep.releaseDepth(t[r]),this._materialRep.releaseHighlight(t[r]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,r=e.uniqueName,i=t.id,n=this._getType(e),a=this._getTargetMat2Data(n),o=e.origin.id,s=a[i];if(!s)return null;var l,h=s.origin2data.get(o);return h?(l=h.type===B.Preinterleaved?h.instances.get(r).instance:h.instances.get(r))?{type:n,uniqueName:r,instance:l,matData:s,originData:h,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,r=e.instance,i=e.originData;if(e.type===B.Instanced&&i.perGeometryDataInfo){var n=i.perGeometryDataInfo[r.dataId],a=n.instanceBufferData;if(a){var o=n.vao,s=a.getSlot(r.idx);if(e.instancedVAOBaseInstance!==s){var l=R.setBaseInstanceOffset(o.layout,s);e.instancedVAO=new E(t,o.locations,l,o.vertexBuffers,o.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new S(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}();!function(e){var t=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}();e.RenderStats=t}(F||(F={}));var B,V=F.RenderStats,L=function(){return function(e,t,r,n,a,o,s,l){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=n,this.transformation=a,this.instanceParameters=o,this.idx=s,this.dataId=l,null!=a&&(this.transformationNormal=i.mat4f64.create(),i.mat4.copy(this.transformationNormal,a),i.mat4.invert(this.transformationNormal,this.transformationNormal),i.mat4.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(B||(B={}));var N={updatedDisplayedIndexRange:!1,begin:0,end:0},U=i.vec2f64.create(),j=i.mat4f64.create(),z=i.mat4f64.create(),G=i.mat4f64.create();return F}.apply(null,i))||(e.exports=n)},1623:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,i=-e[0],n=-e[1],a=-e[2],o=r[3],s=r[7],l=r[11],h=r[15];r[0]+=o*i,r[1]+=o*n,r[2]+=o*a,r[4]+=s*i,r[5]+=s*n,r[6]+=s*a,r[8]+=l*i,r[9]+=l*n,r[10]+=l*a,r[12]+=h*i,r[13]+=h*n,r[14]+=h*a},t.applyToViewMatrix=function(e,t){var r=t,i=e[0],n=e[1],a=e[2];r[12]+=i*r[0]+n*r[4]+a*r[8],r[13]+=i*r[1]+n*r[5]+a*r[9],r[14]+=i*r[2]+n*r[6]+a*r[10],r[14]+=i*r[3]+n*r[7]+a*r[11]}}.apply(null,i))||(e.exports=n)},1624:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1571)],void 0===(n=function(e,t,r){var i=r.boundedPlane.create();return function(){function e(){this._worldPlane=i}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.plane!==i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||i},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1630:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(38),r(1577),r(1586),r(1631)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(t,r,n){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(n),this.name=t,r=r||{},this.group=r.group||"",this.isVisible=null==r.isVisible||r.isVisible,this.isPickable=null==r.isPickable||r.isPickable,this.isSliceable=!1,this.translation=r.translation?i.vec3f64.clone(r.translation):i.vec3f64.create(),this._extent=[i.vec3f64.fromValues(0,0,0),i.vec3f64.fromValues(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.parentLayer=this,this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.parentLayer=null,this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=i.vec3f64.create();return i.vec3.lerp(e,this._extent[0],this._extent[1],.5)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*i.vec3.distance(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,r,i){r=r||a.LAYER;for(var n=i||this,o=0;o<this._parentStages.length;o++)this._parentStages[o].notifyDirty(r,n,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,n=0;n<3;n++)t=Math.max(t,e[1][n]-e[0][n]);var a=i.vec3f64.create();i.vec3.lerp(a,e[0],e[1],.5),this._octree=new o(a,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var n=r.getBBMin(),a=r.getBBMax();if(t)for(var o=0;o<3;++o)e._extent[0][o]=Math.min(e._extent[0][o],n[o]),e._extent[1][o]=Math.max(e._extent[1][o],a[o]);else t=[i.vec3f64.clone(n),i.vec3f64.clone(a)]}),this._extent=t}},e._idGen=new n,e}()}.apply(null,i))||(e.exports=n)},1631:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1571),r(1559)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function s(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function l(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function h(e,t,r){return!n.frustum.intersectsSphere(r,n.sphere.wrap(t,e))}function c(e,t){for(var r=1/0,i=null,n=0;n<8;++n){var a=u(e,t,m[n]);a<r&&(r=a,i=m[n])}return i}function u(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var d,p=function(){function e(e,t,r,n){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new f(null,i.vec3f64.fromValues(0,0,0),.5):this._root=new f(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var i=f.acquire(),n=0;n<t;n++){var a=r[n];i.init(this._root),this._isDegenerate(a)?this._degenerateObjects.add(a):this._add(a,i)}f.release(i)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var i=f.acquire(),n=0;n<r.length;n++){var a=r[n],o=t||this._boundingSphereFromObject(a,S);this._isValidRadius(o.radius)?(i.init(this._root),this._remove(a,o,i)):this._degenerateObjects.delete(a)}f.release(i),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var i=this;this._forEachNode(this._root,function(n){if(!i._intersectsNode(e,t,n))return!1;var a=n.node;return a.terminals.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),null!==a.residents&&a.residents.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),!0})},e.prototype.forEach=function(e){this._forEachNode(this._root,function(t){var r=t.node;return r.terminals.forEach(e),null!==r.residents&&r.residents.forEach(e),!0}),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,i,n){return this._findClosest(e,"front-to-back"===t?d.FRONT_TO_BACK:d.BACK_TO_FRONT,r,i,n)},e.prototype.forEachInDepthRange=function(e,t,r,i,n,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===r?d.FRONT_TO_BACK:d.BACK_TO_FRONT,i,n,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return l(r.center,2*-r.halfSize,x),l(r.center,2*r.halfSize,T),a.rayBoxTest(e,t,x,T)},e.prototype._intersectsObject=function(e,t,r){var i=this._objectToBoundingSphere.getRadius(r);return!(i>0)||n.sphere.intersectsRay(n.sphere.wrap(i,this._objectToBoundingSphere.getCenter(r)),n.ray.wrap(e,t))},e.prototype._forEachNode=function(e,t){for(var r=f.acquire().init(e),i=[r];0!==i.length;){if(t(r=i.pop())&&!r.isLeaf())for(var n=0;n<r.node.children.length;n++){r.node.children[n]&&i.push(f.acquire().init(r).advance(n))}f.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,i){void 0===i&&(i=d.FRONT_TO_BACK);for(var n=f.acquire().init(e),a=[n],o=function(e,t,r){if(!P.length)for(var i=0;i<8;++i)P[i]={index:0,distance:0};for(i=0;i<8;++i){var n=g[i];P[i].index=i,P[i].distance=u(e,t,n)}for(P.sort(function(e,t){return e.distance-t.distance}),i=0;i<8;++i)r[i]=P[i].index;return r}(r,i,M);0!==a.length;){if(t(n=a.pop())&&!n.isLeaf())for(var s=7;s>=0;--s){var l=o[s];if(!(l>=n.node.children.length))n.node.children[l]&&a.push(f.acquire().init(n).advance(l))}f.release(n)}},e.prototype._findClosest=function(e,t,r,n,a){var o=this,s=1/0,l=1/0,d=null,p=c(e,t),f=0,g=function(i){if(++f,!n||n(i)){var a=o._objectToBoundingSphere.getCenter(i),c=o._objectToBoundingSphere.getRadius(i);if(!r||!h(a,c,r)){var p=u(e,t,a),g=p-c;g<s&&(s=g,l=p+c,d=i)}}};return this._forEachNodeDepthOrdered(this._root,function(n){if(null!=a&&f>=a)return!1;if(r&&h(n.center,n.halfSize*v,r))return!1;if(i.vec3.scale(b,p,n.halfSize),i.vec3.add(b,b,n.center),u(e,t,b)>l)return!1;var o=n.node;return o.terminals.forEach(function(e){g(e)}),null!==o.residents&&o.residents.forEach(function(e){g(e)}),!0},e,t),d},e.prototype._forEachInDepthRange=function(e,t,r,n,a,o,s,l){var p=this,f=-1/0,g=1/0,m={setRange:function(e){r===d.FRONT_TO_BACK?(f=Math.max(f,e.near),g=Math.min(g,e.far)):(f=Math.max(f,-e.far),g=Math.min(g,-e.near))}};m.setRange(n);var _=u(t,r,e),y=c(t,r),x=c(t,-1*r),T=0,w=function(e){if(++T,!s||s(e)){var i=p._objectToBoundingSphere.getCenter(e),n=p._objectToBoundingSphere.getRadius(e),l=u(t,r,i)-_;l-n>g||l+n<f||o&&h(i,n,o)||a(e,m)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=l&&T>=l)return!1;if(o&&h(e.center,e.halfSize*v,o))return!1;if(i.vec3.scale(b,y,e.halfSize),i.vec3.add(b,b,e.center),u(t,r,b)-_>g)return!1;if(i.vec3.scale(b,x,e.halfSize),i.vec3.add(b,b,e.center),u(t,r,b)-_<f)return!1;var n=e.node;return n.terminals.forEach(function(e){w(e)}),null!==n.residents&&n.residents.forEach(function(e){w(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(_[0]=e,_)},e.prototype._remove=function(e,t,r){w.length=0;var i=r.advanceTo(t,function(e,t){w.push(e.node,t)})?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(var n=w.length-2;n>=0;n-=2){var a=w[n],o=w[n+1];if(!this._purge(a,o))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,S))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var i=f.acquire().init(e);this._add(t.data[r],i),f.release(i)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},R);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var n=f.acquire();this._rootBoundsForRootAsSubNode(r,n),this._placingRootViolatesMaxDepth(n)?this._rebuildTree(r,n):this._growRootAsSubNode(n),f.release(n)}}},e.prototype._rebuildTree=function(e,t){var r=this;i.vec3.copy(E.center,t.center),E.radius=t.halfSize;var n=this._boundingSphereFromObjects([e,E],function(e){return e},O),a=f.acquire().init(this._root);this._root.initFrom(null,n.center,1.25*n.radius),this._forEachNode(a,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),f.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,i=e.center,n=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=a[s]-o-(i[s]-r),h=i[s]+r-(a[s]+o),c=Math.max(0,Math.ceil(l/(2*o))),u=Math.max(0,Math.ceil(h/(2*o)))+1,d=Math.pow(2,Math.ceil(Math.log(c+u)*Math.LOG2E));n=Math.max(n,d),A[s].min=c,A[s].max=u}for(s=0;s<3;s++){var p=(n-((c=A[s].min)+(u=A[s].max)))/2;c+=Math.ceil(p),u+=Math.floor(p);var f=a[s]-o-c*o*2;y[s]=f+(u+c)*o}return t.initFrom(null,y,n*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(R.center,this._root.center),R.radius=this._root.halfSize,this._root.init(e),e.advanceTo(R,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,i=0;i<t.length&&null==e;)e=t[r=i++];for(;i<t.length;)if(t[i++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,i=e.center;return e.radius<=r&&i[0]>=t[0]-r&&i[0]<=t[0]+r&&i[1]>=t[1]-r&&i[1]<=t[1]+r&&i[2]>=t[2]-r&&i[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var n=t(e[0],R);i.vec3.copy(r.center,n.center),r.radius=n.radius}else{x[0]=1/0,x[1]=1/0,x[2]=1/0,T[0]=-1/0,T[1]=-1/0,T[2]=-1/0;for(var a=0;a<e.length;a++){n=t(e[a],R);this._isValidRadius(n.radius)&&(o(x,n.center,n.radius),s(T,n.center,n.radius))}i.vec3.lerp(r.center,x,T,.5),r.radius=Math.max(T[0]-x[0],T[1]-x[1],T[2]-x[2])/2}return r},e}(),f=function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this.center=i.vec3f64.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,n,a){return void 0===t&&(t=null),void 0===n&&(n=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),r&&i.vec3.copy(this.center,r),this.halfSize=n,this.depth=a,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var i=g[t];return this.center[0]+=i[0]*this.halfSize,this.center[1]+=i[1]*this.halfSize,this.center[2]+=i[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var i=this._childIndex(e);t&&t(this,i),this.advance(i)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,i=0,n=0;n<3;n++)r[n]<t[n]&&(i|=1<<n);return i},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(d||(d={}));var g=[i.vec3f64.fromValues(-1,-1,-1),i.vec3f64.fromValues(1,-1,-1),i.vec3f64.fromValues(-1,1,-1),i.vec3f64.fromValues(1,1,-1),i.vec3f64.fromValues(-1,-1,1),i.vec3f64.fromValues(1,-1,1),i.vec3f64.fromValues(-1,1,1),i.vec3f64.fromValues(1,1,1)],m=[i.vec3f64.fromValues(-1,-1,-1),i.vec3f64.fromValues(-1,-1,1),i.vec3f64.fromValues(-1,1,-1),i.vec3f64.fromValues(-1,1,1),i.vec3f64.fromValues(1,-1,-1),i.vec3f64.fromValues(1,-1,1),i.vec3f64.fromValues(1,1,-1),i.vec3f64.fromValues(1,1,1)],v=Math.sqrt(3),_=[null],y=i.vec3f64.create(),b=i.vec3f64.create(),x=i.vec3f64.create(),T=i.vec3f64.create(),w=[],S={center:i.vec3f64.create(),radius:0},R={center:i.vec3f64.create(),radius:0},E={center:i.vec3f64.create(),radius:0},O={center:i.vec3f64.create(),radius:0},A=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],P=[],M=[];return p}.apply(null,i))||(e.exports=n)},1632:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(9),r(38),r(1571),r(1590),r(1572),r(1604),r(1591),r(1559),r(1568),r(1666)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d){var p=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),f=function(e){function t(t,r){var i=e.call(this,r)||this;return i.params=u.copyParameters(t,v),"miter"!==i.params.join&&(i.params.miterLimit=0),i.numVertsAtJoin="wall"===i.params.type?2:4,i.numVertsAtCap=2,i.canBeMerged="screen"===i.params.type&&null==i.params.stippleLength,i.bufferWriter="wall"===i.params.type?new x:new y(i.canBeMerged),i}return r(t,e),t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=u.copyParameters(this.params);return e.miterLimit="miter"===e.join?e.miterLimit:0,e},t.prototype.setParameterValues=function(e){for(var t in e)c.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),c.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,o,l,h,u){if(i.isSelection&&!s.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!c.isTranslationMatrix(r))return void p.error("intersection assumes a translation-only matrix");var d=e.data,f=d.getVertexAttr()[c.VertexAttrConstants.POSITION].data,g=d.getVertexAttr()[c.VertexAttrConstants.SIZE],m=g&&g.data[0],v=i.camera,_=i.point,y=(m+this.params.width)/2+4;n.vec3.set(F[0],_[0]-y,_[1]+y,0),n.vec3.set(F[1],_[0]+y,_[1]+y,0),n.vec3.set(F[2],_[0]+y,_[1]-y,0),n.vec3.set(F[3],_[0]-y,_[1]-y,0);for(var b=0;b<4;b++)v.unprojectPoint(F[b],B[b]);a.plane.fromPoints(v.eye,B[0],B[1],V),a.plane.fromPoints(v.eye,B[1],B[2],L),a.plane.fromPoints(v.eye,B[2],B[3],N),a.plane.fromPoints(v.eye,B[3],B[0],U);var x=Number.MAX_VALUE;for(b=0;b<f.length-5;b+=3)if(S[0]=f[b]+r[12],S[1]=f[b+1]+r[13],S[2]=f[b+2]+r[14],R[0]=f[b+3]+r[12],R[1]=f[b+4]+r[13],R[2]=f[b+5]+r[14],!(a.plane.signedDistance(V,S)<0&&a.plane.signedDistance(V,R)<0||a.plane.signedDistance(L,S)<0&&a.plane.signedDistance(L,R)<0||a.plane.signedDistance(N,S)<0&&a.plane.signedDistance(N,R)<0||a.plane.signedDistance(U,S)<0&&a.plane.signedDistance(U,R)<0)){if(v.projectPoint(S,A),v.projectPoint(R,P),A[2]<0&&P[2]>0){n.vec3.subtract(E,S,R);var T=v.frustum,w=-a.plane.signedDistance(T.planes[4],S)/n.vec3.dot(E,T.planes[4]);n.vec3.scale(E,E,w),n.vec3.add(S,S,E),v.projectPoint(S,A)}else if(A[2]>0&&P[2]<0){n.vec3.subtract(E,R,S);T=v.frustum,w=-a.plane.signedDistance(T.planes[4],R)/n.vec3.dot(E,T.planes[4]);n.vec3.scale(E,E,w),n.vec3.add(R,R,E),v.projectPoint(R,P)}else if(A[2]<0&&P[2]<0)continue;var j=c.pointLineSegmentDistanceSquared2D(A,P,_);j<x&&(x=j,n.vec3.copy(M,S),n.vec3.copy(C,R))}var z=i.p0,G=i.p1;if(x<y*y){var H=Number.MAX_VALUE;if(a.lineSegment.closestLineSegmentPoint(a.lineSegment.fromPoints(M,C,D),a.lineSegment.fromPoints(z,G,I),O)){n.vec3.subtract(O,O,z);var k=n.vec3.length(O);n.vec3.scale(O,O,1/k),H=k/n.vec3.distance(z,G)}h(H,O)}}},t.prototype.getGLMaterials=function(){return{color:g,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:m}},t.prototype.getAllTextureIds=function(){return[]},t}(h),g=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.writeDepth?6:9)},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.colorPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})},t.prototype.bind=function(e,t){var r=this.program,i=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",i.color),r.setUniform1f("miterLimit",i.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===i.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",i.width*t.pixelRatio)):r.setUniform1f("extLineWidth",i.width),null!=i.stippleLength){var n=i.stippleLength?1/(2*i.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",n)}i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(i.color[3]>=1&&i.writeDepth)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setBlendingEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;u.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&u.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(l),m=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.highlightPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})},t.prototype.bind=function(e,t){var r=this.program,i=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",i.color),r.setUniform1f("miterLimit",i.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===i.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",i.width*t.pixelRatio)):r.setUniform1f("extLineWidth",i.width),null!=i.stippleLength){var n=i.stippleLength?1/(2*i.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",n)}i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(i.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;u.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&u.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(l),v={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},_=o.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec2f(c.VertexAttrConstants.UV0).vec3f(c.VertexAttrConstants.AUXPOS1).vec3f(c.VertexAttrConstants.AUXPOS2).vec4f(c.VertexAttrConstants.COLOR).f32(c.VertexAttrConstants.SIZE),y=function(){function e(e){this.canBeMerged=e,this.vertexBufferLayout=_,this.numVertsAtJoin=4,this.numVertsAtCap=2}return e.prototype.allocate=function(e){return _.createBuffer(e)},e.prototype.elementCount=function(e){var t=(e.indices[c.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t},e.prototype.write=function(e,t,r,i,n){var a=t.vertexAttr[c.VertexAttrConstants.POSITION].data,o=t.indices&&t.indices[c.VertexAttrConstants.POSITION];o&&o.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var s=t.vertexAttr[c.VertexAttrConstants.COLOR]?t.vertexAttr[c.VertexAttrConstants.COLOR].data:T,l=t.vertexAttr[c.VertexAttrConstants.SIZE]?t.vertexAttr[c.VertexAttrConstants.SIZE].data:w,h=a.length/3,u=e.transformation,d=i.position.typedBuffer,p=0,f=this.vertexBufferLayout.stride/4,g=n*f,m=g;this.canBeMerged&&(g+=f);var v=a[0],_=a[1],y=a[2];if(u){var b=v,x=_,S=y;v=u[0]*b+u[4]*x+u[8]*S+u[12],_=u[1]*b+u[5]*x+u[9]*S+u[13],y=u[2]*b+u[6]*x+u[10]*S+u[14]}var R=a[3],E=a[4],O=a[5];if(u){b=R,x=E,S=O;R=u[0]*b+u[4]*x+u[8]*S+u[12],E=u[1]*b+u[5]*x+u[9]*S+u[13],O=u[2]*b+u[6]*x+u[10]*S+u[14]}for(var A=v,P=_,M=y,C=0;C<h;C++){var D=3*C;if(C<h-1&&(R=a[D+3],E=a[D+4],O=a[D+5],u)){b=R,x=E,S=O;R=u[0]*b+u[4]*x+u[8]*S+u[12],E=u[1]*b+u[5]*x+u[9]*S+u[13],O=u[2]*b+u[6]*x+u[10]*S+u[14]}p+=Math.sqrt((A-v)*(A-v)+(P-_)*(P-_)+(M-y)*(M-y)),d[g++]=A,d[g++]=P,d[g++]=M,d[g++]=p,d[g++]=0===C?-1.2:-1,d[g++]=v,d[g++]=_,d[g++]=y,d[g++]=R,d[g++]=E,d[g++]=O,d[g++]=s[0],d[g++]=s[1],d[g++]=s[2],d[g++]=s[3],d[g++]=l[0],d[g++]=A,d[g++]=P,d[g++]=M,d[g++]=p,d[g++]=0===C?1.2:1,d[g++]=v,d[g++]=_,d[g++]=y,d[g++]=R,d[g++]=E,d[g++]=O,d[g++]=s[0],d[g++]=s[1],d[g++]=s[2],d[g++]=s[3],d[g++]=l[0],C>0&&C<h-1&&(d[g++]=A,d[g++]=P,d[g++]=M,d[g++]=p,d[g++]=-1.2,d[g++]=v,d[g++]=_,d[g++]=y,d[g++]=R,d[g++]=E,d[g++]=O,d[g++]=s[0],d[g++]=s[1],d[g++]=s[2],d[g++]=s[3],d[g++]=l[0],d[g++]=A,d[g++]=P,d[g++]=M,d[g++]=p,d[g++]=1.2,d[g++]=v,d[g++]=_,d[g++]=y,d[g++]=R,d[g++]=E,d[g++]=O,d[g++]=s[0],d[g++]=s[1],d[g++]=s[2],d[g++]=s[3],d[g++]=l[0]),v=A,_=P,y=M,A=R,P=E,M=O}if(this.canBeMerged){for(C=m;C<m+f;C++)d[C]=d[C+f];var I=g-f;for(C=0;C<f;C++)d[g++]=d[I++]}},e}(),b=o.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec2f(c.VertexAttrConstants.UV0),x=function(){function e(){this.vertexBufferLayout=b,this.numVertsAtJoin=2,this.numVertsAtCap=2,this.tmpCurrent=n.vec3f64.create(),this.tmpLast=n.vec3f64.create()}return e.prototype.allocate=function(e){return _.createBuffer(e)},e.prototype.elementCount=function(e){return(e.indices[c.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap},e.prototype.write=function(e,t,r,i,a){var o=t.vertexAttr[c.VertexAttrConstants.POSITION].data,s=t.indices&&t.indices[c.VertexAttrConstants.POSITION];s&&s.length!==2*(o.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var l=o.length/3,h=e.transformation,u=0,d=this.tmpCurrent,p=this.tmpLast;n.vec3.set(d,o[0],o[1],o[2]);for(var f=a,g=0;g<l;g++){var m=3*g;n.vec3.copy(p,d),n.vec3.set(d,o[m],o[m+1],o[m+2]),h&&n.vec3.transformMat4(d,d,h),u+=n.vec3.squaredDistance(p,d),i.position.setVec(f,d),i.uv0.set(f,0,u),i.uv0.set(f,1,-1),++f,i.position.setVec(f,d),i.uv0.set(f,0,u),i.uv0.set(f,1,1),++f}},e}(),T=[255,255,255,255],w=[0,0,0,0],S=n.vec3f64.create(),R=n.vec3f64.create(),E=n.vec3f64.create(),O=n.vec3f64.create(),A=n.vec3f64.create(),P=n.vec3f64.create(),M=n.vec3f64.create(),C=n.vec3f64.create(),D=a.lineSegment.create(),I=a.lineSegment.create(),F=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],B=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],V=a.plane.create(),L=a.plane.create(),N=a.plane.create(),U=a.plane.create();return f}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(139)],void 0===(n=function(e,t,r){return{now:r}}.apply(null,i))||(e.exports=n)},1644:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1686)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,i=this.buffers;t<i.length;t++){var n=i[t];if(n.availableCount>=e)return n}if(e>r.MAX_INDEX_COUNT)return null;var a=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(a),a},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=i}.apply(null,i))||(e.exports=n)},1645:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1639)],void 0===(n=function(e,t,r){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=r.now()},e.prototype.stop=function(){var e=r.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,i))||(e.exports=n)},1648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(1649),r(1650),r(1580),r(1651)],void 0===(n=function(e,t,r,i,n,a,o){function s(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._lineWidth=1,this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=a.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=o.loadCapabilities(e,t);var i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]};var s=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:s?this.gl.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)},r("esri-webgl-debug")&&(this.instanceCounter=new n),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},r("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e)},e.prototype.setBlendColor=function(e,t,r,i){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&i===this._blendColorState.a||(this.gl.blendColor(e,t,r,i),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=i)},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t)},e.prototype.setBlendFunctionSeparate=function(e,t,r,i){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=i)},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e)},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t)},e.prototype.setColorMask=function(e,t,r,i){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===i||(this.gl.colorMask(e,t,r,i),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=i)},e.prototype.setClearColor=function(e,t,r,i){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=i)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e)},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e)},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t))},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e)},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e)},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,r,i){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=i)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e)},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e)},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e)},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t)},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e)},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r)},e.prototype.setStencilFunctionSeparate=function(e,t,r,i){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=i)},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e)},e.prototype.setStencilOp=function(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r)},e.prototype.setStencilOpSeparate=function(e,t,r,i){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=i)},e.prototype.setLineWidth=function(e){var t=this._lineWidth;return this._lineWidth!==e&&(this.gl.lineWidth(e),this._lineWidth=e),t},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(i.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.drawArrays=function(e,t,i){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,i)),this.gl.drawArrays(e,t,i)},e.prototype.drawElements=function(e,t,i,n){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,t)),5123!==i?5125===i&&this.gl.drawElements(e,t,i,n):this.gl.drawElements(e,t,i,n)},e.prototype.logIno=function(){r("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,r,i){var n=this._viewport;n.x===e&&n.y===t&&n.width===r&&n.height===i||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,r){void 0===r&&(r=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),(r>=e._MAX_TEXTURE_IMAGE_UNITS||r<0)&&console.error("Input texture unit is out of range of available units!");var i=this._textureUnitMap[r];return this.setActiveTexture(r),null==t||null==t.glName?(null!=i&&(this.gl.bindTexture(i.descriptor.target,null),i.setBoundToUnit(r,!1)),void(this._textureUnitMap[r]=null)):i&&i.id===t.id?void t.applyChanges():(this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(r,!0),t.applyChanges(),void(this._textureUnitMap[r]=t))},e.prototype.bindFramebuffer=function(e){if(!e)return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this._capabilities.vao;t&&t.bindVertexArray(null);for(var n=0;n<this.parameters.maxVertexAttributes;n++)e.disableVertexAttribArray(n);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var a=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(a)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(this._lineWidth),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(i.BASE_TEXTURE_UNIT+o),e.bindTexture(3553,null);var s=this._textureUnitMap[o];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(i.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),r("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,r,i){return t?i===t?i:(e.bindBuffer(r,t.glName),t):(e.bindBuffer(r,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,i))||(e.exports=n)},1649:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,i))||(e.exports=n)},1650:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}return e.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}},e.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}},e.prototype.printResourceCount=function(){console.log("Live objects:"),console.log("Textures: "+this._instanceCount.textureCount),console.log("Buffers: "+this._instanceCount.bufferCount),console.log("VAOs: "+this._instanceCount.vaoCount),console.log("Programs: "+this._instanceCount.programCount),console.log("Framebuffers: "+this._instanceCount.framebufferCount),console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)},e}()}.apply(null,i))||(e.exports=n)},1651:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1652),r(1653),r(1580),r(1654)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){if(n.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}function s(e,t){if(n.default(e))return!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float")?{R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F}:null;if(e instanceof WebGLRenderingContext){var r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return r||i?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}}function l(e,t,r,i,a){if(i&&n.default(e))return!0;if(t[r])return!1;for(var o=0,s=a;o<s.length;o++){var l=s[o];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var n=t&&t.disabledExtensions||{};return l(e,n,"standardDerivatives",!0,["OES_standard_derivatives"]),{instancing:i.load(e),vao:a.load(e,n),compressedTextureS3TC:function(e,t){if(t.compressedTextureS3TC)return null;var r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,n),textureFilterAnisotropic:function(e,t){if(t.textureFilterAnisotropic)return null;var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,n),disjointTimerQuery:r.load(e,n),colorBufferFloat:s(e,n),blendMinMax:o(e,n),depthTexture:l(e,n,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:l(e,n,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:l(e,n,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:l(e,n,"fragDepth",!0,["EXT_frag_depth"])}}}.apply(null,i))||(e.exports=n)},1652:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var i=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return i?r.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(i.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return i.createQueryEXT()},resultAvailable:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return i.endQueryEXT(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,i))||(e.exports=n)},1653:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(r.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,i))||(e.exports=n)},1654:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(r.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}}.apply(null,i))||(e.exports=n)},1661:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(262),r(1586),r(1559)],void 0===(n=function(e,t,r,i,n,a){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return i.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;i.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return a.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var i=t._model.content[n.OBJECT][r];i&&i.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],i=[],o=[],s=this,l=0;l<e.length;l++)!function(l){var h=e[l],c=s._dirtyGeomRecords.get(h);if(!c)return"continue";c.forEach(function(e,s){var l=t._ensureGeomRecord(h,s);e.forEach(function(e,h){var c,u=e[0],d=e[1],p=e[2],f=2&d&&1&p;(4&d||f)&&((c=l.get(h))?i.push.apply(i,c[1]):4===d&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),c&&l.delete(h));if(1&d||f){var g=[u,[]],m=t._model.get(n.OBJECT,s);t._model.getGeometryRenderGeometries(m,u,g[1]),r.push.apply(r,g[1]),l.set(h,g)}if(2&d&&!f)if(c=l.get(h)){var v=c[1],_=v.length;if(16&p){m=t._model.get(n.OBJECT,s);for(var y=0;y<_;y++){var b=v[y];t._model.updateRenderGeometryTransformation(m,u,b)}}for(y=0;y<_;y++){b=v[y];o.push({renderGeometry:b,updateType:p})}}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===l.size&&t._residentGeomRecords.get(h).delete(s)}),0===s._residentGeomRecords.get(h).size&&s._residentGeomRecords.delete(h),s._dirtyGeomRecords.delete(h)}(l);return[r,i,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=this._residentGeomRecords.get(i);n&&n.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,2);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,2)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,32);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,32)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryAdded(t,i[n],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryRemoved(t,i[n],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,i){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,i)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,i,n,o,s,l,h){r=r||this._getParentLayerId(e);var c=e.id,u=t.id,d=this._ensureDirtyRecord(r,c),p=d.get(u);if(p){var f=p[1];f&n?d.delete(u):f&o?(p[1]=i,p[2]=h):f&s?p[2]|=h:f&l||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else d.set(u,[t,i,h])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,i){e.forEach(function(e,n){r.length>0&&(r+="\n"),r+=i+"."+n;var a=[];e.forEach(function(e){var t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(var o=0;o<a.length;o++)if(a[o]){r+=" "+t[o-1]+": ";for(var s=0;s<a[o].length;s++)r+=a[o][s]+", "}})}),r},e}()}.apply(null,i))||(e.exports=n)},1662:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(19),r(9),r(7),r(38),r(1663),r(1700),r(1701),r(1807),r(1702),r(1597),r(1608),r(1704),r(267),r(519),r(1562),r(1648)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g,m,v,_){var y=n.getLogger("esri.views.3d.webgl-engine.parts.View"),b=function(){function e(e,t,r,i){var n=this;this.options=i,this._backgroundColor=o.vec4f64.fromValues(1,1,1,1),this._lightDirection=o.vec3f64.fromValues(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(i),this._programRepository=new c(this._rctx),this._programRepository.globalOptions.viewingMode=i.viewingMode;this._textureRep=new h(t.getAll(p.ContentType.TEXTURE),this._programRepository,function(){return n._viewport.getCamera().viewport},this._rctx),this._materialRep=new l(this._textureRep,this._programRepository),this._viewport=new f(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new s(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){u.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,x.lightDirection=e._lightDirection,x.disableSlice=!1,e._viewport.render(x))},postRender:function(){u.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=m.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=u.instrumentContext(r);var n={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new _(this._gl,n),!e.alpha&&this._rctx.contextAttributes.alpha&&y.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&i("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){o.vec3.set(this._lightDirection,0,0,0);for(var t=0,r=e.lights;t<r.length;t++){var i=r[t];if(i instanceof d.MainLight){o.vec3.negate(this._lightDirection,i.direction);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t={};return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},e.prototype.getIdleSuspend=function(){return this._idleSuspend},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,r,i){this._viewport.modify(e,t,r,i)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,r=a.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==r})});return this._screenshotQueue.push({settings:e,resolver:r}),this._needsRender=!0,r.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._renderScreenshotOverlay=function(e,t,r){if(this.options.renderScreenshotOverlay){e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.save(),i.translate(0,t.height),i.scale(1,-1),r.region&&i.translate(-r.region.x,-r.region.y),i.scale(r.pixelRatio,r.pixelRatio),this.options.renderScreenshotOverlay(e,t),i.restore()}},e.prototype._readbackScreenshot=function(e){var t=e.framebufferWidth,i=e.framebufferHeight,n=e.region,a=e.resample,o=this._ensureScreenshotEncodeCanvas();if(a){var s=g.createEmptyImageData(t,i,o);this._gl.readPixels(0,0,t,i,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(o,s,r({},e,{region:null}));var l=g.createEmptyImageData(n.width,n.height,o);return g.resampleHermite(s,l,!0,a.region.x,i-(a.region.y+a.region.height),a.region.width,a.region.height)}s=g.createEmptyImageData(n.width,n.height,o);return this._gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(o,s,e),s},e.prototype._renderScreenshot=function(e){var t=null,r=this._viewport.getCamera(),i=g.screenshotSuperSampleSettings(e,this._supersampleScreenshots),n=i.framebufferWidth,a=i.framebufferHeight,o=!1;if(n!==r.fullWidth||a!==r.fullHeight||e.disableSlice){var s=r.copy();s.fullWidth=n,s.fullHeight=a;var l=r.fovX-s.fovX,h=r.fovY-s.fovY;l<0&&l<h?s.fovX=r.fovX:h<0&&h<l&&(s.fovY=r.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(s),o=!0,t=new v(this._rctx,{width:s.fullWidth,height:s.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clear(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:s,pixelRatio:i.pixelRatio,disableSlice:e.disableSlice})}var c=this._readbackScreenshot(i);return t&&t.dispose(),this._rctx.bindFramebuffer(null),o&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(r),c},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var r=t[e],i=r.settings;if(this._gl){var n=this._ensureScreenshotEncodeCanvas(),a=this._renderScreenshot(i),o=g.encodeResult(a,i,n,{flipY:!0,premultipliedAlpha:!0});r.resolver(o)}else r.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},e}(),x={lightDirection:o.vec3f64.create(),camera:null,fbo:null,pixelRatio:1,disableSlice:!1};return b}.apply(null,i))||(e.exports=n)},1663:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1589),r(1594),r(1572),r(1587),r(1578),r(1613),r(1610),r(1622),r(1624),r(1597),r(1699),r(1562),r(1560),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g,m){var v=function(){function e(e,t,i,n,a,o){var s=this;this._renderTargets={},this._clearColor=r.vec4f64.fromValues(0,0,0,0),this._uniqueIdx=0,this._localOrigins=new l,this._rctx=e,this._canvas=t,this._programRep=i,this._modelDirtySet=o,this._modelDirtySet.onMaterialChanged=function(e){return s.materialChanged(e)},this._renderer=new c(i,n,a,this._rctx,!0),this._sliceHelper=new u,this._renderer.onHasHighlightsChanged=function(e){s.onHasHighlightsChanged&&s.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new d.AmbientLight(r.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t._localOrigins.getOrigin(e.center)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var r=e.instanceParameters,i=h.generateHighlightId();return r.componentHighlights=a.addHighlight(r.componentHighlights,null,t,i),this.updateRenderGeometries([e],32),i},e.prototype.removeRenderGeometryHighlight=function(e,t){var r=e.instanceParameters;r.componentHighlights=a.removeHighlight(r.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!i.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(0,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},e.prototype.drawPass=function(e,t,n){if(this.isEmpty()||4===e&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!n.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var a=this._renderTargets[t];if(!a)return!1;var o=this._rctx,s=o.gl,l=n.width,h=n.height;a.width===l&&a.height===h||(a.resize(l,h),a.colorTexture.setSamplingMode(9729));var c=y.camera;y.fbo=a,y.pixelRatio=n.pixelRatio||1,c.near=1,c.far=1e4,o.bindFramebuffer(a),o.setDepthTestEnabled(!1),o.setBlendFunctionSeparate(770,771,1,771),o.setClearColor.apply(o,this._clearColor),o.clear(s.COLOR_BUFFER_BIT);for(var u=0;u<n.views.length;u++){var d=n.views[u];c.viewport=d.viewport,r.mat4.ortho(c.projectionMatrix,0,d.extent[2]-d.extent[0],0,d.extent[3]-d.extent[1],c.near,c.far),r.mat4.identity(c.viewMatrix),r.mat4.translate(c.viewMatrix,c.viewMatrix,[-d.extent[0],-d.extent[1],0]),c.setGLViewport(this._rctx),i.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(l,h,_[n.index%_.length]),this._renderer.renderGeometryPass(e,y,null,null,this._sliceHelper)}return o.setDepthTestEnabled(!0),o.setBlendFunctionSeparate(770,771,1,771),o.bindFramebuffer(null),o.setViewport(0,0,this._canvas.width,this._canvas.height),a.colorTexture.descriptor.hasMipmap&&a.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,i){var n=this._rctx,a=n.gl;if(!this._testPatternMat){for(var l=new Uint8Array(e*t*4),h=0,c=0;c<t;c++)for(var u=0;u<e;u++){var d=Math.floor(u/10),f=Math.floor(c/10);d<2||f<2||10*d>e-20||10*f>t-20?(l[h++]=255,l[h++]=255,l[h++]=255,l[h++]=255):(l[h++]=255,l[h++]=255,l[h++]=255,l[h++]=1&d&&1&f?1&u^1&c?0:255:1&d^1&f?0:128)}var v=new g(n,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},l);this._testPatternMat=new p(this._programRep,v,[1,1,1,1],!0,a.ALWAYS),this._testPatternBindParams={proj:r.mat4f64.create(),view:r.mat4f64.create(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(n,o.Pos3Tex)}this._testPatternMat.setColor([i[0],i[1],i[2],1]),this._testPatternMat.bind(n,this._testPatternBindParams),this._testPatternMat.bindView(n,this._testPatternBindParams),n.bindVAO(this._quadVAO),n.drawArrays(5,0,m.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(n)},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,i=0;this._renderTargets[r];)r=e+"_"+ ++i;return this._renderTargets[r]=f.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e}(),_=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],y={fbo:null,camera:new n,pixelRatio:1};return v}.apply(null,i))||(e.exports=n)},1664:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1559)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e,t,r,a){n.assert(e.length>=1),n.assert(r.length%t==0),n.assert(r.length>=e.length*t),n.assert(3===a.size||4===a.size),this.primitiveIndices=e,this.indices=r,this._position=a,this._numIndexPerPrimitive=t;var s=a.data,l=a.offsetIdx,h=a.strideIdx,c=0,u=e.length,d=l+h*r[t*e[c]];for(o.clear(),o.push(d),this.bbMin=i.vec3f64.fromValues(s[d],s[d+1],s[d+2]),this.bbMax=i.vec3f64.clone(this.bbMin);c<u;++c)for(var p=t*e[c],f=0;f<t;++f){d=l+h*r[p+f],o.push(d);var g=s[d];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=s[d+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=s[d+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}this.center=i.vec3f64.create(),i.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var m=this.bsRadius*this.bsRadius;for(c=0;c<o.length;++c){var v=s[d=o.data[c]]-this.center[0],_=s[d+1]-this.center[1],y=s[d+2]-this.center[2],b=v*v+_*_+y*y;if(!(b<=m)){var x=Math.sqrt(b),T=.5*(x-this.bsRadius);this.bsRadius=this.bsRadius+T,m=this.bsRadius*this.bsRadius;var w=T/x;this.center[0]+=v*w,this.center[1]+=_*w,this.center[2]+=y*w}}o.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=i.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,n=new Uint8Array(r),a=new Array(8),o=0;o<8;++o)a[o]=0;var s=this._position,l=s.data,h=s.offsetIdx,c=s.strideIdx;for(o=0;o<r;++o){for(var u=0,d=this._numIndexPerPrimitive*this.primitiveIndices[o],p=h+c*this.indices[d],f=l[p],g=l[p+1],m=l[p+2],v=1;v<this._numIndexPerPrimitive;++v){var _=l[p=h+c*this.indices[d+v]],y=l[p+1],b=l[p+2];_<f&&(f=_),y<g&&(g=y),b<m&&(m=b)}f<t[0]&&(u|=1),g<t[1]&&(u|=2),m<t[2]&&(u|=4),n[o]=u,++a[u]}var x=0;for(o=0;o<8;++o)a[o]>0&&++x;if(x<2)return;var T=new Array(8);for(o=0;o<8;++o)T[o]=a[o]>0?new Uint32Array(a[o]):void 0;for(o=0;o<8;++o)a[o]=0;for(o=0;o<r;++o){T[u=n[o]][a[u]++]=this.primitiveIndices[o]}this.children=new Array(8);for(o=0;o<8;++o)void 0!==T[o]&&(this.children[o]=new e(T[o],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}(),o=new r({deallocator:null});return a}.apply(null,i))||(e.exports=n)},1665:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577)],void 0===(n=function(e,t,r){return function(){function e(t,r,i,n,a,o){this.id=e._idGen.gen(t.id),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=n,this.origin=a,this.shaderTransformation=o}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},1666:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({WALL:e.wall,SCREENSCALE:e.screenScale,STIPPLE:e.stipple,SLICE:e.slice})};t.colorPass={name:"ribbon-line-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"ribbon-line-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1667:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=0,this.shadowMap=null,this.slot=0,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.sliceHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1668:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(92)],void 0===(n=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,i;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return i=new Float32Array(r),t&&i.set(this.array),this.array=i,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var n=2*this.size;r>=n;)r=Math.floor(r/2);return i=new Float32Array(r),t&&i.set(this.array.subarray(0,r)),this.array=i,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,i))||(e.exports=n)},1669:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1564),r(1647),r(1567)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new i(e,o.shader.vertex,o.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new n(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindProgram(this.program),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/i.width,1/i.height),r.setFaceCullingEnabled(!1),r.drawArrays(4,0,3)},e}(),o={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return a}.apply(null,i))||(e.exports=n)},1670:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1562)],void 0===(n=function(e,t,r){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null}return e.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)},Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.prepareHighlightPass=function(e){var t=this._rctx,r=t.gl,i=e.fullViewport,n=i[2],a=i[3];this.updateFBO(n,a),this.viewportToRestore=i,this._rctx.setViewport(0,0,n,a),t.bindFramebuffer(this.fbo),t.setClearColor(0,0,0,0),t.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.updateFBO=function(e,t){this.fbo?this.fbo.resize(e,t):this.fbo=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:e,height:t},{colorTarget:0,depthStencilTarget:1})},e}()}.apply(null,i))||(e.exports=n)},1671:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(92)],void 0===(n=function(e,t,r){return function(){function e(e,t){null==t&&(t=4);var i=r.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(i),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,r){this.array.set(r,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],r=e*this.perInstanceDataSize,i=t*this.perInstanceDataSize;this.array.set(this.array.subarray(r,r+this.perInstanceDataSize),i),this.array.set(this.zeroItem,r);var n=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=n,this.id2slot[n]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,r;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(r=new Float32Array(t)).set(this.array),this.array=r}else if(e<=this.array.length/2){t=this.array.length;for(var i=2*e;t>=i;)t/=2;(r=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=r}},e}()}.apply(null,i))||(e.exports=n)},1672:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push([i[0],i[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];i[0]=i[0]*t,i[1]=i[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],i=0;i<e.length;i++){var n=e[i];if(!(n[1]<t[0]||n[0]>t[1])){var a=[n[0],n[1]];a[0]<t[0]&&(a[0]=t[0]),a[1]>t[1]&&(a[1]=t[1]),r.push(a)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var i=t[t.length-1];i[1]+1<e[r][0]?t.push(e[r]):i[1]<e[r][1]&&(i[1]=e[r][1],t.pop(),t.push(i))}return t},e.invertIntervals=function(e,t){for(var r=[],i=0,n=0;n<e.length;n++){var a=e[n];a[0]>i&&r.push([i,a[0]-1]),i=a[1]+1}return i<=t&&r.push([i,t]),r},e.offsetIntervals=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i];r.push([n[0]+t,n[1]+t])}return r},e}()}.apply(null,i))||(e.exports=n)},1673:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559),r(1562)],void 0===(n=function(e,t,r,i){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){r.assert(!this.enabled),this._depthFBO=i.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){r.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,i))||(e.exports=n)},1674:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559),r(1562)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){r.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=i.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},1675:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1609)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<23;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var i=e[r];this.slots[i].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var i=r[t];i.prepareRender&&i.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,i=0,n=this.slots[e];i<n.length;i++){var a=n[i];a.render(t)&&(a.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=n;t.near=1/0,t.far=-1/0;for(var i=0,a=this.renderPlugins;i<a.length;i++){var o=a[i];if(o.queryDepthRange){var s=o.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}();t.RenderPluginManager=i;var n={near:0,far:0}}.apply(null,i))||(e.exports=n)},1676:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1601),r(1564),r(1562),r(1647),r(1560),r(1567)],void 0===(n=function(e,t,i,n,a,o,s,l){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(86).then(function(){var i=[r(1838)];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,i)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new o(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new o(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new o(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(e,34962,35044,t)}),this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setFaceCullingEnabled(!0),r.setCullFace(1029),r.setFrontFace(2305),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!1),r.setViewport(i.x,i.y,i.width,i.height),this.tmpFramebufferEdges.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3),r.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,r){var n=new s(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return i.requestImage(e).then(function(e){n.resize(e.width,e.height),n.setData(e)}),n},e}()}.apply(null,i))||(e.exports=n)},1677:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559)],void 0===(n=function(e,t,r){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){r.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,i))||(e.exports=n)},1678:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(114),r(83),r(73),r(7),r(182),r(141),r(38),r(92),r(1588),r(1583),r(1614),r(1613),r(1623),r(1685),r(1727),r(1644),r(1756),r(1803),r(1518),r(1689),r(1691),r(1692),r(1564),r(1567),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g,m,v,_,y,b,x,T,w,S,R,E,O){Object.defineProperty(t,"__esModule",{value:!0});var A=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new m.LocalOriginManager(new f),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new x,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=h.vec3f64.create(),this.tmpCameraPosition=h.vec3f64.create(),this.componentColorManager=new _.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;l.open(s.getAbsMid("./EdgeProcessingWorker",e,O)).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=y.VertexLayout.createBuffer(4),i=0;i<4;i++)r.sideness.set(i,0,0===i||3===i?0:1),r.sideness.set(i,1,0===i||1===i?0:1);this.verticesBufferObject=R.createVertex(this.rctx,35044,r.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,s,l,h,c,u;return n(this,function(n){switch(n.label){case 0:if(this.hasObject(e))return[2];if(i=new Array,l={loaded:o.create(function(e){return s=e}),renderables:[]},this.perObjectData.set(e,l),a&&a.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))i.push(this.addObjectMergedGeometries(e,l,t,r));else for(h=0;h<e.geometries.length;h++)c=e.geometries[h],u=e.geometryRecords[h],u.material.supportsEdges&&(c.data instanceof v?i.push(this.addGeometryPreinterleaved(e,l,c,c.data,u,t,r)):i.push(this.addGeometryNonPreinterleaved(e,l,c,c.data,u,t[0],r)));return[4,o.all(i)];case 1:return n.sent(),this.callbacks.setNeedsRender(),s(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r=n.sent(),i=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var n=i(r),a=e.components.meta[r],o=a.index;a.material.opacity=n,e.components.buffer.textureBuffer.setDataElement(o,1,3,255*n)}e.allTransparent=S.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t,r,a){return void 0===a&&(a=!0),i(this,void 0,void 0,function(){var i,o,s=this;return n(this,function(n){switch(n.label){case 0:return[4,this.getObjectEntry(e)];case 1:return i=n.sent(),o=r.slicePlaneEnabled||!1,i.renderables.forEach(function(e){var r=t[0],i=S.determineRequiresUberRenderer(t),n=T.EdgeRenderer.getKey(i,r.type,o);if(n!==e.rendererKey){var l=s.renderers.get(e.rendererKey),h=s.acquireRenderer(i,r,o);l.removeRenderable(e),l.refCount.decrement(),e.rendererKey=n,h.addRenderable(e)}for(var c=0;c<t.length;c++)e.components.meta[c].material=t[c];a&&s.updateComponentBuffer(e.components),e.allTransparent=S.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return i(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.getObjectEntry=function(e){return i(this,void 0,void 0,function(){var t;return n(this,function(r){switch(r.label){case 0:if(!(t=this.perObjectData.get(e)))throw"no object";return[4,t.loaded];case 1:return r.sent(),[2,t]}})})},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},P,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},M,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,i=0,n=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){i+=e.statistics.averageEdgeLength,n++})});var a={distanceFalloffFactor:40*(i/n),minimumEdgeLength:S.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},o=this.rctx.capabilities.blendMinMax;o?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,o.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,a),t.renderSilhouetteEdges(r,e,a)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var i=h.vec3.set(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.aquire(i)}return g.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,i=0;i<t.length;i++){var n=t[i].material,a=t[i].index,o=c.clamp(Math.round(n.size*T.LINE_WIDTH_FRACTION_FACTOR),0,255),s=c.clamp(n.extensionLength,-T.EXTENSION_LENGTH_OFFSET,255-T.EXTENSION_LENGTH_OFFSET)+T.EXTENSION_LENGTH_OFFSET,l="solid"===n.type?0:1,h=255*n.opacity,u=n.color,d=255*u[0],p=255*u[1],f=255*u[2],g=255*u[3];r.textureBuffer.setData(a,0,d,p,f,g),r.textureBuffer.setData(a,1,o,s,l,h)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),i=0;i<e.length;i++){var n=e[i],a=r.aquireIndex();t.push({index:a,material:n})}var o={meta:t,buffer:r};return this.updateComponentBuffer(o),o},t.prototype.extractEdges=function(e,t,r,i){return this.worker.process({data:t,originalIndices:i,writerSettings:e,skipDeduplicate:r},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new E(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:R.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new E(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:R.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,a,o,s,l){return i(this,void 0,void 0,function(){var r,i,c,u;return n(this,function(n){switch(n.label){case 0:return r=a.getAttribute("position"),i=this.computeModelTransformWithLocalOrigin(e,o,h.mat4f64.create()),c=o.origin,u={position:r,indices:a.getIndices("position"),modelTransform:i,origin:c},[4,this.addNonPreinterleaved(e,t,u,s,l)];case 1:return n.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,r,a,o){return i(this,void 0,void 0,function(){var e,i,s,l,h,c,u,d,p,f,g,m,v,_,b;return n(this,function(n){switch(n.label){case 0:for(e=this.acquireRenderer(!1,a,o.slicePlaneEnabled||!1),i=r.modelTransform,s=r.origin,l=r.indices,h=r.position,c=h.data.length/h.strideIdx,u=y.EdgeInputBufferLayout.createBuffer(c),d=0;d<c;d++)u.position.set(d,0,h.data[h.offsetIdx+d*h.strideIdx+0]),u.position.set(d,1,h.data[h.offsetIdx+d*h.strideIdx+1]),u.position.set(d,2,h.data[h.offsetIdx+d*h.strideIdx+2]);return p=this.createComponentBuffers([a]),S.fillComponenBufferIndices(p.meta,[0,u.componentIndex.count],u.componentIndex),[4,this.extractEdges(e.writerSettings,u,!1,l)];case 1:return f=n.sent(),g=this.createEdgeResources(f),m=g.regular,v=g.silhouette,_=(m?m.vao.size:0)+(v?v.vao.size:0),b={regular:m,silhouette:v,transform:{modelMatrix:i,origin:s},statistics:{gpuMemoryUsage:_,averageEdgeLength:f.averageEdgeLength},components:p,visible:!0,allTransparent:S.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(b),e.addRenderable(b),this.gpuMemoryUsage+=_,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,a,o,s,l){return i(this,void 0,void 0,function(){var r,i,c,f,g,m,v,_,b,x,T,w,R,E,O,A,P;return n(this,function(n){switch(n.label){case 0:return(r=a.getAttribute("position"))&&d.isFloat32Array(r.data)?(i=s[0],c=S.determineRequiresUberRenderer(s),f=this.acquireRenderer(c,i,l.slicePlaneEnabled||!1),g=this.computeModelTransformWithLocalOrigin(e,o,h.mat4f64.create()),m=o.origin,v=a.getIndices("position"),_=new u.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),b=y.EdgeInputBufferLayout.createBuffer(_.count),p.vec3.copy(b.position,_),x=this.createComponentBuffers(s),S.fillComponenBufferIndices(x.meta,a.componentOffsets,b.componentIndex,v),T=a.hasPositionData,[4,this.extractEdges(f.writerSettings,b,T,v)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return w=n.sent(),R=this.createEdgeResources(w),E=R.regular,O=R.silhouette,A=(E?E.vao.size:0)+(O?O.vao.size:0),P={regular:E,silhouette:O,transform:{modelMatrix:g,origin:m},statistics:{gpuMemoryUsage:A,averageEdgeLength:w.averageEdgeLength},components:x,visible:!e.isHidden(o),allTransparent:S.determineAllTransparent(x.meta),distanceToCamera:0,rendererKey:f.key},t.renderables.push(P),f.addRenderable(P),this.gpuMemoryUsage+=A,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,i=0;i<e.geometries.length;i++){var n=e.geometries[i],o=e.geometryRecords[i];if(o.material.supportsEdges){if(n.data instanceof v)return!1;if(t){if(!a.equals(t,o.transformation))return!1}else t=o.transformation;if(!r&&o.origin)r=o;else if(r&&o.origin&&r.origin.id!==o.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,o,s,l,c,u,p,f,g,m,v,_,y,b,x,T,w,S,R,E;return n(this,function(n){switch(n.label){case 0:for(i=new Map,o=0,s=null,l=null,R=0;R<e.geometries.length;R++)g=e.geometries[R],c=e.geometryRecords[R],c.material.supportsEdges&&(!l&&c.origin&&(l=c),_=g.data.getIndices("position"),o+=_?_.length:0,(_&&null==s||s===Uint16Array)&&(s=d.isUint16Array(_)?Uint16Array:Uint32Array));for(u=o?new s(o):null,p=[],f=0,R=0;R<e.geometries.length;R++)if(g=e.geometries[R],m=e.geometryRecords[R],m.material.supportsEdges){if(v=g.data.getAttribute("position"),_=g.data.getIndices("position"),null==(y=i.get(v.data))){for(y=p.length/3,b=v.offsetIdx;b<v.data.length;b+=v.strideIdx)p.push(v.data[b+0]),p.push(v.data[b+1]),p.push(v.data[b+2]);i.set(v.data,y)}if(_)for(x=0;x<_.length;x++)u[f++]=y+_[x]}for(T=l||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,T,h.mat4f64.create()),S=T.origin,R=0;R<e.geometryRecords.length;R++)e.geometryRecords[R].origin=S;return E={position:{data:p,offsetIdx:0,strideIdx:3},indices:u,modelTransform:w,origin:S},[4,this.addNonPreinterleaved(e,t,E,r[0],a)];case 1:return n.sent(),[2]}})})},t.prototype.acquireRenderer=function(e,t,r){var i=T.EdgeRenderer.getKey(e,t.type,r),n=this.renderers.get(i);return this.strokesTexture||(this.strokesTexture=w.generateStrokesTexture(this.rctx)),n||(n=new T.EdgeRenderer(this.rctx,this.programRepository,{type:t.type,slicePlaneEnabled:r,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(i,n)),n.refCount.increment(),n},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,i=e.components.meta;r<i.length;r++){var n=i[r];e.components.buffer.releaseIndex(n.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;h.vec3.set(this.tmpCameraPosition,r[3],r[7],r[11]),this.perObjectData.forEach(function(e,r){var i=h.vec3.distance(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=i})})},t.prototype.renderRegularEdges=function(e,t,r){var i=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.regular&&!n.allTransparent){var a=S.computeEdgeCount(n.regular.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderRegularEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var i=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.silhouette&&!n.allTransparent){var a=S.computeEdgeCount(n.silhouette.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderSilhouetteEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t}();t.EdgeView=A;var P={color:h.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1},M={color:h.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,i))||(e.exports=n)},1679:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c){for(var u=0;u<9;++u)i[l+u]=a[h+u];l+=n,h+=o}}}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c){for(var u=0;u<16;++u)i[l+u]=a[h+u];l+=n,h+=o}}}.apply(null,i))||(e.exports=n)},1681:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[h],l+=n,h+=o},t.makeDense=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var i=0;i<r;i++)t[i]=e.get(i);return t}}.apply(null,i))||(e.exports=n)},1682:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1655)],void 0===(n=function(e,t,r){function i(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[h],i[l+1]=a[h+1],l+=n,h+=o}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=i,t.normalizeIntegerBuffer=function(e,t,n){var a=e.typedBuffer,o=e.typedBufferStride,s=t.typedBuffer,l=t.typedBufferStride,h=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*o,u=(n&&n.srcIndex?n.srcIndex:0)*l;if(r.isInteger(t.elementType)){var d=r.maximumValue(t.elementType);if(r.isSigned(t.elementType))for(var p=0;p<h;++p)a[c]=Math.max(s[u]/d,-1),a[c+1]=Math.max(s[u+1]/d,-1),c+=o,u+=l;else for(p=0;p<h;++p)a[c]=s[u]/d,a[c+1]=s[u+1]/d,c+=o,u+=l}else i(e,t,n);return e}}.apply(null,i))||(e.exports=n)},1683:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[h],i[l+1]=a[h+1],i[l+2]=a[h+2],l+=n,h+=o}}.apply(null,i))||(e.exports=n)},1684:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,h=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[h],i[l+1]=a[h+1],i[l+2]=a[h+2],i[l+3]=a[h+3],l+=n,h+=o}}.apply(null,i))||(e.exports=n)},1685:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1623)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:r.mat4f64.create(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4.copy(t.viewMatrix,e),i.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=n}.apply(null,i))||(e.exports=n)},1686:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1687),r(1688)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var n=function(){function e(e,n){void 0===n&&(n=1),this.textureBuffer=new i.TextureBackedBuffer(e,n),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},1687:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,i))||(e.exports=n)},1688:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1588),r(1560)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new i(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,i,n,a){var o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,r),this.data.set(o,1,i),this.data.set(o,2,n),this.data.set(o,3,a)},e.prototype.setDataElement=function(e,t,r,i){var n=e*this.fieldCount+t;this.dirty=!0,this.data.set(n,r,i)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var i=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,n=new r.BufferViewVec4u8(new ArrayBuffer(4*i));n.typedBuffer.set(this.data.typedBuffer),this.data=n}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},1689:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(26),r(38),r(92),r(1568),r(1690)],void 0===(n=function(e,t,r,i,n,a,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var l={type:"solid",slicePlaneEnabled:!1,uber:!0,strokesTexture:null},h=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),c=function(){function e(t,i,a){this.rctx=t,this.programRepository=i,this.refCount=new h,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=n.mat3f64.create(),this.settings=r({},l,a),this.key=e.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);var o=this.settings.strokesTexture.variants;this.writerSettings={variants:o},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,i,n){this.setUniforms(e,t,i);var a=this.rctx;a.bindVAO(r),a.capabilities.instancing.drawArraysInstanced(6,0,4,n)},e.prototype.setUniforms=function(e,r,i){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",i.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var a=i.viewInvTransp,s=n.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,a);e.setUniform3f("uCameraPosition",a[3],a[7],a[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",s),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(i.fovY/2)/(i.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3),this.settings.slicePlaneEnabled&&o.bindSlicePlane(r.transform.origin.vec3,i.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",a.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return r({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t,r){return e?"edges-uber:"+r:"edges-t:"+t+":"+r},e}();t.EdgeRenderer=c,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,i))||(e.exports=n)},1690:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1565),r(1573)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return i.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,i))||(e.exports=n)},1691:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(92),r(1559),r(1560)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){if(!e)return null;for(var r=e.length/2,i=s*r,n=new Array(r),a=0,o=1===t,h=0;h<e.length;h+=2){var c=(e[h]+e[h+1])/2;n[a++]=o?Math.min(i,1-(1-c)*l):Math.min(i,c*l)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,l=new Uint8Array(4*r*r),h=4*r*s,c=t.strokesDefinition.amplitude,u=2*c,d=4*r,p=i.log2(r)+1,f=t.strokesDefinition.strokes.length,g=(p-1)*f*d,m=0,v=t.strokesDefinition.strokes;m<v.length;m++){for(var _=v[m],y=_.distance,b=_.pressure,x=g,T=0;T<p;T++){0!==T&&(y=o(y,0),b=o(b,1));for(var w=0;w<t.strokesDefinition.resolution;w++){var S=.5+(y?y[w%y.length]/u:0),R=b?b[w%b.length]:1;n.packFloatRGBA(S,l,x),n.packFloatRGBA(R,l,x+h),x+=4}x-=d*(f+1)}g+=d}return{resolution:r,texture:new a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},l),normalizationScale:u,amplitude:c,variants:f}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,i))||(e.exports=n)},1692:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(58),r(1583)],void 0===(n=function(e,t,r,i,n){function a(e){return e.size*e.color[3]*e.opacity>0}function o(e,t){var i=r.binaryIndexOf(e,t,!0);return-1===i?t<e[0]?0:e.length:i}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=null,r=0,n=e;r<n.length;r++){var o=n[r],s=o.type;if(a(o))if(i.isNone(t))t=s;else if(t!==s)return!0}return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++)if(a(e[t].material))return!1;return!0},t.cloneIndices=function(e){if(Uint16Array.from)return n.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=n.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,i){return r*(i/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=o,t.computeEdgeCount=function(e,t,r){return e.length-o(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,i){for(var n=0;n<e.length;n++){var a=e[n].index,o=t[n],s=t[n+1];if(i)for(var l=o;l<s;l++){var h=i[l];r.set(h,a)}else for(l=o;l<s;l++)r.set(l,a)}}}.apply(null,i))||(e.exports=n)},1693:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1694)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=r.vec3f64.create(),a=function(){function e(){this._renderLighting={main:{intensity:r.vec3f64.create(),direction:r.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=r.vec3f64.create(),this._oldSpecular=r.vec4f64.create(),this._oldDiffuse=r.vec4f64.create(),this._oldAmbient=r.vec4f64.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var i=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),r.vec3.negate(this._oldDirection,this._renderLighting.main.direction);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var a=r.vec3.copy(n,this._oldDiffuse);r.vec3.scale(a,a,.4*this._info.globalFactor),r.vec3.add(this._oldAmbient,this._oldAmbient,a)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=a}.apply(null,i))||(e.exports=n)},1694:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1695),r(1597)],void 0===(n=function(e,t,r,i,n,a){function o(e){return(e+1)*(e+1)}function s(e){return i.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){var i=e[0],n=e[1],a=e[2],s=r||[];return s.length=o(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*i*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*i*a,s[8]=.54627421529*(i*i-n*n)),s}function h(e,t){var r=o(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(var n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function c(e,t){for(var i=s(t.r.length),a=0,o=e;a<o.length;a++){var h=o[a];r.vec3.negate(v,h.direction),l(v,i,g),n.elementwiseProduct(g,_),n.scalarProduct(g,h.intensity[0],m),n.add(t.r,m),n.scalarProduct(g,h.intensity[1],m),n.add(t.g,m),n.scalarProduct(g,h.intensity[2],m),n.add(t.b,m)}return t}function u(e,t){l(v,0,g);for(var r=0,i=e;r<i.length;r++){var n=i[r];t.r[0]+=g[0]*_[0]*n.intensity[0]*4*Math.PI,t.g[0]+=g[0]*_[0]*n.intensity[1]*4*Math.PI,t.b[0]+=g[0]*_[0]*n.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=o,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=l,t.initSHCoefficients=h,t.projectFillLights=c,t.projectAmbientLights=u,t.combineLights=function(e,t,i,o){h(t,o.sh),r.vec3.set(i.intensity,0,0,0);var s=!1,l=d,g=p,m=f;l.length=0,g.length=0,m.length=0;for(var v=0,_=e;v<_.length;v++)(x=_[v])instanceof a.MainLight&&!s?(r.vec3.copy(i.direction,x.direction),i.intensity[0]=x.intensity[0],i.intensity[1]=x.intensity[1],i.intensity[2]=x.intensity[2],i.castShadows=x.castShadows,s=!0):x instanceof a.MainLight||x instanceof a.FillLight?l.push(x):x instanceof a.AmbientLight?g.push(x):x instanceof a.SphericalHarmonicsLight&&m.push(x);c(l,o.sh),u(g,o.sh);for(var y=0,b=m;y<b.length;y++){var x=b[y];n.add(o.sh.r,x.sh.r),n.add(o.sh.g,x.sh.g),n.add(o.sh.b,x.sh.b)}};var d=[],p=[],f=[],g=[0],m=[0],v=r.vec3f64.create(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,i))||(e.exports=n)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,i=0;i<e.length;i++)r+=e[i]*t[i];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t[i];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}}.apply(null,i))||(e.exports=n)},1696:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){return e instanceof Float32Array&&e.length>=16}function i(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=r,t.isMat4f64=i,t.isMat4=function(e){return r(e)||i(e)}}.apply(null,i))||(e.exports=n)},1697:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion,SLICE:e.slice})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:r.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:function(e){return n.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})}(e)+i.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:i.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1698:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var i=e.capabilities.disjointTimerQuery;if(!i)return null;if(i.timestampBits()<=0)return null;var n=i.createQuery();i.createTimestamp(n);var a=function(){var e=i.resultAvailable(n),o=i.disjoint();if(!e||o)o?t():setTimeout(a,r);else{var s=i.getResult(n);t(s/1e6)}};a()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,i))||(e.exports=n)},1699:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1568),r(1598)],void 0===(n=function(e,t,r,i,n){var a=r.vec4f64.fromValues(1,1,1,1);return function(){function e(e,t,r,i,a){this.program=e.getProgram(n.texOnly),this.color=r,this.depthFunc=a,this.blend=i,this.texGLName=t}return e.prototype.beginSlot=function(e){return 1===e},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",i.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:a),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){i.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e}()}.apply(null,i))||(e.exports=n)},1700:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559)],void 0===(n=function(e,t,r){function i(e,t){return e+"_"+t}var n=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var r,a=i(e.id,t),o=this.id2glMaterialRef[a];if(null==o){var s=e.getGLMaterials()[t];r=s?new s(e,this.programRep,this.textureRep):void 0,o=new n(r),this.id2glMaterialRef[a]=o}else r=o.getGLMaterial();return o.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var r=i(e,t),n=this.id2glMaterialRef[r];if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&(this.decreaseProgramReferences(a),a.dispose()),delete this.id2glMaterialRef[r]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[i(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var r=this.id2glMaterialRef[i(e,"depth")];r&&r.getGLMaterial()&&this.updateParamsForMat(r.getGLMaterial());var n=this.id2glMaterialRef[i(e,"depthShadowMap")];n&&n.getGLMaterial()&&this.updateParamsForMat(n.getGLMaterial());var a=this.id2glMaterialRef[i(e,"normal")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial());var o=this.id2glMaterialRef[i(e,"highlight")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.increaseRefCount(t[i])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.decreaseRefCount(t[i])},e}()}.apply(null,i))||(e.exports=n)},1701:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(1559),r(1560)],void 0===(n=function(e,t,r,i,n){var a=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),o=function(){function e(e,t,r,i){this.NUM_PARALLEL=8,this._fallbackTexture=null,this._fallbackTextureTransparent=null,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=i,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=i.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?i.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var n=0;n<this._fallbackTextureData.length;++n)this._fallbackTextureData[n]=255,this._fallbackTextureTransparentData[n]=(n+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(t,r,n){var o=this,s=this.id2textureRef[t];if(null==s){var l=this.textures[t];i.assert(void 0!==l),l.setUnloadFunc(this._unload.bind(this));var h=!0===r,c=this._createGLTextureDescription(l);if(s=new e.TextureRef(null),i.assert(null==this.id2textureRef[t]),this.id2textureRef[t]=s,l.initializeThroughRender){var u=l.initializeThroughRender(this._rctx,c);s.setGLTexture(u),n&&n(s)}else if(l.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(t,c,n):this._queue.push([t,c,n]);else try{l.initializeThroughUpload(this._rctx,c,this._programRepository,this.getViewportToRestore(),function(e){s.setGLTexture(e),o._needsRender=!0,n&&n(s)})}catch(e){a.error("#aquire","Error loading texture: "+e.toString())}null==s.getGLTexture()&&s.setGLTexture(h?this.fallbackTextureTransparent:this.fallbackTexture),this._needsRender=!0}return s.incRefCnt(),s},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),i.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrap;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(i){i(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var n=this;i.assert(null==this.loading[e]),this.loading[e]=!0;var a=this.textures[e];i.assert(void 0!==a),setTimeout(function(){var i=n.id2textureRef[e];i&&i.getRefCnt()&&a.initializeThroughUpload(n._rctx,t,n._programRepository,n.getViewportToRestore(),function(t){n.next(e),n._needsRender=!0,i&&i.getRefCnt()&&(i.setGLTexture(t),r&&r(i))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],i=this.id2textureRef[r];void 0!==i&&(0===i.getRefCnt()?(i.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var n=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<n;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,n)},Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){return this._fallbackTexture||(this._fallbackTexture=new n(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){return this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new n(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent},enumerable:!0,configurable:!0}),e}();return function(e){var t=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,i.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();e.TextureRef=t}(o||(o={})),o}.apply(null,i))||(e.exports=n)},1702:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1703),r(1580)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=null,a=[];t.enabled=!1,t.begin=function(){t.enabled&&(n=[])},t.trace=function(e){t.enabled&&null!=n&&n.push(e)},t.end=function(){if(t.enabled){var e=n;return n=null,e&&(a.forEach(function(t){return t(e)}),a.length=0),e}},t.instrumentContext=function(e){return t.enabled?i.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,function(e,i){t.enabled&&n&&n.push("gl."+e+"("+r.glFunctionArgsToString(e,i)+")")}):e},t.request=function(e){a.push(e)}}.apply(null,i))||(e.exports=n)},1703:function(e,t,r){var i;void 0===(i=function(){function e(e){if(null==l)for(var t in l={},h={},e)"number"==typeof e[t]&&(l[e[t]]=t,h[t]=e[t])}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=l[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function i(e,t,i,n){var a;if(void 0!==(a=s[e])&&(void 0!==(a=a[t])&&a[i])){if("object"==typeof a[i]&&void 0!==a[i].enumBitwiseOr){for(var o=a[i].enumBitwiseOr,l=0,c=[],u=0;u<o.length;++u){var d=h[o[u]];0!=(n&d)&&(l|=d,c.push(r(d)))}return l===n?c.join(" | "):r(n)}return r(n)}return null===n?"null":void 0===n?"undefined":n.toString()}function n(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function a(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var o=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,h=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==l[e]},glEnumToString:r,glFunctionArgToString:i,glFunctionArgsToString:function(e,t){for(var r="",n=t.length,a=0;a<n;++a)r+=(0==a?"":", ")+i(e,n,a,t[a]);return r},makeDebugContext:function t(a,s,l,h){function c(e,t){return function(){l&&l(t,arguments);var r=e[t].apply(e,arguments),i=h.getError();return 0!=i&&(u[i]=!0,s(i,t,arguments)),r}}h=h||a,e(a),s=s||function(e,t,n){for(var a="",s=n.length,l=0;l<s;++l)a+=(0==l?"":", ")+i(t,s,l,n[l]);o("WebGL error "+r(e)+" in "+t+"("+a+")")};var u={},d={};for(var p in a)if("function"==typeof a[p])if("getExtension"!=p)d[p]=c(a,p);else{var f=c(a,p);d[p]=function(){return t(f.apply(a,arguments),s,l,h)}}else n(d,a,p);return d.getError=function(){for(var e in u)if(u.hasOwnProperty(e)&&u[e])return u[e]=!1,e;return a.NO_ERROR},d},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){++g,d||f==g&&e.loseContext()}function i(e,t){var i=e[t];return function(){if(r(),!d)return i.apply(e,arguments)}}function o(e){return{statusMessage:e,preventDefault:function(){m=!0}}}var s,l=[],h=[],c={},u=1,d=!1,p=[],f=0,g=0,m=!1,v=0,_={};e.getContext=function(t){return function(){var a=t.apply(e,arguments);if(a instanceof WebGLRenderingContext){if(a!=s){if(s)throw"got different context";c=function(e){for(var t in e)"function"==typeof e[t]?c[t]=i(e,t):n(c,e,t);c.getError=function(){if(r(),!d)for(;e=s.getError();)_[e]=!0;for(var e in _)if(_[e])return delete _[e],e;return c.NO_ERROR};for(var a=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],o=0;o<a.length;++o)c[f=a[o]]=function(t){return function(){if(r(),d)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=u,p.push(i),i}}(e[f]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(o=0;o<l.length;++o)c[f=l[o]]=function(t){return function(){return r(),d?null:t.apply(e,arguments)}}(c[f]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(o=0;o<h.length;++o){var f;c[f=h[o]]=function(t){return function(){return r(),!d&&t.apply(e,arguments)}}(c[f])}return c.checkFramebufferStatus=function(t){return function(){return r(),d?c.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(c.checkFramebufferStatus),c.getAttribLocation=function(t){return function(){return r(),d?-1:t.apply(e,arguments)}}(c.getAttribLocation),c.getVertexAttribOffset=function(t){return function(){return r(),d?0:t.apply(e,arguments)}}(c.getVertexAttribOffset),c.isContextLost=function(){return d},c}(s=a)}return c}return a}}(e.getContext);var y=function(e){l.push(t(e))},b=function(e){h.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":y(i);break;case"webglcontextrestored":b(i);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!d){for(d=!0,f=0,++u;s.getError(););(function(){for(var e=Object.keys(_),t=0;t<e.length;++t)delete _[e]})(),_[s.CONTEXT_LOST_WEBGL]=!0;var t=o("context lost"),r=l.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);v>=0&&setTimeout(function(){e.restoreContext()},v)},0)}},e.restoreContext=function(){d&&h.length&&setTimeout(function(){if(!m)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<p.length;++e){var t=p[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),a(s),d=!1,g=0,m=!1;for(var e=h.slice(),t=o("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(d)throw"You can not ask a lost contet to be lost";f=g+e},e.getNumCalls=function(){return g},e.setRestoreTimeout=function(e){v=e},e},resetToInitialState:a}}.apply(null,[]))||(e.exports=i)},1704:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(38),r(1594),r(1645),r(1705)],void 0===(n=function(e,t,r,i,n,a,o){var s=r("dojo-debug-messages"),l=function(){function e(e,t,r,l,h){this._content=new Map,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=h,this._gl=h.gl,this._visualizer=new o(e,t,r,l,this._rctx),this._camera=new n(i.vec3f64.fromValues(0,100,-100)),s&&(this._stats.visualizerRenderTimer=new a(10),this._stats.viewportRenderTimer=new a(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var r in t)e[r]=t[r];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var i=this._gl.getUsedTextureMemoryStats();for(var n in i)e["texMem type: "+n]=i[n]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,r,i){this._visualizer.modify(e,t,r,i),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._visualizer.getFramebufferTexture(e)},e.prototype.render=function(e){s&&this._stats.viewportRenderTimer.start(),s&&this._stats.visualizerRenderTimer.start(),h.camera=e.camera||this._camera,h.fbo=e.fbo,h.lightDirection=e.lightDirection,h.pixelRatio=e.pixelRatio||1,h.disableSlice=e.disableSlice||!1,this._visualizer.render(h),s&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e}(),h={fbo:null,lightDirection:null,camera:null,pixelRatio:1,disableSlice:!1};return l}.apply(null,i))||(e.exports=n)},1705:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1709),r(38),r(1589),r(1609),r(1710),r(1711),r(1706),r(1622),r(1713),r(1715),r(1624),r(1716),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f){var g=f.assert;return function(){function e(e,t,r,i,n){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=n,this._renderer=new h(t,r,i,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new u(t,this._rctx),ssao:new p(t,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,this._rctx),renderOccluded:new c(t,this._rctx),slice:new d,offscreenRendering:new l(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._helpers.slice.plane=e.slicePlane),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades,this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._helpers.offscreenRendering.colorTexture;case"hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(e)},e.prototype.modify=function(e,t,r,i){this._renderer.modify(e,t,r,i);for(var n=0;n<t.length;++n)this._content.delete(t[n].uniqueName);for(n=0;n<e.length;++n)this._content.set(e[n].uniqueName,e[n]);for(n=0;n<r.length;++n)g(this._content.get(r[n].renderGeometry.uniqueName)===r[n].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getProjectionMatrix=function(e,t,r,n,a){var o=f.fovx2fovy(t,e[2],e[3]);i.mat4.perspective(a,180*o/Math.PI,e[2]/e[3],r,n)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e){var t=e.camera,a=e.fbo,o=e.lightDirection,s=t.viewport,l=this._helpers.slice.plane;if(e.disableSlice&&(this._helpers.slice.plane=null),this._renderer.prepareRender(t),this._helpers.shadowMap.enabled){n.ENABLE_PROFILE_DEPTH_RANGE&&r.begin("depthRange");var h=this.computeDepthRange(t);n.ENABLE_PROFILE_DEPTH_RANGE&&r.end("depthRange"),this._helpers.shadowMap.prepare(t,o,this._content,h);for(var c=this._helpers.shadowMap.getCascades(),u=0;u<c.length;++u){var d=c[u];d.camera.setGLViewport(this._rctx),e.camera=d.camera,this._renderer.renderGeometryPass(3,e,null,null,this._helpers.slice)}e.camera=t,this._helpers.shadowMap.finish(a),t.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,this._helpers),this._renderer.render(e,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var p=i.mat4.ortho(i.mat4f64.create(),s[0],s[2],s[1],s[3],-1,1);this._helpers.shadowMap.drawDebugQuad(p)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){p=i.mat4.ortho(i.mat4f64.create(),s[0],s[2],s[1],s[3],-1,1);this._helpers.ssao.drawQuad(p)}this._helpers.slice.plane=l},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=o.depthRangeFromScene(e,this._content,this._stage.getLayers());return a.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,i))||(e.exports=n)},1706:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(1578),r(1707),r(1559),r(1708),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s){var l=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._rctx=t,this.renderTargetHelper=new n.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(o.compositePass),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(o.compositeTransparentToHUDVisibilityPass)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){a.assert(this.enabled);var r=this._rctx,i=r.gl,n=e.fullViewport;this.dimensions.width=n[2],this.dimensions.height=n[3],this.mainFbo=t,this.bindTarget(this.mainColor,this.mainDepth),r.setClearStencil(0);var o=this._background.color;r.setClearColor(o[0]*o[3],o[1]*o[3],o[2]*o[3],o[3]),r.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=h),void 0===r&&(r=c),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,u)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(r),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,s.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,i){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.mainFbo),void 0===i&&(i=c);var n=this._rctx,a=this._compositeProgram;switch(n.bindFramebuffer(t),n.setDepthTestEnabled(!1),n.bindProgram(a),a.setUniform1i("tex",1),n.bindTexture(e,1),i){case"none":n.setBlendingEnabled(!1);break;case"alpha":n.setBlendFunctionSeparate(770,771,1,771),n.setBlendingEnabled(!0);break;case"premultiplied-alpha":n.setBlendFunction(1,771),n.setBlendingEnabled(!0);break;default:r.neverReached(i)}n.bindVAO(this.quadVAO),n.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry")),n.setDepthTestEnabled(!0),n.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=i.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,i,n){var a=this._rctx,o=a.gl;this.bindTarget(t,r);var s=0;if(i){var l=Math.max(1e-13,i[3]);a.setClearColor(i[0],i[1],i[2],l),s|=o.COLOR_BUFFER_BIT}n&&(s|=o.DEPTH_BUFFER_BIT),a.clear(s),e(),o.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(r)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),h=[0,0,0,0],c="none",u=[0,1,0,1];return l}.apply(null,i))||(e.exports=n)},1707:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(1562),r(1612),r(1560)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o={dataType:5121},s={},l=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var i=this.depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new n(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,i)),i}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r)),r},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},o,e)},e.prototype.getFramebuffer=function(e,t,r){var n=this.getKey(t,r),a=this.framebuffers.get(n),o=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o||a.depthStencilTexture!==s)&&(a.detachColorTexture(),a.detachDepthStencilTexture(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilTexture(s)),a):(a=r?i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:4},s):i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(n,a),a)}var l=r?this.getDepthBuffer(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o)&&(a.detachColorTexture(),a.detachDepthStencilBuffer(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilBuffer(l)),a):(a=i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:r?3:0},l),this.framebuffers.set(n,a),a)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=l}.apply(null,i))||(e.exports=n)},1708:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.compositePass={name:"offscreen-composite",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/offscreen.frag")},attributes:r.Default3D},t.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1709:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in n||(n[t]=new e(t)),n[t]}function r(e){console.log(t(e).toJSON())}var i=1e3,n={},a={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,n){void 0===n&&(n=!0),t(e).end();var o=performance.now();!n||e in a&&!(o>=a[e]+i)||(r(e),a[e]=o)},e.log=r,e.logAll=function(){for(var e in n)r(e)}}(r||(r={})),r}.apply(null,i))||(e.exports=n)},1710:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1571),r(92),r(1572),r(1609),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){function h(e,t){if(t.isVisible){var r=s.empty(),i=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var i=t.eye,n=t.viewForward,a=t.frustum,o=function(e){return!e.areAllComponentsHidden()},l=r.objectCount;if(l<g)s.set(S,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,"front-to-back",S,function(r,i){c(e,t,r),S.far=e.near,i.setRange(S)},a,o),s.set(S,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,"back-to-front",S,function(r,i){c(e,t,r),S.near=e.far,i.setRange(S)},a,o);else{var h=Math.max(Math.min(l,m),Math.ceil(l*v)),u=r.findClosest(n,"front-to-back",a,o,h),p=r.findClosest(n,"back-to-front",a,o,h);u&&p&&(d(e,t,u.getCenter(),u.getBSRadius()),d(e,t,p.getCenter(),p.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){R.clear(),r.forEach(function(e){e.areAllComponentsHidden()||R.add(e)}),R.empty||(R.sort(t),s.set(S,t.near,Math.min(e.near,t.far)),R.forEachInDepthRange(S,"front-to-back",function(r,i,n){i<e.near&&c(e,t,r)}),s.set(S,Math.max(e.far,t.near),t.far),R.forEachInDepthRange(S,"back-to-front",function(t,r,i){e.far=Math.max(e.far,i)}))}(r,e,i),r}}function c(e,t,r){if(!r.areAllComponentsHidden()&&n.frustum.intersectsSphere(t.frustum,n.sphere.wrap(r.getBSRadius(),r.getCenter()))){var o=r.objectTransformation,s=w;r.geometryRecords.forEach(function(r){i.mat4.multiply(s,o,r.getShaderTransformation());var n=a.maxScale(s);u(e,t,r.geometry.boundingInfo,s,n)})}}function u(e,t,r,a,o){var s=t.eye,l=t.viewForward;i.vec3.transformMat4(T,r.center,a);var h=l[0]*(T[0]-s[0])+l[1]*(T[1]-s[1])+l[2]*(T[2]-s[2]),c=r.bsRadius*o;if(!(h-c>e.near&&h+c<e.far)&&n.frustum.intersectsSphere(t.frustum,n.sphere.wrap(c,T)))if(r.bsRadius>f&&r.getChildren())for(var d=r.getChildren(),p=0;p<8;++p)d[p]&&u(e,t,d[p],a,o);else O.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,a,r.bbMin,r.bbMax)}function d(e,t,r,i){var n=t.eye,a=t.viewForward,o=(r[0]-n[0])*a[0]+(r[1]-n[1])*a[1]+(r[2]-n[2])*a[2];e.near=Math.min(e.near,o-i),e.far=Math.max(e.far,o+i)}Object.defineProperty(t,"__esModule",{value:!0});var p=1e4,f=100,g=500,m=500,v=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<p)return E.compute(e,t);var i=s.empty();for(var n in r){var a=r[n];a.isVisible&&s.union(i,h(e,a))}return i},t.depthRangeFromLayer=h;var _=function(){function e(){this._items=new r({allocator:function(e){return e||{obj:null,distance:0,near:0,far:0}},deallocator:function(e){return e.obj=null,e.distance=0,e.near=0,e.far=0,e}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var i=e.obj,n=i.getCenter(),a=i.getBSRadius(),o=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-t[2])*r[2];e.distance=o,e.near=o-a,e.far=o+a}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var i=0;i<this._items.length;++i){(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(i=this._items.length-1;i>=0;--i){var n;(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}},e}(),y=function(){function e(){this.view=i.mat4f64.create(),this.viewProj=i.mat4f64.create(),this.frustum=n.frustum.create(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),i.mat4.copy(this.view,e.viewMatrix),i.mat4.multiply(this.viewProj,e.projectionMatrix,this.view),n.frustum.copy(e.frustum,this.frustum);var a=this.view,s=a[2],l=a[6],h=a[10],c=a[14],u=this.range,d=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,i=e.componentOffsets;if(!o.isAllHidden(t,i)&&e.castShadow){var n,a;e.hasShaderTransformation?(n=e.getBoundingSphere(e.getShaderTransformation(),1,T),a=T):(n=e.bsRadius,a=e.center);var u=s*a[0]+l*a[1]+h*a[2]+c,p=u-n,f=u+n;r.geometries[d]=e,r.near[d]=-f,r.far[d]=-p,++d}}),0===this.geometries.length)return u;for(var p=0;p<this.geometries.length;++p)this.near[p]>u.far&&(u.far=this.near[p]),this.near[p]>2&&this.far[p]<u.near&&(u.near=this.far[p]);var f=this.looseRange;f.near=Math.max(.5*u.near,2),f.far=2*u.far;var g=0,m=0;for(p=0;p<this.geometries.length;++p)this.near[p]<u.near&&(this.near[p]>=f.near?u.near=this.near[p]:this.nearCandidates[g++]=p),this.far[p]>u.far&&(this.far[p]<=f.far?u.far=this.far[p]:this.farCandidates[m++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return u;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var v=this.nearCandidates[p];if(this.near[v]<u.near){var _=(y=this.geometries[v]).boundingInfo;this.includeNearBoundingInfoRec(_,y.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){v=this.farCandidates[p];if(this.far[v]>u.far){var y;_=(y=this.geometries[v]).boundingInfo;this.includeFarBoundingInfoRec(_,y.getShaderTransformation())}}return u},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.vec3.transformMat4(T,n,t);var o=a.maxScale(t),s=T[0],l=T[1],h=T[2];r*=o;var c=this.frustum.planes;if(!(c[0][0]*s+c[0][1]*l+c[0][2]*h+c[0][3]>r||c[1][0]*s+c[1][1]*l+c[1][2]*h+c[1][3]>r||c[2][0]*s+c[2][1]*l+c[2][2]*h+c[2][3]>r||c[3][0]*s+c[3][1]*l+c[3][2]*h+c[3][3]>r)){var u=this.view[2]*s+this.view[6]*l+this.view[10]*h+this.view[14],d=u+r;if(!(-(u-r)<2||-d>=this.range.near)){if(-d>this.looseRange.near)return void(this.range.near=-d);if(r>f){var p=e.getChildren();if(void 0!==p){for(var g=0;g<8;++g)void 0!==p[g]&&this.includeNearBoundingInfoRec(p[g],t);return}}O.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.vec3.transformMat4(T,n,t);var o=a.maxScale(t),s=T[0],l=T[1],h=T[2];r*=o;var c=this.frustum.planes;if(!(c[0][0]*s+c[0][1]*l+c[0][2]*h+c[0][3]>r||c[1][0]*s+c[1][1]*l+c[1][2]*h+c[1][3]>r||c[2][0]*s+c[2][1]*l+c[2][2]*h+c[2][3]>r||c[3][0]*s+c[3][1]*l+c[3][2]*h+c[3][3]>r)){var u=this.view[2]*s+this.view[6]*l+this.view[10]*h+this.view[14]-r;if(!(-u<=this.range.far)){if(-u<this.looseRange.far)return void(this.range.far=-u);if(r>f){var d=e.getChildren();if(void 0!==d){for(var p=0;p<8;++p)void 0!==d[p]&&this.includeFarBoundingInfoRec(d[p],t);return}}O.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var b=function(){function e(){this.modelViewProj=i.mat4f64.create(),this.clipPosition=[i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,n,a){var o=this.modelViewProj;i.mat4.multiply(o,t,r);for(var s=!1,l=0;l<8;++l){var h=this.clipPosition[l],c=0===l||3===l||4===l||7===l?n[0]:a[0],u=0===l||1===l||4===l||5===l?n[1]:a[1],d=l<4?n[2]:a[2];h[0]=o[0]*c+o[4]*u+o[8]*d+o[12],h[1]=o[1]*c+o[5]*u+o[9]*d+o[13],h[2]=o[2]*c+o[6]*u+o[10]*d+o[14],h[3]=o[3]*c+o[7]*u+o[11]*d+o[15]}for(l=0;l<12;++l){for(var p=this.clipPosition[x[l][0]],f=this.clipPosition[x[l][1]],g=this.clipPosition[x[l][2]],m=this.clipTriangle(p,f,g),v=!0,_=0;_<m.length;++_){if((y=m[_][3])>=2){v=!1;break}}if(!v){s=!0;for(_=0;_<m.length;++_){var y;(y=m[_][3])<e.near&&(e.near=y),y>e.far&&(e.far=y)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void l.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),i.vec4.lerp(i.vec4f64.create(),e,t,n)},e.prototype.clipTriangle=function(e,t,r){for(var i=[e,t,r],n=0;n<4;++n){var a=i;i=[];for(var o=0;o<a.length;++o){var s=a[o],l=a[(o+1)%a.length];this.inside(l,n)?(this.inside(s,n)||i.push(this.intersect(s,l,n)),i.push(l)):this.inside(s,n)&&i.push(this.intersect(s,l,n))}}return i},e}(),x=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],T=i.vec3f64.create(),w=i.mat4f64.create(),S=s.empty(),R=new _,E=new y,O=new b}.apply(null,i))||(e.exports=n)},1711:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1589),r(1561),r(1587),r(1578),r(1559),r(1712),r(1564),r(1562),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d){var p=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=r.vec4f64.create(),this.defaultOptions={color:r.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(l.blurPass,{gaussianSamples:p}),this.blurGridProgram=e.getProgram(l.blurPass,{gaussianSamples:p,gridOptimization:!0}),this.applyProgram=e.getProgram(l.applyPass),this.applyGridProgram=e.getProgram(l.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(l.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(l.downsamplePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return i.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t){var n=!i.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,a=i.HIGHLIGHTS_VISUALIZE_BLOCKS,o=e.camera,l=e.fbo,h=this._rctx;s.assert(this.enabled),r.vec4.copy(this.viewportToRestore,o.fullViewport);var c=t.width,d=t.height,p=Math.ceil(c/1),f=Math.ceil(d/1);this.blur0Fbo.resize(p,f),this.blur1Fbo.resize(p,f),h.bindVAO(this.quadVAO),h.setDepthWriteEnabled(!1),h.setDepthTestEnabled(!1),h.setBlendingEnabled(!1);var g=null,m=null,v=null,_=null;if(n){var y=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),v=y.vao,_=4,g=this.blurGridProgram,h.bindProgram(g),h.bindTexture(y.coverageMipmap[y.mipmapLevels].colorTexture,1),g.setUniform1i("coverageTex",1)}else v=this.quadVAO,_=5,g=this.blurProgram,h.bindProgram(g);if(h.bindVAO(v),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,p,f),h.setClearColor(0,0,0,0),h.clear(h.gl.COLOR_BUFFER_BIT),g.setUniform1i("tex",0),h.bindTexture(t.colorTexture,0),g.setUniform2f("blurSize",1/p,0),h.drawArrays(_,0,u.vertexCount(v,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(h.gl.COLOR_BUFFER_BIT),h.bindTexture(this.blur0Fbo.colorTexture,0),g.setUniform2f("blurSize",0,1/f),h.drawArrays(_,0,u.vertexCount(v,"geometry")),h.bindFramebuffer(l),h.setBlendingEnabled(!0),h.setBlendFunctionSeparate(770,771,1,771),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),n){m=a?this.applyGridDebugProgram:this.applyGridProgram,h.bindProgram(m),m.setUniform1i("coverageTex",2);var b=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;h.bindTexture(b,2)}else m=this.applyProgram,h.bindProgram(m);m.setUniform1i("tex",0),h.bindTexture(this.blur1Fbo.colorTexture,0),m.setUniform1i("origin",1),h.bindTexture(t.colorTexture,1);var x=e.pixelRatio||1;m.setUniform4fv("color",this.defaultOptions.color),m.setUniform1f("outlineSize",8.6*x),m.setUniform1f("blurSize",.4*x),m.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),h.drawArrays(_,0,u.vertexCount(v,"geometry")),h.bindVAO(null),h.setDepthWriteEnabled(!0),h.setDepthTestEnabled(!0),h.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=o.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=c.createWithAttachments(this._rctx,t,e),this.blur1Fbo=c.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,i=this._grid,o=!1;if(null===i.coverageMipmap&&(i.coverageMipmap=[e],o=!0),i.viewportWidth===e.width&&i.viewportHeight===e.height||(o=!0,i.viewportWidth=e.width,i.viewportHeight=e.height),i.coverageMipmap[0]=e,i.cellPixelSize!==t&&(i.cellPixelSize=t,o=!0),o){for(var s=1;s<i.coverageMipmap.length;s++)i.coverageMipmap[s].dispose();i.mipmapLevels=Math.ceil(Math.log(i.cellPixelSize)*Math.LOG2E),i.coverageMipmap.length=i.mipmapLevels+1;for(s=0;s<i.mipmapLevels;s++){var l=i.coverageMipmap[s],u={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},f=c.createWithAttachments(r,u,p);i.coverageMipmap[s+1]=f}}var g=Math.ceil(e.height/i.cellPixelSize),m=Math.ceil(e.width/i.cellPixelSize);if(!i.vao||i.verticalCellCount!==g||i.horizontalCellCount!==m){i.verticalCellCount=g,i.horizontalCellCount=m;for(var v=g+1,_=m+1,y=1/g,b=1/m,x=new Float32Array(24*v*_),T=0,w=0;w<v;w++)for(var S=0;S<_;S++)x[T+0]=(S-.5)*b*2-1,x[T+1]=(w-.5)*y*2-1,x[T+2]=S*b,x[T+3]=w*y,x[T+4]=(S+.5)*b*2-1,x[T+5]=(w-.5)*y*2-1,x[T+6]=S*b,x[T+7]=w*y,x[T+8]=(S-.5)*b*2-1,x[T+9]=(w+.5)*y*2-1,x[T+10]=S*b,x[T+11]=w*y,x[T+12]=(S-.5)*b*2-1,x[T+13]=(w+.5)*y*2-1,x[T+14]=S*b,x[T+15]=w*y,x[T+16]=(S+.5)*b*2-1,x[T+17]=(w-.5)*y*2-1,x[T+18]=S*b,x[T+19]=w*y,x[T+20]=(S+.5)*b*2-1,x[T+21]=(w+.5)*y*2-1,x[T+22]=S*b,x[T+23]=w*y,T+=24;i.vao&&i.vao.dispose(!0),i.vao=new d(r,n.Default3D,{geometry:a.Pos2Tex},{geometry:h.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var i=0;i<t.mipmapLevels;i++){e.bindFramebuffer(t.coverageMipmap[i+1]),e.bindTexture(t.coverageMipmap[i].colorTexture,0);var n=t.coverageMipmap[i+1].width,a=t.coverageMipmap[i+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/n,1/a),e.setViewport(0,0,n,a),e.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"))}},e}()}.apply(null,i))||(e.exports=n)},1712:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},o=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:i.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:i.resolveIncludes("renderer/highlight/downsample.frag")},attributes:r.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:a(e)+i.resolveIncludes("renderer/highlight/blur.frag")}},attributes:r.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:o(e)+i.resolveIncludes("renderer/highlight/apply.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1713:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1578),r(1559),r(1714),r(1562),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(e,t){this._quadVAO=null,this._rctx=t,this._colorFBO=void 0,this._viewportToRestore=r.vec4f64.create(),this._combineProgram=e.getProgram(a.combinePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){n.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this._combineProgram;e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,s.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=i.createQuadVAO(this._rctx),this._colorFBO=o.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},1714:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.combinePass={name:"occluded-combine",shaders:{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:i.resolveIncludes("renderer/occluded/combine.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1715:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1594),r(1561),r(1587),r(1578),r(1559),r(1598),r(1564),r(1562),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f){function g(e,t,i,n,a,o,s,h){r.vec2.set(U,0,0);for(var c=0;c<4;++c)r.vec2.add(U,U,e[c]);r.vec2.scale(U,U,.25),r.vec2.set(j,0,0);for(c=4;c<8;++c)r.vec2.add(j,j,e[c]);r.vec2.scale(j,j,.25),r.vec2.lerp(z[0],e[4],e[5],.5),r.vec2.lerp(z[1],e[5],e[6],.5),r.vec2.lerp(z[2],e[6],e[7],.5),r.vec2.lerp(z[3],e[7],e[4],.5);var u=0,d=r.vec2.squaredDistance(z[0],U);for(c=1;c<4;++c){var p=r.vec2.squaredDistance(z[c],U);p<d&&(d=p,u=c)}r.vec2.subtract(G,z[u],e[u+4]);var f,g,m=G[0];G[0]=-G[1],G[1]=m,r.vec2.subtract(H,j,U),r.vec2.lerp(G,G,H,i),r.vec2.normalize(G,G),f=g=r.vec2.dot(r.vec2.subtract(k,e[0],U),G);for(c=1;c<8;++c){var v=r.vec2.dot(r.vec2.subtract(k,e[c],U),G);v<f?f=v:v>g&&(g=v)}r.vec2.copy(n,U),r.vec2.scale(k,G,f-t),r.vec2.add(n,n,k);var _=-1,y=1,b=0,x=0;for(c=0;c<8;++c){r.vec2.subtract(W,e[c],n),r.vec2.normalize(W,W);var T=G[0]*W[1]-G[1]*W[0];T>0?T>_&&(_=T,b=c):T<y&&(y=T,x=c)}l.verify(_>0,"leftArea"),l.verify(y<0,"rightArea"),r.vec2.scale(X,G,f),r.vec2.add(X,X,U),r.vec2.scale(q,G,g),r.vec2.add(q,q,U),Y[0]=-G[1],Y[1]=G[0];var w=l.rayRay2D(n,e[x],q,r.vec2.add(k,q,Y),1,a),S=l.rayRay2D(n,e[b],q,k,1,o),R=l.rayRay2D(n,e[b],X,r.vec2.add(k,X,Y),1,s),E=l.rayRay2D(n,e[x],X,k,1,h);l.verify(w,"rayRay"),l.verify(S,"rayRay"),l.verify(R,"rayRay"),l.verify(E,"rayRay")}function m(e,t){return 3*t+e}function v(e,t){return r.vec2.set(Q,e[t],e[t+3]),Q}function _(e,t,i,n,a){r.vec2.subtract(K,i,n),r.vec2.scale(K,K,.5),Z[0]=K[0],Z[1]=K[1],Z[2]=0,Z[3]=K[1],Z[4]=-K[0],Z[5]=0,Z[6]=K[0]*K[0]+K[1]*K[1],Z[7]=K[0]*K[1]-K[1]*K[0],Z[8]=1,Z[m(0,2)]=-r.vec2.dot(v(Z,0),e),Z[m(1,2)]=-r.vec2.dot(v(Z,1),e);var o=r.vec2.dot(v(Z,0),i)+Z[m(0,2)],s=r.vec2.dot(v(Z,1),i)+Z[m(1,2)],l=r.vec2.dot(v(Z,0),n)+Z[m(0,2)],h=r.vec2.dot(v(Z,1),n)+Z[m(1,2)];o=-(o+l)/(s+h),Z[m(0,0)]+=Z[m(1,0)]*o,Z[m(0,1)]+=Z[m(1,1)]*o,Z[m(0,2)]+=Z[m(1,2)]*o,o=1/(r.vec2.dot(v(Z,0),i)+Z[m(0,2)]),s=1/(r.vec2.dot(v(Z,1),i)+Z[m(1,2)]),Z[m(0,0)]*=o,Z[m(0,1)]*=o,Z[m(0,2)]*=o,Z[m(1,0)]*=s,Z[m(1,1)]*=s,Z[m(1,2)]*=s,Z[m(2,0)]=Z[m(1,0)],Z[m(2,1)]=Z[m(1,1)],Z[m(2,2)]=Z[m(1,2)],Z[m(1,2)]+=1,o=-.5*((o=r.vec2.dot(v(Z,1),t)+Z[m(1,2)])/(s=r.vec2.dot(v(Z,2),t)+Z[m(2,2)])+(l=r.vec2.dot(v(Z,1),i)+Z[m(1,2)])/(h=r.vec2.dot(v(Z,2),i)+Z[m(2,2)])),Z[m(1,0)]+=Z[m(2,0)]*o,Z[m(1,1)]+=Z[m(2,1)]*o,Z[m(1,2)]+=Z[m(2,2)]*o,o=r.vec2.dot(v(Z,1),t)+Z[m(1,2)],l=-(s=r.vec2.dot(v(Z,2),t)+Z[m(2,2)])/o,Z[m(1,0)]*=l,Z[m(1,1)]*=l,Z[m(1,2)]*=l,a[0]=Z[0],a[1]=Z[1],a[2]=0,a[3]=Z[2],a[4]=Z[3],a[5]=Z[4],a[6]=0,a[7]=Z[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=Z[6],a[13]=Z[7],a[14]=0,a[15]=Z[8]}for(var y=function(){return function(){this.camera=new n,this.lightMat=r.mat4f64.create()}}(),b=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var r=0;r<4;++r)this.cascades.push(new y)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=i.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)V[e]=this.cascades[e];return V.length=this.numCascades,V},e.prototype.prepare=function(e,t,n,a){l.assert(this.enabled),r.mat4.multiply(T,e.projectionMatrix,e.viewMatrix);var o=a.near,s=a.far;o<2&&(o=2),s<2&&(s=2),o>=s&&(o=2,s=4),this.numCascades=Math.min(1+Math.floor(l.logWithBase(s/o,4)),this.maxNumCascades);for(var h=Math.pow(s/o,1/this.numCascades),c=0;c<this.numCascades+1;++c)this.cascadeDistances[c]=o*Math.pow(h,c);r.mat4.invert(w,T),r.mat4.lookAt(F,[0,0,0],[-t[0],-t[1],-t[2]],[0,1,0]);var u=e.viewMatrix,d=e.projectionMatrix;for(c=0;c<this.numCascades;++c){var p=this.cascades[c],f=-this.cascadeDistances[c],m=-this.cascadeDistances[c+1],v=(d[10]*f+d[14])/Math.abs(d[11]*f+d[15]),y=(d[10]*m+d[14])/Math.abs(d[11]*m+d[15]);l.assert(v<y);for(var b=0;b<8;++b){var E=b%4==0||b%4==3?-1:1,V=b%4==0||b%4==1?-1:1,L=b<4?v:y;r.vec4.set(S,E,V,L,1),r.vec4.transformMat4(R[b],S,w);for(var N=0;N<3;++N)R[b][N]/=R[b][3]}r.vec3.negate(B,R[0]),r.mat4.translate(x,F,B),p.camera.viewMatrix=x;for(b=0;b<8;++b)r.vec3.transformMat4(R[b],R[b],p.camera.viewMatrix);r.vec3.copy(O,R[0]),r.vec3.copy(A,R[0]);for(b=1;b<8;++b)for(N=0;N<3;++N)O[N]=Math.min(O[N],R[b][N]),A[N]=Math.max(A[N],R[b][N]);O[2]-=200,A[2]+=200,p.camera.near=-A[2],p.camera.far=-O[2],o=1/R[0][3],s=1/R[4][3],l.assert(o<s);var U=o+Math.sqrt(o*s),j=Math.sin(i.acos(u[2]*t[0]+u[6]*t[1]+u[10]*t[2]));g(R,U/=j,j,P,M,C,D,I),_(P,M,D,I,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(O[2]-A[2]),p.camera.projectionMatrix[14]=-(O[2]+A[2])/(O[2]-A[2]),r.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);var z=this.textureRes/2;p.camera.viewport[0]=c%2==0?0:z,p.camera.viewport[1]=0===Math.floor(c/2)?0:z,p.camera.viewport[2]=z,p.camera.viewport[3]=z}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*s;var G=this.rctx,H=G.gl;G.bindFramebuffer(this.fbo),G.bindTexture(null,7),G.setClearColor(1,1,1,1),G.clear(H.COLOR_BUFFER_BIT|H.DEPTH_BUFFER_BIT),G.setBlendingEnabled(!1)},e.prototype.finish=function(e){l.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var i=this.lastOrigin;if(!i||i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]){this.lastOrigin=this.lastOrigin||r.vec3f64.create(),r.vec3.copy(this.lastOrigin,t);for(var n=0;n<this.numCascades;++n){r.mat4.translate(L,this.cascades[n].lightMat,t);for(var a=0;a<16;++a)N[16*n+a]=L[a]}}e.setUniformMatrix4fv("shadowMapMatrix",N)}},e.prototype.drawDebugQuad=function(e){l.assert(this.enabled);var t=this.rctx,r=t.gl;if(!this.debugQuadVAO){var i=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new f(t,a.Default3D,{geometry:o.Pos2Tex},{geometry:c.createVertex(t,r.STATIC_DRAW,i)})}var n=this.programRep.getProgram(h.showDepth),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(n),n.setUniformMatrix4fv("proj",e),n.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),p.assertCompatibleVertexAttributeLocations(s,n),t.drawArrays(r.TRIANGLE_STRIP,0,p.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new d(this.rctx,t),this.fbo=u.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=r.mat4f64.create(),T=r.mat4f64.create(),w=r.mat4f64.create(),S=r.vec4f64.create(),R=[],E=0;E<8;++E)R.push(r.vec4f64.create());var O=r.vec3f64.create(),A=r.vec3f64.create(),P=r.vec2f64.create(),M=r.vec2f64.create(),C=r.vec2f64.create(),D=r.vec2f64.create(),I=r.vec2f64.create(),F=r.mat4f64.create(),B=r.vec3f64.create(),V=[],L=r.mat4f64.create(),N=new Float32Array(64),U=r.vec2f64.create(),j=r.vec2f64.create(),z=[r.vec2f64.create(),r.vec2f64.create(),r.vec2f64.create(),r.vec2f64.create()],G=r.vec2f64.create(),H=r.vec2f64.create(),k=r.vec2f64.create(),W=r.vec2f64.create(),X=r.vec2f64.create(),q=r.vec2f64.create(),Y=r.vec2f64.create(),Q=r.vec2f64.create(),K=r.vec2f64.create(),Z=r.mat3f64.create();return b}.apply(null,i))||(e.exports=n)},1716:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(38),r(1601),r(1561),r(1587),r(1578),r(1559),r(1598),r(1717),r(1564),r(1562),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,i,n,a,o,s,l,h,c,u,d,p,f,g,m){var v=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),_=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=n.vec4f64.create(),this._rctx=t,this._programRep=e,this._requestRender=r,this._emptyTexture=l.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r,i){if(this._noiseTexture){h.assert(this.enabled);var a=this._rctx,o=r.width,s=r.height,c=o/this._BLUR_F,u=s/this._BLUR_F;this._ssaoFBO.resize(o,s),this._blur0FBO.resize(c,u),this._blur1FBO.resize(c,u);var d=1*o,p=1*s;a.bindFramebuffer(this._ssaoFBO),n.vec4.copy(this._viewportToRestore,e.fullViewport),a.setViewport(0,0,o,s);var f=this._ssaoProgram,m=this._blurProgram;f.setUniform2f("rnmScale",o/this._noiseTexture.descriptor.width,s/this._noiseTexture.descriptor.height),f.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),a.bindProgram(f);var v=this._data.minDiscrepancy,_=this._samples<v.length?v[this._samples]:5779;f.setUniform1f("numSpiralTurns",_);var x=b,T=y;h.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,T),f.setUniform4fv("projInfo",x),f.setUniform2fv("zScale",T),f.setUniform2f("nearFar",e.near,e.far);var w=1/e.computePixelSizeAtDist(1);f.setUniform1f("projScale",1*w),f.setUniform2f("screenDimensions",d,p);var S=2*this._radius,R=n.vec3.distance(e.eye,e.center);S=20*e.computePixelSizeAtDist(R),S=Math.max(.1,S),f.setUniform1f("radius",S),f.setUniform1f("intensity",4*this._attenuation/Math.pow(S,6)),f.setUniform1i("rnm",0),f.setUniform1i("normalMap",1),f.setUniform1i("depthMap",2),a.bindTexture(this._noiseTexture,0),a.bindTexture(i.colorTexture,1),a.bindTexture(r.colorTexture,2);var E=l.createQuadVAO(this._rctx);a.bindVAO(E),a.drawArrays(5,0,g.vertexCount(E,"geometry")),a.bindTexture(this._ssaoFBO.colorTexture,0),a.setViewport(0,0,d/this._BLUR_F,p/this._BLUR_F),a.bindFramebuffer(this._blur0FBO),m.setUniform2f("screenDimensions",d,p),m.setUniform1i("tex",0),m.setUniform1i("normalMap",1),m.setUniform1i("depthMap",2),m.setUniform2f("blurSize",0,1*this._BLUR_F/p),m.setUniform1i("radius",4),m.setUniform1f("g_BlurFalloff",.08),m.setUniform2f("nearFar",e.near,e.far),R>5e4&&(w=Math.max(0,w-(R-5e4))),m.setUniform1f("projScale",w),m.setUniform2f("zScale",1,0),a.drawArrays(5,0,g.vertexCount(E,"geometry")),m.setUniform2f("blurSize",1*this._BLUR_F/d,0),a.bindFramebuffer(this._blur1FBO),a.bindTexture(this._blur0FBO.colorTexture,0),a.drawArrays(5,0,g.vertexCount(E,"geometry")),a.bindFramebuffer(t),a.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.drawQuad=function(e){h.assert(this.enabled);var t=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new m(this._rctx,o.Default3D,{geometry:s.Pos2Tex},{geometry:d.createVertex(this._rctx,35044,x)}));var r=this._rctx;r.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),r.bindTexture(this._ssaoFBO.colorTexture,0),r.bindVAO(this._debugQuadVAO),r.drawArrays(5,0,g.vertexCount(this._debugQuadVAO,"geometry")),r.setDepthTestEnabled(!0)},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(u.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(u.blurPass,{radius:4}),this._showDepthProgram=this._programRep.getProgram(c.showDepth)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void v.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(63).then(function(){var i=[r(1839)];(function(r){t._data=r,e()}).apply(null,i)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,t,r),this._blur0FBO=p.createWithAttachments(this._rctx,t,r),this._blur1FBO=p.createWithAttachments(this._rctx,t,r),a.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new f(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e}(),y=n.vec2f64.create(),b=n.vec4f64.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return _}.apply(null,i))||(e.exports=n)},1717:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define SAMPLES "+e.samples+"\n"}(e)+i.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:r.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define RADIUS "+e.radius+"\n"}(e)+i.resolveIncludes("renderer/ssao/blur.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1718:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1560)],void 0===(n=function(e,t,r){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var n=542327876,a=131072,o=4,s=33776,l=33778,h=33779,c=i("DXT1"),u=i("DXT3"),d=i("DXT5"),p=31,f=0,g=1,m=2,v=3,_=4,y=7,b=20,x=21;t.createDDSTexture=function(e,t,i,T){var w=new Int32Array(i,0,p);if(w[f]!==n)return console.error("Invalid magic number in DDS header"),null;if(!(w[b]&o))return console.error("Unsupported format, must contain a FourCC code"),null;var S,R,E=w[x];switch(E){case c:S=8,R=s;break;case u:S=16,R=l;break;case d:S=16,R=h;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(E)),null}var O=1;w[m]&a&&!1!==T&&(O=Math.max(1,w[y]));for(var A,P,M=w[_],C=w[v],D=w[g]+4,I=[],F=0;F<O;++F)P=Math.floor((M+3)/4)*Math.floor((C+3)/4)*S,A=new Uint8Array(i,D,P),I.push(A),D+=P,M=Math.max(1,M>>1),C=Math.max(1,C>>1);t.samplingMode=O>1?9987:9729,t.hasMipmap=O>1,t.width=w[_],t.height=w[v],t.internalFormat=R;var B=new r(e,t,{type:"compressed",levels:I});return e.bindTexture(B),B}}.apply(null,i))||(e.exports=n)},1719:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===e.viewingMode,VIEWING_MODE_LOCAL:"local"===e.viewingMode,TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TEXTURE_ALPHA_TEST:e.textureAlphaTest,ALPHA_COVERAGE_CORRECTION:e.alphaCoverageCorrection,BIAS_SHADOWMAP:e.shadowMap,TREE_RENDERING:e.treeRendering,IOS_SAFARI_FIX:e.iosSafariFix})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1834:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(31),r(531)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,a=e.layer.fullExtent,o=a&&a.spatialReference;return o?o.equals(t)?r.resolve(a.clone()):i.canProject(o,t)?r.resolve(i.project(a,t)):e.view.state.isLocal?n.projectGeometry(a,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null}):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},1942:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(9),r(7),r(1),r(38),r(18),r(72),r(1643),r(1943),r(1834),r(1589),r(1575),r(1607),r(1600),r(1592),r(1617)],void 0===(n=function(e,t,r,i,n,a,o,s,l,h,c,u,d,p,f,g,m,v,_){var y=n.getLogger("esri.views.3d.layers.DynamicLayerView3D"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsDraping=!0,t.hasDraped=!0,t.fullExtentInLocalViewSpatialReference=null,t.overlayUpdating=!1,t.maximumDataResolution=null,t._images=[],t._extents=[],t}return r(t,e),Object.defineProperty(t.prototype,"drawingOrder",{get:function(){return this._get("drawingOrder")},set:function(e){if(e!==this._get("drawingOrder")){this._set("drawingOrder",e);var t=new Set;this._images.forEach(function(r){r&&r.material&&(r.material.renderPriority=e,t.add(r.material.id))}),t.size>0&&(this.view._stage.getDrapedTextureRenderer().updateRenderOrder(t),this.emit("draped-data-change"))}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(d.toViewIfLocal(this).then(function(t){return e._set("fullExtentInLocalViewSpatialReference",t)})),this.handles.add(this.watch("suspended",function(){return e._suspendedChangeHandler()}));var t=this.notifyChange.bind(this,"suspended");this.handles.add(this.view.resourceController.registerIdleFrameWorker({idleBegin:function(){e._isScaleRangeActive()&&t()}})),this._isScaleRangeLayer()&&this.handles.add([this.layer.watch("minScale",t),this.layer.watch("maxScale",t)],"layer"),this.handles.add([this.watch("fullOpacity",this._opacityChangeHandler.bind(this)),this.layer.on("redraw",this._layerRedrawHandler.bind(this))],"layer")},t.prototype.destroy=function(){this.clear()},t.prototype.setDrapingExtent=function(e,t,r,i,n){var a=this._extentAndSizeAtResolution(t,r,i),o=a.size,s=a.extent;if("imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var l=this.layer.imageMaxWidth,c=this.layer.imageMaxHeight;o.width>l&&(o.height=Math.floor(o.height*l/o.width),o.width=l),o.height>c&&(o.width=Math.floor(o.width*c/o.height),o.height=c)}var u=this._extents[e];u&&h.equals(u.extent,s)&&!this._imageSizeDiffers(s,r,u.imageSize,o)||(this._extents[e]={extent:h.create(s),spatialReference:r,imageSize:o,renderLocalOrigin:n},this.suspended||this._fetch(e))},t.prototype.getGraphicFromGraphicUid=function(e){return a.reject()},t.prototype.clear=function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)},t.prototype.doRefresh=function(){this.suspended||this.refetch()},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;if(this._isScaleRangeLayer()){var e=this.layer,t=e.minScale,r=e.maxScale;if(t>0||r>0){var i=this.view.scale;if(i<r||t>0&&i>t)return!1}}return!0},t.prototype.isUpdating=function(){if(this.overlayUpdating)return!0;for(var e=0,t=this._images;e<t.length;e++)if(t[e].loadingPromise)return!0;return!1},t.prototype.processResult=function(e,t){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)},t.prototype.updateImage=function(e){return!1},t.prototype.refetch=function(){for(var e=0;e<this._extents.length;e++)this._extents[e]&&this._fetch(e)},t.prototype.beforeFetch=function(){},t.prototype.findExtentInfoAt=function(e){for(var t=0,r=this._extents;t<r.length;t++){var i=r[t],n=i.extent;if(new l(n[0],n[1],n[2],n[3],i.spatialReference).contains(e))return i}return null},t.prototype._imageSizeDiffers=function(e,t,r,i){if(!this.maximumDataResolution)return!0;if(p.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)return!0;var n=h.width(e)/this.maximumDataResolution.x,a=h.height(e)/this.maximumDataResolution.y,o=n/r.width,s=a/r.height,l=n/i.width,c=a/i.height,u=Math.abs(o-l),d=Math.abs(s-c);return u>1.5||d>1.5},t.prototype._fetch=function(e){var t=this;if(!this.suspended){this.beforeFetch();var r=this._extents[e],i=r.extent,n=new l(i[0],i[1],i[2],i[3],r.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,image:null,pixelData:null,renderExtent:h.create(i)});var a=this._images[e];if(a.loadingPromise&&a.loadingPromise.cancel(),0===n.width||0===n.height)return void this._clearImage(e);a.loadingPromise=this.layer.fetchImage(n,r.imageSize.width,r.imageSize.height,{requestAsImageElement:!0}),a.loadingPromise.then(function(r){h.set(a.renderExtent,i),t.processResult(a,r),t._createStageObjects(e,a.image),0===e&&t._images[1]&&t._images[1].rendergeometry&&t._createStageObjects(1,null),t.notifyChange("updating"),t.emit("draped-data-change")}).catch(function(e){e&&"CancelError"!==e.name&&"cancel"!==e.dojoType&&y.error(e),t.notifyChange("updating")}).then(function(){a.loadingPromise=null},function(){a.loadingPromise=null}),this.notifyChange("updating")}},t.prototype._clearImage=function(e){var t=this._images[e],r=this.view._stage;t&&(t.rendergeometry&&(r.getDrapedTextureRenderer().removeRenderGeometries([t.rendergeometry]),t.rendergeometry=null),t.texture&&(r.remove(f.ModelContentType.TEXTURE,t.texture.id),t.texture=null),t.material&&(r.remove(f.ModelContentType.MATERIAL,t.material.id),t.material=null),t.loadingPromise&&(t.loadingPromise.cancel(),t.loadingPromise=null),t.image=null,t.pixelData=null)},t.prototype._createStageObjects=function(e,t){var r=this.view._stage,i=r.getDrapedTextureRenderer(),n=this._images[e];t&&(n.texture&&r.remove(f.ModelContentType.TEXTURE,n.texture.id),n.texture=new m(t,"dynamicLayer",{width:t.width,height:t.height,wrap:{s:33071,t:33071}}),r.add(f.ModelContentType.TEXTURE,n.texture)),n.material?t&&n.material.setParameterValues({textureId:n.texture.id}):(n.material=new v({ambient:[1,1,1],diffuse:[0,0,0],transparent:!0,opacity:this.fullOpacity,textureId:n.texture.id,receiveSSAO:!1},"dynamicLayer"),n.material.renderPriority=this.drawingOrder,r.add(f.ModelContentType.MATERIAL,n.material));var a,o=this._extents[e].renderLocalOrigin;if(0===e)a=u.createGeometryForExtent(n.renderExtent,-1);else{if(1!==e)return void console.error("DynamicLayerView3D._createStageObjects: Invalid extent idx");var l=this._images[0].renderExtent;if(!l)return;a=u.createOuterImageGeometry(l,n.renderExtent,-1)}var h=new g(a);h.material=n.material,h.origin=o,h.transformation=s.mat4f64.create(),h.name="dynamicLayer",h.uniqueName="dynamicLayer#"+a.id,i.addRenderGeometries([h]),n.rendergeometry&&i.removeRenderGeometries([n.rendergeometry]),n.rendergeometry=h},t.prototype._isScaleRangeLayer=function(){return"minScale"in this.layer&&"maxScale"in this.layer},t.prototype._isScaleRangeActive=function(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)},t.prototype._extentAndSizeAtResolution=function(e,t,r){var i=h.width(e)/h.height(e),n={width:r,height:r};i>1.0001?n.height=r/i:i<.9999&&(n.width=r*i);var a=this._clippedExtent(e,t,x);return n.width=Math.round(n.width/(h.width(e)/h.width(a))),n.height=Math.round(n.height/(h.height(e)/h.height(a))),{size:n,extent:a}},t.prototype._clippedExtent=function(e,t,r){if("local"!==this.view.viewingMode)return h.set(r,e);var i=this.view.basemapTerrain,n=i.extent;return i.ready&&n?h.intersection(e,n,r):h.set(r,e)},t.prototype._opacityChangeHandler=function(e){for(var t=0,r=this._images;t<r.length;t++){var i=r[t];i&&i.material&&i.material.setParameterValues({opacity:e})}this.emit("draped-data-change")},t.prototype._layerRedrawHandler=function(){for(var e=!1,t=0;t<this._images.length;t++){var r=this._images[t];this.updateImage(r)&&(e=!0,this._createStageObjects(t,r.image))}e&&this.emit("draped-data-change")},t.prototype._suspendedChangeHandler=function(){if(this.suspended)this.clear(),this.emit("draped-data-change");else for(var e=0;e<this._extents.length;e++)this._fetch(e)},i([o.property()],t.prototype,"layer",void 0),i([o.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),i([o.property({type:Boolean})],t.prototype,"supportsDraping",void 0),i([o.property({type:Boolean})],t.prototype,"hasDraped",void 0),i([o.property({value:0,type:Number})],t.prototype,"drawingOrder",null),i([o.property({readOnly:!0})],t.prototype,"fullExtentInLocalViewSpatialReference",void 0),i([o.property()],t.prototype,"overlayUpdating",void 0),i([o.property({dependsOn:["overlayUpdating"]})],t.prototype,"updating",void 0),i([o.subclass("esri.views.3d.layers.DynamicLayerView3D")],t)}(o.declared(c,_)),x=h.create();return b}.apply(null,i))||(e.exports=n)},1943:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(72),r(1576),r(1596),r(1559)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=[[e[0],e[1],t],[e[2],e[1],t],[e[2],e[3],t],[e[0],e[3],t]];return n.createSquareGeometry(r)}Object.defineProperty(t,"__esModule",{value:!0});var s=new Float32Array([0,0,1]);t.createGeometryForExtent=o,t.createOuterImageGeometry=function(e,t,n){if(!r.intersects(e,t))return o(t,n);for(var l=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],h=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],c=t[2]-t[0],u=t[3]-t[1],d=h[0]>0&&h[2]>0?3:2,p=l[0]>0&&l[2]>0?3:2,f=(p+1)*(d+1),g=new Float32Array(3*f),m=new Float32Array(2*f),v=new Uint32Array(6*(p*d-1)),_=0,y=0,b=0,x=0,T=0,w=0;w<4;w++){var S=l[w];if(!(S<=0)){for(var R=0,E=0;E<4;E++){var O=h[E];O<=0||(g[y++]=t[0]+R,g[y++]=t[1]+_,g[y++]=n,m[b++]=R/c,m[b++]=_/u,E<3&&w<3&&(1!==E||1!==w)&&(v[T++]=x,v[T++]=x+1,v[T++]=x+d+1,v[T++]=x+1,v[T++]=x+d+2,v[T++]=x+d+1),x++,R+=O)}_+=S}}var A={};A[a.VertexAttrConstants.POSITION]={size:3,data:g},A[a.VertexAttrConstants.NORMAL]={size:3,data:s},A[a.VertexAttrConstants.UV0]={size:2,data:m};for(var P={},M=new Uint32Array(v.length),C=0;C<M.length;C++)M[C]=0;return P[a.VertexAttrConstants.POSITION]=v,P[a.VertexAttrConstants.NORMAL]=M,P[a.VertexAttrConstants.UV0]=v,new i(A,P)}}.apply(null,i))||(e.exports=n)},2020:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(8),r(7),r(1),r(1617)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.fetchPopupFeatures=function(e){var t=this.layer;if(!e)return a.reject(new n("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));var r=t.popupEnabled;if(!r)return a.reject(new n("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r}));var i=this.createFetchPopupFeaturesQuery(e),o=i.extent,s=i.width,l=i.height,h=i.x,c=i.y;if(!(o&&s&&l))return a.reject(new n("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:o,width:s,height:l}));var u=t.fetchFeatureInfo(o,s,l,h,c);return u?u.then(function(e){return[e]}):a.resolve([])},i([o.property()],t.prototype,"layer",void 0),i([o.subclass("esri.views.layers.WMSLayerView")],t)}(o.declared(s))}.apply(null,i))||(e.exports=n)},2512:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(1),r(18),r(2007),r(1942),r(2020)],void 0===(n=function(e,t,r,i,n,a,o,s,l){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){var e=this;this._exportWMSImageParameters=new o({layer:this.layer}),this.handles.add(this._exportWMSImageParameters.watch("version",function(t){e._imageVersion!==t&&(e._imageVersion=t,e.refetch())}))},t.prototype.destroy=function(){this._exportWMSImageParameters&&(this._exportWMSImageParameters.layer=null,this._exportWMSImageParameters.destroy(),this._exportWMSImageParameters=null)},t.prototype.canResume=function(){var e=this.inherited(arguments);return e?this.layer.supportsSpatialReference(this.view.spatialReference):e},t.prototype.createFetchPopupFeaturesQuery=function(e){var t=this.findExtentInfoAt(e),r=t.extent,i=new a(r[0],r[1],r[2],r[3],t.spatialReference),n=t.imageSize,o=n.width,s=n.height,l=i.width/o;return{extent:i,width:o,height:s,x:Math.round((e.x-i.xmin)/l),y:Math.round((i.ymax-e.y)/l)}},t.prototype.beforeFetch=function(){this._imageVersion=this._exportWMSImageParameters.version},i([n.property({dependsOn:["view.spatialReference","layer.spatialReferences"]})],t.prototype,"suspended",void 0),i([n.subclass("esri.views.3d.layers.WMSLayerView3D")],t)}(n.declared(s,l))}.apply(null,i))||(e.exports=n)}}]);