(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/sources/FeatureLayerSource":1542})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1542:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2),r(0),r(10),r(55),r(21),r(4),r(8),r(61),r(7),r(1),r(97),r(566)],void 0===(a=function(e,t,r,n,a,u,s,o,i,l,c,d,p,y){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="feature-layer",t}return r(t,e),t.prototype.load=function(){return this.addResolvingPromise(this._fetchService()),this.when()},Object.defineProperty(t.prototype,"queryTask",{get:function(){var e=this.layer,t=e.parsedUrl,r=e.dynamicDataSource,n=e.gdbVersion;return new p({url:null!=r?t.path+"?"+u.objectToQuery(t.query):t.path,gdbVersion:n})},enumerable:!0,configurable:!0}),t.prototype.addAttachment=function(e,t){var r=this;return this.load().then(function(){var n=e.attributes[r.layer.objectIdField],u=r.layer.parsedUrl.path+"/"+n+"/addAttachment";return s(u,{body:t,query:a({f:"json"},r.layer.parsedUrl.query,{token:r.layer.token}),responseType:"json"}).then(function(e){return r._createFeatureEditResult(e.data.addAttachmentResult)}).catch(function(e){return c.reject(r._createAttachmentErrorResult(n,e))})})},t.prototype.updateAttachment=function(e,t,r){var n=this;return this.load().then(function(){var u=e.attributes[n.layer.objectIdField],o=n.layer.parsedUrl.path+"/"+u+"/updateAttachment";return s(o,{body:r,query:a({f:"json"},n.layer.parsedUrl.query,{attachmentId:t,token:n.layer.token}),responseType:"json"}).then(function(e){return n._createFeatureEditResult(e.data.updateAttachmentResult)}).catch(function(e){return c.reject(n._createAttachmentErrorResult(u,e))})})},t.prototype.applyEdits=function(e){var t=this;return this.load().then(function(){var r=e.addFeatures.map(t._serializeFeature,t),n=e.updateFeatures.map(t._serializeFeature,t),a=t._getFeatureIds(e.deleteFeatures),u={f:"json",adds:r.length?JSON.stringify(r):null,updates:n.length?JSON.stringify(n):null,deletes:a.length?a.join(","):null};return s(t.layer.parsedUrl.path+"/applyEdits",{query:u,method:"post",responseType:"json"})}).then(function(e){return t._createEditsResult(e)})},t.prototype.deleteAttachments=function(e,t){var r=this;return this.load().then(function(){var n=e.attributes[r.layer.objectIdField],u=r.layer.parsedUrl.path+"/"+n+"/deleteAttachments";return s(u,{query:a({f:"json"},r.layer.parsedUrl.query,{token:r.layer.token,attachmentIds:t.join(",")}),method:"post",responseType:"json"}).then(function(e){return e.data.deleteAttachmentResults.map(r._createFeatureEditResult)}).catch(function(e){return c.reject(r._createAttachmentErrorResult(n,e))})})},t.prototype.queryAttachments=function(e){var t=this,r=this.layer,n=r.token,u=r.parsedUrl,o=u.path;return this.load().then(function(){var r={query:a({},u.query,{f:"json",token:n}),responseType:"json"};if(!t.layer.get("capabilities.operations.supportsQueryAttachments")){for(var i=e.objectIds,l=[],d=0,p=i;d<p.length;d++){var h=p[d],f=o+"/"+h+"/attachments";l.push(s(f,r))}return c.all(l).then(function(e){return i.map(function(t,r){return{parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}})}).then(function(e){return y.processAttachmentQueryResult(e,o,n)})}return t.queryTask.executeAttachmentQuery(e,r)})},t.prototype.queryFeatures=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.execute(e,t)})},t.prototype.queryFeaturesJSON=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeJSON(e,t)})},t.prototype.queryObjectIds=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForIds(e,t)})},t.prototype.queryFeatureCount=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForCount(e,t)})},t.prototype.queryExtent=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForExtent(e,t)})},t.prototype.queryRelatedFeatures=function(e){var t=this;return this.load().then(function(){return t.queryTask.executeRelationshipQuery(e)})},t.prototype._fetchService=function(){var e=this,t=this.layer.resourceInfo;return t?(this.layerDefinition=t,c.resolve()):s(this.layer.parsedUrl.path,{query:a({f:"json"},this.layer.parsedUrl.query),responseType:"json"}).then(function(t){var r=t.data;e.layerDefinition=r})},t.prototype._serializeFeature=function(e){var t=e.geometry,r=e.attributes;return"mesh"===t.type||"extent"===t.type?null:{geometry:t&&t.toJSON(),attributes:r}},t.prototype._getFeatureIds=function(e){var t=e[0];return t?"objectId"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]},t.prototype._getIdsFromFeatures=function(e){var t=this.layer.objectIdField;return e.map(function(e){return e.attributes&&e.attributes[t]})},t.prototype._getIdsFromFeatureIdentifier=function(e){return e.map(function(e){return e.objectId})},t.prototype._createEditsResult=function(e){var t=e.data;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[]}},t.prototype._createFeatureEditResult=function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new i("feature-layer-source:edit-failure",t.description,{code:t.code}):null}},t.prototype._createAttachmentErrorResult=function(e,t){var r=t.details.messages&&t.details.messages[0]||t.message,n=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new i("feature-layer-source:attachment-failure",r,{code:n})}},n([d.property()],t.prototype,"type",void 0),n([d.property({constructOnly:!0})],t.prototype,"layer",void 0),n([d.property({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource"]})],t.prototype,"queryTask",null),n([d.subclass("esri.layers.graphics.sources.FeatureLayerSource")],t)}(d.declared(o,l));t.default=h}.apply(null,n))||(e.exports=a)}}]);