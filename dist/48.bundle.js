(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/SceneLayerGraphicsView3D":1549,"esri/views/webgl/Texture":1560,"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":1561,"esri/views/webgl/FramebufferObject":1562,"esri/views/3d/layers/graphics/graphicUtils":1566,"esri/views/3d/webgl-engine/lib/Geometry":1570,"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":1574,"esri/views/3d/webgl-engine/Stage":1575,"esri/views/3d/webgl-engine/lib/GeometryData":1576,"esri/views/3d/webgl-engine/lib/IdGen":1577,"esri/views/3d/webgl-engine/lib/glUtil3D":1578,"esri/views/webgl/capabilities/isWebGL2Context":1580,"esri/views/3d/webgl-engine/lib/Object3D":1581,"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":1584,"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":1585,"esri/views/3d/webgl-engine/lib/ModelContentType":1586,"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":1587,"esri/views/3d/support/debugFlags":1589,"esri/views/3d/webgl-engine/lib/Material":1591,"esri/views/3d/webgl-engine/materials/DefaultMaterial":1592,"esri/layers/graphics/dehydratedFeatures":1593,"esri/views/3d/webgl-engine/lib/Camera":1594,"esri/views/3d/webgl-engine/materials/internal/bufferWriters":1595,"esri/views/3d/webgl-engine/lib/GeometryUtil":1596,"esri/views/3d/webgl-engine/lighting/Lightsources":1597,"esri/views/3d/webgl-engine/shaders/MiscPrograms":1598,"esri/views/3d/layers/graphics/ElevationAligners":1599,"esri/views/3d/webgl-engine/lib/Texture":1600,"esri/views/3d/support/imageUtils":1601,"esri/views/3d/layers/graphics/featureExpressionInfoUtils":1603,"esri/views/3d/webgl-engine/lib/GLMaterial":1604,"esri/views/3d/layers/graphics/symbolComplexity":1605,"esri/views/3d/webgl-engine/lib/RenderGeometry":1607,"esri/views/3d/webgl-engine/parts/Model":1608,"esri/views/3d/webgl-engine/lib/depthRange":1609,"esri/views/3d/webgl-engine/lib/HighlightUtils":1610,"esri/views/3d/webgl-engine/lib/GLMaterialTexture":1611,"esri/views/webgl/Renderbuffer":1612,"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":1613,"esri/views/3d/support/buffer/utils":1614,"esri/views/3d/webgl-engine/materials/HUDMaterial":1615,"esri/views/3d/layers/i3s/I3SUtil":1618,"esri/views/3d/support/PromiseLightweight":1619,"esri/geometry/support/quantizationUtils":1620,"esri/views/3d/webgl-engine/lib/Renderer":1622,"esri/views/3d/webgl-engine/lib/localOriginHelper":1623,"esri/views/3d/webgl-engine/lib/SliceHelper":1624,"esri/views/3d/layers/support/FastSymbolUpdates":1625,"@dojo/framework/shim/Map":1628,"esri/views/3d/support/orientedBoundingBox":1629,"esri/views/3d/webgl-engine/lib/Layer":1630,"esri/views/3d/webgl-engine/lib/Octree":1631,"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":1632,"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":1633,"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":1634,"esri/views/3d/layers/i3s/I3SBinaryReader":1635,"esri/views/3d/layers/support/layerViewUpdatingProperties":1637,"esri/views/3d/layers/graphics/ElevationContext":1638,"esri/views/3d/webgl-engine/lib/Performance":1639,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":1644,"esri/views/3d/webgl-engine/lib/PerformanceTimer":1645,"esri/views/3d/layers/support/edgeUtils":1646,"esri/views/webgl/RenderingContext":1648,"esri/views/webgl/enums":1649,"esri/views/webgl/InstanceCounter":1650,"esri/views/webgl/capabilities/load":1651,"esri/views/webgl/capabilities/DisjointTimerQuery":1652,"esri/views/webgl/capabilities/Instancing":1653,"esri/views/webgl/capabilities/VertexArrayObjects":1654,"esri/views/3d/support/Evented":1656,"esri/renderers/support/clickToleranceUtils":1657,"esri/views/3d/layers/graphics/Graphics3DSymbol":1659,"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":1660,"esri/views/3d/webgl-engine/lib/ModelDirtySet":1661,"esri/views/3d/webgl-engine/parts/View":1662,"esri/views/3d/webgl-engine/lib/DrapedRenderer":1663,"esri/views/3d/webgl-engine/lib/BoundingInfo":1664,"esri/views/3d/webgl-engine/lib/GeometryRecord":1665,"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":1666,"esri/views/3d/webgl-engine/lib/RenderContext":1667,"esri/views/3d/webgl-engine/lib/Float32ArrayList":1668,"esri/views/3d/webgl-engine/lib/FxaaRenderPass":1669,"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":1670,"esri/views/3d/webgl-engine/lib/InstanceBufferData":1671,"esri/views/3d/webgl-engine/lib/IntervalUtilities":1672,"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":1673,"esri/views/3d/webgl-engine/lib/NormalTextureHelper":1674,"esri/views/3d/webgl-engine/lib/RenderPluginManager":1675,"esri/views/3d/webgl-engine/lib/SmaaRenderPass":1676,"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":1677,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":1678,"esri/views/3d/support/buffer/utils/mat3":1679,"esri/views/3d/support/buffer/utils/mat4":1680,"esri/views/3d/support/buffer/utils/scalar":1681,"esri/views/3d/support/buffer/utils/vec2":1682,"esri/views/3d/support/buffer/utils/vec3":1683,"esri/views/3d/support/buffer/utils/vec4":1684,"esri/views/3d/webgl-engine/lib/LocalOriginManager":1685,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":1686,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":1687,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":1688,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":1689,"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":1690,"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":1691,"esri/views/3d/webgl-engine/lib/edgeRendering/util":1692,"esri/views/3d/webgl-engine/lighting/SceneLighting":1693,"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":1694,"esri/views/3d/webgl-engine/lib/LongVectorMath":1695,"esri/core/libs/gl-matrix-2/types/mat4":1696,"esri/views/3d/webgl-engine/shaders/HUDPrograms":1697,"esri/views/webgl/Profiling":1698,"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":1699,"esri/views/3d/webgl-engine/lib/GLMaterialRep":1700,"esri/views/3d/webgl-engine/lib/GLTextureRep":1701,"esri/views/3d/webgl-engine/lib/tracer":1702,"esri/views/3d/webgl-engine/lib/webgl-debug":1703,"esri/views/3d/webgl-engine/parts/Viewport":1704,"esri/views/3d/webgl-engine/parts/Visualizer":1705,"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":1706,"esri/views/3d/webgl-engine/lib/RenderTargetHelper":1707,"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":1708,"esri/core/TimeProfiler":1709,"esri/views/3d/webgl-engine/lib/depthRangeUtils":1710,"esri/views/3d/webgl-engine/lib/HighlightHelper":1711,"esri/views/3d/webgl-engine/shaders/HighlightPrograms":1712,"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":1713,"esri/views/3d/webgl-engine/shaders/OccludedPrograms":1714,"esri/views/3d/webgl-engine/lib/ShadowMap":1715,"esri/views/3d/webgl-engine/lib/SSAOHelper":1716,"esri/views/3d/webgl-engine/shaders/SSAOPrograms":1717,"esri/views/3d/webgl-engine/lib/DDSUtil":1718,"esri/views/3d/webgl-engine/shaders/DefaultPrograms":1719,"esri/views/3d/webgl-engine/materials/NativeLineMaterial":1720,"esri/views/3d/layers/graphics/lineUtils":1721,"esri/core/Version":1722,"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":1723,"esri/views/3d/webgl-engine/lib/pathGeometryUtils":1724,"esri/layers/graphics/dehydratedFeatureComparison":1732,"esri/views/3d/layers/graphics/constants":1738,"esri/views/3d/layers/graphics/Graphics3DGraphic":1739,"esri/views/3d/layers/support/symbolColorUtils":1740,"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":1741,"esri/views/3d/layers/i3s/LEPCC":1742,"esri/core/sql/WhereGrammar":1746,"esri/views/3d/support/dito":1751,"esri/core/sql/WhereClause":1752,"esri/core/sql/AggregateFunctions":1753,"esri/core/sql/StandardizedFunctions":1754,"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":1757,"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":1758,"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":1759,"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":1760,"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":1761,"esri/views/3d/layers/graphics/SignedDistanceFunctions":1762,"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":1763,"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":1764,"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":1765,"esri/views/3d/layers/graphics/lodResourceUtils":1766,"esri/views/3d/layers/graphics/objectResourceUtils":1767,"esri/views/3d/glTF/DefaultLoadingContext":1768,"esri/views/3d/glTF/loader":1769,"esri/views/3d/glTF/internal/indexUtils":1770,"esri/views/3d/glTF/DefaultErrorContext":1771,"esri/views/3d/glTF/esriProvidedModelParameters":1772,"esri/views/3d/glTF/internal/Resource":1773,"esri/views/3d/glTF/internal/BinaryStreamReader":1774,"esri/views/3d/glTF/internal/fillDefaults":1775,"esri/views/3d/glTF/internal/pathUtils":1776,"esri/views/3d/support/buffer/math":1777,"esri/views/3d/support/buffer/math/vec3":1778,"esri/views/3d/support/buffer/math/common":1779,"esri/views/3d/support/buffer/math/vec4":1780,"esri/views/3d/layers/graphics/wosrLoader":1781,"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":1782,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":1783,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":1784,"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":1785,"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":1786,"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":1787,"esri/views/3d/webgl-engine/lib/lodRendering/utils":1788,"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":1789,"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer2":1790,"esri/views/3d/webgl-engine/materials/PathMaterial":1791,"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":1792,"esri/views/3d/webgl-engine/shaders/PathPrograms":1793,"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":1794,"esri/views/3d/webgl-engine/materials/ColorMaterial":1795,"esri/views/3d/webgl-engine/shaders/ColorPrograms":1796,"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":1797,"esri/views/3d/webgl-engine/lib/TextTexture":1798,"esri/views/3d/webgl-engine/lib/HighlightSet":1799,"esri/views/3d/layers/support/attributeUtils":1800,"esri/support/graphicUtils":1832,"esri/views/layers/support/popupUtils":1833,"esri/views/3d/layers/support/popupUtils3D":1835,"esri/views/3d/layers/i3s/IdleQueue":1836,"esri/core/libs/quickselect/quickselect":1853,"esri/layers/graphics/controllers/I3SOnDemandController":1865,"esri/views/3d/layers/i3s/I3SFrameWorker":1866,"esri/views/3d/layers/i3s/I3SIndex":1867,"esri/views/3d/layers/i3s/I3SLodHandling":1868,"esri/views/3d/layers/i3s/I3SNodeLoader":1869,"esri/views/3d/layers/i3s/I3SViewportQueries":1870,"esri/views/3d/support/ResourceController":1871,"esri/views/3d/support/MemoryController":1872,"esri/views/3d/layers/support/MemoryManagedLayerView":1873,"esri/views/3d/support/StreamDataLoader":1874,"esri/views/3d/support/AsyncQuotaRoundRobinQueue":1875,"esri/views/3d/support/StreamDataSupplier":1876,"esri/core/libs/rbush/PooledRBush":1890,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":1914,"esri/renderers/support/renderingInfoUtils":1916,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1917,"esri/views/3d/layers/graphics/Graphics3DCore":1918,"esri/renderers/support/rendererConversion":1919,"esri/views/3d/layers/graphics/ElevationQuery":1920,"esri/views/3d/layers/graphics/Graphics3DOwner":1921,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1922,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1923,"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":1924,"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":1925,"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":1926,"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":1927,"esri/views/3d/support/PropertiesPool":1928,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1929,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1930,"esri/views/3d/support/FrustumExtentIntersection":1931,"esri/views/3d/support/intersectionUtils":1932,"esri/views/3d/layers/graphics/Graphics3DHighlights":1933,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1934,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1935,"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":1936,"esri/views/3d/layers/i3s/I3SQueryEngine":2008,"esri/views/3d/layers/support/PopupSceneLayerView":2009,"esri/views/3d/support/EventedArray":2451})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[48,7],{1549:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(50),r(19),r(9),r(261),r(7),r(14),r(1),r(38),r(1890),r(1563),r(72),r(99),r(1593),r(1865),r(1916),r(1643),r(1917),r(1914),r(2008),r(1618),r(1637),r(2009),r(2451),r(1629),r(93)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E,P,O){var R=o.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),A=function(e){function t(t){var r=e.call(this)||this;return r._nodesAddedToStage={},r.overlayUpdating=!1,r.supportsDraping=!0,r._queryEngine=null,r._memCache=null,r.loadedGraphics=new E,r.progressiveLoadFactor=1,r.supportsHeightUnitConversion=!0,r._coordinatesOutsideExtentErrors=0,r._maxCoordinatesOutsideExtentErrors=20,r._definitionExpressionErrors=0,r._maxDefinitionExpressionErrors=20,r}return r(t,e),t.prototype.initialize=function(){var e=this;S.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode),this.handles.add([u.init(this.layer,"rangeInfos",function(t){return e._rangeInfosChanged(t)}),this.layer.watch("renderer",function(t,r){return e._rendererChange(t,r)}),this.layer.watch("objectIdFilter",function(){return e._objectIdFilterChange()}),this.watch("_controller.parsedDefinitionExpression",function(){return e._definitionExpressionChange()})]),this._set("graphics3d",new _({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(t){return e._updateClippingExtent(t)},queryGraphicUIDsInExtent:function(t,r,i){return e._queryGraphicUIDsInExtent(t,r,i)}})),this.supportsHeightUnitConversion&&(this._verticalScale=new x({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference})),this.addResolvingPromise(this.graphics3d.setup()),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this._memCache=this.view.resourceController.getMemCache(this.layer.uid),this._controller=new v({layerView:this}),this.when(function(){e.handles.add([u.init(e,"maximumNumberOfFeatures",function(t){return e._controller.featureTarget=t}),u.whenTrue(e,"suspended",function(){return e._removeAllNodeData()})])})},t.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this._controller&&(this._controller.destroy(),this._controller=null),this._memCache.destroy(),this._memCache=null,this._elevationUpdateNodes=null,this._nodesAddedToStage=null},Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){var e=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return e?e.maximumNumberOfFeatures:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!this.suspended&&!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0}),t.prototype.whenGraphicAttributes=function(e,t){var r=this;return S.whenGraphicAttributes(this.layer,e,this._getObjectIdField(),t,function(e){for(var t=new Map,i=[],n=0,a=e;n<a.length;n++){var o=a[n],s=r._findGraphicNodeAndIndex(o),l=t.get(s.node);l||(l={node:s.node,indices:[],graphics:[]},i.push(l)),l.indices.push(s.index),l.graphics.push(o)}return i},{ignoreUnavailableFields:!0,populateObjectId:!0})},t.prototype.getGraphicFromGraphicUid=function(e){if(!this.loadedGraphics)return l.reject();var t=g.hydrateGraphic(this.loadedGraphics.find(function(t){return t.uid===e}),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,l.resolve(t)):l.reject()},t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d.graphicsCore.whenGraphicBounds(e,t)},t.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},t.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||!this.graphics3d.destroyed&&this.graphics3d.updating},t.prototype.getRenderingInfo=function(e){var t=y.getRenderingInfo(e,{renderer:this.layer.renderer});if(t&&t.color){var r=t.color;r[0]=r[0]/255,r[1]=r[1]/255,r[2]=r[2]/255}return t},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0}),t.prototype._findGraphicNodeAndIndex=function(e){for(var t=e.attributes[this.layer.objectIdField],r=0,i=Object.keys(this._nodesAddedToStage);r<i.length;r++){var n=i[r],a=this._nodesAddedToStage[n].bundle,o=this._findGraphicIndex(a,t);if(o>=0)return{node:this._controller.nodeIndex[n],index:o}}return null},t.prototype._forAllFeatures=function(e,t){for(var r=0,i=Object.keys(this._nodesAddedToStage);r<i.length;r++){for(var n=i[r],a=this._nodesAddedToStage[n].bundle,o=0;o<a.length;o++)for(var s=a[o].graphics,l=0;l<s.length;l++){var u=s[l],c=a[o].featureIds[l];u.visible&&e(c,o,u)}null!=t&&t({nodeId:n})}},t.prototype._getGraphicIndices=function(e,t){for(var r=this._nodesAddedToStage[e],i=this._getObjectIdField(),n=[],a=0,o=t;a<o.length;a++){var s=o[a].attributes[i],l=this._findGraphicIndex(r.bundle,s);l>=0&&n.push(l)}return n},t.prototype._findGraphicIndex=function(e,t){for(var r=0;r<e.length;r++)for(var i=0,n=e[r].featureIds;i<n.length;i++){if(n[i]===t)return r}return-1},t.prototype._queryGraphicUIDsInExtent=function(e,t,r){if(this._controller){var i=this._controller.crsIndex;O.boundingRectToBoundingRect(e,t,D,i);var n=F;p.fromRect(n,D),n[2]=-1/0,n[5]=1/0,null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new s);var o=this._elevationUpdateNodes;o.clear(),this._controller.updateElevationChanged(n,i,o);for(var l=0;l<o.length;l++){var u=o.data[l],c=this._nodesAddedToStage[u.id];if(null!=c){if(!c.spatialIndex&&c.bundle.length>=I){var h=new d.PooledRBush(9,a("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);U.length=0;for(var m=0,v=c.bundle;m<v.length;m++){for(var y=v[m],b=f.empty(),_=0,x=y.graphics;_<x.length;_++){var w=x[_];g.expandAABR(w.geometry,b)}y.extent=b,U.push(y)}h.load(U),c.spatialIndex=h}if(c.spatialIndex){var S=D;O.boundingRectToBoundingRect(e,t,D,this.view.spatialReference),V.minX=S[0],V.minY=S[1],V.maxX=S[2],V.maxY=S[3],c.spatialIndex.search(V,function(e){for(var t=0,i=e.graphics;t<i.length;t++){var n=i[t];r(n.uid)}})}else for(var C=0,T=c.bundle;C<T.length;C++)for(var E=0,P=(y=T[C]).graphics;E<P.length;E++){w=P[E];r(w.uid)}}}}},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.addNodeData=function(e,t){var r=t.allGeometryData,i=t.attributeDataInfo,a=this._controller.crsIndex,o=this.view.spatialReference,s=[0,0,0],u=this._getObjectIdField();null==this._nodesAddedToStage[e.id]&&(this._nodesAddedToStage[e.id]={bundle:[],attributeInfo:i});var c=[];this._nodesAddedToStage[e.id].bundle=c;for(var h=this.layer.fullExtent&&function(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}(this.layer.fullExtent.clone(),.5),d=[],p=[],f=0;f<r.length;f++){var v=r[f],y=v.featureDataPosition,b=y.length,_=v.geometries||[M[b]],x=v.featureIds;h&&!m.extentContainsCoords3D(h,y)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&R.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&R.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var w=0;w<_.length;w++){var S=_[w];if("points"===S.params.type){var C=[],T=x[w<x.length?w:0],E={};null!=T&&(E[u]=T);var A=void 0;"Embedded"===S.type&&(A=S.params.vertexAttributes.position);for(var I=0;I<A.length;I+=b){for(var D=0;D<b;D++)s[D]=y[D]+A[I+D];O.bufferToBuffer(s,a,0,L,o,0,1);var F=g.makeDehydratedPoint(L[0],L[1],L[2],o);b<3&&(F.z=void 0),C.push({uid:n.generateUID(),geometry:F,attributes:E,visible:!0}),e.obb||p.push(F.x,F.y,F.z?F.z:0)}d.push.apply(d,C),c.push({featureIds:v.featureIds,graphics:C})}}}e.numFeatures=d.length,this._updateNodeMemory(e);var V=this._nodesAddedToStage[e.id];if(this._setBundleAttributes(V.bundle,V.attributeInfo),p.length>0){var U=this.view.renderSpatialReference,B=this._controller.crsVertex;O.bufferToBuffer(p,o,0,p,U,0,p.length/3);var N={data:p,size:3,offsetIdx:0,strideIdx:3};e.obb=P.compute(N),O.vectorToVector(e.obb.center,U,e.obb.center,B),this._controller.updateVisibility(e.id)}return this._controller.isGeometryVisible(e)?(this._verticalScale&&this._verticalScale.adjust(d),this.loadedGraphics.addMany(d),this._filterNode(V),l.resolve()):(this._cacheNodeData(e.id,this._nodesAddedToStage[e.id]),delete this._nodesAddedToStage[e.id],l.resolve())},t.prototype.isNodeLoaded=function(e){return null!=this._nodesAddedToStage[e.id]},t.prototype._updateNodeMemory=function(e){e.memory=4096+e.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic},t.prototype._cacheNodeData=function(e,t){var r=t.bundle.reduce(function(e,t){return t.graphics.reduce(function(e,t){return g.estimateSize(t)+e},512+8*t.featureIds.length+e)},1024);this._memCache.put(e,t,r)},t.prototype._removeAllNodeData=function(){var e=this;Object.keys(this._nodesAddedToStage).forEach(function(t){var r=e._nodesAddedToStage[t];if(r){var i=e._controller.nodeIndex[t];e._updateNodeMemory(i),e._cacheNodeData(t,r)}}),this._nodesAddedToStage={},this.loadedGraphics.clear()},t.prototype.removeNodeData=function(e){var t=this,r=[];e.forEach(function(e){var i=t._removeNodeStageData(e,r);i&&(t._updateNodeMemory(e),t._cacheNodeData(e.id,i))}),this.loadedGraphics.removeUnorderedMany(r)},t.prototype._removeNodeStageData=function(e,t){var r=this._nodesAddedToStage[e.id];if(!r)return null;for(var i=0,n=r.bundle;i<n.length;i++){var a=n[i];t.push.apply(t,a.graphics)}return delete this._nodesAddedToStage[e.id],r},t.prototype.loadCachedNodeData=function(e,t){return l.resolve(this._memCache.pop(e.id))},t.prototype.addCachedNodeData=function(e,t,r){for(var i=[],n=0,a=t.bundle;n<a.length;n++){var o=a[n];i.push.apply(i,o.graphics)}return this._updateNodeMemory(e),this._nodesAddedToStage[e.id]=t,this.setAttributeData(e,r),this.loadedGraphics.addMany(i),this._filterNode(t),l.resolve()},t.prototype.getLoadedNodeIDs=function(){return Object.keys(this._nodesAddedToStage)},t.prototype.getLoadedAttributes=function(e){var t=this._nodesAddedToStage[e.id];if(t)return t.attributeInfo.loadedAttributes},t.prototype.getAttributeData=function(e){var t=this._nodesAddedToStage[e.id];if(t)return t.attributeInfo.attributeData},t.prototype.setAttributeData=function(e,t){var r=this._nodesAddedToStage[e.id];if(r&&(r.attributeInfo=t,this._setBundleAttributes(r.bundle,t),this._filterNode(r),this.graphics3d.graphicsCore.labelsEnabled)){var i=r.bundle.map(function(e){return e.graphics.length&&e.graphics[0].uid});this.graphics3d.graphicsCore.updateLabelingInfo(i)}},t.prototype._setBundleAttributes=function(e,t){for(var r=0;r<e.length;r++)for(var i=0,n=e[r].graphics;i<n.length;i++){var a=n[i];if(a.attributes||(a.attributes={}),t.loadedAttributes)for(var o=0,s=t.loadedAttributes;o<s.length;o++){var l=s[o].name;t.attributeData[l]&&(a.attributes[l]=S.getCachedAttributeValue(t.attributeData[l],r))}}},t.prototype._updateClippingExtent=function(e){return this._controller&&this._controller.updateClippingArea(e),!1},t.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},t.prototype._rendererChange=function(e,t){var r=e?e.requiredFields:[],i=t?t.requiredFields:[];r.length===i.length&&r.every(function(e,t){return r[t]===i[t]})||this._reloadAllNodes()},t.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&R.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},t.prototype._objectIdFilterChange=function(){var e=this;Object.keys(this._nodesAddedToStage).forEach(function(t){return e._filterNode(e._nodesAddedToStage[t])})},t.prototype._reloadAllNodes=function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()},t.prototype._definitionExpressionChange=function(){this._definitionExpressionErrors=0},t.prototype._evaluateClause=function(e,t){try{return!!e.calculateValue(t)}catch(e){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&R.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&R.error("Further errors are ignored"),!1}},t.prototype._filterNode=function(e){var t=this._getObjectIdField(),r=null;if(this.layer.objectIdFilter){var i=this.layer.objectIdFilter.ids,n="include"===this.layer.objectIdFilter.method;r=function(e){return i.indexOf(e)>=0===n}}for(var a=this._controller.parsedDefinitionExpression,o=0,s=e.bundle;o<s.length;o++)for(var l=0,u=s[o].graphics;l<u.length;l++){var c=u[l],h=c.visible;r&&!r(c.attributes[t])?c.visible=!1:c.visible=!a||this._evaluateClause(a,c),h!==c.visible&&(B.graphic=c,B.property="visible",B.oldValue=h,B.newValue=c.visible,this.layer.graphicChanged(B))}},t.prototype.queryExtent=function(e){return this._ensureQueryEngine().queryExtent(e)},t.prototype.queryFeatureCount=function(e){return this._ensureQueryEngine().queryFeatureCount(e)},t.prototype.queryFeatures=function(e){return this._ensureQueryEngine().queryFeatures(e)},t.prototype.queryObjectIds=function(e){return this._ensureQueryEngine().queryObjectIds(e)},t.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},t.prototype._createQueryEngine=function(){var e=this,t={id:0,index:0,graphic:null},r=this;return new w(this.layer,{forAll:function(r,i){e._forAllFeatures(function(e,i,n){t.id=e,t.index=i,t.graphic=n,r(t)},i)},createGraphic:function(e){return g.hydrateGraphic(e.graphic,r.layer)},requestFields:function(t,r,i){return S.whenGraphicAttributes(e.layer,r,e._getObjectIdField(),i,function(r){var i=e._getGraphicIndices(t.nodeId,r);return[{node:e._controller.nodeIndex[t.nodeId],indices:i,graphics:r}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){var t=p.empty(),r=e.layer.spatialReference;return{add:function(e){return g.expandAABB(e.graphic.geometry,t)},getExtent:function(){return p.toExtent(t,r)}}}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return e?e.usedMemory:0},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(e?e.unprocessedMemoryEstimate:0))},t.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget},t.prototype.getNumberOfNodes=function(){return Object.keys(this._nodesAddedToStage).length},t.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length},t.prototype.getStats=function(){var e=this.inherited(arguments)||{};return e.index=this._controller?Object.keys(this._controller.nodeIndex).length:0,e.nodes=Object.keys(this._nodesAddedToStage).length,e.features=this.loadedGraphics.length,this._controller&&this._controller.updateStats(e),e},i([c.property()],t.prototype,"graphics3d",void 0),i([c.property()],t.prototype,"drawingOrder",void 0),i([c.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),i([c.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),i([c.property({type:Boolean})],t.prototype,"supportsDraping",void 0),i([c.property()],t.prototype,"loadedGraphics",void 0),i([c.property()],t.prototype,"layer",void 0),i([c.property()],t.prototype,"_controller",void 0),i([c.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],t.prototype,"updating",void 0),i([c.property({dependsOn:["_controller.rootNodeVisible"]})],t.prototype,"suspended",void 0),i([c.property(C.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([c.property({aliasOf:"_controller.updatingPercentage"})],t.prototype,"updatingPercentageValue",void 0),i([c.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i([c.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([c.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],t.prototype,"lodFactor",void 0),i([c.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],t)}(c.declared(b,T.PopupSceneLayerView)),M={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},I=100,D=f.create(),F=p.create(p.POSITIVE_INFINITY),V={minX:0,minY:0,maxX:0,maxY:0},L=h.vec3f64.create(),U=[],B={graphic:null,property:null,oldValue:null,newValue:null};return A}.apply(null,i))||(e.exports=n)},1560:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19)],void 0===(n=function(e,t,r){return function(){function e(t,i,n){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:i.pixelFormat,internalFormat:i.internalFormat,dataType:i.dataType,target:i.target?i.target:3553,samplingMode:i.samplingMode?i.samplingMode:9729,wrapMode:i.wrapMode?i.wrapMode:10497,maxAnisotropy:i.maxAnisotropy,flipped:void 0!==i.flipped&&i.flipped,hasMipmap:void 0!==i.hasMipmap&&i.hasMipmap,unpackAlignment:i.unpackAlignment?i.unpackAlignment:4,width:i.width,height:i.height,preMultiplyAlpha:void 0!==i.preMultiplyAlpha&&i.preMultiplyAlpha},this._id=++e._nextId,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var r=this._desc;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var i=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var n=this._desc;e._validateTexture(n),r.pixelStorei(r.UNPACK_ALIGNMENT,n.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,n.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.preMultiplyAlpha?1:0);var a=n.pixelFormat,o=n.internalFormat?n.internalFormat:a;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)n.width&&n.height&&console.assert(t.width===n.width&&t.height===n.height),r.texImage2D(r.TEXTURE_2D,0,o,a,n.dataType,t),n.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=n.width&&null!=n.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&o===r.DEPTH_STENCIL&&(o=r.DEPTH24_STENCIL8);var s=n.width,l=n.height;if(function(e){return null!=e&&"type"in e&&"compressed"===e.type}(t))for(var u=0;;++u){var c=t.levels[Math.min(u,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,u,o,s,l,0,c),1===s&&1===l||!n.hasMipmap)break;s=Math.max(1,s>>1),l=Math.max(1,l>>1)}else if(t)r.texImage2D(r.TEXTURE_2D,0,o,s,l,0,a,n.dataType,t),n.hasMipmap&&this.generateMipmap();else for(u=0;r.texImage2D(r.TEXTURE_2D,u,o,s,l,0,a,n.dataType,null),(1!==s||1!==l)&&n.hasMipmap;++u)s=Math.max(1,s>>1),l=Math.max(1,l>>1)}e._applySamplingMode(r,this._desc),e._applyWrapMode(r,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(i,0)},e.prototype.updateData=function(e,t,r,i,n,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var o=this._context.gl,s=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||r<0||i>s.width||n>s.height||t+i>s.width||r+n>s.height)&&console.error("An attempt to update out of bounds of the texture!"),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(console.assert(a.width===i&&a.height===n),o.texSubImage2D(o.TEXTURE_2D,e,t,r,s.pixelFormat,s.dataType,a)):o.texSubImage2D(o.TEXTURE_2D,e,t,r,i,n,s.pixelFormat,s.dataType,a),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!"),e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))},e._applySamplingMode=function(e,t){var r=t.samplingMode;9985===r||9987===r?r=9729:9984!==r&&9986!==r||(r=9728),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.samplingMode)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var i=e.gl;i.texParameterf(i.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1561:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,i))||(e.exports=n)},1562:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(1612),r(1560)],void 0===(n=function(e,t,r,i,n){return function(){function e(t,a,o,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:a.colorTarget,depthStencilTarget:a.depthStencilTarget,width:a.width,height:a.height,multisampled:a.multisampled},this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(4),o){var l=void 0;o instanceof n?(this._colorAttachment=o,l=o.descriptor):(l=o,this._colorAttachment=new n(this._context,l)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),e._validateTextureDimensions(l,this._desc)}if(s instanceof i)2===a.depthStencilTarget?this._stencilAttachment=s:1===a.depthStencilTarget||3===a.depthStencilTarget?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var u=void 0;s instanceof n?(this._depthStencilTexture=s,u=this._depthStencilTexture.descriptor):(u=s,this._depthStencilTexture=new n(this._context,u)),e._validateTextureDimensions(u,this._desc)}}return e.create=function(t,r){return new e(t,r)},e.createWithAttachments=function(t,r,i,n){return new e(t,i,r,n)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof n?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(4),this._context=null)},e.prototype.attachColorTexture=function(t){if(t){var r=t.descriptor;if(e._validateTextureDimensions(r,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){var e=void 0;if(this._colorAttachment instanceof n){if(e=this._colorAttachment,this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}this._colorAttachment=null}return e},e.prototype.attachDepthStencilTexture=function(t){if(t){var r=t.descriptor;if(34041!==r.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==r.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),e._validateTextureDimensions(r,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var r=t.descriptor;if(34041!==r.internalFormat&&33189!==r.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),e._validateBufferDimensions(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===r.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl,n=1===this._desc.depthStencilTarget?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(i.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,r,i,n,a,o){(e<0||t<0||n<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");var s=this._desc,l=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>s.width||t+i>s.height||n+r>l.width||a+i>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");var u=this._context;u.bindTexture(o),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(3553,0,n,a,e,t,r,i)},e.prototype.readPixels=function(e,t,r,i,n,a,o){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,a,o)},e.prototype.resize=function(t,r){var i=this._desc;if(i.width!==t||i.height!==r){if(!this._initialized){if(i.width=t,i.height=r,this._colorAttachment instanceof n)(a=this._colorAttachment).resize(t,r);return void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r))}var a,o;if(i.width=t,i.height=r,this._colorAttachment instanceof n)(o=(a=this._colorAttachment).descriptor).width=t,o.height=r,this._colorAttachment.dispose(),this._colorAttachment=new n(this._context,o),e._validateTextureDimensions(a.descriptor,this._desc);else this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)(o=this._depthStencilTexture.descriptor).width=t,o.height=r,this._depthStencilTexture.dispose(),this._depthStencilTexture=new n(this._context,o);else(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments();this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),r=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===r.colorTarget){var a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._colorAttachment=new n(this._context,a)}else{var o=new i(this._context,{internalFormat:32854,width:r.width,height:r.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,o.glName),this._colorAttachment=o}if(this._colorAttachment instanceof n){var s=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glName,0)}switch(r.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new i(this._context,{internalFormat:1===r.depthStencilTarget?33189:34041,width:r.width,height:r.height}));var l=1===r.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new i(this._context,{internalFormat:36168,width:r.width,height:r.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var u={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._depthStencilTexture=new n(this._context,u)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof n){var e=this._colorAttachment;if(this._initialized)this._context.bindFramebuffer(this),(r=this._context.gl).framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0);e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1566:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(30),r(38),r(1563),r(72),r(520),r(185),r(31),r(1593),r(1659),r(1741),r(92)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){function p(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=s.getPointOnPath(t,s.getPathLength(t)/2);return u.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function f(e,t,i){if(!t||!e)return e;var n=e.spatialReference;return n.isWebMercator&&t.isWGS84?(l.xyToLngLat(e.x,e.y,g),i||(e=u.clonePoint(e)),e.x=g[0],e.y=g[1],e.spatialReference=r.SpatialReference.WGS84):t.isWebMercator&&n.isWGS84&&(l.lngLatToXY(e.x,e.y,g),i||(e=u.clonePoint(e)),e.x=g[0],e.y=g[1],e.spatialReference=r.SpatialReference.WebMercator),e}Object.defineProperty(t,"__esModule",{value:!0});var m=i.vec3f64.fromValues(1,1,1);t.computeCentroid=function(e,t){if("point"===e.type)return f(e,t,!1);if(u.isHydratedGeometry(e))switch(e.type){case"extent":return f(e.center,t,!1);case"polygon":return f(e.centroid,t,!1);case"polyline":return f(p(e),t,!0);case"mesh":return f(e.extent.center,t,!1)}else switch(e.type){case"extent":return f(function(e){var t=d.isFinite(e.zmin);return u.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return f(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=o.ringsCentroid(e.rings,e.hasZ);return u.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return f(p(e),t,!0)}},t.convertPointSR=f,t.enlargeExtent=function(e,t,r){if(e){t||(t=a.create());var n=e,o=.5*n.width*(r-1),s=.5*n.height*(r-1);return n.width<1e-7*n.height?o+=s/20:n.height<1e-7*n.width&&(s+=o/20),i.vec4.set(t,n.xmin-o,n.ymin-s,n.xmax+o,n.ymax+s),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var i=e.geometries[r].data.vertexAttributes.auxpos1;i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=[1,1,1,1];return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!==t&&void 0!==t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,i,n,a){void 0===a&&(a=[0,0,0,0]);for(var o=0;o<3;++o)e&&null!=e[o]?a[o]=e[o]:r&&null!=r[o]?a[o]=r[o]:a[o]=n[o];return a[3]=null!=t?t:null!=i?i:n[3],a},t.computeObjectScale=function(e,t,r,n){void 0===e&&(e=m),void 0===n&&(n=1);var a=new Array(3);if(null==t||null==r)a[0]=1,a[1]=1,a[2]=1;else{for(var o=void 0,s=0,l=2;l>=0;l--){var u=e[l],c=void 0,h=null!=u,d=0===l&&!o&&!h,p=r[l];"symbolValue"===u||d?c=0!==p?t[l]/p:1:h&&"proportional"!==u&&isFinite(u)&&(c=0!==p?u/p:1),null!=c&&(a[l]=c,o=c,s=Math.max(s,Math.abs(c)))}for(l=2;l>=0;l--)null==a[l]?a[l]=o:0===a[l]&&(a[l]=.001*s)}for(l=2;l>=0;l--)a[l]/=n;return i.vec3f64.fromArray(a)},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,n=t.width,a=t.depth,o=t.height,s=r?10:1;if(null==n&&null==o&&null==a)return[s*e[0],s*e[1],s*e[2]];for(var l,u=i.vec3f64.fromValues(n,a,o),c=0;c<3;c++){var h=u[c];if(null!=h){l=h/e[c];break}}for(c=0;c<3;c++)null==u[c]&&(u[c]=e[c]*l);return u},t.validateSymbolLayerSize=function(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),function e(t){if(Array.isArray(t)){for(var r=0,i=t;r<i.length;r++)if(!e(i[r]))return!1;return!0}return null==t||t>=0}(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,r,n){void 0===n&&(n=i.mat4f64.create());var a=e||0,o=t||0,s=r||0;return 0!==a&&i.mat4.rotateZ(n,n,-a/180*Math.PI),0!==o&&i.mat4.rotateX(n,n,o/180*Math.PI),0!==s&&i.mat4.rotateY(n,n,s/180*Math.PI),n},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:n.isPoint(e)?t.minDemResolutionForPoints:.01*n.maximumDimension(e)},t.getGraphics3DSymbol=function(e){return e instanceof h?e.graphics3DSymbol:e instanceof c?e:null};var g=[0,0]}.apply(null,i))||(e.exports=n)},1570:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1664),r(1572),r(1626),r(1577),r(1559),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(t,r,i){this.singleUse=!1,this._boundingInfo=null,this._componentAABB=null,this.id=e.__idGen.gen(r),this._data=t,this._boundingInfo=i}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return i.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var r=0;r<6;r++)t[r]=this._componentAABB[6*e+r];return t},e.prototype._computeComponentAABB=function(){for(var e=this.componentCount,t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var i=this.data.getIndices(s.VertexAttrConstants.POSITION),n=this.data.getAttribute(s.VertexAttrConstants.POSITION),a=this.data.componentOffsets,o=a.length?a[e]:0,l=a.length?a[e+1]:i.length,u=1/0,c=1/0,h=1/0,d=-1/0,p=-1/0,f=-1/0,m=n.offsetIdx,g=n.strideIdx,v=o;v<l;v++){var y=m+g*i[v],b=n.data[y],_=n.data[y+1],x=n.data[y+2];u=Math.min(u,b),c=Math.min(c,_),h=Math.min(h,x),d=Math.max(d,b),p=Math.max(p,_),f=Math.max(f,x)}return t?(t[r]=u,t[r+1]=c,t[r+2]=h,t[r+3]=d,t[r+4]=p,t[r+5]=f):t=[u,c,h,d,p,f],t},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var a=0;a<i;++a)e[a]=a}var l=e.length;o.assert(l%i==0);var u=n.generateDefaultIndexArray(l/i);return new r(u,i,e,t)},e.__idGen=new a,e}()}.apply(null,i))||(e.exports=n)},1574:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(38),r(185),r(529),r(1593),r(264),r(1566),r(93),r(1581)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){function h(e,t,i,n,a){var o=t.z||0,s=i.featureExpressionInfoContext;switch(i.mode){case"on-the-ground":var l=e.getElevation(t,"ground")||0;return a&&(a.verticalDistanceToGround=0,a.terrainElevation=l),l;case"relative-to-ground":var u=e.getElevation(t,"ground")||0;l=i.calculateOffsetRenderUnits(n);return null==s&&(l+=o),a&&(a.verticalDistanceToGround=l,a.terrainElevation=u),l+u;case"relative-to-scene":u=e.getElevation(t,"scene")||0,l=i.calculateOffsetRenderUnits(n);return a&&(a.verticalDistanceToGround=l,a.terrainElevation=u),l+u;case"absolute-height":l=i.calculateOffsetRenderUnits(n);if(null==s&&(l+=o),a){u=e.getElevation(t,"ground")||0;a.verticalDistanceToGround=l-u,a.terrainElevation=u}return l;default:r.neverReached(i.mode)}return 0}function d(e,t,r,i,n,a){var o,s=0;if(e.metadata.usesVerticalDistanceToGround)s=h(n,t,r,a,w),l.updateVertexAttributeAuxpos1w(e,w.verticalDistanceToGround),o=w.terrainElevation;else{var c="absolute-height"!==r.mode;s=h(n,t,r,a,c?w:null),c&&(o=w.terrainElevation)}var d=e.getObjectTransformation();return b[0]=t.x,b[1]=t.y,b[2]=s,u.computeLinearTransformation(t.spatialReference,b,d,i)?e.setObjectTransformation(d):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:o}}function p(e,t){var r=a.pathsToTriangulationInfo(e,t);return{vertexData:r.position,polygons:r.polygons,outlines:r.outlines}}function f(e,t,r,i,n){t*=3,i*=3;for(var a=0;a<n;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}function m(e,t,r,i,n,a,o){return u.bufferToBuffer(e,r,t,i,a,n,o)}function g(e,t,r){u.pointToVector(e,t,r)}function v(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function y(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var b=i.vec3f64.create(),_=i.mat4f64.create(),x=o.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,r,i,n,a,o,s,l,u,h,p){var f=r?r.length:0,m=e.clippingExtent;if(g(t,b,e.elevationProvider.spatialReference),m&&!v(b,m))return null;g(t,b,e.renderSpatialReference);for(var y=e.localOriginFactory.getOrigin(b),x=new c({castShadow:!1,metadata:{layerUid:l,graphicUid:u,usesVerticalDistanceToGround:!!h},idHint:s}),w=0;w<f;w++){var S=n?n[w]:_;x.addGeometry(r[w],i[w],S,a,y,p)}return{object:x,terrainElevation:d(x,t,o,e.renderSpatialReference,e.elevationProvider,e.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,r){var i=e.elevationContext,n=r.spatialReference;g(t,b,n),i.centerPointInElevationSR=o.makeDehydratedPoint(b[0],b[1],t.hasZ?b[2]:0,n)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return l.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=n.getPointOnPath(t,n.getPathLength(t)/2);return o.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=h,t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=p,t.copyVertices=f,t.chooseOrigin=function(e,t,r,i){var n=Math.floor(t+(r-1)/2);i[0]=e[3*n+0],i[1]=e[3*n+1],i[2]=e[3*n+2]},t.subtractCoordinates=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t++]-=i[0],e[t++]-=i[1],e[t++]-=i[2]},t.setZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]=i,t+=3},t.offsetZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]+=i,t+=3},t.scaleZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]*=i,t+=3},t.flatArrayToArrayOfArrays=function(e,t,r){var i=[];t*=3;for(var n=0;n<r;++n)i.push([e[t++],e[t++],e[t++]]);return i},t.reproject=m,t.reprojectPoint=g,t.getGeometryVertexData3D=function(e,t,r,i,n,a,o){var s=n.spatialReference,l=p(e,t),u=l.vertexData,c=u.length/3,h=new Float64Array(u.length),d=!0;r.equals(s)?f(u,0,h,0,u.length):d=m(u,0,r,h,0,s,c);var g=function(e,t,r,i,n,a,o,s){var l=s.mode,u=0,c=0,h=0,d=s.calculateOffsetRenderUnits(o),p=s.featureExpressionInfoContext;x.spatialReference=e.spatialReference,r*=3,n*=3;for(var f=0;f<a;++f){switch(x.x=t[r+0],x.y=t[r+1],x.z=t[r+2],l){case"on-the-ground":c=u=e.getElevation(x)||0,h+=u;break;case"relative-to-ground":c=(u=e.getElevation(x)||0)+d,null==p&&(c+=x.z),h+=u;break;case"relative-to-scene":c=(u=e.getElevation(x,"scene")||0)+d,h+=u;break;case"absolute-height":c=d,null==p&&(c+=x.z)}i[n+0]=t[r+0],i[n+1]=t[r+1],i[n+2]=c,r+=3,n+=3}return{terrainElevation:h/=a}}(n,h,0,u,0,c,a,o);return s.equals(i)||m(u,0,s,u,0,i,c),{geometryData:l,vertexData:u,eleVertexData:h,terrainElevation:g.terrainElevation,projectionSuccess:d}},t.getGeometryVertexDataDraped=function(e,t,r){var i=p(e,!1),n=i.vertexData,a=n.length/3,o=!0;return t.equals(r)||(o=u.bufferToBuffer(n,t,0,n,r,0,a)),{geometryData:i,vertexData:n,projectionSuccess:o}},t.computeBoundingBox=function(e,t,r,i){i[0]=Number.MAX_VALUE,i[1]=Number.MAX_VALUE,i[2]=Number.MAX_VALUE,i[3]=-Number.MAX_VALUE,i[4]=-Number.MAX_VALUE,i[5]=-Number.MAX_VALUE,t*=3;for(var n=0;n<r;++n){var a=e[t++],o=e[t++],s=e[t++];a<i[0]&&(i[0]=a),o<i[1]&&(i[1]=o),s<i[2]&&(i[2]=s),a>i[3]&&(i[3]=a),o>i[4]&&(i[4]=o),s>i[5]&&(i[5]=s)}return i},t.pointInBox2D=v,t.boxesIntersect2D=y,t.boundingBoxClipped=function(e,t){return!!t&&!y(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.needsOffsetAdjustment=function(e,t,r,i){if(!1===t.needsOffsetAdjustment||!1===t.supportsOffsetAdjustment)return!1;if("on-the-ground"===e.mode)return!1;if(0===e.meterUnitOffset){if(!0===t.needsOffsetAdjustment)return!0;if(s.isCalloutSupport(i)&&i.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===e.mode&&(!r.hasZ||e.featureExpressionInfoContext))return!0;if("relative-to-scene"===e.mode)return!0}return!1};var w={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,i))||(e.exports=n)},1575:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1586),r(1597),r(1608),r(1662)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(e,t,i,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new a,this.view=new o(t,this,this.model.getDirtySet(),i),this.view.setLighting({lights:[new n.MainLight(r.vec3f64.fromValues(.7,.7,.7)),new n.AmbientLight(r.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return"function"==typeof r.removeParentStage&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,i){this.model.notifyDirty(e,t,r,i)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var i=t.commitLayers(this._viewContent);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+i[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+i[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),i=t.commitLayers([e]);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(i.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var i=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(i,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,i=[],n=0;n<e.length;n++){var a=r.indexOf(e[n]);a>-1&&(r[a]=r[r.length-1],r.pop(),i.push(e[n]))}var o=t.getResidentRenderGeometriesFilteredByLayers(i);this.view.modify([],o,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"intersect"in t&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return"intersect"in e&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var i in r+="<table>",t)r+="<tr><td>"+i+'</td><td style="text-align: right">'+Math.round(t[i])+"</td></tr>";r+="</table>"}else for(var i in t)r+=i+": "+t[i]+"\n";return r},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=i,e}()}.apply(null,i))||(e.exports=n)},1576:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1572),r(1626),r(1559)],void 0===(n=function(e,t,r,i,n){function a(e){var t=n.getFirstObjectValue(e);return t.data.length/t.size}return function(){function e(t,n,o,s){void 0===n&&(n=e.DefaultIndices),void 0===o&&(o=e.DefaultOffsets),void 0===s&&(s="triangle"),this.preinterleaved=!1;var l={};for(var u in t){var c=t[u],h=c.data,d=c.size;l[u]={data:h,size:d,offsetIdx:0,strideIdx:d}}if(n===e.DefaultIndices){var p=a(l),f=i.generateDefaultIndexArray(p);for(var m in n={},l)n[m]=f}this._id=i.getNewId(),this._vertexAttributes=l,this._indices=n,this._componentOffsets=r.createOffsets(o),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return n.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices.position){var t=3;e+=this._indices.position.length*t*4}if(this._indices.normal){t=3;e+=this._indices.normal.length*t*4}if(this._indices.uv0){t=2;e+=this._indices.uv0.length*t*4}if(this._indices.color){t=1;e+=this._indices.color.length*t*4}return e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}()}.apply(null,i))||(e.exports=n)},1577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,i))||(e.exports=n)},1578:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1587),r(1564),r(1560),r(1567)],void 0===(n=function(e,t,r,i,n,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=i.Pos2);var a=null;switch(t){case i.Pos3Tex:a=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case i.Pos3:a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case i.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case i.Pos2:default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new o(e,r.Default3D,{geometry:t},{geometry:n.createVertex(e,35044,a)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var i=new Uint8Array(r*r*4),n=0;n<i.length;n+=4)i[n+0]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},i)}}.apply(null,i))||(e.exports=n)},1580:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,i))||(e.exports=n)},1581:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1572),r(1665),r(1610),r(1577),r(1586),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){var c=u.assert,h=r.mat4f64.create(),d=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new p,this._bvWorldSpace=new p,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=r.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return e.prototype._initializeGeometryRecords=function(e,t,i,n){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);c(t.length===e.length,"Object3D: materials don't match geometries"),c(i.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var o=0;o<e.length;o++){this.geometryRecords[o]=new a(e[o],t[o],r.mat4f64.clone(i[o]),{},n&&n[o])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){c(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return c(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return c(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,i,n,o,s){void 0===i&&(i=h),this.geometries.push(e);var l=new a(e,t,r.mat4f64.clone(i),n||{},o,s);return this.geometryRecords.push(l),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this._notifyDirty("objGeometryAdded",l),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,l},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!n.isAllHidden(i,a)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!n.isAllVisible(i,a))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t];if(e=n.hasComponents(r.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var i=e.geometry,a=e.instanceParameters.componentVisibilities,o=i.data.componentOffsets,s=n.updateVisibility(a,o,t,r);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return n.getVisibility(r,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.hideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.unhideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,r,i){var a=e.instanceParameters.componentHighlights,o=n.addHighlight(a,t,r,i);e.instanceParameters.componentHighlights=o},e.prototype.setComponentHighlight=function(e,t,r){var i=o.generateHighlightId();return this._setComponentHighlight(e,t,r,i),this._notifyDirty("componentHighlightChanged"),i},e.prototype.highlightAllComponents=function(e){for(var t=o.generateHighlightId(),r=0,i=this.geometryRecords;r<i.length;r++){var n=i[r];this._setComponentHighlight(n,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var i=r[t].instanceParameters,a=i.componentHighlights,o=n.removeHighlight(a,e);i.componentHighlights=o}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.data.componentOffsets;return n.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var i=this.geometryRecords[e],n=new a(i.geometry,i.material,r.mat4f64.clone(t),i.instanceParameters);this.geometryRecords[e]=n,this._notifyDirty("objGeometryReplaced",[i,n]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return r.mat4f64.clone(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){r.mat4.copy(this.objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||r.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getStaticTransformation()),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||r.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],n=this.geometryRecords[e],a=t.boundingInfo;this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}r.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),r.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var o=r.vec3f64.create(),s=r.vec3f64.create(),l=i.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var u=this.geometryRecords[e].getShaderTransformation(),c=i.maxScale(u);a=t.boundingInfo;r.vec3.transformMat4(o,a.getCenter(),u);var h=r.vec3.distance(o,this._bvObjectSpace.center),d=a.getBSRadius()*c;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,h+d),r.vec3.transformMat4(s,o,this.objectTransformation);var p=r.vec3.distance(s,this._bvWorldSpace.center),f=d*l;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+f)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,i){var n=e.getBBMin(),a=e.getBBMax(),o=r.vec3f64.clone(n),s=r.vec3f64.clone(a);r.vec3.transformMat4(o,o,i),r.vec3.transformMat4(s,s,i);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],o[l],s[l]),t.bbMax[l]=Math.max(t.bbMax[l],o[l],s[l]);for(l=0;l<3;++l){r.vec3.copy(o,n),r.vec3.copy(s,a),o[l]=a[l],s[l]=n[l],r.vec3.transformMat4(o,o,i),r.vec3.transformMat4(s,s,i);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],o[u],s[u]),t.bbMax[u]=Math.max(t.bbMax[u],o[u],s[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,i){if(this._parentLayer){r=r||l.OBJECT;var n=i||this;this._parentLayer.notifyDirty(e,t,r,n)}},e._idGen=new s,e}(),p=function(){function e(){this.bbMin=r.vec3f64.create(),this.bbMax=r.vec3f64.create(),this.center=r.vec3f64.create(),this.bsRadius=0}return e.prototype.init=function(){r.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.vec3.set(this.center,0,0,0),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return d}.apply(null,i))||(e.exports=n)},1584:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(25),r(9),r(47),r(38),r(1738),r(1638),r(1603),r(1574),r(1566),r(1605),r(92),r(1619)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f){function m(e,t){var r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}var g=new l,v=n.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),y={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"};return function(e){function t(t,r,i,n){var a=e.call(this)||this;return a.complexity=null,a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},a.symbolContainer=t,a.symbol=r,a._context=i,a._symbolLayerOrder=i.layerOrder,a._symbolLayerOrderDelta=i.layerOrderDelta,a._elevationContext=new l,a._material=null,a.complexity=a.computeComplexity(),a._geometryCreationWarningHandle=null,a._updateDrivenProperties(n),a._updateElevationContext(),a._prepareResources(),a}return r(t,e),t.prototype._logWarning=function(e){v.warn(e)},t.prototype._logGeometryCreationWarnings=function(e,t,r,i){var n=this;if(null==this._geometryCreationWarningHandle){var o=e.projectionSuccess,s=e.geometryData&&e.geometryData.polygons,l=i+" geometry failed to be created",u=null;o?!t.length||1===t.length&&!t[0].length?u=l+" (no "+r+" were defined)":Array.isArray(t)&&Array.isArray(t[0])?t.some(function(e){return 1===e.length})?u=l+" ("+r+" should contain at least 2 vertices)":s&&0===s.length&&"rings"===r&&(u=l+" (filled "+r+" should use clockwise winding - try reversing the order of vertices)"):u=l+" ("+r+" should be defined as a 2D array)":u=l+" (failed to project geometry to view spatial reference)",u&&(this._geometryCreationWarningHandle=a.schedule(function(){return n._onNextTick()}),this._logWarning(u))}},t.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null},t.prototype._validateGeometry=function(e){if("point"===e.type){var t=e;if(!p.isFinite(t.x)||!p.isFinite(t.y))return this._logWarning("point coordinate is not a valid number, graphic skipped"),!1}return!0},t.prototype._defaultElevationInfoNoZ=function(){return y},t.prototype._defaultElevationInfoZ=function(){return b},t.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var e=this._context.layer.elevationInfo;e&&this._elevationContext.mixinApi(e);var t=this.symbol&&this.symbol.elevationInfo;t&&this._elevationContext.mixinApi(t),this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext},t.prototype.getGraphicElevationContext=function(e){var t=e.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();g.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:t.unit),g.mode=this._elevationContext.mode||t.mode,g.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:t.offset),g.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext,g.hasOffsetAdjustment=!1,this._elevationOptions.supportsOnTheGround||"on-the-ground"!==g.mode||(g.mode="relative-to-ground",g.setOffsetMeters(0),g.featureExpressionInfoContext=u.zeroContext);var r=u.createFeature(e,this._context.layer);return u.setContextFeature(g.featureExpressionInfoContext,r),c.needsOffsetAdjustment(g,this._elevationOptions,e.geometry,this.symbolContainer)&&(g.setOffsetRenderUnits(s.defaultIconElevationOffset),g.hasOffsetAdjustment=!0),g},t.prototype._getDrapedZ=function(){return-2},t.prototype._updateDrivenProperties=function(e){var t={color:!1,opacity:!1,size:!1};if(!e){var r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach(function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var i=e.stops[r].color;i&&(Array.isArray(i)&&i.length>3&&255!==i[3]||void 0!==i.a&&255!==i.a)&&(t.opacity=!0)}break;case"opacity":t.opacity=!0;break;case"size":t.size=!0}})}this._drivenProperties=t},t.prototype._isPropertyDriven=function(e){return this._drivenProperties[e]},t.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var e=this._context.layer.opacity;return null==e?1:e},t.prototype._getMaterialOpacity=function(){var e=1;e*=this._getLayerOpacity();var t=this.symbol&&this.symbol.material;return t&&!this._isPropertyDriven("opacity")&&t.color&&(e*=t.color.a),e},t.prototype._getMaterialOpacityAndColor=function(){var e=this.symbol&&this.symbol.material,t=this._getMaterialOpacity(),r=!this._isPropertyDriven("color")&&e&&e.color?i.toUnitRGB(e.color):null;return h.mixinColorAndOpacity(r,t)},t.prototype._getVertexOpacityAndColor=function(e,t,r){var i=this._isPropertyDriven("color")?e.color:null,n=this._isPropertyDriven("opacity")?e.opacity:null,a=h.mixinColorAndOpacity(i,n);return r&&(a[0]*=r,a[1]*=r,a[2]*=r,a[3]*=r),t?new t(a):a},t.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"},t.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled},t.prototype.updateSymbolLayerOrder=function(e,t){this._symbolLayerOrder=e,this._symbolLayerOrderDelta=t},t.prototype.computeComplexity=function(){return d.defaultSymbolLayerComplexity(this.symbolContainer,this.symbol)},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e,r.add(this._material.id))},t.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)},t.prototype.layerPropertyChanged=function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged();case"elevationInfo":var i=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,i);case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r)}return!1},t.prototype.updateGraphics3DGraphicElevationInfo=function(e,t,r){var i=this,n=!0;return e.forEach(function(e){var a=t(e);if(a){var o=e.graphic,s=i.getGraphicElevationContext(o);a.needsElevationUpdates=r(s.mode),a.elevationContext.set(s)}else n=!1}),n},t.prototype.applyRendererDiff=function(e,t){return!1},t.prototype.getFastUpdateAttrValues=function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables,r=t.size?m(t.size.field,e):0,i=t.color?m(t.color.field,e):0;return o.vec4f64.fromValues(r,i,0,0)},t}(f.Promise)}.apply(null,i))||(e.exports=n)},1585:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(83),r(114),r(38),r(1563),r(1603),r(1660),r(1566),r(1575)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){var h=function(){function e(t,r,i,n,a,o,s,u){this.type="object3d",this._addedToStage=!1,this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=t,this.uniqueMaterials=n,this.uniqueGeometries=i,this.uniqueTextures=a,this.stageObject=r,this.elevationAligner=o,this.elevationContext=new l(s),this.stage=null,this.stageLayer=null,this._visible=!1,this.visibilityMode=null!=u?u:e.VisibilityModes.HIDE_FACERANGE}return e.prototype.initialize=function(e,t){if(this.stageLayer=e,this.stage=t,this.uniqueMaterials)for(var r=0;r<this.uniqueMaterials.length;r++)t.add(c.ModelContentType.MATERIAL,this.uniqueMaterials[r]);if(this.uniqueGeometries)for(r=0;r<this.uniqueGeometries.length;r++)t.add(c.ModelContentType.GEOMETRY,this.uniqueGeometries[r]);if(this.uniqueTextures)for(r=0;r<this.uniqueTextures.length;r++)t.add(c.ModelContentType.TEXTURE,this.uniqueTextures[r]);t.add(c.ModelContentType.OBJECT,this.stageObject)},e.prototype.setVisibility=function(t){if(null!=this.stage){if(this._visible!==t){this._visible=t,this._visible?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===e.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var r=this.stage.view.getEdgeView();return r.hasObject(this.stageObject)&&r.updateObjectVisibility(this.stageObject,this._visible),!0}return!1}},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){var e=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var t=0;t<this.uniqueMaterials.length;t++)e.remove(c.ModelContentType.MATERIAL,this.uniqueMaterials[t].id);if(this.uniqueGeometries)for(t=0;t<this.uniqueGeometries.length;t++)e.remove(c.ModelContentType.GEOMETRY,this.uniqueGeometries[t].id);if(this.uniqueTextures)for(t=0;t<this.uniqueTextures.length;t++)e.remove(c.ModelContentType.TEXTURE,this.uniqueTextures[t].id)}e.remove(c.ModelContentType.OBJECT,this.stageObject.id),this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var r=this.stage.view.getEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this._visible=!1,this.stageLayer=null,this.stage=null},e.prototype.alignWithElevation=function(e,t,r){if(this.elevationAligner){s.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var i=this.elevationAligner(this,this.elevationContext,e,t);null!=i&&(this.alignedTerrainElevation=i)}},e.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=a.vec3f64.create()),a.vec3.copy(e,this.stageObject.getCenter(!0))},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=o.create()),function(e,t,r){return r||(r=o.create()),o.setMin(r,e.getBBMin(t)),o.setMax(r,e.getBBMax(t)),r}(this.stageObject,!0,e)},e.prototype.getProjectedBoundingBox=function(e,t,r,s){return n(this,void 0,void 0,function(){var n,l,c,h,g,v,y,b,_,x;return i(this,function(i){switch(i.label){case 0:for(n=this.getBoundingBoxObjectSpace(s),l=m,c=o.isPoint(n)?1:l.length,v=0;v<c;v++)h=l[v],p[0]=n[h[0]],p[1]=n[h[1]],p[2]=n[h[2]],a.vec3.transformMat4(p,p,this.stageObject.objectTransformation),d[3*v+0]=p[0],d[3*v+1]=p[1],d[3*v+2]=p[2];if(!e(d,0,c))return[2,null];for(o.empty(n),g=null,this.calculateRelativeScreenBounds&&(g=this.calculateRelativeScreenBounds()),v=0;v<3*c;v+=3){for(y=0;y<3;y++)n[y]=Math.min(n[y],d[v+y]),n[y+3]=Math.max(n[y+3],d[v+y]);g&&r.push({location:d.slice(v,v+3),screenSpaceBoundingRect:g})}return t&&t.service&&"absolute-height"!==this.elevationContext.mode?(o.center(n,f),b="relative-to-scene"===this.elevationContext.mode?"scene":"ground",_=void 0,t.useViewElevation?(_=t.service.getElevation(f[0],f[1],b),[3,4]):[3,1]):[3,5];case 1:return i.trys.push([1,3,,4]),x=u.demResolutionForBoundingBox(n,t),[4,t.service.queryElevation(f[0],f[1],x,b)];case 2:return _=i.sent(),[3,4];case 3:return i.sent(),_=null,[3,4];case 4:o.offset(n,0,0,-this.alignedTerrainElevation+_),i.label=5;case 5:return[2,n]}})})},e.prototype.addHighlight=function(e,t){var r=this.stageObject.highlightAllComponents(t);e.addObject(this.stageObject,r)},e.prototype.removeHighlight=function(e){e.removeObject(this.stageObject)},e}();!function(e){!function(e){e[e.REMOVE_OBJECT=0]="REMOVE_OBJECT",e[e.HIDE_FACERANGE=1]="HIDE_FACERANGE"}(e.VisibilityModes||(e.VisibilityModes={}))}(h||(h={}));var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=a.vec3f64.create(),f=a.vec3f64.create(),m=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return h}.apply(null,i))||(e.exports=n)},1586:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,i))||(e.exports=n)},1587:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,i))||(e.exports=n)},1589:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(1)],void 0===(n=function(e,t,r,i,n,a){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t}return r(t,e),i([a.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),i([a.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),i([a.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),i([a.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),i([a.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),i([a.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),i([a.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),i([a.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),i([a.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),i([a.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),i([a.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),i([a.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),i([a.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),i([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),i([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),i([a.subclass()],t)}(a.declared(n)))}.apply(null,i))||(e.exports=n)},1591:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577),r(1586)],void 0===(n=function(e,t,r,i){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(i.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},1592:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(19),r(38),r(1590),r(1611),r(1591),r(1559),r(1595),r(1568),r(1568),r(1719)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){function p(e,t,r){!function(e,t){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}(t)?e.setFaceCullingEnabled(!1):(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029))}function f(e){e.setFaceCullingEnabled(!1)}function m(e,t,r){return e?t?6:9:r?2:4}function g(e,t){var r=t.vvSizeEnabled;if(t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r){e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor);var i=t.vvSymbolRotation[2]||0,a=t.vvSymbolRotation[0]||0,o=t.vvSymbolRotation[1]||0;n.mat4.identity(A),0!==i&&n.mat4.rotateZ(A,A,-i/180*Math.PI),0!==a&&n.mat4.rotateX(A,A,a/180*Math.PI),0!==o&&n.mat4.rotateY(A,A,o/180*Math.PI),e.setUniformMatrix3fv("vvSymbolRotation",n.mat3.fromMat4(R,A))}t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}var v=l.assert,y=1,b=function(e){function t(r,i){var n=e.call(this,i)||this;return n.supportsEdges=!0,n.params=h.copyParameters(r,T),n.instanced=!!r.instanced,n.vertexBufferLayout=t.getVertexBufferLayout(n.params),n.instanceBufferLayout=n.instanced?t.getInstanceBufferLayout(n.params):null,n.bufferWriter=new E(n.vertexBufferLayout,n.instanceBufferLayout),n}return r(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,i=t.vertexColors,n=t.symbolColors,a=!!r&&r.indexOf("color")>-1,o=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,u=t.externalColor&&t.externalColor[3]>0;return i&&(a||o||n)?!!s||l:i?s?u:l:a||o||n?!!s||l:s?u:l},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return h.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&v(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&v(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,a,o,s,l){if(null!==this.params.verticalOffset){var u=i.camera;n.vec3.set(L,r[12],r[13],r[14]);var c=n.vec3.subtract(U,L,u.eye),d=n.vec3.length(c),p=n.vec3.scale(c,c,1/d),f=null,m=null;switch(i.viewingMode){case"global":m=n.vec3.normalize(F,L);break;case"local":m=n.vec3.copy(F,D)}this.params.screenSizePerspective&&(f=n.vec3.dot(m,p));var g=h.verticalOffsetAtDistance(u,d,this.params.verticalOffset,f,this.params.screenSizePerspective);n.vec3.scale(m,m,g),n.vec3.transformMat3(V,m,i.transformInverseRotation),a=n.vec3.subtract(M,a,V),o=n.vec3.subtract(I,o,V)}h.intersectTriangleGeometry(e,t,r,i,a,o,s)},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:this.params.castShadows?w:null,normal:S,depth:x,highlight:C}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=a.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),t},t.getInstanceBufferLayout=function(e){var t=a.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(s),_=function(e){function t(t,r,i){var n=this,a=t.getParams();(n=e.call(this,t,r,i,a.textureId,a.textureInitTransparent)||this).params=h.copyParameters(a);var o=n.params;n.slot=m(o.transparent,o.writeDepth,o.writeStencil),n.texturing=o.textureId?o.atlasRegions?"AtlasTextured":"Textured":"none";var s=o.instanced;return n.instanced=!!s,n.instancedColor=!!s&&s.indexOf("color")>-1,n._createPrograms(),n}return r(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=c.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(d.colorPass,{treeRendering:!!t.treeRendering,viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,groundNormalShading:t.groundNormalShading,compressedNormals:t.compressedNormals,componentColor:null!=t.componentColorBuffer,textureAlphaTest:t.textureAlphaTest,alphaCoverageCorrection:O,iosSafariFix:P})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return c.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.slot=m(this.params.transparent,this.params.writeDepth,this.params.writeStencil),this.updateTexture(this.params.textureId),this._createPrograms()},t.prototype.bind=function(e,t){var r=this.params,i=this.program=c.BindParametersMap.lookup(this.programs,t);e.bindProgram(i),i.setUniform3fv("ambient",r.ambient),i.setUniform3fv("diffuse",r.diffuse),i.setUniform3fv("specular",r.specular),i.setUniform4fv("externalColor",r.externalColor),i.setUniform1i("colorMixMode",h.colorMixModes[r.colorMixMode]),i.setUniform1f("opacity",r.opacity),i.setUniform1f("layerOpacity",r.layerOpacity),h.bindVerticalOffset(r.verticalOffset,t,i),h.bindScreenSizePerspective(r.screenSizePerspective,t,i),g(i,r),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(770,771,1,771),r.inverseWindingOrder&&e.setFrontFace(2304),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(1,1),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(770,771,1,771)):e.setBlendingEnabled(!1),e.setDepthWriteEnabled(r.writeDepth),r.textureAlphaTest&&i.setUniform1f("textureAlphaCutoff",r.textureAlphaCutoff),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),p(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:y}))},t.prototype.release=function(e,t){e.setPolygonOffsetFillEnabled(!1),f(e),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthWriteEnabled(!0),e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program=c.BindParametersMap.lookup(this.programs,t),i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(a,t.view,r),h.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&h.bindViewOriginDouble(a,r),i.slicePlaneEnabled&&h.bindSlicePlane(a,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,a)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),x=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=h.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.biased=n,a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:O,iosSafariFix:P})},t.prototype.selectSlot=function(){this.slot=m(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(2304),h.bindVerticalOffset(i.verticalOffset,t,r),h.bindScreenSizePerspective(i.screenSizePerspective,t,r),g(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),this.bindTexture(e,r),p(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(a,t.view,r),i.slicePlaneEnabled&&h.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&h.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&h.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(o),w=function(e){function t(t,r,i){return e.call(this,t,r,i,!0)||this}return r(t,e),t}(x),S=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=h.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:O,iosSafariFix:P})},t.prototype.selectSlot=function(){this.slot=m(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),h.bindVerticalOffset(i.verticalOffset,t,r),h.bindScreenSizePerspective(i.screenSizePerspective,t,r),g(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),p(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(a,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.slicePlaneEnabled&&h.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&h.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&h.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),C=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=h.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:O,iosSafariFix:P})},t.prototype.selectSlot=function(){this.slot=m(this.params.transparent,this.params.writeDepth,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),h.bindVerticalOffset(i.verticalOffset,t,r),h.bindScreenSizePerspective(i.screenSizePerspective,t,r),g(r,i),i.textureAlphaTest&&r.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),p(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;f(e),t.inverseWindingOrder&&e.setFrontFace(2304)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,a=i.instancedDoublePrecision?n.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(a,t.view,r),i.slicePlaneEnabled&&h.bindSlicePlane(a,t.slicePlane,r),i.screenSizePerspective&&h.bindCamPos(a,t.viewInvTransp,r),i.instancedDoublePrecision&&h.bindViewOriginDouble(a,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(o),T={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,writeDepth:!0,textureAlphaTest:!0,textureAlphaCutoff:.1,polygonOffset:!1,atlasRegions:!1},E=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,i,n){u.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)},e}(),P=!!i("ios")&&!!i("safari"),O=!1,R=n.mat3f64.create(),A=n.mat4f64.create(),M=n.vec3f64.create(),I=n.vec3f64.create(),D=n.vec3f64.fromValues(0,0,1),F=n.vec3f64.create(),V=n.vec3f64.create(),L=n.vec3f64.create(),U=n.vec3f64.create();return b}.apply(null,i))||(e.exports=n)},1593:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(30),r(50),r(58),r(5),r(20),r(1563),r(72),r(1620),r(95),r(1583),r(1732)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){function p(e,t,r,n){return{uid:i.generateUID(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:f(e.geometry,t,r),visible:!0}}function f(e,t,r){if(!e)return null;switch(t){case"point":var i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:null!=i.z,hasM:null!=i.m,type:t,spatialReference:r};case"polyline":var n=e;return{paths:n.paths,hasZ:!!n.hasZ,hasM:!!n.hasM,type:t,spatialReference:r};case"polygon":var a=e;return{rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:t,spatialReference:r};case"multipoint":var o=e;return{points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:t,spatialReference:r}}}function m(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function g(e){return"declaredClass"in e}function v(e){return"declaredClass"in e}function y(e){if(!e)return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,r=0,i=e.paths;r<i.length;r++)t+=i[r].length;return t;case"polygon":t=0;for(var a=0,o=e.rings;a<o.length;a++)t+=o[a].length;return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var s=e.vertexAttributes&&e.vertexAttributes.position;return s?s.length/3:0;default:n.neverReached(e)}}function b(e){if(function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(0!==i.length)return x(i)}return!1}(e))return e.map(function(e){return _(e)})}function _(e){return e.map(function(e){return h.toArray(e)})}function x(e){return e.length&&(h.isFloat32Array(e[0])||h.isFloat64Array(e[0]))}function w(e,t){switch(s.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)s.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(r=0;r<e.rings.length;r++)s.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":s.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:n.neverReached(e)}}function S(e,t){switch(l.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)l.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(r=0;r<e.rings.length;r++)l.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":l.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:n.neverReached(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=d.equals,t.isPoint=function(e){return"point"===e.type},t.fromFeatureSetJSON=function(e){var t=r.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),i=o.fromJSON(e.spatialReference),a=e.transform,s=e.features.map(function(r){var o=p(r,t,i,e.objectIdFieldName),s=o.geometry;if(s&&a)switch(s.type){case"point":o.geometry=u.hydratePoint(a,s,s,s.hasZ,s.hasM);break;case"multipoint":o.geometry=u.hydrateMultipoint(a,s,s,s.hasZ,s.hasM);break;case"polygon":o.geometry=u.hydratePolygon(a,s,s,s.hasZ,s.hasM);break;case"polyline":o.geometry=u.hydratePolyline(a,s,s,s.hasZ,s.hasM);break;default:n.neverReached(s)}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(function(e){return c.fromJSON(e)}):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}},t.fromJSONGeometry=f,t.makeDehydratedPoint=m,t.isHydratedGeometry=g,t.isHydratedGraphic=v,t.hydrateGraphic=function(e,t){if(!e||v(e))return e;var r=new i({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=a.clone(e.symbol),r.attributes=a.clone(e.attributes),e.geometry&&("mesh"===e.geometry.type?r.geometry=e.geometry:r.read({geometry:function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,i=e.hasZ,a=e.hasM;return{rings:b(r),hasZ:i,hasM:a,spatialReference:t};case"polyline":var o=e.paths,i=e.hasZ,a=e.hasM;return{paths:b(o),hasZ:i,hasM:a,spatialReference:t};case"extent":var s=e.xmin,l=e.xmax,u=e.ymin,c=e.ymax,h=e.zmin,d=e.zmax,p=e.mmin,f=e.mmax,i=e.hasZ,a=e.hasM;return{xmin:s,xmax:l,ymin:u,ymax:c,zmin:h,zmax:d,mmin:p,mmax:f,hasZ:i,hasM:a,spatialReference:t};case"multipoint":var m=e.points,i=e.hasZ,a=e.hasM;return{points:x(m)?_(m):m,hasZ:i,hasM:a,spatialReference:t};default:n.neverReached(e)}}(e.geometry)})),r},t.clonePoint=function(e){if(!e)return null;if(g(e))return e.clone();var t=m(e.x,e.y,e.z,e.spatialReference);return e.hasM&&(t.m=e.m,t.hasM=!0),t},t.estimateSize=function(e){for(var t=32,r=0,i=Object.keys(e.attributes);r<i.length;r++){var n=i[r];t+=n.length;var a=e.attributes[n];switch(typeof a){case"string":t+=a.length;break;default:case"number":t+=8}}return t+12*(e.geometry?"mesh"===e.geometry.type?0:y(e.geometry):0)},t.numVertices=y,t.hasVertices=function(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,r=e.paths;t<r.length;t++)if(r[t].length>0)return!0;return!1;case"polygon":for(var i=0,a=e.rings;i<a.length;i++)if(a[i].length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:n.neverReached(e)}},t.computeAABB=w,t.expandAABB=function(e,t){w(e,C),s.expand(t,C)},t.computeAABR=S,t.expandAABR=function(e,t){S(e,T),l.expand(t,T)};var C=s.create(),T=l.create()}.apply(null,i))||(e.exports=n)},1594:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1571),r(92),r(1559)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function l(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var u=function(){function e(e,t,n){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.create()),void 0===n&&(n=r.vec3f64.fromValues(0,0,1)),this._viewUp=r.vec3f64.create(),this._viewForward=r.vec3f64.create(),this._viewRight=r.vec3f64.create(),this._ray=i.ray.createWrapper(),this._viewport=r.vec4f64.fromValues(0,0,1,1),this._padding=r.vec4f64.create(),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4f64.create(),this._frustumDirty=!0,this._frustum=i.frustum.create(),this._fullViewport=null,this.relativeElevation=0,this._eye=r.vec3f64.clone(e),this._center=r.vec3f64.clone(t),this._up=r.vec3f64.clone(n),this._padding=r.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=r.vec3f64.create()),r.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){r.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=r.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),r.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(r.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;r.mat4.frustum(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){r.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return a.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return a.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return r.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4f64.create()),r.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),r.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return r.vec3.copy(this._eye,e._eye),r.vec3.copy(this._center,e._center),r.vec3.copy(this._up,e._up),r.vec4.copy(this._viewport,e._viewport),r.vec4.copy(this._padding,e._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(r.mat4.copy(this._viewMatrix,e._viewMatrix),r.vec3.copy(this._viewRight,e._viewRight),r.vec3.copy(this._viewUp,e._viewUp),r.vec3.copy(this._viewForward,e._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(r.mat4.copy(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumDirty?this._frustumDirty=!0:(i.frustum.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?r.mat4.copy(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4f64.clone(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?r.vec4.copy(this._fullViewport,e._fullViewport):this._fullViewport=r.vec4f64.clone(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return s(this._eye,e._eye)&&s(this._center,e._center)&&s(this._up,e._up)&&l(this._viewport,e._viewport)&&l(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,i){void 0===i&&(i=!1);var a,s=r.vec3.distance(this._eye,this._center)*(t||5e-4),l=s*s;return i?(n.directionFromTo(d,e._eye,e._center),n.directionFromTo(p,this._eye,this._center),a=1e-10):(r.vec3.copy(d,e._center),r.vec3.copy(p,this._center),a=l),r.vec3.squaredDistance(e._eye,this._eye)<l&&r.vec3.squaredDistance(d,p)<a&&Math.abs(e._fov-this._fov)<.001&&o(e._padding,this._padding)<.5&&o(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(r.vec3.distance(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,i){void 0===i&&(i=!1),e!==c&&r.vec3.copy(c,e),c[3]=1,i&&(t[2]=-c[2]),r.vec4.transformMat4(c,c,this.projectionMatrix),r.vec3.scale(c,c,1/Math.abs(c[3]));var a=this.fullViewport;return t[0]=n.lerp(0,a[0]+a[2],.5+.5*c[0]),t[1]=n.lerp(0,a[1]+a[3],.5+.5*c[1]),i||(t[2]=.5*(c[2]+1)),t},e.prototype.projectPoint=function(e,t){if(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,r.vec4.transformMat4(c,c,this.viewProjectionMatrix),0===c[3])return null;r.vec3.scale(c,c,1/Math.abs(c[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*c[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*c[1]),t[2]=.5*(c[2]+1),t},e.prototype.unprojectPoint=function(e,t){if(r.mat4.multiply(h,this.projectionMatrix,this.viewMatrix),!r.mat4.invert(h,h))return null;var i=this.fullViewport;return c[0]=2*(e[0]-i[0])/i[2]-1,c[1]=2*(e[1]-i[1])/i[3]-1,c[2]=2*e[2]-1,c[3]=1,r.vec4.transformMat4(c,c,h),0===c[3]?null:(t[0]=c[0]/c[3],t[1]=c[1]/c[3],t[2]=c[2]/c[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){r.vec3.subtract(d,this.center,this.eye);var e=r.vec3.length(this.center);e<1?(r.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(r.vec3.dot(d,this.center))>.9999*r.vec3.length(d)*e||(r.vec3.cross(this.up,d,this.center),r.vec3.cross(this.up,this.up,d),r.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){n.directionFromTo(d,this.eye,this.center),Math.abs(d[2])<=.9999&&(r.vec3.scale(d,d,d[2]),r.vec3.set(this.up,-d[0],-d[1],1-d[2]),r.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){s(e,t)||(r.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(i.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(r.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),r.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),r.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),r.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),c=r.vec4f64.create(),h=r.mat4f64.create(),d=r.vec3f64.create(),p=r.vec3f64.create();return u}.apply(null,i))||(e.exports=n)},1595:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1588),r(1559)],void 0===(n=function(e,t,r,i){function n(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var u=2*e[l];a[i]=t[u],a[i+1]=t[u+1],i+=o}else for(l=0;l<s;++l){u=2*e[l];for(var c=0;c<n;++c)a[i]=t[u],a[i+1]=t[u+1],i+=o}}function a(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var u=3*e[l];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],i+=o}else for(l=0;l<s;++l){u=3*e[l];for(var c=0;c<n;++c)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],i+=o}}function o(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var l=0;l<s;++l){var u=4*e[l];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=o}else for(l=0;l<s;++l){u=4*e[l];for(var c=0;c<n;++c)a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=o}}function s(e,t,r,i,n,o){if(r){var s=r,l=i.typedBuffer,u=i.typedBufferStride,c=e.length;if(n*=u,null==o||1===o)for(var h=0;h<c;++h){var d=t[m=3*e[h]],p=t[m+1],f=t[m+2];l[n]=s[0]*d+s[4]*p+s[8]*f+s[12],l[n+1]=s[1]*d+s[5]*p+s[9]*f+s[13],l[n+2]=s[2]*d+s[6]*p+s[10]*f+s[14],n+=u}else for(h=0;h<c;++h){d=t[m=3*e[h]],p=t[m+1],f=t[m+2];for(var m,g=s[0]*d+s[4]*p+s[8]*f+s[12],v=s[1]*d+s[5]*p+s[9]*f+s[13],y=s[2]*d+s[6]*p+s[10]*f+s[14],b=0;b<o;++b)l[n]=g,l[n+1]=v,l[n+2]=y,n+=u}}else a(e,t,i,n,o)}function l(e,t,r,i,n,o){if(r){var s=r,l=i.typedBuffer,u=i.typedBufferStride,c=e.length;if(n*=u,null==o||1===o)for(var h=0;h<c;++h){var d=t[m=3*e[h]],p=t[m+1],f=t[m+2];l[n]=s[0]*d+s[4]*p+s[8]*f,l[n+1]=s[1]*d+s[5]*p+s[9]*f,l[n+2]=s[2]*d+s[6]*p+s[10]*f,n+=u}else for(h=0;h<c;++h){d=t[m=3*e[h]],p=t[m+1],f=t[m+2];for(var m,g=s[0]*d+s[4]*p+s[8]*f,v=s[1]*d+s[5]*p+s[9]*f,y=s[2]*d+s[6]*p+s[10]*f,b=0;b<o;++b)l[n]=g,l[n+1]=v,l[n+2]=y,n+=u}}else a(e,t,i,n,o)}function u(e,t,r,i,n,a){var o=i.typedBuffer,s=i.typedBufferStride,l=e.length;if(n*=s,null==a||1===a){if(4===r)for(var u=0;u<l;++u){var c=4*e[u];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=s}else if(3===r)for(u=0;u<l;++u){c=3*e[u];o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=255,n+=s}}else if(4===r)for(u=0;u<l;++u){c=4*e[u];for(var h=0;h<a;++h)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=t[c+3],n+=s}else if(3===r)for(u=0;u<l;++u)for(c=3*e[u],h=0;h<a;++h)o[n]=t[c],o[n+1]=t[c+1],o[n+2]=t[c+2],o[n+3]=255,n+=s}function c(e,t,r,i,n,a,o){var s=n.typedBuffer,l=n.typedBufferStride,u=e.length;if(a*=l,null==o||1===o){if(4===r)for(var c=0;c<u;++c){var h=4*e[c];s[a]=t[h]*i[0],s[a+1]=t[h+1]*i[1],s[a+2]=t[h+2]*i[2],s[a+3]=t[h+3]*i[3],a+=l}else if(3===r){var d=255*i[3];for(c=0;c<u;++c){h=3*e[c];s[a]=t[h]*i[0],s[a+1]=t[h+1]*i[1],s[a+2]=t[h+2]*i[2],s[a+3]=d,a+=l}}}else if(4===r)for(c=0;c<u;++c){h=4*e[c];for(var p=0;p<o;++p)s[a]=t[h]*i[0],s[a+1]=t[h+1]*i[1],s[a+2]=t[h+2]*i[2],s[a+3]=t[h+3]*i[3],a+=l}else if(3===r)for(d=255*i[3],c=0;c<u;++c)for(h=3*e[c],p=0;p<o;++p)s[a]=t[h]*i[0],s[a+1]=t[h+1]*i[1],s[a+2]=t[h+2]*i[2],s[a+3]=d,a+=l}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=n,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writePosition=s,t.writeNormal=l,t.writeColor=u,t.writeMultipliedColor=c,t.writeDefaultAttributes=function(e,t,a,h,d,p,f){for(var m=0,g=a.fieldNames;m<g.length;m++){var v=g[m],y=e.vertexAttr[v],b=e.indices[v];if(y&&b)switch(v){case i.VertexAttrConstants.POSITION:i.assert(3===y.size);var _=p.getField(v,r.BufferViewVec3f);_&&s(b,y.data,h,_,f);break;case i.VertexAttrConstants.NORMAL:i.assert(3===y.size);var x=p.getField(v,r.BufferViewVec3f);x&&l(b,y.data,d,x,f);break;case i.VertexAttrConstants.UV0:i.assert(2===y.size);var w=p.getField(v,r.BufferViewVec2f);w&&n(b,y.data,w,f);break;case i.VertexAttrConstants.REGION:i.assert(4===y.size);var S=p.getField(v,r.BufferViewVec4u16);S&&o(b,y.data,S,f);break;case i.VertexAttrConstants.COLOR:i.assert(3===y.size||4===y.size);var C=p.getField(v,r.BufferViewVec4u8);C&&(t&&t.color?c(b,y.data,y.size,t.color,C,f):u(b,y.data,y.size,C,f));break;case i.VertexAttrConstants.SYMBOLCOLOR:i.assert(3===y.size||4===y.size);var T=p.getField(v,r.BufferViewVec4u8);T&&u(b,y.data,y.size,T,f)}}}}.apply(null,i))||(e.exports=n)},1596:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1571),r(523),r(1576),r(1559)],void 0===(n=function(e,t,r,i,n,a,o){var s,l,u,c,h=n.Vec3Compact;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],s=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=new Array(36),u=0;u<6;u++)for(var c=0;c<6;c++)l[6*u+c]=u;var h=new Array(36);for(u=0;u<6;u++)h[6*u+0]=0,h[6*u+1]=1,h[6*u+2]=2,h[6*u+3]=2,h[6*u+4]=3,h[6*u+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),u=0;u<8;u++)t[3*u]=r[u][0]*e[0],t[3*u+1]=r[u][1]*e[1],t[3*u+2]=r[u][2]*e[2];var c={};c[o.VertexAttrConstants.POSITION]=new Uint32Array(s),c[o.VertexAttrConstants.NORMAL]=new Uint32Array(l),c[o.VertexAttrConstants.UV0]=new Uint32Array(h);var d={};return d[o.VertexAttrConstants.POSITION]={size:3,data:t},d[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},d[o.VertexAttrConstants.UV0]={size:2,data:new Float32Array(n)},new a(d,c)}}(s||(s={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],s=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];(l||(l={})).createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),l=0;l<6;l++)t[3*l]=r[l][0]*e[0],t[3*l+1]=r[l][1]*e[1],t[3*l+2]=r[l][2]*e[2];var u={};u[o.VertexAttrConstants.POSITION]=new Uint32Array(n),u[o.VertexAttrConstants.NORMAL]=new Uint32Array(s);var c={};return c[o.VertexAttrConstants.POSITION]={size:3,data:t},c[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},new a(c,u)}}(),function(e){var t=r.vec3f32.fromValues(-.5,0,-.5),i=r.vec3f32.fromValues(.5,0,-.5),n=r.vec3f32.fromValues(0,0,.5),s=r.vec3f32.fromValues(0,.5,0),l=r.vec3f32.create(),u=r.vec3f32.create(),c=r.vec3f32.create(),h=r.vec3f32.create(),d=r.vec3f32.create();r.vec3.subtract(l,t,s),r.vec3.subtract(u,t,i),r.vec3.cross(c,l,u),r.vec3.normalize(c,c),r.vec3.subtract(l,i,s),r.vec3.subtract(u,i,n),r.vec3.cross(h,l,u),r.vec3.normalize(h,h),r.vec3.subtract(l,n,s),r.vec3.subtract(u,n,t),r.vec3.cross(d,l,u),r.vec3.normalize(d,d);var p=[t,i,n,s],f=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],d[0],d[1],d[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),r=0;r<4;r++)t[3*r]=p[r][0]*e[0],t[3*r+1]=p[r][1]*e[1],t[3*r+2]=p[r][2]*e[2];var i={};i[o.VertexAttrConstants.POSITION]=new Uint32Array(m),i[o.VertexAttrConstants.NORMAL]=new Uint32Array(g);var n={};return n[o.VertexAttrConstants.POSITION]={size:3,data:t},n[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(f)},new a(n,i)}}(u||(u={})),function(e){function t(e,t,i,n,a){return!(Math.abs(r.vec3.dot(t,e))>a||(r.vec3.cross(i,e,t),r.vec3.normalize(i,i),r.vec3.cross(n,i,e),r.vec3.normalize(n,n),0))}function c(e,r,i,n,a,o,s){return t(e,r,a,o,s)||t(e,i,a,o,s)||t(e,n,a,o,s)}e.createBoxGeometry=s.createGeometry,e.createDiamondGeometry=l.createGeometry,e.createTetrahedronGeometry=u.createGeometry,e.createSphereGeometry=function(e,t,r,i,n,s,l){e=e||50,i=void 0!==i?i:-Math.PI,n=void 0!==n?n:2*Math.PI,s=void 0!==s?s:.5*-Math.PI,l=void 0!==l?l:Math.PI;for(var u=Math.max(3,Math.floor(t)||8),c=Math.max(2,Math.floor(r)||6),h=(u+1)*(c+1),d=new Float32Array(3*h),p=new Float32Array(3*h),f=new Float32Array(2*h),m=[],g=0,v=0;v<=c;v++){for(var y=[],b=v/c,_=s+b*l,x=Math.cos(_),w=0;w<=u;w++){var S=w/u,C=i+S*n,T=Math.cos(C)*x,E=Math.sin(_),P=-Math.sin(C)*x;d[3*g]=T*e,d[3*g+1]=E*e,d[3*g+2]=P*e,p[3*g]=T,p[3*g+1]=E,p[3*g+2]=P,f[2*g]=S,f[2*g+1]=b,y.push(g),++g}m.push(y)}var O=new Uint32Array(2*u*(c-1)*3);for(g=0,v=0;v<c;v++)for(w=0;w<u;w++){var R=m[v][w],A=m[v][w+1],M=m[v+1][w+1],I=m[v+1][w];0===v?(O[g++]=R,O[g++]=M,O[g++]=I):v===c-1?(O[g++]=R,O[g++]=A,O[g++]=M):(O[g++]=R,O[g++]=A,O[g++]=M,O[g++]=M,O[g++]=I,O[g++]=R)}o.assert(g===O.length);var D={};D[o.VertexAttrConstants.POSITION]=O,D[o.VertexAttrConstants.NORMAL]=O,D[o.VertexAttrConstants.UV0]=O;var F={};return F[o.VertexAttrConstants.POSITION]={size:3,data:d},F[o.VertexAttrConstants.NORMAL]={size:3,data:p},F[o.VertexAttrConstants.UV0]={size:2,data:f},new a(F,D)},e.createPolySphereGeometry=function(e,t,r){function i(t,r){var i;t>r&&(t=(i=[r,t])[0],r=i[1]);var a=t.toString()+"."+r.toString();if(d[a])return d[a];var o=n.length;return n.length+=3,h.add(n,3*t,n,3*r,n,o),h.scale(n,o,e/h.length(n,o)),o/=3,d[a]=o,o}var n,s,l=e;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var u=l*(1+Math.sqrt(5))/2;n=[-l,u,0,l,u,0,-l,-u,0,l,-u,0,0,-l,u,0,l,u,0,-l,-u,0,l,-u,u,0,-l,u,0,l,-u,0,-l,-u,0,l],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var c=0;c<n.length;c+=3)h.scale(n,c,e/h.length(n,c));var d={};for(c=0;c<t;c++){for(var p=s.length,f=new Uint32Array(4*p),m=0;m<p;m+=3){var g=s[m],v=s[m+1],y=s[m+2],b=i(g,v),_=i(v,y),x=i(y,g),w=4*m;f[w]=g,f[w+1]=b,f[w+2]=x,f[w+3]=v,f[w+4]=_,f[w+5]=b,f[w+6]=y,f[w+7]=x,f[w+8]=_,f[w+9]=b,f[w+10]=_,f[w+11]=x}s=f,d={}}var S=new Float32Array(n);for(c=0;c<S.length;c+=3)h.normalize(S,c);var C={};C[o.VertexAttrConstants.POSITION]=s,C[o.VertexAttrConstants.NORMAL]=s;var T={};return T[o.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(n)},T[o.VertexAttrConstants.NORMAL]={size:3,data:S},new a(T,C)},e.createPointGeometry=function(e,t,r,i,n,s,l){var u=t?new Float32Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),c=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),h=s?new Float32Array(s):new Float32Array([0,0]),d=r?new Uint8Array([255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]):new Uint8Array([255,255,255,255]),p=null!=i&&2===i.length?new Float32Array(i):new Float32Array([1,1]),f=new Uint32Array([0]),m={};m[o.VertexAttrConstants.POSITION]=f,m[o.VertexAttrConstants.NORMAL]=f,m[o.VertexAttrConstants.UV0]=f,m[o.VertexAttrConstants.COLOR]=f,m[o.VertexAttrConstants.SIZE]=f;var g={};if(g[o.VertexAttrConstants.POSITION]={size:3,data:u},g[o.VertexAttrConstants.NORMAL]={size:3,data:c},g[o.VertexAttrConstants.UV0]={size:h.length,data:h},g[o.VertexAttrConstants.COLOR]={size:4,data:d},g[o.VertexAttrConstants.SIZE]={size:2,data:p},null!=n){var v=new Float32Array([n[0],n[1],n[2],n[3]]);m[o.VertexAttrConstants.AUXPOS1]=f,g[o.VertexAttrConstants.AUXPOS1]={size:4,data:v}}if(null!=l){var y=new Float32Array([l[0],l[1],l[2],l[3]]);m[o.VertexAttrConstants.AUXPOS2]=f,g[o.VertexAttrConstants.AUXPOS2]={size:4,data:y}}return new a(g,m,a.DefaultOffsets,"point")},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),s=new Uint32Array(e.length),l=0;l<e.length;l++)r[3*l]=e[l][0],r[3*l+1]=e[l][1],r[3*l+2]=e[l][2],t&&(i[3*l]=t[l][0],i[3*l+1]=t[l][1],i[3*l+2]=t[l][2]),n[l]=l,s[l]=0;t||(i[0]=0,i[1]=1,i[2]=0);var u=new Float32Array(2);u[0]=0,u[1]=0;var c={};c[o.VertexAttrConstants.POSITION]=n,c[o.VertexAttrConstants.NORMAL]=t?n:s,c[o.VertexAttrConstants.UV0]=s;var h={};return h[o.VertexAttrConstants.POSITION]={size:3,data:r},h[o.VertexAttrConstants.NORMAL]={size:3,data:i},h[o.VertexAttrConstants.UV0]={size:2,data:u},new a(h,c,a.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),r=new Float32Array([0,1,0]),i=new Uint32Array([0,0,0]),n=new Float32Array([0,0]),s=new Uint32Array([0,0,0]),l={};l[o.VertexAttrConstants.POSITION]=t,l[o.VertexAttrConstants.NORMAL]=i,l[o.VertexAttrConstants.UV0]=s;var u={};return u[o.VertexAttrConstants.POSITION]={size:3,data:e},u[o.VertexAttrConstants.NORMAL]={size:3,data:r},u[o.VertexAttrConstants.UV0]={size:2,data:n},new a(u,l)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var r=0;r<4;r++)for(var i=0;i<3;i++)t[3*r+i]=e[r][i];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var n=new Uint32Array([0,1,2,2,3,0]),s=new Float32Array([0,0,1]),l=new Uint32Array([0,0,0,0,0,0]),u=new Float32Array([0,0,1,0,1,1,0,1]),c=new Uint8Array([255,255,255,255]),h={};h[o.VertexAttrConstants.POSITION]=n,h[o.VertexAttrConstants.NORMAL]=l,h[o.VertexAttrConstants.UV0]=n,h[o.VertexAttrConstants.COLOR]=l;var d={};return d[o.VertexAttrConstants.POSITION]={size:3,data:t},d[o.VertexAttrConstants.NORMAL]={size:3,data:s},d[o.VertexAttrConstants.UV0]={size:2,data:u},d[o.VertexAttrConstants.COLOR]={size:4,data:c},new a(d,h)},e.createConeGeometry=function(e,t,i,n,s,l){void 0===s&&(s=!0),void 0===l&&(l=!0);var u=0,c=t,h=e,d=r.vec3f32.fromValues(0,u,0),p=r.vec3f32.fromValues(0,u+h,0),f=r.vec3f32.fromValues(0,-1,0),m=r.vec3f32.fromValues(0,1,0);n&&(u=h,p=r.vec3f32.fromValues(0,0,0),d=r.vec3f32.fromValues(0,u,0),f=r.vec3f32.fromValues(0,1,0),m=r.vec3f32.fromValues(0,-1,0));var g=[p,d],v=[f,m],y=i+2,b=Math.sqrt(h*h+c*c);if(n)for(var _=i-1;_>=0;_--){var x=_*(2*Math.PI/i),w=r.vec3f32.fromValues(Math.cos(x)*c,u,Math.sin(x)*c);g.push(w);var S=r.vec3f32.fromValues(h*Math.cos(x)/b,-c/b,h*Math.sin(x)/b);v.push(S)}else for(_=0;_<i;_++)x=_*(2*Math.PI/i),w=r.vec3f32.fromValues(Math.cos(x)*c,u,Math.sin(x)*c),g.push(w),S=r.vec3f32.fromValues(h*Math.cos(x)/b,c/b,h*Math.sin(x)/b),v.push(S);var C=new Uint32Array(2*(i+2)*3),T=new Uint32Array(2*(i+2)*3),E=0,P=0;if(s){for(_=3;_<g.length;_++)C[E++]=1,C[E++]=_-1,C[E++]=_,T[P++]=0,T[P++]=0,T[P++]=0;C[E++]=g.length-1,C[E++]=2,C[E++]=1,T[P++]=0,T[P++]=0,T[P++]=0}if(l){for(_=3;_<g.length;_++)C[E++]=_,C[E++]=_-1,C[E++]=0,T[P++]=_,T[P++]=_-1,T[P++]=1;C[E++]=0,C[E++]=2,C[E++]=g.length-1,T[P++]=1,T[P++]=2,T[P++]=v.length-1}var O=new Float32Array(3*y);for(_=0;_<y;_++)O[3*_]=g[_][0],O[3*_+1]=g[_][1],O[3*_+2]=g[_][2];var R=new Float32Array(3*y);for(_=0;_<y;_++)R[3*_]=v[_][0],R[3*_+1]=v[_][1],R[3*_+2]=v[_][2];var A={};A[o.VertexAttrConstants.POSITION]=C,A[o.VertexAttrConstants.NORMAL]=T;var M={};return M[o.VertexAttrConstants.POSITION]={size:3,data:O},M[o.VertexAttrConstants.NORMAL]={size:3,data:R},new a(M,A)},e.createCylinderGeometry=function(e,t,i,n,s,l){var u=n?r.vec3f32.clone(n):r.vec3f32.fromValues(1,0,0),c=s?r.vec3f32.clone(s):r.vec3f32.fromValues(0,0,0),h=void 0===l||l,d=r.vec3f32.create();r.vec3.normalize(d,u);var p=r.vec3f32.create();r.vec3.scale(p,d,Math.abs(e));var f=r.vec3f32.create();r.vec3.scale(f,p,-.5),r.vec3.add(f,f,c);var m=r.vec3f32.fromValues(0,1,0);Math.abs(1-r.vec3.dot(d,m))<.2&&r.vec3.set(m,0,0,1);var g=r.vec3f32.create();r.vec3.cross(g,d,m),r.vec3.normalize(g,g),r.vec3.cross(m,g,d);var v=2*i+(h?2:0),y=i+(h?2:0),b=new Float32Array(3*v),_=new Float32Array(3*y),x=new Float32Array(2*v),w=new Uint32Array(3*i*(h?4:2)),S=new Uint32Array(3*i*(h?4:2));h&&(b[3*(v-2)+0]=f[0],b[3*(v-2)+1]=f[1],b[3*(v-2)+2]=f[2],x[2*(v-2)]=0,x[2*(v-2)+1]=0,b[3*(v-1)+0]=b[3*(v-2)+0]+p[0],b[3*(v-1)+1]=b[3*(v-2)+1]+p[1],b[3*(v-1)+2]=b[3*(v-2)+2]+p[2],x[2*(v-1)]=1,x[2*(v-1)+1]=1,_[3*(y-2)+0]=-d[0],_[3*(y-2)+1]=-d[1],_[3*(y-2)+2]=-d[2],_[3*(y-1)+0]=d[0],_[3*(y-1)+1]=d[1],_[3*(y-1)+2]=d[2]);for(var C=function(e,t,r){w[e]=t,S[e]=r},T=0,E=r.vec3f32.create(),P=r.vec3f32.create(),O=0;O<i;O++){var R=O*(2*Math.PI/i);r.vec3.scale(E,m,Math.sin(R)),r.vec3.scale(P,g,Math.cos(R)),r.vec3.add(E,E,P),_[3*O+0]=E[0],_[3*O+1]=E[1],_[3*O+2]=E[2],r.vec3.scale(E,E,t),r.vec3.add(E,E,f),b[3*O+0]=E[0],b[3*O+1]=E[1],b[3*O+2]=E[2],x[2*O+0]=O/i,x[2*O+1]=0,b[3*(O+i)+0]=b[3*O+0]+p[0],b[3*(O+i)+1]=b[3*O+1]+p[1],b[3*(O+i)+2]=b[3*O+2]+p[2],x[2*(O+i)+0]=O/i,x[2*O+1]=1;var A=(O+1)%i;C(T++,O,O),C(T++,O+i,O),C(T++,A,A),C(T++,A,A),C(T++,O+i,O),C(T++,A+i,A)}if(h){for(O=0;O<i;O++)A=(O+1)%i,C(T++,v-2,y-2),C(T++,O,y-2),C(T++,A,y-2);for(O=0;O<i;O++)A=(O+1)%i,C(T++,O+i,y-1),C(T++,v-1,y-1),C(T++,A+i,y-1)}var M={};M[o.VertexAttrConstants.POSITION]=w,M[o.VertexAttrConstants.NORMAL]=S,M[o.VertexAttrConstants.UV0]=w;var I={};return I[o.VertexAttrConstants.POSITION]={size:3,data:b},I[o.VertexAttrConstants.NORMAL]={size:3,data:_},I[o.VertexAttrConstants.UV0]={size:2,data:x},new a(I,M)},e.createTubeGeometry=function(t,r,i,n,a){i=i||10,n=null==n||n,o.assert(t.length>1);for(var s=[],l=[],u=0;u<i;u++){s.push([0,-u-1,-(u+1)%i-1]);var c=u/i*2*Math.PI;l.push([Math.cos(c)*r,Math.sin(c)*r])}return e.createPathExtrusionGeometry(l,t,[[0,0,0]],s,n,a)},e.createPathExtrusionGeometry=function(e,t,n,s,l,u){void 0===u&&(u=r.vec3f32.fromValues(0,0,0));var h=e.length,p=new Float32Array(t.length*h*3+(6*n.length||0)),f=new Float32Array(t.length*h+(2*n.length||0)),m=new Float32Array(t.length*h*3+(n?6:0)),g=(t.length-1)*h*6+3*s.length*2,v=new Uint32Array(g),y=new Uint32Array(g),b=0,_=0,x=0,w=0,S=0,C=r.vec3f32.create(),T=r.vec3f32.create(),E=r.vec3f32.create(),P=r.vec3f32.create(),O=r.vec3f32.create(),R=r.vec3f32.create(),A=r.vec3f32.create(),M=r.vec3f64.create(),I=r.vec3f32.create(),D=r.vec3f32.create(),F=r.vec3f32.create(),V=r.vec3f32.create(),L=r.vec3f32.create(),U=i.plane.create();r.vec3.set(I,0,1,0),r.vec3.subtract(T,t[1],t[0]),r.vec3.normalize(T,T),l?(r.vec3.add(M,t[0],u),r.vec3.normalize(E,M)):r.vec3.set(E,0,0,1),c(T,E,I,I,O,E,d),r.vec3.copy(P,E),r.vec3.copy(V,O);for(var B=0;B<n.length;B++)r.vec3.scale(R,O,n[B][0]),r.vec3.scale(M,E,n[B][2]),r.vec3.add(R,R,M),r.vec3.add(R,R,t[0]),p[b++]=R[0],p[b++]=R[1],p[b++]=R[2],f[x++]=0;for(m[_++]=-T[0],m[_++]=-T[1],m[_++]=-T[2],B=0;B<s.length;B++)v[w++]=s[B][0]>0?s[B][0]:-s[B][0]-1+n.length,v[w++]=s[B][1]>0?s[B][1]:-s[B][1]-1+n.length,v[w++]=s[B][2]>0?s[B][2]:-s[B][2]-1+n.length,y[S++]=0,y[S++]=0,y[S++]=0;for(var N=n.length,j=n.length-1,G=0;G<t.length;G++){var z=!1;G>0&&(r.vec3.copy(C,T),G<t.length-1?(r.vec3.subtract(T,t[G+1],t[G]),r.vec3.normalize(T,T)):z=!0,r.vec3.add(D,C,T),r.vec3.normalize(D,D),r.vec3.add(F,t[G-1],P),i.plane.fromPositionAndNormal(t[G],D,U),i.plane.intersectRay(U,i.ray.wrap(F,C),M)?(r.vec3.subtract(M,M,t[G]),r.vec3.normalize(E,M),r.vec3.cross(O,D,E),r.vec3.normalize(O,O)):c(D,P,V,I,O,E,d),r.vec3.copy(P,E),r.vec3.copy(V,O)),l&&(r.vec3.add(M,t[G],u),r.vec3.normalize(L,M));for(var H=0;H<h;H++)if(r.vec3.scale(R,O,e[H][0]),r.vec3.scale(M,E,e[H][1]),r.vec3.add(R,R,M),r.vec3.normalize(A,R),m[_++]=A[0],m[_++]=A[1],m[_++]=A[2],f[x++]=l?r.vec3.dot(R,L):R[2],r.vec3.add(R,R,t[G]),p[b++]=R[0],p[b++]=R[1],p[b++]=R[2],!z){var k=(H+1)%h;v[w++]=N+H,v[w++]=N+h+H,v[w++]=N+k,v[w++]=N+k,v[w++]=N+h+H,v[w++]=N+h+k;for(var W=0;W<6;W++)y[S++]=v[w-6+W]-j}N+=h}var q=t[t.length-1];for(B=0;B<n.length;B++)r.vec3.scale(R,O,n[B][0]),r.vec3.scale(M,E,n[B][1]),r.vec3.add(R,R,M),r.vec3.add(R,R,q),p[b++]=R[0],p[b++]=R[1],p[b++]=R[2],f[x++]=0;var X=_/3;m[_++]=T[0],m[_++]=T[1],m[_++]=T[2];var Y=N-h;for(B=0;B<s.length;B++)v[w++]=s[B][0]>=0?N+s[B][0]:-s[B][0]-1+Y,v[w++]=s[B][2]>=0?N+s[B][2]:-s[B][2]-1+Y,v[w++]=s[B][1]>=0?N+s[B][1]:-s[B][1]-1+Y,y[S++]=X,y[S++]=X,y[S++]=X;var Q={};Q[o.VertexAttrConstants.POSITION]=v,Q[o.VertexAttrConstants.NORMAL]=y;var Z={};return Z[o.VertexAttrConstants.POSITION]={size:3,data:p},Z.zOffset={size:1,data:f},Z[o.VertexAttrConstants.NORMAL]={size:3,data:m},new a(Z,Q)},e.createPolylineGeometry=function(e,t){o.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),o.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),o.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),o.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var r=new Float32Array(3*e.length),i=new Uint32Array(2*(e.length-1)),n=0,s=0,l=0;l<e.length;l++){for(var u=0;u<3;u++)r[n++]=e[l][u];l>0&&(i[s++]=l-1,i[s++]=l)}var c={},h={};if(c[o.VertexAttrConstants.POSITION]=i,h[o.VertexAttrConstants.POSITION]={size:3,data:r},t){var d=new Float32Array(3*t.length),p=0;for(l=0;l<e.length;l++)for(u=0;u<3;u++)d[p++]=t[l][u];c[o.VertexAttrConstants.NORMAL]=i,h[o.VertexAttrConstants.NORMAL]={size:3,data:d}}return new a(h,c,a.DefaultOffsets,"line")},e.addVertexColors=function(e,t){var r=t||[1,1,1,1],i=new Uint8Array(4);i[0]=255*r[0],i[1]=255*r[1],i[2]=255*r[2],i[3]=255*(r.length>3?r[3]:1);var n={},s=e.getVertexAttr();for(var l in s)n[l]=s[l];n[o.VertexAttrConstants.COLOR]={size:4,data:i};var u={};for(var l in e.indices)u[l]=e.indices[l];var c=u[o.VertexAttrConstants.POSITION].length;return u[o.VertexAttrConstants.COLOR]=new Uint32Array(c),new a(n,u,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),i=e.indices,a=n.Vec3Compact.subtract,s=i.position.length/3,l=new Float32Array(3*s),u=t.position.data,c=0,h=i.position,d=new Uint32Array(h.length),m=0;m<h.length;m+=3){a(u,3*h[m],u,3*h[m+2],f,0),a(u,3*h[m],u,3*h[m+1],p,0),r.vec3.cross(p,p,f),r.vec3.normalize(p,p);var g=c/3;l[c++]=p[0],l[c++]=p[1],l[c++]=p[2],d[m]=g,d[m+1]=g,d[m+2]=g}t[o.VertexAttrConstants.NORMAL]={size:3,data:l,offsetIdx:0,strideIdx:3},i[o.VertexAttrConstants.NORMAL]=d},e.cgToGIS=function(e,t){void 0===t&&(t=e);var r=e.getVertexAttr(),i=r.position.data,n=r.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(n)for(var l=0;l<n.length;l+=3){var u=n[l+1];s[l+1]=-n[l+2],s[l+2]=u}if(i)for(l=0;l<i.length;l+=3)u=i[l+1],o[l+1]=-i[l+2],o[l+2]=u;return t},e.makeOrthoBasisDirUp=t,e.makeOrthoBasisDirUpFallback=c}(c||(c={}));var d=.99619469809,p=r.vec3f32.create(),f=r.vec3f32.create();return c}.apply(null,i))||(e.exports=n)},1597:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,i){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),void 0===i&&(i=!0),this.intensity=e,this.direction=t,this.castShadows=i}}();t.MainLight=i;var n=function(){return function(e,t){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=r.vec3f64.create(),this.direction=r.vec3f64.create(),this.intensity=e,this.direction=t}}();t.FillLight=n;var a=function(){return function(e){void 0===e&&(e=r.vec3f64.create()),this.intensity=e}}();t.AmbientLight=a;var o=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=o}.apply(null,i))||(e.exports=n)},1598:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:i.resolveIncludes("misc/blendLayers.vert"),fragmentShader:i.resolveIncludes("misc/blendLayers.frag")},attributes:r.Default3D},t.simple={name:"simple",shaders:{vertexShader:i.resolveIncludes("misc/simple.vert"),fragmentShader:i.resolveIncludes("misc/simple.frag")},attributes:r.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:i.resolveIncludes("misc/texOnly.vert"),fragmentShader:i.resolveIncludes("misc/texOnly.frag")},attributes:r.Default3D},t.showDepth={name:"show-depth",shaders:{vertexShader:i.resolveIncludes("misc/showDepth.vert"),fragmentShader:i.resolveIncludes("misc/showDepth.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1599:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(22),r(1574),r(1566),r(1589),r(93),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u=l.VertexAttrConstants,c=new i,h=r.vec3f64.create(),d=r.vec3f64.create(),p=r.vec3f64.create(),f=r.mat4f64.create(),m=r.vec3f64.create(),g={verticalDistanceToGround:0,terrainElevation:0};t.perVertexElevationAligner=function(e,r,i,a){var s=e.stageObject,l=i.spatialReference;c.spatialReference=l;for(var f=s.getGeometryRecords(),m=f.length,v="absolute-height"!==r.mode,y=0,b=0;b<m;b++){var _=f[b].geometry,x=f[b].getShaderTransformation();d[0]=x[12],d[1]=x[13],d[2]=x[14],_.invalidateBoundingInfo();for(var w=_.data.getVertexAttr(),S=w[u.POSITION],C=S.data,T=w.mapPos.data,E=S.size,P=C.length/E,O=0,R=0,A=!1,M=0,I=0;I<P;I++){c.x=T[R++],c.y=T[R++],c.z=T[R++],p[0]=C[O],p[1]=C[O+1],p[2]=C[O+2];var D=n.computeElevation(i,c,r,a,v?g:null);if(v&&(M+=g.terrainElevation),h[0]=C[O]+d[0],h[1]=C[O+1]+d[1],h[2]=C[O+2]+d[2],a.setAltitude(D,h),C[O]=h[0]-d[0],C[O+1]=h[1]-d[1],C[O+2]=h[2]-d[2],o.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)A=!0;else{var F=t.updateThresholdInMeters/a.unitInMeters;(Math.abs(p[0]-C[O])>=F||Math.abs(p[1]-C[O+1])>=F||Math.abs(p[2]-C[O+2])>=F)&&(A=!0)}O+=E}y+=M/P,A&&s.geometryVertexAttrsUpdated(b)}return y/m},t.perObjectElevationAligner=function(e,i,l,u,c){var d=e.stageObject,p=i.centerPointInElevationSR,f=0,v=0;if(d.metadata.usesVerticalDistanceToGround)f=n.computeElevation(l,p,i,u,g),a.updateVertexAttributeAuxpos1w(d,g.verticalDistanceToGround),v=g.terrainElevation;else{var y="absolute-height"!==i.mode;f=n.computeElevation(l,p,i,u,y?g:null),y&&(v=g.terrainElevation)}var b=d.getObjectTransformation(),_=r.vec3.set(m,b[12],b[13],b[14]);o.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=p.x,h[1]=p.y,h[2]=f,s.computeLinearTransformation(p.spatialReference,h,b,u.spatialReference)&&d.setObjectTransformation(b)):u.setAltitudeOfTransformation(f,b);var x=t.updateThresholdInMeters/u.unitInMeters;return(Math.abs(b[12]-_[0])>=x||Math.abs(b[13]-_[1])>=x||Math.abs(b[14]-_[2])>=x)&&d.setObjectTransformation(b),v},t.perLodInstanceElevationAligner=function(e,i,a,l,u){var c,d=i.centerPointInElevationSR,p=0,v="absolute-height"!==i.mode;c=n.computeElevation(a,d,i,l,v?g:null),v&&(p=g.terrainElevation);var y=e.graphics3DSymbolLayer.lodRenderer.instanceData,b=e.instanceIndex,_=f;y.getGlobalTransform(b,_);var x=r.vec3.set(m,_[12],_[13],_[14]);o.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=d.x,h[1]=d.y,h[2]=c,s.computeLinearTransformation(d.spatialReference,h,_,l.spatialReference)&&y.setGlobalTransform(b,_)):l.setAltitudeOfTransformation(c,_);var w=t.updateThresholdInMeters/l.unitInMeters;return(Math.abs(_[12]-x[0])>=w||Math.abs(_[13]-x[1])>=w||Math.abs(_[14]-x[2])>=w)&&y.setGlobalTransform(b,_),p},t.updateThresholdInMeters=.01,t.iterativeUpdatesEnabled=!0}.apply(null,i))||(e.exports=n)},1600:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(38),r(1601),r(92),r(1583),r(1718),r(1587),r(1578),r(1577),r(1559),r(1598),r(1562),r(1560),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m){function g(e,t,r,i,o,s,l){l=!1!==l,n.requestImage(t).then(function(t){if(h.assert(t.width>=1&&t.height>=1),r.samplingMode=l?9987:9729,r.hasMipmap=l,!l&&33071===r.wrapMode||a.isPowerOfTwo(t.width)&&a.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var n=new f(e,r,t);e.bindTexture(n),s(n)}else{n=v(e,t,r,i,o);e.bindTexture(n),s(n)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;y.error("Failed to load image from uri",r,e),s(null)})}function v(e,t,r,n,o){var s=a.nextHighestPowerOfTwo(t.width),c=a.nextHighestPowerOfTwo(t.height);h.assert(s!==t.width||c!==t.height),r.width=s,r.height=c;var g=new f(e,r),v=p.createWithAttachments(e,g,{colorTarget:0,depthStencilTarget:0}),y=new f(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(v),void 0===o){var b=e.getViewport();o=[b.x,b.y,b.width,b.height]}e.setViewport(0,0,s,c);var _=n.getProgram(d.texOnly),x=i.mat4f64.create();e.bindProgram(_),_.setUniformMatrix4fv("model",x),_.setUniformMatrix4fv("view",x),_.setUniformMatrix4fv("proj",x),_.setUniform4f("color",1,1,1,1),_.setUniform1i("tex",0);var w=u.createQuadVAO(e,l.Pos3Tex);return e.bindTexture(y,0),e.bindVAO(w),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,m.vertexCount(w,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(o[0],o[1],o[2],o[3]),w.dispose(!0),y.dispose(),e.bindFramebuffer(null),v.detachColorTexture(),v.dispose(),r.hasMipmap&&g.generateMipmap(),g}var y=r.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function e(t,r,i){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=i||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:o.isArrayBuffer(e)||o.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4:(t.mipmap?4/3:1)*t.width*t.height*4||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,i,n,l){var u=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrap,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof u)g(t,u,r,i,n,l,this.params.mipmap);else if(u instanceof Image||u instanceof ImageData||u instanceof HTMLCanvasElement){this.params.width=u.width,this.params.height=u.height;var c=33071===this.params.wrap.s&&33071===this.params.wrap.t;if(!(this.params.mipmap||!c)||a.isPowerOfTwo(u.width)&&a.isPowerOfTwo(u.height)){r.width=u.width,r.height=u.height;var d=new f(t,r,u);t.bindTexture(d),l(d)}else{d=v(t,u,r,i,n);t.bindTexture(d),l(d)}}else if(o.isArrayBuffer(u)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,u,this.params.mipmap);t.bindTexture(d),l(d)}else if(o.isUint8Array(u)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,u.buffer,this.params.mipmap);t.bindTexture(d),l(d)}else if(o.isUint8Array(u)){h.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:6408,r.width=this.params.width,r.height=this.params.height;d=new f(t,r,u);t.bindTexture(d),l(d)}else{if(null!==u)throw console.warn("Unsupported image data"),new Error("Unsupported image data");d=new f(t,r,null);t.bindTexture(d),l(d)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrap:{s:33071,t:33071}})},e.idGen=new c,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,i))||(e.exports=n)},1601:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(21)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Blob([i],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,i))||(e.exports=n)},1603:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(53)],void 0===(n=function(e,t,r){function i(e){return null!=e.cachedResult}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,i){var n=null,a=e&&e.expression;if("string"==typeof a){var o=function(e){return"0"===e?0:null}(a);if(null!=o)n={cachedResult:o};else{var s=r.createSyntaxTree(a);r.dependsOnView(s)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),n={cachedResult:0}):n={arcade:{func:r.createFunction(s),context:r.createExecContext(null,{sr:t})}}}}return n},t.createFeature=function(e,t){return r.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||i(e)||r.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(i(e))return e.cachedResult;var t=e.arcade,n=r.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,i=r&&r.expression;return t||"0"===i||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,i))||(e.exports=n)},1604:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,i))||(e.exports=n)},1605:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(58),r(19),r(1723),r(1559),r(1634)],void 0===(n=function(e,t,r,i,n,a,o,s){function l(e){for(var t=0,r=0,i={bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}},n=0,a=e;n<a.length;n++){var o=a[n];o&&(t+=o.primitivesPerFeature,r+=o.primitivesPerCoordinate,i.bytesPerFeature+=o.memory.bytesPerFeature,i.bytesPerCoordinate+=o.memory.bytesPerCoordinate,i.draped.bytesPerFeature+=o.memory.bytesPerFeature,i.draped.bytesPerCoordinate+=o.memory.bytesPerCoordinate)}return{primitivesPerFeature:t,primitivesPerCoordinate:r,memory:i}}function u(e,t){var n=c(e,t);switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,memory:n};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,memory:n}:t.outline&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,memory:n}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,memory:n};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,memory:n};case"object":if(t.resource&&t.resource.href)return{primitivesPerFeature:16,primitivesPerCoordinate:0,memory:n};var a=t.resource&&t.resource.primitive||"sphere";return r({},h(a),{memory:n});case"path":return{primitivesPerFeature:-4,primitivesPerCoordinate:20,memory:n};case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:n};default:i.neverReached(t)}}function c(e,r){var a="point-3d"===e.type;switch(r.type){case"extrude":return r.edges&&r.edges.size>0?t.memoryEstimators.EXTRUDE_EDGES:t.memoryEstimators.EXTRUDE;case"fill":return r.outline&&r.outline.size>0?t.memoryEstimators.FILL_OUTLINE:t.memoryEstimators.FILL;case"line":return t.memoryEstimators.LINE;case"path":return t.memoryEstimators.PATH;case"object":return n("enable-feature:skallweit/lod-rendering")?a?t.memoryEstimators.OBJECT_POINT_LOD:t.memoryEstimators.OBJECT_POLYGON_LOD:a?t.memoryEstimators.OBJECT_POINT:t.memoryEstimators.OBJECT_POLYGON;case"icon":case"text":return a?t.memoryEstimators.ICON_POINT:t.memoryEstimators.ICON_POLYGON;default:i.neverReached(r)}}function h(e){var t=d[e];if(t)return t;if(n("enable-feature:skallweit/lod-rendering")){var r=a.primitiveLodResources(e,null,null);t={primitivesPerFeature:s.geometriesFromLodLevelResources(r.levels[0]).reduce(function(e,t){return e+t.data.getIndices(o.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0}}else{t={primitivesPerFeature:a.primitiveGeometryData(e).getIndices(o.VertexAttrConstants.POSITION).length/3,primitivesPerCoordinate:0}}return d[e]=t,t}Object.defineProperty(t,"__esModule",{value:!0}),t.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}}},t.defaultSymbolComplexity=function(e){return"web-style"===e.type?t.emptySymbolComplexity:l(e.symbolLayers.toArray().map(function(t){return u(e,t)}))},t.totalSymbolComplexities=l;var d={};t.defaultSymbolLayerComplexity=u,t.defaultSymbolLayerMemoryComplexity=c,t.memoryEstimators={ICON_POINT:{bytesPerFeature:7478.781325779039,bytesPerCoordinate:0,draped:{bytesPerFeature:5712.082651558076,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9679.372971750396,bytesPerCoordinate:56.86422538239579,draped:{bytesPerFeature:7883.966873022898,bytesPerCoordinate:56.89697037586389}},OBJECT_POINT:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0,draped:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206,draped:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206}},OBJECT_POINT_LOD:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0,draped:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0}},OBJECT_POLYGON_LOD:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441,draped:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441}},LINE:{bytesPerFeature:7586.045782417972,bytesPerCoordinate:112.02132538683836,draped:{bytesPerFeature:4775.97368572266,bytesPerCoordinate:111.85995483757563}},PATH:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872,draped:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872}},FILL:{bytesPerFeature:8702.040510627665,bytesPerCoordinate:56.610361738134486,draped:{bytesPerFeature:5921.70744530372,bytesPerCoordinate:56.58839624148057}},FILL_OUTLINE:{bytesPerFeature:12168.362923563885,bytesPerCoordinate:56.265773613009564,draped:{bytesPerFeature:7929.090679733446,bytesPerCoordinate:56.17528027868163}},EXTRUDE:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536,draped:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536}},EXTRUDE_EDGES:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105,draped:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105}}}}.apply(null,i))||(e.exports=n)},1607:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92)],void 0===(n=function(e,t,r,i){return function(){function e(e,t,i,n,a,o,s,l,u,c,h){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=i,this.origin=null,this.center=r.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=a,n&&this.updateTransformation(n,o),this.castShadow=s,this.singleUse=l,this.name=u,this.uniqueName=c,this.idx=h,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||i.maxScale(e),r.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=r.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,i))||(e.exports=n)},1608:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(183),r(92),r(1636),r(1586),r(1661),r(1607),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var u=l.assert,c=l.logWithBase;return function(){function e(){for(var e in this.dirtySet=new o(this),this._uniqueIdx=0,this._id2origin={},this.content={},a)this.content[a[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return u(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];u(void 0!==r);var i=t.id;u(null==r[i],"Model/Stage already contains object to be added"),r[i]=t,e===a.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];u(void 0!==r);var i=r[t];return u(void 0!==i,"Model/Stage doesn't contain object to be removed"),delete r[t],e===a.TEXTURE&&i.unload(),e===a.LAYER&&this.notifyDirty(e,i,"layerRemoved"),i},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,i){this.dirtySet.handleUpdate(t,r,i)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var i=0,a=t*r/1e4;a>1&&(i=Math.ceil(c(a,2)));var o=1e4*Math.pow(2,i),s=Math.round(e[0]/o),l=Math.round(e[1]/o),u=Math.round(e[2]/o),h=i+"_"+s+"_"+l+"_"+u,d=this._id2origin[h];return null==d&&(d=n.fromValues(s*o,l*o,u*o,h),this._id2origin[h]=d),d},e.prototype.getGeometryRenderGeometries=function(e,t,r){var n=e.id,a=t.geometry,o=e.getCombinedStaticTransformation(t),l=i.maxScale(o),u=t.origin,c=t.id,h=this._uniqueIdx++,d=new s(a.data,a.boundingInfo,t.material,o,t.shaderTransformation,l,e.getCastShadow(),!!a.singleUse,n,c,h);d.origin=u||this.getOrigin(d.center,d.bsRadius),d.instanceParameters=t.instanceParameters,r.push(d)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var i in t[0]="<table>",a){var n=a[i];t[0]+="<tr><td>"+n+'</td><td style="text-align: right">'+Object.keys(this.getAll(n)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var i in t[0]="",a){n=a[i];t[0]+=r.pad(String(Object.keys(this.getAll(n)).length),6," ")+" "+n+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(a.OBJECT);for(var t in e)this.validateObject(e[t]);var r=this.getAll(a.LAYER);for(var i in r)this.validateLayer(r[i]);var n=this.getAll(a.MATERIAL);for(var o in n)this.validateMaterial(n[o])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var i=t[r];u(null!=this.get(a.GEOMETRY,i.geometry.id)),u(null!=this.get(a.MATERIAL,i.material.id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var i=this.get(a.OBJECT,t[r].id);u(null!=i)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),r=0;r<t.length;++r){var i=this.get(a.TEXTURE,t[r]);u(null!=i)}},e.ContentType=a,e}()}.apply(null,i))||(e.exports=n)},1609:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return{near:e,far:t}}function i(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?i(e,1/0,-1/0):r(1/0,-1/0)},t.set=i,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,i))||(e.exports=n)},1610:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r;t.generateHighlightId=function(){return i.gen("highlight")}}.apply(null,i))||(e.exports=n)},1611:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1604),r(1568)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r,i,a,o){void 0===o&&(o=!1);var s=e.call(this,t,r)||this;return s.textureRep=i,s.textureId=a,s.initTransparent=o,s.glTextureRef=n.aquireIfNotUndefined(s.textureId,i,s.initTransparent),s}return r(t,e),t.prototype.dispose=function(){n.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(n.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=n.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t}(i)}.apply(null,i))||(e.exports=n)},1612:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19)],void 0===(n=function(e,t,r){return function(){function e(t,i){this._context=t,this._desc=i,this._glName=null,this._id=-1;var n=this._context.gl;r("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5),this._id=++e._nextId,this._glName=n.createRenderbuffer(),this._context.bindRenderbuffer(this),n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var r=this._context.gl,i=this._desc;i.width===e&&i.height===t||(i.width=e,i.height=t,this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5),this._context=null},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},1613:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(38),r(20),r(93),r(1570),r(1576),r(1630),r(1636),r(1581),r(1559),r(1632),r(1608)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p){var f=0,m="rg_",g=function(){function e(){if(this.ROOT_ORIGIN_ID=m+"root_"+f++,this._origins=new Map,this._gridSize=42e5,r.isSome(e.testOrigin)){var t=e.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,u.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID))}}return e.prototype.getOrigin=function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){var r=u.fromValues(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,r),r}i.vec3.subtract(y,e,t.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]);var n=this._gridSize;if(y[0]<n&&y[1]<n&&y[2]<n)return t;var a=Math.round(e[0]/n),o=Math.round(e[1]/n),s=Math.round(e[2]/n),l=""+m+a+"/"+o+"/"+s,c=this._origins.get(l);return c||(c=u.fromValues(a*n,o*n,s*n,l),this._origins.set(l,c)),c},e.prototype._drawOriginBox=function(e){var t=window.view,r=t._stage;if(null==this._object){this._material=new d({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),r.add(p.ContentType.MATERIAL,this._material);var i=new l("GridLocalOrigin",{isPickable:!1},"GridLocalOrigin");r.add(p.ContentType.LAYER,i),this._object=new c({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1}),r.add(p.ContentType.OBJECT,this._object),i.addObject(this._object),r.addToViewContent([i.id])}for(var u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],f=u.length,m=new Float32Array(3*f),g=new Uint32Array(2*(f-1)),y=.5*this._gridSize,b=0;b<f;b++)m[3*b+0]=e[0]+(1&u[b]?y:-y),m[3*b+1]=e[1]+(2&u[b]?y:-y),m[3*b+2]=e[2]+(4&u[b]?y:-y),b>0&&(g[2*b+0]=b-1,g[2*b+1]=b);a.bufferToBuffer(m,n.WebMercator,0,m,t.spatialReference,0,f);var _={};_[h.VertexAttrConstants.POSITION]={size:3,data:m};var x={};x[h.VertexAttrConstants.POSITION]=g;var w=new s(_,x,void 0,"line"),S=new o(w,"GridLocalOriginBox");r.add(p.ContentType.GEOMETRY,S),this._object.addGeometry(S,this._material,v),console.log(this._origins.size,e)},e}(),v=i.mat4f64.create(),y=i.vec3f64.create();return(g||(g={})).testOrigin=null,g}.apply(null,i))||(e.exports=n)},1614:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1655),r(1679),r(1680),r(1681),r(1682),r(1683),r(1684)],void 0===(n=function(e,t,r,i,n,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=i,t.mat4=n,t.scalar=a,t.vec2=o,t.vec3=s,t.vec4=l,t.createBuffer=function(e,t){return new e(new ArrayBuffer(t*e.ElementCount*r.elementTypeSize(e.ElementType)))}}.apply(null,i))||(e.exports=n)},1615:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(1696),r(72),r(1590),r(1572),r(1611),r(1591),r(1808),r(1559),r(1595),r(1568),r(1697)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f){function m(e,t){return void 0===t&&(t=w),e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):i.vec2.copy(t,e.anchorPos),t}var g={"bottom-left":i.vec2f64.fromValues(0,0),bottom:i.vec2f64.fromValues(.5,0),"bottom-right":i.vec2f64.fromValues(1,0),left:i.vec2f64.fromValues(0,.5),center:i.vec2f64.fromValues(.5,.5),right:i.vec2f64.fromValues(1,.5),"top-left":i.vec2f64.fromValues(0,1),top:i.vec2f64.fromValues(.5,1),"top-right":i.vec2f64.fromValues(1,1)},v=function(e){function t(t,r){var i=e.call(this,r)||this;return i._textureDirty=!1,i.params=p.copyParameters(t,V),"string"==typeof i.params.anchorPos&&(i.params.anchorPos=g[i.params.anchorPos]),i.bufferWriter=new U(i),i}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){return this.params},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&h.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.intersect=function(e,t,r,n,a,o,l,u){if(n.isSelection&&n.enableHUDSelection&&!s.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var d=e.data,p=this.params,f=1,g=1;if(i.mat3.fromMat4(O,r),u){var v=u(M);f=v[0],g=v[5],function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(n*n+a*a+o*o),d=1/Math.sqrt(s*s+l*l+u*u);e[0]=t*c,e[1]=r*c,e[2]=i*c,e[3]=n*h,e[4]=a*h,e[5]=o*h,e[6]=s*d,e[7]=l*d,e[8]=u*d}(O)}var y=d.getVertexAttr()[h.VertexAttrConstants.POSITION],b=d.getVertexAttr()[h.VertexAttrConstants.SIZE],_=d.getVertexAttr()[h.VertexAttrConstants.NORMAL];h.assert(y.size>=3);for(var w=n.point,E=n.camera,A=m(p),F=0;F<y.data.length/y.size;F++){var V=F*y.size;i.vec3.set(S,y.data[V],y.data[V+1],y.data[V+2]),i.vec3.transformMat4(S,S,r);var L=F*b.size;D[0]=b.data[L]*f,D[1]=b.data[L+1]*g,i.vec3.transformMat4(S,S,E.viewMatrix);var U=F*_.size;if(i.vec3.set(C,_.data[U],_.data[U+1],_.data[U+2]),this.applyVerticalOffsetTransformation(S,C,O,E,x),E.applyProjection(S,T),T[0]>-1){var B=Math.floor(T[0]),N=Math.floor(T[1]);c.applyPrecomputedScaleFactorVec2(D,x.factor,D);var j=B-I-(A[0]>0?D[0]*A[0]:0),G=j+D[0]+2*I,z=N-I-(A[1]>0?D[1]*A[1]:0),H=z+D[1]+2*I;if(p.textureIsSignedDistanceField){var k=p.outlineSize/2,W=p.distanceFieldBoundingBox;j+=D[0]*W[0],z+=D[1]*W[1],G-=D[0]*(1-W[2]),H-=D[1]*(1-W[3]),j-=k,G+=k,z-=k,H+=k}if(w[0]>j&&w[0]<G&&w[1]>z&&w[1]<H){var q=n.p0,X=n.p1;i.vec3.transformMat4(P,S,i.mat4.invert(R,E.viewMatrix)),T[0]=w[0],T[1]=w[1],E.unprojectPoint(T,S);var Y=i.vec3f64.create();i.vec3.subtract(Y,X,q);var Q=1/i.vec3.length(Y);i.vec3.scale(Y,Y,Q),l(i.vec3.distance(q,S)*Q,Y,-1,1,!0,P)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,n){return void 0===n&&(n=A),i.vec3.transformMat3(n.normal,e,t),i.vec3.transformMat4(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=i.vec3.dot(E,F),n},t.prototype.updateScaleInfo=function(e,t,r){var i=this.params;i.screenSizePerspective?e.factor=c.precomputeScaleFactor(A.cosAngle,r,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?(e.scaleAlignment=c.precomputeScale(A.cosAngle,r,i.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=i.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,a,o,s){var l=this.params;if(n.isMat4(r)&&(r=i.mat3.fromMat4(O,r)),!l.verticalOffset||!l.verticalOffset.screenLength){if(o&&(l.screenSizePerspective||l.screenSizePerspectiveAlignment)){var u=this.normalAndViewAngle(t,r,a),c=i.vec3.length(e);this.updateScaleInfo(o,u.cosAngle,c)}else o&&(o.factor.scale=1,o.scaleAlignment=1);return s?i.vec3.copy(s,e):e}var h=this.normalAndViewAngle(t,r,a),d=i.vec3.length(e),f=l.screenSizePerspectiveAlignment||l.screenSizePerspective,m=p.verticalOffsetAtDistance(a,d,l.verticalOffset,h.cosAngle,f);return o&&this.updateScaleInfo(o,h.cosAngle,d),i.vec3.add(s||e,e,i.vec3.scale(h.normal,h.normal,m))},t.prototype.getGLMaterials=function(){return{color:b,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:_}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=a.create()),function(e,t,r,n){void 0===n&&(n=w),i.vec2.copy(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return m(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(u),y=function(e){function t(t,r,i){var n=e.call(this,t,r,i,t.getParams().textureId)||this;return n.params=p.copyParameters(t.getParams()),n.selectProgram(),n.selectSlot(),n}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?20:19},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=p.copyParameters(this.material.getParameterValues()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,i=this.getProgram();this.bindTexture(e,i),i.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),i.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75);var n=t.pixelRatio||1;i.setUniform4fv("overrideColor",r.color),i.setUniform1f("pixelRatio",n),r.textureIsSignedDistanceField&&(i.setUniform4fv("outlineColor",r.outlineColor),i.setUniform1f("outlineSize",r.outlineSize*n)),r.vvSizeEnabled&&(i.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),i.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),i.setUniform3fv("vvSizeOffset",r.vvSizeOffset),i.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(i.setUniform1fv("vvColorValues",r.vvColorValues),i.setUniform4fv("vvColorColors",r.vvColorColors)),i.setUniform2fv("texScale",r.texCoordScale),i.setUniform2f("screenOffset",2*r.screenOffset[0]*n,2*r.screenOffset[1]*n),i.setUniform2fv("anchorPos",m(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,i=this.getProgram(),n=this.params;e.bindProgram(i),i.setUniform1f("cameraGroundRelative",r),i.setUniform1f("polygonOffset",n.shaderPolygonOffset),i.setUniform4fv("viewport",t.viewport),p.bindVerticalOffset(n.verticalOffset,t,i),i.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.screenSizePerspective&&(p.bindScreenSizePerspective(n.screenSizePerspective,t,i,"screenSizePerspective"),p.bindScreenSizePerspective(n.screenSizePerspectiveAlignment||n.screenSizePerspective,t,i,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,i=this.getProgram();p.bindView(r,t.view,i),p.bindCamPos(r,t.viewInvTransp,i),this.params.slicePlaneEnabled&&p.bindSlicePlane(t.origin,t.slicePlane,i)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(l),b=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.isOcclusionSlot=!1,n}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(f.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.program=this.programRep.getProgram(f.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder,slice:e.slicePlaneEnabled})},t.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4},t.prototype.release=function(e){e.setDepthFunction(513),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){this.bindProjection(e,t);var r=this.getProgram();if(e.setDepthTestEnabled(!0),e.setDepthFunction(515),this.isOcclusionSlot){r.setUniform4f("color",1,1,1,1);var i=t.pixelRatio||1;r.setUniform1f("pixelRatio",i)}else this.bindRender(e,t),this.bindTexture(e,r)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=14===e,14===e||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(y),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(f.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion,slice:e.slicePlaneEnabled})},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(y),x={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},w=i.vec2f64.create(),S=i.vec3f64.create(),C=i.vec3f64.create(),T=i.vec3f64.create(),E=i.vec3f64.create(),P=i.vec3f64.create(),O=i.mat3f64.create(),R=i.mat4f64.create(),A={normal:E,cosAngle:0},M=i.mat4f64.create();i.mat4.identity(M);var I=1,D=[0,0],F=i.vec3f64.fromValues(0,0,1),V={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:g.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},L=o.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec3f(h.VertexAttrConstants.NORMAL).vec2f(h.VertexAttrConstants.UV0).vec4u8(h.VertexAttrConstants.COLOR).vec2f(h.VertexAttrConstants.SIZE).vec4f(h.VertexAttrConstants.AUXPOS1).vec4f(h.VertexAttrConstants.AUXPOS2),U=function(){function e(e){this.material=e,this.vertexBufferLayout=L}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[h.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){d.writePosition(t.indices[h.VertexAttrConstants.POSITION],t.vertexAttr[h.VertexAttrConstants.POSITION].data,e.transformation,i.position,n,6),d.writeNormal(t.indices[h.VertexAttrConstants.NORMAL],t.vertexAttr[h.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,i.normal,n,6);var a=t.vertexAttr[h.VertexAttrConstants.UV0].data,o=void 0,s=void 0,l=void 0,u=void 0;if(null==a||a.length<4){var c=this.material.getParameterValues();o=0,s=0,l=c.texCoordScale[0],u=c.texCoordScale[1]}else o=a[0],s=a[1],l=a[2],u=a[3];l=Math.min(1.99999,l+1),u=Math.min(1.99999,u+1);for(var p=t.indices[h.VertexAttrConstants.POSITION].length,f=i.uv0,m=n,g=0;g<p;++g)f.set(m,0,o),f.set(m,1,s),m+=1,f.set(m,0,l),f.set(m,1,s),m+=1,f.set(m,0,l),f.set(m,1,u),m+=1,f.set(m,0,l),f.set(m,1,u),m+=1,f.set(m,0,o),f.set(m,1,u),m+=1,f.set(m,0,o),f.set(m,1,s),m+=1;d.writeColor(t.indices[h.VertexAttrConstants.COLOR],t.vertexAttr[h.VertexAttrConstants.COLOR].data,4,i.color,n,6);var v=t.indices[h.VertexAttrConstants.SIZE],y=t.vertexAttr[h.VertexAttrConstants.SIZE].data,b=v.length,_=i.size;for(m=n,g=0;g<b;++g)for(var x=y[2*v[g]],w=y[2*v[g]+1],S=0;S<6;++S)_.set(m,0,x),_.set(m,1,w),m+=1;t.indices[h.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[h.VertexAttrConstants.AUXPOS1]&&d.writeBufferVec4(t.indices[h.VertexAttrConstants.AUXPOS1],t.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,i.auxpos1,n,6),t.indices[h.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[h.VertexAttrConstants.AUXPOS2]&&d.writeBufferVec4(t.indices[h.VertexAttrConstants.AUXPOS2],t.vertexAttr[h.VertexAttrConstants.AUXPOS2].data,i.auxpos2,n,6)},e}();return v}.apply(null,i))||(e.exports=n)},1618:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(21),r(73),r(8),r(7),r(17),r(38),r(20),r(31),r(97),r(52),r(1635),r(93),r(1583)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f){function m(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function g(e,t){var r,i=t[0],n=t[1],a=t[2],o=t[3],s=0;i<e[0]&&(s+=(r=e[0]-i)*r);n<e[1]&&(s+=(r=e[1]-n)*r);a<e[2]&&(s+=(r=e[2]-a)*r);i>e[3]&&(s+=(r=i-e[3])*r);n>e[4]&&(s+=(r=n-e[4])*r);a>e[5]&&(s+=(r=a-e[5])*r);if(s>o*o)return 0;if(s>0)return 1;var l=1/0;return i-e[0]<l&&(l=i-e[0]),n-e[1]<l&&(l=n-e[1]),a-e[2]<l&&(l=a-e[2]),e[3]-i<l&&(l=e[3]-i),e[4]-n<l&&(l=e[4]-n),e[5]-a<l&&(l=e[5]-a),l>o?2:1}function v(e,t,r){for(var i=[],n=r&&r.missingFields,a=r&&r.originalFields,o=0,s=e;o<s.length;o++){for(var l=s[o],u=l.toLowerCase(),c=!1,h=0,d=t;h<d.length;h++){var p=d[h];if(u===p.name.toLowerCase()){i.push(p.name),c=!0,a&&a.push(l);break}}!c&&n&&n.push(l)}return i}function y(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var i=function(e,t){for(var r=e.length,i=Math.ceil(r/t),n=[],a=0;a<i;a++){var o=Math.floor(r*a/i),s=Math.floor(r*(a+1)/i);n.push(e.slice(o,s))}return n}(t,e.maxRecordCount);return a.all(i.map(function(t){return y(e,t,r)})).then(x)}var o=new h({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new c(e.parsedUrl.path).execute(o).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):a.reject(new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function b(e,t,i,s,l){for(var u=[],c=0;c<t.attributeData.length;c++){var h=t.attributeData[c],p=e[c];if(p&&-1!==s.indexOf(p.name)){var f=o.makeAbsolute(h.href,t.baseUrl);u.push({url:f,storageInfo:p})}}return a.eachAlways(u.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return d.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!l.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],o=0;o<e.length;o++)null==e[o].value&&r.push({name:u[o].storageInfo.name,error:e[o].error});return a.reject(new n("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,c=i;s<c.length;s++){var h=c[s],d={};for(o=0;o<e.length;o++)null!=e[o].value&&(d[u[o].storageInfo.name]=_(e[o].value,h));t.push(d)}return t})}function _(e,t){var r=e[t];return f.isInt16Array(e)?r===O?null:r:f.isInt32Array(e)?r===R?null:r:r!=r?null:r}function x(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t=t.concat(n)}return t}function w(e){var t=new l(m(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function S(e){var t=new l(m(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function C(e,t,r){if(!u.canProject(e,t))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function T(e,t,r){var i=w(e),n=S(e);C(i,t,r),C(n,t,r)}function E(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=m,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var i=e.indexOf(t.DDS_ENCODING_STRING);if(i>-1)return i}for(var n=0;n<e.length;n++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[n])>-1)return n;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,i,n,a,o){if(null!=i){var s=i.mbs;if(r!==n&&(s=P,p.mbsToMbs(i.mbs,n,s,r)),0!==g(t,s)&&(o(i),i.children))for(var l=0;l<i.children.length;++l)e(t,r,a[i.children[l].id],n,a,o)}},t.buildTopNodeMap=function(e,t,r,i){if(void 0===i&&(i=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var n=new Map,a=Number.POSITIVE_INFINITY;e.forEach(function(o,s){var l=r(o);if(s<t)return a=Math.min(a,l),void n.set(o.id,l);if(!(l<=a||l>=i)){n.set(o.id,l);for(var u=a=n.get(e.front().id),c=0,h=1;h<t;++h){var d=e.data[h],p=n.get(d.id);p<a&&(c=h,u=a,a=p)}e.data[c]=o,a=u}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return n.get(t.id)-n.get(e.id)})}};var P=s.vec4f64.create();t.intersectBoundingBoxWithMbs=g,t.findFieldsCaseInsensitive=v,t.whenGraphicAttributes=function(e,t,r,o,s,l){var u=!0===(l&&l.populateObjectId),c=l.ignoreUnavailableFields?void 0:[],h=1===o.length&&"*"===o[0];!h&&u&&(o=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(o,r));var d=h?o:v(o,e.fields,{missingFields:c});if(c&&0!==c.length)return a.reject(new n("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:c}));if(0===t.length)return a.resolve(t);var p=e.associatedLayer,f=e.attributeStorageInfo,m=h?e.fields.map(function(e){return e.name}):d;if(p)return function(e,t,r,i){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var n=t.map(function(e){return e.attributes[r]}),a=[],o=v(i,e.fields,{originalFields:a});return y(e,n,o).then(function(e){for(var r=0;r<t.length;r++){var i=t[r],n=e[r];i.attributes={};for(var s=0;s<a.length;s++)i.attributes[a[s]]=n[o[s]]}return t})}(p,t,r,m);var g=function(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i];a in t.attributes||r.push(a)}return r}(m,t[0]);if(0===g.length)return a.resolve(t);if(f){var _=s(t);return _?a.all(_.map(function(e){return b(f,e.node,e.indices,g,l).then(function(t){for(var r=0;r<e.graphics.length;r++){for(var i=0,n=m;i<n.length;i++){var a=n[i];a in t[r]||(t[r][a]=e.graphics[r].attributes[a])}e.graphics[r].attributes=t[r]}return e.graphics})})).then(i.concatAll):a.reject(new n("scenelayer:features-not-loaded","Tried to query attributes for unloaded features"))}return a.reject(new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var O=-Math.pow(2,15),R=-Math.pow(2,31);t.getCachedAttributeValue=_,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var i=null!=t?t:e.length/r,a=new Uint32Array(i+1),o=0;o<i;o++){var s=e[o*r],l=3*s;a[o]=l;var u=(o-1)*r+1;if(u>=0&&s-1!==e[u])throw new n("Face ranges are not continuous")}var c=3*(e[(i-1)*r+1]+1);return a[a.length-1]=c,a},t.getIndexCrs=w,t.getVertexCrs=S,t.getCacheKeySuffix=function(e,t){return t===p.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=C,t.checkSpatialReferences=T,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){T(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){C(e.spatialReference,t.spatialReference,t.viewingMode)},t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,i=t;r<i.length;r++){var n=i[r];if(!E(n)||0===n.symbolLayers.length)return!0;for(var a=0,o=n.symbolLayers.items;a<o.length;a++){var s=o[a];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1};var A=function(){return function(){this.edges=null,this.material=null}}();t.SymbolInfo=A,t.getSymbolInfo=function(e){for(var t=new A,r=!1,i=!1,n=0,a=e.symbolLayers.items;n<a.length;n++){var o=a[n];if("fill"===o.type&&o.enabled){var s=o.material,l=o.edges;if(s&&!r){var u=s.color;t.material={color:u?[u.r/255,u.g/255,u.b/255]:null,alpha:u?u.a:null,colorMixMode:s.colorMixMode},r=!0}l&&!i&&(t.edges=o.edges,i=!0)}}return t}}.apply(null,i))||(e.exports=n)},1619:function(e,t,r){var i;!function(t){function r(e){this._callbacks=[],this._errbacks=[],this._cancelCallback=e,this._iscancelled=!1,this._isdone=!1,this._iserr=!1}r.prototype.cancel=function(e){this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e)},r.prototype.then=function(e,t,r){var i;if(!this._iscancelled)return this._isdone?i=e.apply(r,this.result):this._iserr&&t?i=t.apply(r,this.result):(this._callbacks.push(function(){return e.apply(r,arguments)}),t&&this._errbacks.push(function(){return t.apply(r,arguments)})),i},r.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]},r.prototype.resolve=r.prototype.done,r.prototype.reject=function(){if(!this._iscancelled){this.result=arguments,this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]}},r.prototype.isRejected=function(){return this._iserr},r.prototype.isFulfilled=function(){return this._isdone||this._iserr},r.prototype.isResolved=function(){return this._isdone},r.prototype.isCancelled=function(){return this._iscancelled};var n={Promise:r,join:function(e){function t(e,t){return function(){t&&(s=!0),a+=1,o[e]=Array.prototype.slice.call(arguments),a===n&&(s?i.reject():i.done(o))}}for(var i=new r,n=e.length,a=0,o=[],s=!1,l=0;l<n;l++)e[l].then(t(l,!1),t(l,!0));return 0===e.length&&i.done(),i},chain:function e(t,i){var n=new r;return 0===t.length?n.done.apply(n,i):t[0].apply(null,i).then(function(){t.splice(0,1),e(t,arguments).then(function(){n.done.apply(n,arguments)})}),n}};void 0===(i=function(){return n}.apply(null,[]))||(e.exports=i)}()},1620:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(59)],void 0===(n=function(e,t,r){function i(e){return e&&"upperLeft"===e.originPosition}function n(e,t){var r=e.scale,i=e.translate;return Math.round((t-i[0])/r[0])}function a(e,t){var r=e.scale,i=e.translate;return Math.round((i[1]-t)/r[1])}function o(e,t,r){for(var i,o,s,l,u=[],c=0;c<r.length;c++){var h=r[c];c>0?(s=n(e,h[0]),l=a(e,h[1]),s===i&&l===o||(u.push(t(h,s-i,l-o)),i=s,o=l)):(i=n(e,h[0]),o=a(e,h[1]),u.push(t(h,i,o)))}return u.length>0?u:null}function s(e,t,r,i){return o(e,r?i?E:T:i?T:C,t)}function l(e,t,r,i){for(var n=[],a=r?i?E:T:i?T:C,s=0;s<t.length;s++){var l=o(e,a,t[s]);l&&l.length>=3&&n.push(l)}return n.length?n:null}function u(e,t,r,i){for(var n=[],a=r?i?E:T:i?T:C,s=0;s<t.length;s++){var l=o(e,a,t[s]);l&&l.length>=2&&n.push(l)}return n.length?n:null}function c(e,t){var r=e.scale,i=e.translate;return t*r[0]+i[0]}function h(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function d(e,t,r){var i=new Array(r.length);if(!r.length)return i;var n=e.scale,a=n[0],o=n[1],s=c(e,r[0][0]),l=h(e,r[0][1]);i[0]=t(r[0],s,l);for(var u=1;u<r.length;u++){var d=r[u];s+=d[0]*a,l-=d[1]*o,i[u]=t(d,s,l)}return i}function p(e,t,r){for(var i=new Array(r.length),n=0;n<r.length;n++)i[n]=d(e,t,r[n]);return i}function f(e,t,r,i){return d(e,r?i?E:T:i?T:C,t)}function m(e,t,r,i){return p(e,r?i?E:T:i?T:C,t)}function g(e,t,r,i){return p(e,r?i?E:T:i?T:C,t)}function v(e,t,r){for(var i=r[0],n=i[0],a=i[1],o=Math.min(n,t[0]),s=Math.min(a,t[1]),l=Math.max(n,t[2]),u=Math.max(a,t[3]),c=1;c<r.length;c++){var h=r[c],d=h[0],p=h[1];n+=d,a+=p,d<0&&(o=Math.min(o,n)),d>0&&(l=Math.max(l,n)),p<0?s=Math.min(s,a):p>0&&(u=Math.max(u,a))}return e[0]=o,e[1]=s,e[2]=l,e[3]=u,e}function y(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)v(e,e,t[r]);return e}function b(e,t,r,i,o){return t.xmin=n(e,r.xmin),t.ymin=a(e,r.ymin),t.xmax=n(e,r.xmax),t.ymax=a(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),o&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function _(e,t,r,i,n){return t.points=s(e,r.points,i,n),t}function x(e,t,r,i,o){return t.x=n(e,r.x),t.y=a(e,r.y),t!==r&&(i&&(t.z=r.z),o&&(t.m=r.m)),t}function w(e,t,r,i,n){var a=l(e,r.rings,i,n);return a?(t.rings=a,t):null}function S(e,t,r,i,n){var a=u(e,r.paths,i,n);return a?(t.paths=a,t):null}Object.defineProperty(t,"__esModule",{value:!0});var C=function(e,t,r){return[t,r]},T=function(e,t,r){return[t,r,e[2]]},E=function(e,t,r){return[t,r,e[2],e[3]]};t.toTransform=function(e){return e?{originPosition:"upperLeft",scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(i(e)?(r=e.translate[0],n=e.translate[1],a=e.scale[0]):(r=e.extent.xmin,n=e.extent.ymax,a=e.tolerance),i(t)?(o=t.translate[0],s=t.translate[1],l=t.scale[0]):(o=t.extent.xmin,s=t.extent.ymax,l=t.tolerance),r===o&&n===s&&a===l);var r,n,a,o,s,l},t.quantizeX=n,t.quantizeY=a,t.quantizeBounds=function(e,t,r){return t[0]=n(e,r[0]),t[3]=a(e,r[1]),t[2]=n(e,r[2]),t[1]=a(e,r[3]),t},t.quantizePoints=s,t.quantizeRings=l,t.quantizePaths=u,t.hydrateX=c,t.hydrateY=h,t.hydrateCoordsArray=d,t.hydrateCoordsArrayArray=p,t.hydrateBounds=function(e,t,r){return r?(t[0]=c(e,r[0]),t[1]=h(e,r[3]),t[2]=c(e,r[2]),t[3]=h(e,r[1]),t):[c(e,t[0]),h(e,t[3]),c(e,t[2]),h(e,t[1])]},t.hydratePoints=f,t.hydratePaths=m,t.hydrateRings=g,t.getQuantizedBoundsCoordsArray=v,t.getQuantizedBoundsCoordsArrayArray=y,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return v(t,t,e)},t.getQuantizedBoundsPaths=function(e){return y([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return y([0,0,0,0],e)},t.quantizeExtent=b,t.quantizeMultipoint=_,t.quantizePoint=x,t.quantizePolygon=w,t.quantizePolyline=S,t.quantizeGeometry=function(e,t){return e&&t?r.isPoint(t)?x(e,{},t,!1,!1):r.isPolyline(t)?S(e,{},t,!1,!1):r.isPolygon(t)?w(e,{},t,!1,!1):r.isMultipoint(t)?_(e,{},t,!1,!1):r.isExtent(t)?b(e,{},t,!1,!1):null:null},t.hydrateExtent=function(e,t,r,i,n){return t.xmin=c(e,r.xmin),t.ymin=h(e,r.ymin),t.xmax=c(e,r.xmax),t.ymax=h(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,i,n){return t.points=f(e,r.points,i,n),t},t.hydratePoint=function(e,t,r,i,n){return t.x=c(e,r.x),t.y=h(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,i,n){return t.rings=g(e,r.rings,i,n),t},t.hydratePolyline=function(e,t,r,i,n){return t.paths=m(e,r.paths,i,n),t}}.apply(null,i))||(e.exports=n)},1622:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(262),r(38),r(1642),r(1572),r(1561),r(1668),r(1669),r(1670),r(1671),r(1672),r(1673),r(1674),r(1667),r(1675),r(1676),r(1677),r(1559),r(1678),r(1693),r(1615),r(1564),r(1698),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E){function P(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return a.generateVisibleIndexRanges(t,r)}function O(e,t,r){var n=e.origin.vec3;y.setMatrixTranslation3(j,-n[0],-n[1],-n[2]),i.mat4.multiply(t,j,e.transformation),i.mat4.invert(r,t),i.mat4.transpose(r,r)}function R(e,t,r){for(var i in e){var n=e[i];t(i,n),n.origin2data.forEach(function(e,t){r(t,e)})}}function A(e){return M(e.data)>=1}function M(e){return!1===e.preinterleaved?y.getFirstObjectValue(e.indices).length:e.indexCount}var I=i.mat4f64.create(),D=1535,F=function(){function e(e,t,r,i,n){this._lighting=new _.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._renderContext=new f,this._isRendering=!1,this._highlights=[],this._threshold=D,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new L,this._edgeView=null,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=n,this._rctx=i,this._fxaaPass=new l(i),this._smaaPass=new g(i),this._renderContext.rctx=i,this._renderContext.lightingData=this._lighting.getOld(),i.setDepthTestEnabled(!0),i.setFaceCullingEnabled(!0),i.setBlendingEnabled(!1),i.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._linearDepthTextureHelper=new d(i),this._normalTextureHelper=new p(i),this._highlightTextureHelper=new u(i),this._stencilRenderingHelper=new v(i),this._renderPlugins=new m.RenderPluginManager({rctx:i,gl:i.gl,programRep:e,textureRep:r,materialRep:t}),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,r=new C(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:r}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},r=function(e,t){t.type===V.Preinterleaved?t.instances.forEach(function(e){return e.vao.dispose(!0)}):t.vao.dispose(!0)};R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return null==this._edgeView&&(this._edgeView=new b.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},r=function(t,r){r.type===V.Preinterleaved?r.instances.forEach(function(t){var r=t.vao.size;e._stats.VBOallocatedSize+=r/4,e._stats.VBOusedSize+=r/4,e._stats.VBOoptimalSize+=r/4}):(e._stats.VBOallocatedSize+=r.buffer.getArray().length,e._stats.VBOusedSize+=r.buffer.getSize(),e._stats.VBOoptimalSize+=r.optimalCount)};return R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;case"normals":return this._normalTextureHelper.framebuffer.colorTexture}return null},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,r=x.shouldRenderVisibilityDuringRenderPass(e.pass),i=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,n=!1;return r&&i&&e.offscreenRenderingHelper.renderHUDVisibility(function(){n=t._renderInternalSlot(14,e)}),n},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(1,e),this._renderInternalSlot(2,e),this._renderPlugins.render(3,e),this._renderInternalSlot(4,e),this._renderPlugins.render(5,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(16,this._renderContext),this._renderInternalSlot(6,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(21,this._renderContext)),this._renderPlugins.render(7,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(8,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(22,this._renderContext),this._renderInternalSlot(19,this._renderContext),this._renderInternalSlot(20,this._renderContext)},e.prototype._renderHighlights=function(e,t){if(t&&t.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var r=null;t.profilingCallback&&(r=S.startMeasurement(this._renderContext.rctx));var i=e.camera,n=e.fbo;this._highlightTextureHelper.prepareHighlightPass(i),this.renderGeometryPass(4,e,null,null,this._renderContext.sliceHelper);var a=this._rctx.gl;this._rctx.clear(a.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(n);var o=this._highlightTextureHelper.framebuffer;t.render(e,o),null!==r&&t.profilingCallback&&r.stop(function(e){t.profilingCallback&&t.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var r=this._mat2DataInstanced[t][0];if(r&&r.renderOccluded&&r.beginSlot(e)&&r.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,r){if(t&&r&&r.enabled){var i=this._needsRenderOccluded(4)||this._needsRenderOccluded(6)||this._needsRenderOccluded(9);if(t.enabled=i,i){var n=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),n.pass=0,n.renderOccludedOnly=!0,this._renderInternalSlot(4,n),this._renderInternalSlot(6,n),this._renderInternalSlot(9,n),n.renderOccludedOnly=!1,t.finish(r.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,r){var i=this,n=this._rctx;this._isRendering=!0,this._stats.reset();var a=e.camera,o=e.fbo,s=e.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=0,this._renderContext.camera=a,this._renderContext.pixelRatio=s,this._renderContext.shadowMap=t,this._renderContext.sliceHelper=r.slice,this._renderContext.ssaoHelper=r.ssao,this._renderContext.offscreenRenderingHelper=r.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,r.offscreenRendering.enabled=!0,r.offscreenRendering.initializeFrame(a,o),this._renderPlugins.render(0,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&r.offscreenRendering.renderSeparateAndComposite(function(){i._edgeView.render(i._bindParameters)},void 0,"alpha");var l={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(l.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(21,this._renderContext)),l.transparentTerrain=this.renderTransparentTerrain(this._renderContext),l.transparentTerrain&&l.hudVisibility&&(r.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),r.offscreenRendering.renderToTargets(function(){return i.renderHUD("occluded")},r.offscreenRendering.mainColor,r.offscreenRendering.tmpDepth,void 0,!0)),l.transparentTerrain&&r.offscreenRendering.compositeTransparentTerrainOntoMain(),r.offscreenRendering.renderToTargets(function(){i._renderInternalSlot(9,i._renderContext),i._renderPlugins.render(17,i._renderContext),i._renderPlugins.render(18,i._renderContext),i._renderOccluded(a,r.renderOccluded,r.offscreenRendering),r.slice&&r.slice.isEnabled&&(i._renderInternalSlot(10,i._renderContext),i._renderInternalSlot(11,i._renderContext),i._renderInternalSlot(12,i._renderContext),i._renderInternalSlot(13,i._renderContext))},r.offscreenRendering.mainColor,r.offscreenRendering.mainDepth);var u=this.renderOptions.antialiasing;"smaa"===u&&this._smaaPass.loadResources(function(){i._needsRender=!0}),"smaa"===u&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):"fxaa"===u&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):(r.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),n.bindFramebuffer(o),this._renderContext.framebufferTex=r.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,r.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights()},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,r=0;r<this._renderOrder.length;r++){var i,n,a=this._renderOrder[r][1];if(a.instanced)(n=(i=a.instanced||a.merged)[e.pass])&&n.isVisible()&&(this._renderInternalInstanced(i,n,this._bindParameters,1/0),t=null);if(a.merged)if((n=(i=a.merged)[e.pass])&&n.isVisible()){var o=n.getProgram();o!==t&&(o.setUniformMatrix4fv("model",I),o.hasUniform("modelNormal")&&o.setUniformMatrix4fv("modelNormal",I)),t=o,this._renderInternalMerged(i,n,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,N[0]=t.near,N[1]=t.far,this._bindParameters.nearFar=N,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t){this._orderedRendering?this._renderOrdered(0,e):this._renderUnordered(e,t.shadowMap,t)},e.prototype.renderAuxiliaryBuffers=function(e,t){var r=t.ssao,i=t.slice,n=t.shadowMap,a=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),o=e.camera,s=e.fbo;this._linearDepthTextureHelper.enabled=a,a&&(this._linearDepthTextureHelper.setupFBOs(o),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(1,e,n,r,i),this._linearDepthTextureHelper.finish(s)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(o),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(2,e,n,r,i),this._normalTextureHelper.finish(s),r.computeSSAO(o,s,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer)),r.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,r,i,n){this._isRendering=!0;var a=t.camera,o=t.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=a,this._renderContext.pixelRatio=o,this._renderContext.shadowMap=r,this._renderContext.ssaoHelper=i,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.sliceHelper=n,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e){void 0===e&&(e=null);for(var t=!1,r=0;r<this._highlights.length;++r){var i=this._highlights[r],n=i.matData[4];n&&(null===e||n.beginSlot(e))&&n.isVisible()&&(t=this._renderInternalHighlight(i,this._bindParameters,4)||t)}return t},e.prototype._renderInternalSlotOccluded=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){var n=this._mat2DataInstanced[i],a=n[t.pass];a&&a.renderOccluded&&a.beginSlot(e)&&a.isVisible()&&(r=this._renderInternalInstanced(n,a,this._bindParameters,e)||r)}return r},e.prototype._renderInternalSlotMaterial=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){(u=(l=this._mat2DataInstanced[i])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalInstanced(l,u,this._bindParameters,e)||r)}for(var n=this._programRep.getProgramsUsingUniform("model"),a=this._programRep.getProgramsUsingUniform("modelNormal"),o=0;o<n.length;o++){var s=n[o];s.setUniformMatrix4fv("model",I),a.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",I)}for(var i in this._mat2DataMerged){(u=(l=this._mat2DataMerged[i])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalMerged(l,u,this._bindParameters,e)||r)}for(var i in this._mat2DataPreinterleaved){var l,u;(u=(l=this._mat2DataPreinterleaved[i])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalPreinterleaved(l,u,this._bindParameters,e)||r)}return 2===e&&this._stencilRenderingHelper.finish(),r},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,N[0]=t.camera.near,N[1]=t.camera.far;var r=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=N,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=r?r.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=r?r.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=t.getDrawMode(),u=a.capabilities.instancing,c=!1;return e.origin2data.forEach(function(e){r.origin=e.origin,2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass());var h=!1;if(t.instanced)for(var d in e.perGeometryDataInfo){var p=e.perGeometryDataInfo[d];s||(t.bind(a,r),s=!0),a.bindVAO(p.vao);var f=t.getProgram();T.assertCompatibleVertexAttributeLocations(p.vao,f),h||(t.bindView(a,r),h=!0);var m=p.to-p.from,g=p.refCount;l===o.TRIANGLES&&(n._stats.trianglesRendered+=g*m/3),u.drawArraysInstanced(l,p.from,m,g),c=!0,n._stats.drawCallsAngleInstanced++,n._stats.instancesDrawnAngle+=g}else e.instances.forEach(function(i){var u=i.displayedIndexRange;u&&0===u.length||(s||(t.bind(a,r),s=!0),h||(a.bindVAO(e.vao),t.bindView(a,r),h=!0),t.bindInstance(a,i),n._stats.drawCallsInstanced++,l===o.TRIANGLES&&(n._stats.trianglesRendered+=(i.to-i.from)/3),u?n._drawArraysFaceRange(u,i.from,l):a.drawArrays(l,i.from,i.to-i.from),c=!0)})}),a.bindVAO(null),s&&t.release(a,r),c},e.prototype._renderInternalHighlight=function(e,t,r){var i=this._rctx,n=i.gl,a=e.matData[r],o=a.getDrawMode(),s=e.instance,l=s.highlightedIndexRange,u=this._renderContext.offscreenRenderingHelper,c=(u?u.depthTexture:null)||this._getFallbackDepthTexture(),h=a.getProgram(),d=i.capabilities.instancing;t.origin=e.originData.origin;var p=!1;if(a.instanced&&e.type===V.Instanced){var f=e.instancedVAO;a.bind(i,t),i.bindVAO(f),T.assertCompatibleVertexAttributeLocations(f,h),a.bindView(i,t);for(var m=0;m<l.length;m++){var g=(_=l[m]).range?_.range[0]+s.from:s.from,v=_.range?_.range[1]-_.range[0]+1:s.to-s.from;i.bindTexture(c,5),h.setUniform1i("depthTex",5),h.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),d.drawArraysInstanced(o,g,v,1),o===n.TRIANGLES&&(this._stats.trianglesRendered+=1*v/3),this._stats.drawCallsHighlight++,p=!0}}else if(e.type===V.Instanced&&a.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{a.bind(i,t),a.bindView(i,t);var y=null;switch(e.type){case V.Merged:var b=e.originData;i.bindVAO(b.vao),h.setUniformMatrix4fv("model",I);break;case V.Instanced:b=e.originData;i.bindVAO(b.vao),a.bindInstance(i,s);break;case V.Preinterleaved:f=(b=e.originData).instances.get(e.uniqueName).vao;i.bindVAO(f),a.bindInstance(i,s),y=f.indexBuffer&&f.indexBuffer.indexType}for(m=0;m<l.length;m++){var _;g=(_=l[m]).range?_.range[0]+s.from:s.from,v=_.range?_.range[1]-_.range[0]+1:s.to-s.from;if(i.bindTexture(c,5),a.getProgram().setUniform1i("depthTex",5),h.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),y){var x=T.getBytesPerElement(y);i.drawElements(o,v,y,g*x)}else i.drawArrays(o,g,v);o===n.TRIANGLES&&(this._stats.trianglesRendered+=v/3),this._stats.drawCallsHighlight++,p=!0}}return i.bindVAO(null),a.release(i,t),p},e.prototype._drawArraysFaceRange=function(e,t,r){for(var i=this._rctx,n=0,a=e;n<a.length;n++){var o=a[n];i.drawArrays(r,o[0]+t,o[1]-o[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,r,i){for(var n=this._rctx,a=T.getBytesPerElement(i),o=0,s=e;o<s.length;o++){var l=s[o],u=l[1]-l[0]+1,c=l[0]+t;n.drawElements(r,u,i,c*a)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=!1;return e.origin2data.forEach(function(e){if(r.origin=e.origin,2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){l||(t.bind(a,r),l=!0);var u=t.getProgram();a.bindVAO(e.vao),T.assertCompatibleVertexAttributeLocations(e.vao,u),t.bindView(a,r),n._stats.drawCallsMerged++;var c=t.getDrawMode();c===o.TRIANGLES&&(n._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?n._drawArraysFaceRange(e.displayedIndexRange,0,c):a.drawArrays(c,0,T.vertexCount(e.vao,"geometry")),s=!0}}),l&&t.release(a,r),s},e.prototype._renderInternalPreinterleaved=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,l=!1,u=t.getDrawMode();return e.origin2data.forEach(function(e){r.origin=e.origin;var c=!1;2===i&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),e.instances.forEach(function(e){var i=e.instance,h=e.vao,d=i.displayedIndexRange;if(!d||0!==d.length){l||(t.bind(a,r),l=!0);var p=t.getProgram();T.assertCompatibleVertexAttributeLocations(h,p),a.bindVAO(h),c||(t.bindView(a,r),c=!0),t.bindInstance(a,i),n._stats.drawCallsPreinterleaved++,u===o.TRIANGLES&&(n._stats.trianglesRendered+=(i.to-i.from)/3);var f=h.indexBuffer&&h.indexBuffer.indexType;if(d)f?n._drawElementsFaceRange(d,i.from,u,f):n._drawArraysFaceRange(d,i.from,u);else if(f){var m=T.getBytesPerElement(f);a.drawElements(u,i.to-i.from,f,i.from*m)}else a.drawArrays(u,i.from,i.to-i.from);s=!0}})}),a.bindVAO(null),l&&t.release(a,r),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,r=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+r);var i=0;R(this._mat2DataMerged,function(){},function(e,t){i+=t.instances.size});var n=0;R(this._mat2DataInstanced,function(){},function(e,t){n+=t.instances.size});var a=0;R(this._mat2DataPreinterleaved,function(){},function(e,t){a+=t.instances.size}),console.log("number of instances (merged/instanced/preinterleaved): "+i+"/"+n+"/"+a)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!r.everyMap(t.origin2data,function(e){return 0===e.instances.size}))return!1}return!0},e.prototype.modify=function(e,t,r,i){this._isRendering&&console.warn("Renderer.modify called while rendering");var n=[],a=[],o=[];this._classifyRenderGeometry(e,n,a,o);var s=[],l=[],u=[];this._classifyRenderGeometry(t,s,l,u);var c={};r&&this._performUpdates(r,c);var h=[];this._modifyMerged(n,s,h,c),this._modifyInstanced(a,l,h),this._modifyPreinterleaved(o,u,h),this._updateMergedFaceranges(c),this._releaseMaterials(h);var d=this._highlights.length;t&&t.length>0&&d>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),d!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),i&&this._modifyMaterials(i),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,r,i){for(var n=0,a=e;n<a.length;n++){var o=a[n];if(A(o))switch(this._getType(o)){case V.Merged:t.push(o);break;case V.Instanced:r.push(o);break;case V.Preinterleaved:i.push(o)}}},e.prototype._performUpdates=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r],a=n.updateType,o=n.renderGeometry,s=this._getType(o)===V.Merged;if(A(o)){if(2&a&&this._updateFaceranges(o,t),32&a){var l=this._getInstance(o);l&&this._updateHighlightFaceranges(o,l.instance)}4&a||s&&16&a?this._updateVertexAttributes(o,!s):!s&&16&a&&this._updateInstanceTransformation(o)}}},e.prototype._updateFaceranges=function(e,t){var r,i,n=e.material.id,a=e.origin.id,o=this._getType(e);o===V.Preinterleaved?r=(i=this._getOriginData(o,n,a)).instances.get(e.uniqueName).instance:(r=(i=this._getOriginData(o,n,a)).instances.get(e.uniqueName))&&o===V.Merged&&(t[this._modifiedMergedFacerangesKey(n,a)]=i);r&&(r.displayedIndexRange=P(e),this._updateHighlightFaceranges(e,r))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var r=t.highlightedIndexRange,i=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,i=e.componentOffsets;return a.generateHighlightedIndexRanges(t,r,i)}(e);t.highlightedIndexRange=i,i&&!r?this._addHighlight(e):!i&&r&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e)!function(t){var r=e[t];r.displayedIndexRange=[];var i=!0;r.instances.forEach(function(e){e.displayedIndexRange?(r.displayedIndexRange.push.apply(r.displayedIndexRange,h.offsetIntervals(e.displayedIndexRange,e.from)),i=!1):r.displayedIndexRange.push([e.from,e.to-1])}),r.displayedIndexRange=i?null:h.mergeIntervals(r.displayedIndexRange)}(t)},e.prototype._updateVertexAttributes=function(e,t){var r=e.material,i=r.bufferWriter,n=r.id,a=e.origin.id,o=i.vertexBufferLayout.stride/4,s=this._getType(e);if(s!==V.Preinterleaved){var l,u,c=this._getOriginData(s,n,a),h=c.instances.get(e.uniqueName),d=c.buffer.getArray(),p=c.vao;t||(O(e,G,z),l=G,u=z),i.write({transformation:l,invTranspTransformation:u},e.data,e.instanceParameters,i.vertexBufferLayout.createView(d.buffer),h.from),y.assert(h.from+i.elementCount(e.data)===h.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(d,h.from*o*4,h.from*o*4,h.to*o*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),r=e.material.id,i=e.origin.id;if(t===V.Preinterleaved){O(e,(a=(n=this._getOriginData(t,r,i)).instances.get(e.uniqueName).instance).transformation,a.transformationNormal)}else{var n,a=(n=this._getOriginData(t,r,i)).instances.get(e.uniqueName),o=n.perGeometryDataInfo[e.data.id],s=o.instanceBufferData;if(O(e,a.transformation,a.transformationNormal),s){var l=s.getSlot(e.idx);s.fill(l,0,a.transformation),s.fill(l,16,a.transformationNormal);var u=4*s.getOffset(l),c=T.getStride(o.vao.layout.instance);o.vao.vertexBuffers.instance.setSubData(s.getArray(),u,u,u+c)}}},e.prototype._modifyMerged=function(e,t,r,i){var n=this._compMatToDelta(e,t,V.Merged),a=this._mat2DataMerged;for(var o in n){var s=n[o];for(var l in s){var u=s[l],c=u.optimalCount,h=u.sparseCount,d=u.material,p=d.bufferWriter.vertexBufferLayout,f=p.stride/4,m=a[o];null==m&&(y.assert(c>0),m=this._initializeMatData(d),a[o]=m,this._orderedRendering&&this._insertIntoRenderOrder(m,d.renderPriority,"merged"));var g=m.origin2data.get(l);if(null==g&&(y.assert(c>0),g=this._createMergedData(p,c,u.origin),m.origin2data.set(l,g)),0===c)g.vao.dispose(!0),g.vao=null,m.origin2data.delete(l),0===m.origin2data.size&&(r.push(o),delete a[o],this._orderedRendering&&this._removeFromRenderOrder(m,"merged"));else{var v=c<u.sparseCount/2,b=v?c:h,_=B,x=g.buffer.getSize(),w=g.buffer.getArray(),S=g.buffer.resize(b);v||S?this._rebuildMerged(g,u.toRemove,f,w,_):u.toRemove.length>0?(this._removeMergedByErasing(g,u.toRemove,f,_),u.toAdd.length>0&&(_.end=x)):(_.begin=x,_.end=x);var C=j;y.setMatrixTranslation3(C,-u.origin[0],-u.origin[1],-u.origin[2]),this._appendMerged(g,d,u.toAdd,f,C,_);var T=g.vao.vertexBuffers.geometry;if(T.byteSize!==g.buffer.getArray().buffer.byteLength)T.setData(g.buffer.getArray());else{var E=_.begin,P=_.end;if(E<P){var O=g.buffer.getArray(),R=4*E,A=4*P;T.setSubData(O,R,R,A)}}(_.updatedDisplayedIndexRange||g.displayedIndexRange)&&(i[this._modifiedMergedFacerangesKey(o,l)]=g)}}}},e.prototype._createMergedData=function(e,t,r){return{type:V.Merged,instances:new Map,vao:new E(this._rctx,o.Default3D,{geometry:n.glLayout(e)},{geometry:w.createVertex(this._rctx,35044)}),buffer:new s(t),optimalCount:0,origin:r}},e.prototype._rebuildMerged=function(e,t,r,i,n){for(var a=0;a<t.length;++a){var o=e.instances.get(t[a].uniqueName);e.optimalCount-=(o.to-o.from)*r,e.instances.delete(t[a].uniqueName)}var s=0,l=e.buffer.getArray();n.begin=0,n.end=0;var u=-1,c=-1,h=0;e.instances.forEach(function(e){var t=e.from*r,n=e.to*r,a=n-t;u!==c&&c!==t?(l.set(i.subarray(u,c),h),h+=c-u,u=t):-1===u&&(u=t),c=n,e.from=s/r,s+=a,e.to=s/r}),u!==c&&l.set(i.subarray(u,c),h),n.end=s},e.prototype._removeMergedByErasing=function(e,t,r,i){if(0!==t.length){i.begin=1/0,i.end=-1/0;for(var n=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,u=e.instances.get(l),c=u.from*r,h=u.to*r;n!==a&&a!==c?(e.buffer.erase(n,a),n=c):-1===n&&(n=c),a=h,e.instances.delete(l),e.optimalCount-=h-c,c<i.begin&&(i.begin=c),h>i.end&&(i.end=h)}n!==a&&e.buffer.erase(n,a)}},e.prototype._appendMerged=function(e,t,r,n,a,o){o.updatedDisplayedIndexRange=!1;for(var s=t.bufferWriter,l=0,u=r;l<u.length;l++){var c=u[l],h=c.data;i.mat4.multiply(G,a,c.transformation),i.mat4.invert(z,G),i.mat4.transpose(z,z);var d=o.end;s.write({transformation:G,invTranspTransformation:z},h,c.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),o.end/n);var p=s.elementCount(h)*n,f=d+p;y.assert(null==e.instances.get(c.uniqueName));var m=P(c),g=new U(c.name,d/n,f/n,m,void 0,void 0,c.idx);e.instances.set(c.uniqueName,g),this._updateHighlightFaceranges(c,g),m&&(o.updatedDisplayedIndexRange=!0),e.optimalCount+=p,o.end+=p}},e.prototype._modifyInstanced=function(e,t,r){var a=this._rctx,l=V.Instanced,u=this._compMatToDelta(e,t,l),h=this._mat2DataInstanced;for(var d in u){var p=u[d],f=this;for(var m in p)!function(e){var t=p[e];if(0===t.optimalCount){var u=h[d];return u.origin2data.get(e).vao.dispose(!0),u.origin2data.delete(e),0===u.origin2data.size&&(r.push(d),delete h[d],f._orderedRendering&&f._removeFromRenderOrder(u,"instanced")),"continue"}var m=t.material,g=m.bufferWriter,v=h[d];if(null==v){var b=m.renderPriority;v=f._initializeMatData(m),h[d]=v,f._orderedRendering&&f._insertIntoRenderOrder(v,b,"instanced")}var _=g.vertexBufferLayout,x=v[0].instanced?g.instanceBufferLayout:void 0,S=x&&x.fields.get("instanceColor"),C=x&&x.fields.get("instanceFeatureAttribute"),T=_.stride/4,O=v.origin2data.get(e);null==O&&(O={type:l,instances:new Map,vao:new E(a,o.Default3D,{geometry:n.glLayout(_)},{geometry:w.createVertex(a,35044)}),buffer:new s(t.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:t.origin},v.origin2data.set(e,O));var R=O.buffer.getSize(),A=O.buffer.getArray(),M=t.optimalCount<t.sparseCount/2,I=O.buffer.resize(M?t.optimalCount:t.sparseCount);for(var D in t.perGeometryDelta){if((Q=O.perGeometryDataInfo[D])&&Q.instanceBufferData){var F=t.perGeometryDelta[D].removeCount;F>0&&Q.instanceBufferData.prepareFree(F)}}var V=t.toRemove;if(M||I){for(var L=0;L<V.length;++L){var B=V[L];O.instances.delete(B.uniqueName);D=B.data.id;0==--(H=Q=O.perGeometryDataInfo[D]).refCount&&null==t.dataId2refCount[D]?(O.optimalCount-=(H.to-H.from)*T,delete O.perGeometryDataInfo[D]):Q.instanceBufferData&&Q.instanceBufferData.free(B.idx)}R=0;var N=O.buffer.getArray(),G={};for(var z in O.perGeometryDataInfo){var H=O.perGeometryDataInfo[z];y.assert(null==G[H.from]),G[H.from]=H}for(var k in G){var W=(H=G[k]).from*T,q=H.to*T;N.set(A.subarray(W,q),R),H.from=R/T,R+=q-W,H.to=R/T}O.instances.forEach(function(e){e.from=O.perGeometryDataInfo[e.dataId].from,e.to=O.perGeometryDataInfo[e.dataId].to})}else for(L=0;L<V.length;++L){B=V[L];O.instances.delete(B.uniqueName);D=B.data.id;if(0==--(Q=O.perGeometryDataInfo[D]).refCount&&null==t.dataId2refCount[D]){W=Q.from*T,q=Q.to*T;O.buffer.erase(W,q),O.optimalCount-=q-W,delete O.perGeometryDataInfo[D]}else Q.instanceBufferData&&Q.instanceBufferData.free(B.idx)}for(var D in y.setMatrixTranslation3(j,-t.origin[0],-t.origin[1],-t.origin[2]),t.perGeometryDelta){if((Q=O.perGeometryDataInfo[D])&&Q.instanceBufferData){var X=t.perGeometryDelta[D].addCount;X>0&&Q.instanceBufferData.prepareAllocate(X)}}var Y=t.toAdd;for(L=0;L<Y.length;++L){var Q,Z=(B=Y[L]).data;D=Z.id;if(null==(Q=O.perGeometryDataInfo[D])){g.write({},Z,void 0,g.vertexBufferLayout.createView(O.buffer.getArray().buffer),R/T);var K=g.elementCount(Z)*T;W=R/T,q=(R+=K)/T;if(O.optimalCount+=K,Q={refCount:1,from:W,to:q,vao:null,instanceBufferData:null},x){var J=x.stride/4;Q.vao=new E(a,o.Default3D,{geometry:n.glLayout(_),instance:n.glLayout(x,{divisor:1})},{geometry:O.vao.vertexBuffers.geometry,instance:w.createVertex(a,35044)}),Q.instanceBufferData=new c(J,t.perGeometryDelta[D].addCount)}O.perGeometryDataInfo[D]=Q}else++Q.refCount;y.assert(Q.from*T<=O.buffer.getSize()&&Q.to*T<=O.buffer.getSize());var $=i.mat4f64.create();i.mat4.multiply($,j,B.transformation);var ee=P(B),te=new U(B.name,Q.from,Q.to,ee,$,B.instanceParameters,B.idx,D);O.instances.set(B.uniqueName,te),f._updateHighlightFaceranges(B,te);var re=Q.instanceBufferData;if(re){var ie=re.allocate(B.idx);re.fill(ie,0,te.transformation),re.fill(ie,16,te.transformationNormal),S&&re.fill(ie,S.offset/4,B.instanceParameters.color),C&&re.fill(ie,C.offset/4,B.instanceParameters.featureAttribute)}}y.assert(O.optimalCount===t.optimalCount);var ne=new Float32Array(O.buffer.getArray().buffer,0,O.buffer.getSize());for(var D in O.vao.vertexBuffers.geometry.setData(ne),O.perGeometryDataInfo){var ae=O.perGeometryDataInfo[D];if(ae.vao){var oe=ae.vao.vertexBuffers.instance;if(oe){var se=t.perGeometryDelta[D];if(se.addCount+se.removeCount>0){var le=ae.instanceBufferData.compact();oe.setData(le)}}}}}(m)}},e.prototype._modifyPreinterleaved=function(e,t,r){for(var a=this._rctx,s=V.Preinterleaved,l=this._mat2DataPreinterleaved,u=0,c=e;u<c.length;u++){var h=(I=(M=c[u]).material).bufferWriter,d=I.id,p=M.origin.id,f=M.origin.vec3;null==(D=l[d])&&(D=this._initializeMatData(I),l[d]=D);var m=D.origin2data.get(p);null==m&&(m={type:s,origin:f,count:0,instances:new Map},D.origin2data.set(p,m)),y.setMatrixTranslation3(j,-f[0],-f[1],-f[2]);var g=i.mat4f64.create();i.mat4.multiply(g,j,M.transformation);var v=P(M),b=M.data;if(b.preinterleaved)if(null!=b.vertexData){var _=b.indexCount,x=b.id,S=new U(M.name,0,_,v,g,M.instanceParameters,M.idx,x),C=b.indexData?w.createIndex(a,35044,b.indexData):null,T=h.vertexBufferLayout,O=new E(a,o.Default3D,{geometry:n.glLayout(T)},{geometry:w.createVertex(a,35044)},C);O.vertexBuffers.geometry.setData(b.vertexData),b.indexData=null,b.vertexData=null,m.count+=1,m.instances.set(M.uniqueName,{instance:S,vao:O}),this._updateHighlightFaceranges(M,S)}else y.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else y.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var R=0,A=t;R<A.length;R++){var M,I,D,F=(M=A[R]).origin,L=(d=(I=M.material).id,p=F.id,M.uniqueName),B=(D=l[d]).origin2data.get(p);B.instances.get(L).vao.dispose(),B.instances.delete(L),B.count-=1,0===B.count&&D.origin2data.delete(p),0===D.origin2data.size&&(r.push(d),delete l[d])}},e.prototype._compMatToDelta=function(e,t,r){var i={};return this._updateMatToDelta(e,!0,r,i),this._updateMatToDelta(t,!1,r,i),i},e.prototype._updateMatToDelta=function(e,t,r,i){for(var n=r===V.Instanced,a=0,o=e;a<o.length;a++){var s=o[a],l=s.origin,u=s.material,c=u.bufferWriter,h=u.id,d=n?this._mat2DataInstanced[h]:this._mat2DataMerged[h],p=d&&d.origin2data.get(l.id),f=i[h];null==f&&(f={},i[h]=f);var m=f[l.id];if(null==m){if(m={optimalCount:null==p?0:p.optimalCount,sparseCount:null==p?0:p.buffer.getSize(),material:u,toAdd:[],toRemove:[],perGeometryDelta:null,origin:l.vec3},n){var g={};if(void 0!==p)for(var v in p.perGeometryDataInfo)g[v]=p.perGeometryDataInfo[v].refCount;m.dataId2refCount=g,m.perGeometryDelta={}}f[l.id]=m}var y=c.vertexBufferLayout.stride/4,b=c.elementCount(s.data)*y;if(n){var _=s.data.id,x=m.perGeometryDelta[_];x||(x={addCount:0,removeCount:0},m.perGeometryDelta[_]=x),t?(x.addCount++,null==m.dataId2refCount[_]&&(m.dataId2refCount[_]=0),1==++m.dataId2refCount[_]&&(m.optimalCount+=b,m.sparseCount+=b),m.toAdd.push(s)):(x.removeCount++,0==--m.dataId2refCount[_]&&(delete m.dataId2refCount[_],m.optimalCount-=b),m.toRemove.push(s))}else t?(m.optimalCount+=b,m.sparseCount+=b,m.toAdd.push(s)):(m.optimalCount-=b,m.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return V.Preinterleaved;var t=!1,r=M(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||r>this._threshold),t?V.Instanced:V.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case V.Merged:return this._mat2DataMerged;case V.Instanced:return this._mat2DataInstanced;case V.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,r){return this._getTargetMat2Data(e)[t].origin2data.get(r)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,r){for(var i=e[0].materialId,n=this._renderOrder.length,a=0;a<n&&this._renderOrder[a][0]>=t;){var o=this._renderOrder[a][1];if(o.id===i)return y.assert(!o[r],"matData for type already exists"),void(o[r]=e);a++}var s={id:i,instanced:null,merged:null};s[r]=e,this._renderOrder.splice(a,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var r=e[0].materialId,i=0;this._renderOrder[i][1].id!==r;)i++;var n=this._renderOrder[i][1];n[t]=null,n.instanced||n.merged||this._renderOrder.splice(i,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var r=e.matData[0].renderPriority,i=t.matData[0].renderPriority;return r>i?-1:i>r?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var r=t.length,i=0;i<r&&t[i][1].id!==e;)i++;if(i<r){var n=t[i][1],a=(n.merged||n.instanced)[0].renderPriority,o=t[i][0];if(a!==t[i][0]){t[i][0]=a;var s=a>o?-1:1;for(i+=s;i>-1&&i<r&&s*t[i][0]>s*a;){var l=t[i];t[i]=t[i-s],t[i-s]=l,i+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[0]=this._materialRep.aquire(e),t[3]=this._materialRep.aquireDepthShadowMap(e),t[2]=this._materialRep.aquireNormal(e),t[1]=this._materialRep.aquireDepth(e),t[4]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,r=0;r<t.length;r++)this._materialRep.release(t[r]),this._materialRep.releaseDepthShadowMap(t[r]),this._materialRep.releaseNormal(t[r]),this._materialRep.releaseDepth(t[r]),this._materialRep.releaseHighlight(t[r]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,r=e.uniqueName,i=t.id,n=this._getType(e),a=this._getTargetMat2Data(n),o=e.origin.id,s=a[i];if(!s)return null;var l,u=s.origin2data.get(o);return u?(l=u.type===V.Preinterleaved?u.instances.get(r).instance:u.instances.get(r))?{type:n,uniqueName:r,instance:l,matData:s,originData:u,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,r=e.instance,i=e.originData;if(e.type===V.Instanced&&i.perGeometryDataInfo){var n=i.perGeometryDataInfo[r.dataId],a=n.instanceBufferData;if(a){var o=n.vao,s=a.getSlot(r.idx);if(e.instancedVAOBaseInstance!==s){var l=T.setBaseInstanceOffset(o.layout,s);e.instancedVAO=new E(t,o.locations,l,o.vertexBuffers,o.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}();!function(e){var t=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}();e.RenderStats=t}(F||(F={}));var V,L=F.RenderStats,U=function(){return function(e,t,r,n,a,o,s,l){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=n,this.transformation=a,this.instanceParameters=o,this.idx=s,this.dataId=l,null!=a&&(this.transformationNormal=i.mat4f64.create(),i.mat4.copy(this.transformationNormal,a),i.mat4.invert(this.transformationNormal,this.transformationNormal),i.mat4.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(V||(V={}));var B={updatedDisplayedIndexRange:!1,begin:0,end:0},N=i.vec2f64.create(),j=i.mat4f64.create(),G=i.mat4f64.create(),z=i.mat4f64.create();return F}.apply(null,i))||(e.exports=n)},1623:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,i=-e[0],n=-e[1],a=-e[2],o=r[3],s=r[7],l=r[11],u=r[15];r[0]+=o*i,r[1]+=o*n,r[2]+=o*a,r[4]+=s*i,r[5]+=s*n,r[6]+=s*a,r[8]+=l*i,r[9]+=l*n,r[10]+=l*a,r[12]+=u*i,r[13]+=u*n,r[14]+=u*a},t.applyToViewMatrix=function(e,t){var r=t,i=e[0],n=e[1],a=e[2];r[12]+=i*r[0]+n*r[4]+a*r[8],r[13]+=i*r[1]+n*r[5]+a*r[9],r[14]+=i*r[2]+n*r[6]+a*r[10],r[14]+=i*r[3]+n*r[7]+a*r[11]}}.apply(null,i))||(e.exports=n)},1624:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1571)],void 0===(n=function(e,t,r){var i=r.boundedPlane.create();return function(){function e(){this._worldPlane=i}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.plane!==i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||i},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1625:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(265)],void 0===(n=function(e,t,r,i){function n(e){return null!==e&&void 0!==e}function a(e){return"number"==typeof e}function o(e){return"string"==typeof e}function s(e,t){e&&e.push(t),u(t)}function l(e){w&&console.warn("[FastSymbolUpdates] "+e)}function u(e){w&&console.info("[FastSymbolUpdates] "+e)}function c(e,t,r,o,l){var u=e.minSize,c=e.maxSize;if(e.expression)return s(l,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var d=o.symbolSize[r];return t.minSize[r]=d,t.maxSize[r]=d,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(n(e.field))return n(e.stops)?2===e.stops.length&&a(e.stops[0].size)&&a(e.stops[1].size)?(h(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(s(l,"Could not convert size info: stops only supported with 2 elements"),!1):a(u)&&a(c)&&n(e.minDataValue)&&n(e.maxDataValue)?(h(u,c,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=i.meterIn[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/i.meterIn[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(s(l,"Could not convert size info: proportional size not supported"),!1):(s(l,"Could not convert size info: scale-dependent size not supported"),!1);if(!n(e.field)){if(e.stops&&e.stops[0]&&a(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(a(u))return t.minSize[r]=u,t.maxSize[r]=u,t.offset[r]=u,t.factor[r]=0,t.type[r]=1,!0}return s(l,"Could not convert size info: unsupported variant of sizeInfo"),!1}function h(e,t,r,i,n,a){var o=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[a]=o>0?e:t,n.maxSize[a]=o>0?t:e,n.offset[a]=e-r*o,n.factor[a]=o}function d(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return s(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||o(e)}(e.field))return s(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return s(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var n;switch(e.axis){case"width":return(n=c(e,t.size,0,r,i))?t:null;case"height":return(n=c(e,t.size,2,r,i))?t:null;case"depth":return(n=c(e,t.size,1,r,i))?t:null;case"width-and-depth":return(n=c(e,t.size,0,r,i))&&c(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return(n=(n=(n=c(e,t.size,0,r,i))&&c(e,t.size,1,r,i))&&c(e,t.size,2,r,i))?t:null;default:return s(i,'Could not convert size info: unknown axis "'+e.axis+'""'),null}}function p(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function f(e,t,r){if(e.normalizationField)return s(r,"Could not convert color info: unsupported property"),null;if(o(e.field)){if(!e.stops)return s(r,"Could not convert color info: missing stops or colors"),null;if(e.stops.length>8)return s(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.color.values[n]=a.value,p(t.color.colors,n,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return s(r,"Could not convert color info: no field and no colors/stops"),null;var l=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(n=0;n<8;n++)t.color.values[n]=1/0,p(t.color.colors,n,l)}return t}function m(e,t,r,i){var n=2===r&&"arithmetic"===e.rotationType;t.offset[r]=n?90:0,t.factor[r]=n?-1:1,t.type[r]=1}function g(e,t,r){if(!o(e.field))return s(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return s(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return m(e,t.rotation,0),t;case"roll":return m(e,t.rotation,1),t;case null:case void 0:case"heading":return m(e,t.rotation,2),t;default:return s(r,'Could not convert rotation info: unknown axis "'+e.axis+'""'),null}}function v(e,t,r){if(!e)return null;var i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation;w&&(r=r||[]);var o=e.reduce(function(e,o){if(!e)return e;if(o.valueExpression)return s(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return i?d(o,e,t,r):e;case"color":return n?f(o,e,r):e;case"rotation":return a?g(o,e,r):e;default:return s(r,"Could not convert visual variables: unsupported type "+o.type),null}},{size:null,color:null,rotation:null});return o&&o.size&&!function(e,t,r){for(var i=0;i<3;++i){var n=t.unitInMeters;1===e.type[i]&&(n*=t.modelSize[i],e.type[i]=2),e.minSize[i]=e.minSize[i]/n,e.maxSize[i]=e.maxSize[i]/n,e.offset[i]=e.offset[i]/n,e.factor[i]=e.factor[i]/n}var a;if(0!==e.type[0])a=0;else if(0!==e.type[1])a=1;else{if(0===e.type[2])return s(r,"No size axis contains a valid size or scale"),!1;a=2}for(i=0;i<3;++i)0===e.type[i]&&(e.minSize[i]=e.minSize[a],e.maxSize[i]=e.maxSize[a],e.offset[i]=e.offset[a],e.factor[i]=e.factor[a],e.type[i]=e.type[a]);return!0}(o.size,t,r)?null:o}function y(e){return e&&null!=e.size}function b(e,t,r){if(!!e!=!!t)return l("State update failed ({$name} enabled/disabled)"),!1;if(e&&e.field!==t.field)return l("State update failed ({$name} field changed)"),!1;if(e&&"rotation"===r)for(var i=e,n=t,a=0;a<3;a++)if(i.type[a]!==n.type[a]||i.offset[a]!==n.offset[a]||i.factor[a]!==n.factor[a])return!1;return!0}function _(e,t){var r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},i=y(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotation=t.transformation.rotation),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),r}Object.defineProperty(t,"__esModule",{value:!0});var x,w=!1,S=!1;t.convertVisualVariables=v,t.initFastSymbolUpdatesState=function(e,t){if(S)return l("State not initialized, fast updates disabled (globally disabled)"),{enabled:!1};if(!e)return l("State not initialized, fast updates disabled (no renderer)"),{enabled:!1};if(e.disableFastUpdates)return l("State not initialized, fast updates disabled (renderer.disableFastUpdates set)"),{enabled:!1};var r=v(e.visualVariables,t);return r?(u("State initialized, fast updates enabled"),{enabled:!0,visualVariables:r,materialParameters:_(r,t),requiresShaderTransformation:y(r)}):(l("State not initialized, fast updates disabled (conversion failed)"),{enabled:!1})},t.updateFastSymbolUpdatesState=function(e,t,r){if(!t||!e.enabled)return!1;var i=e.visualVariables,n=v(t.visualVariables,r);return n?!!(b(i.size,n.size,"size")&&b(i.color,n.color,"color")&&b(i.rotation,n.rotation,"rotation"))&&(e.visualVariables=n,e.materialParameters=_(n,r),e.requiresShaderTransformation=y(n),u("State updated"),!0):(l("State update failed (conversion failed)"),!1)},t.getMaterialParams=_,function(e){function t(e,t,r){return e<t?t:e>r?r:e}var i=r.mat4f64.create(),n=r.vec3f64.create();e.evaluateModelTransform=function(e,a,o){if(!e.vvSizeEnabled)return o;r.mat4.copy(i,o),function(e,t,i,n){void 0===n&&(n=r.mat4f64.create());var a=e||0,o=t||0,s=i||0;0!==a&&r.mat4.rotateZ(n,n,-a/180*Math.PI),0!==o&&r.mat4.rotateX(n,n,o/180*Math.PI),0!==s&&r.mat4.rotateY(n,n,s/180*Math.PI)}(e.vvSymbolRotation[2],e.vvSymbolRotation[0],e.vvSymbolRotation[1],i);for(var s=0;s<3;++s){var l=e.vvSizeOffset[s]+a[0]*e.vvSizeFactor[s];n[s]=t(l,e.vvSizeMinSize[s],e.vvSizeMaxSize[s])}return r.mat4.scale(i,i,n),r.mat4.translate(i,i,e.vvSymbolAnchor),i},e.evaluateModelTransformScaleFactor=function(e,r){if(!e.vvSizeEnabled)return 1;for(var i=-1/0,n=0;n<3;++n){var a=e.vvSizeOffset[n]+r[0]*e.vvSizeFactor[n];i=Math.max(i,t(a,e.vvSizeMinSize[n],e.vvSizeMaxSize[n]))}return i}}(x||(x={})),t.evaluateModelTransform=x.evaluateModelTransform,t.evaluateModelTransformScaleFactor=x.evaluateModelTransformScaleFactor}.apply(null,i))||(e.exports=n)},1628:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(28),a=r(272),o=r(87),s=r(1810),l=r(118);r(266),t.Map=o.default.Map,l.default("es6-map")||(t.Map=((i=function(){function e(e){if(this._keys=[],this._values=[],this[Symbol.toStringTag]="Map",e)if(a.isArrayLike(e))for(var t=0;t<e.length;t++){var r=e[t];this.set(r[0],r[1])}else try{for(var i=n.__values(e),o=i.next();!o.done;o=i.next()){r=o.value;this.set(r[0],r[1])}}catch(e){s={error:e}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(s)throw s.error}}var s,l}return e.prototype._indexOfKey=function(e,t){for(var r=0,i=e.length;r<i;r++)if(s.is(e[r],t))return r;return-1},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._keys.length=this._values.length=0},e.prototype.delete=function(e){var t=this._indexOfKey(this._keys,e);return!(t<0)&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},e.prototype.entries=function(){var e=this,t=this._keys.map(function(t,r){return[t,e._values[r]]});return new a.ShimIterator(t)},e.prototype.forEach=function(e,t){for(var r=this._keys,i=this._values,n=0,a=r.length;n<a;n++)e.call(t,i[n],r[n],this)},e.prototype.get=function(e){var t=this._indexOfKey(this._keys,e);return t<0?void 0:this._values[t]},e.prototype.has=function(e){return this._indexOfKey(this._keys,e)>-1},e.prototype.keys=function(){return new a.ShimIterator(this._keys)},e.prototype.set=function(e,t){var r=this._indexOfKey(this._keys,e);return r=r<0?this._keys.length:r,this._keys[r]=e,this._values[r]=t,this},e.prototype.values=function(){return new a.ShimIterator(this._values)},e.prototype[Symbol.iterator]=function(){return this.entries()},e}())[Symbol.species]=i,i)),t.default=t.Map},1629:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1563),r(1751),r(1571)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,i){return{center:r.vec3f64.clone(e),halfSize:r.vec3f32.clone(t),quaternion:r.quatf32.clone(i)}}function s(e,t){var r=a.plane.signedDistance(t,e.center),i=l(e,t);return r>i?1:r<-i?-1:0}function l(e,t){r.quat.conjugate(u,e.quaternion),r.vec3.transformQuat(c,t,u);var i=e.halfSize;return Math.abs(c[0]*i[0])+Math.abs(c[1]*i[1])+Math.abs(c[2]*i[2])}Object.defineProperty(t,"__esModule",{value:!0});var u=r.quatf32.create(),c=r.vec3f32.create(),h=r.vec3f32.create(),d=r.mat3f32.create(),p=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var i=0;i<e;i++)this.obbs[i]={center:r.vec3f64.createView(this.buffer,56*i+0),halfSize:r.vec3f32.createView(this.buffer,56*i+24),quaternion:r.quatf32.createView(this.buffer,56*i+36)}}}();t.ObbArray=p,t.create=o,t.clone=function(e){return o(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){r.vec3.copy(t.center,e.center),r.vec3.copy(t.halfSize,e.halfSize),r.quat.copy(t.quaternion,e.quaternion)},t.compute=function(e,t){return t||(t=o([0,0,0],[-1,-1,-1],[0,0,0,1])),n.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=i.create());var n=r.mat3.fromQuat(d,e.quaternion),a=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),o=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),s=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-a,t[1]=e.center[1]-o,t[2]=e.center[2]-s,t[3]=e.center[0]+a,t[4]=e.center[1]+o,t[5]=e.center[2]+s,t},t.minimumDistancePlane=function(e,t){return a.plane.signedDistance(t,e.center)-l(e,t)},t.maximumDistancePlane=function(e,t){return a.plane.signedDistance(t,e.center)+l(e,t)},t.isVisible=function(e,t){return s(e,t.planes[0])<=0&&s(e,t.planes[1])<=0&&s(e,t.planes[2])<=0&&s(e,t.planes[3])<=0&&s(e,t.planes[4])<=0&&s(e,t.planes[5])<=0},t.intersectLine=function(e,t,i,n){void 0===n&&(n=0),r.quat.conjugate(u,e.quaternion),r.vec3.subtract(c,t,e.center);for(var a=r.vec3.transformQuat(c,c,u),o=r.vec3.transformQuat(h,i,u),s=-1/0,l=1/0,d=0;d<3;d++)if(Math.abs(o[d])>1e-6){var p=(n+e.halfSize[d]-a[d])/o[d],f=(-n-e.halfSize[d]-a[d])/o[d];s=Math.max(s,Math.min(p,f)),l=Math.min(l,Math.max(p,f))}else if(a[d]>e.halfSize[d]+n||a[d]<-e.halfSize[d]-n)return!1;return s<=l}}.apply(null,i))||(e.exports=n)},1630:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(38),r(1577),r(1586),r(1631)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(t,r,n){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(n),this.name=t,r=r||{},this.group=r.group||"",this.isVisible=null==r.isVisible||r.isVisible,this.isPickable=null==r.isPickable||r.isPickable,this.isSliceable=!1,this.translation=r.translation?i.vec3f64.clone(r.translation):i.vec3f64.create(),this._extent=[i.vec3f64.fromValues(0,0,0),i.vec3f64.fromValues(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.parentLayer=this,this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.parentLayer=null,this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=i.vec3f64.create();return i.vec3.lerp(e,this._extent[0],this._extent[1],.5)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*i.vec3.distance(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,r,i){r=r||a.LAYER;for(var n=i||this,o=0;o<this._parentStages.length;o++)this._parentStages[o].notifyDirty(r,n,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,n=0;n<3;n++)t=Math.max(t,e[1][n]-e[0][n]);var a=i.vec3f64.create();i.vec3.lerp(a,e[0],e[1],.5),this._octree=new o(a,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var n=r.getBBMin(),a=r.getBBMax();if(t)for(var o=0;o<3;++o)e._extent[0][o]=Math.min(e._extent[0][o],n[o]),e._extent[1][o]=Math.max(e._extent[1][o],a[o]);else t=[i.vec3f64.clone(n),i.vec3f64.clone(a)]}),this._extent=t}},e._idGen=new n,e}()}.apply(null,i))||(e.exports=n)},1631:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1571),r(1559)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function s(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function l(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function u(e,t,r){return!n.frustum.intersectsSphere(r,n.sphere.wrap(t,e))}function c(e,t){for(var r=1/0,i=null,n=0;n<8;++n){var a=h(e,t,g[n]);a<r&&(r=a,i=g[n])}return i}function h(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var d,p=function(){function e(e,t,r,n){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new f(null,i.vec3f64.fromValues(0,0,0),.5):this._root=new f(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var i=f.acquire(),n=0;n<t;n++){var a=r[n];i.init(this._root),this._isDegenerate(a)?this._degenerateObjects.add(a):this._add(a,i)}f.release(i)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var i=f.acquire(),n=0;n<r.length;n++){var a=r[n],o=t||this._boundingSphereFromObject(a,C);this._isValidRadius(o.radius)?(i.init(this._root),this._remove(a,o,i)):this._degenerateObjects.delete(a)}f.release(i),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var i=this;this._forEachNode(this._root,function(n){if(!i._intersectsNode(e,t,n))return!1;var a=n.node;return a.terminals.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),null!==a.residents&&a.residents.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),!0})},e.prototype.forEach=function(e){this._forEachNode(this._root,function(t){var r=t.node;return r.terminals.forEach(e),null!==r.residents&&r.residents.forEach(e),!0}),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,i,n){return this._findClosest(e,"front-to-back"===t?d.FRONT_TO_BACK:d.BACK_TO_FRONT,r,i,n)},e.prototype.forEachInDepthRange=function(e,t,r,i,n,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===r?d.FRONT_TO_BACK:d.BACK_TO_FRONT,i,n,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return l(r.center,2*-r.halfSize,x),l(r.center,2*r.halfSize,w),a.rayBoxTest(e,t,x,w)},e.prototype._intersectsObject=function(e,t,r){var i=this._objectToBoundingSphere.getRadius(r);return!(i>0)||n.sphere.intersectsRay(n.sphere.wrap(i,this._objectToBoundingSphere.getCenter(r)),n.ray.wrap(e,t))},e.prototype._forEachNode=function(e,t){for(var r=f.acquire().init(e),i=[r];0!==i.length;){if(t(r=i.pop())&&!r.isLeaf())for(var n=0;n<r.node.children.length;n++){r.node.children[n]&&i.push(f.acquire().init(r).advance(n))}f.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,i){void 0===i&&(i=d.FRONT_TO_BACK);for(var n=f.acquire().init(e),a=[n],o=function(e,t,r){if(!R.length)for(var i=0;i<8;++i)R[i]={index:0,distance:0};for(i=0;i<8;++i){var n=m[i];R[i].index=i,R[i].distance=h(e,t,n)}for(R.sort(function(e,t){return e.distance-t.distance}),i=0;i<8;++i)r[i]=R[i].index;return r}(r,i,A);0!==a.length;){if(t(n=a.pop())&&!n.isLeaf())for(var s=7;s>=0;--s){var l=o[s];if(!(l>=n.node.children.length))n.node.children[l]&&a.push(f.acquire().init(n).advance(l))}f.release(n)}},e.prototype._findClosest=function(e,t,r,n,a){var o=this,s=1/0,l=1/0,d=null,p=c(e,t),f=0,m=function(i){if(++f,!n||n(i)){var a=o._objectToBoundingSphere.getCenter(i),c=o._objectToBoundingSphere.getRadius(i);if(!r||!u(a,c,r)){var p=h(e,t,a),m=p-c;m<s&&(s=m,l=p+c,d=i)}}};return this._forEachNodeDepthOrdered(this._root,function(n){if(null!=a&&f>=a)return!1;if(r&&u(n.center,n.halfSize*v,r))return!1;if(i.vec3.scale(_,p,n.halfSize),i.vec3.add(_,_,n.center),h(e,t,_)>l)return!1;var o=n.node;return o.terminals.forEach(function(e){m(e)}),null!==o.residents&&o.residents.forEach(function(e){m(e)}),!0},e,t),d},e.prototype._forEachInDepthRange=function(e,t,r,n,a,o,s,l){var p=this,f=-1/0,m=1/0,g={setRange:function(e){r===d.FRONT_TO_BACK?(f=Math.max(f,e.near),m=Math.min(m,e.far)):(f=Math.max(f,-e.far),m=Math.min(m,-e.near))}};g.setRange(n);var y=h(t,r,e),b=c(t,r),x=c(t,-1*r),w=0,S=function(e){if(++w,!s||s(e)){var i=p._objectToBoundingSphere.getCenter(e),n=p._objectToBoundingSphere.getRadius(e),l=h(t,r,i)-y;l-n>m||l+n<f||o&&u(i,n,o)||a(e,g)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=l&&w>=l)return!1;if(o&&u(e.center,e.halfSize*v,o))return!1;if(i.vec3.scale(_,b,e.halfSize),i.vec3.add(_,_,e.center),h(t,r,_)-y>m)return!1;if(i.vec3.scale(_,x,e.halfSize),i.vec3.add(_,_,e.center),h(t,r,_)-y<f)return!1;var n=e.node;return n.terminals.forEach(function(e){S(e)}),null!==n.residents&&n.residents.forEach(function(e){S(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(y[0]=e,y)},e.prototype._remove=function(e,t,r){S.length=0;var i=r.advanceTo(t,function(e,t){S.push(e.node,t)})?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(var n=S.length-2;n>=0;n-=2){var a=S[n],o=S[n+1];if(!this._purge(a,o))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,C))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var i=f.acquire().init(e);this._add(t.data[r],i),f.release(i)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},T);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var n=f.acquire();this._rootBoundsForRootAsSubNode(r,n),this._placingRootViolatesMaxDepth(n)?this._rebuildTree(r,n):this._growRootAsSubNode(n),f.release(n)}}},e.prototype._rebuildTree=function(e,t){var r=this;i.vec3.copy(E.center,t.center),E.radius=t.halfSize;var n=this._boundingSphereFromObjects([e,E],function(e){return e},P),a=f.acquire().init(this._root);this._root.initFrom(null,n.center,1.25*n.radius),this._forEachNode(a,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),f.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,i=e.center,n=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=a[s]-o-(i[s]-r),u=i[s]+r-(a[s]+o),c=Math.max(0,Math.ceil(l/(2*o))),h=Math.max(0,Math.ceil(u/(2*o)))+1,d=Math.pow(2,Math.ceil(Math.log(c+h)*Math.LOG2E));n=Math.max(n,d),O[s].min=c,O[s].max=h}for(s=0;s<3;s++){var p=(n-((c=O[s].min)+(h=O[s].max)))/2;c+=Math.ceil(p),h+=Math.floor(p);var f=a[s]-o-c*o*2;b[s]=f+(h+c)*o}return t.initFrom(null,b,n*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(T.center,this._root.center),T.radius=this._root.halfSize,this._root.init(e),e.advanceTo(T,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,i=0;i<t.length&&null==e;)e=t[r=i++];for(;i<t.length;)if(t[i++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,i=e.center;return e.radius<=r&&i[0]>=t[0]-r&&i[0]<=t[0]+r&&i[1]>=t[1]-r&&i[1]<=t[1]+r&&i[2]>=t[2]-r&&i[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var n=t(e[0],T);i.vec3.copy(r.center,n.center),r.radius=n.radius}else{x[0]=1/0,x[1]=1/0,x[2]=1/0,w[0]=-1/0,w[1]=-1/0,w[2]=-1/0;for(var a=0;a<e.length;a++){n=t(e[a],T);this._isValidRadius(n.radius)&&(o(x,n.center,n.radius),s(w,n.center,n.radius))}i.vec3.lerp(r.center,x,w,.5),r.radius=Math.max(w[0]-x[0],w[1]-x[1],w[2]-x[2])/2}return r},e}(),f=function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this.center=i.vec3f64.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,n,a){return void 0===t&&(t=null),void 0===n&&(n=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),r&&i.vec3.copy(this.center,r),this.halfSize=n,this.depth=a,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var i=m[t];return this.center[0]+=i[0]*this.halfSize,this.center[1]+=i[1]*this.halfSize,this.center[2]+=i[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var i=this._childIndex(e);t&&t(this,i),this.advance(i)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,i=0,n=0;n<3;n++)r[n]<t[n]&&(i|=1<<n);return i},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(d||(d={}));var m=[i.vec3f64.fromValues(-1,-1,-1),i.vec3f64.fromValues(1,-1,-1),i.vec3f64.fromValues(-1,1,-1),i.vec3f64.fromValues(1,1,-1),i.vec3f64.fromValues(-1,-1,1),i.vec3f64.fromValues(1,-1,1),i.vec3f64.fromValues(-1,1,1),i.vec3f64.fromValues(1,1,1)],g=[i.vec3f64.fromValues(-1,-1,-1),i.vec3f64.fromValues(-1,-1,1),i.vec3f64.fromValues(-1,1,-1),i.vec3f64.fromValues(-1,1,1),i.vec3f64.fromValues(1,-1,-1),i.vec3f64.fromValues(1,-1,1),i.vec3f64.fromValues(1,1,-1),i.vec3f64.fromValues(1,1,1)],v=Math.sqrt(3),y=[null],b=i.vec3f64.create(),_=i.vec3f64.create(),x=i.vec3f64.create(),w=i.vec3f64.create(),S=[],C={center:i.vec3f64.create(),radius:0},T={center:i.vec3f64.create(),radius:0},E={center:i.vec3f64.create(),radius:0},P={center:i.vec3f64.create(),radius:0},O=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R=[],A=[];return p}.apply(null,i))||(e.exports=n)},1632:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(9),r(38),r(1571),r(1590),r(1572),r(1604),r(1591),r(1559),r(1568),r(1666)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){var p=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),f=function(e){function t(t,r){var i=e.call(this,r)||this;return i.params=h.copyParameters(t,v),"miter"!==i.params.join&&(i.params.miterLimit=0),i.numVertsAtJoin="wall"===i.params.type?2:4,i.numVertsAtCap=2,i.canBeMerged="screen"===i.params.type&&null==i.params.stippleLength,i.bufferWriter="wall"===i.params.type?new x:new b(i.canBeMerged),i}return r(t,e),t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=h.copyParameters(this.params);return e.miterLimit="miter"===e.join?e.miterLimit:0,e},t.prototype.setParameterValues=function(e){for(var t in e)c.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),c.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,o,l,u,h){if(i.isSelection&&!s.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!c.isTranslationMatrix(r))return void p.error("intersection assumes a translation-only matrix");var d=e.data,f=d.getVertexAttr()[c.VertexAttrConstants.POSITION].data,m=d.getVertexAttr()[c.VertexAttrConstants.SIZE],g=m&&m.data[0],v=i.camera,y=i.point,b=(g+this.params.width)/2+4;n.vec3.set(F[0],y[0]-b,y[1]+b,0),n.vec3.set(F[1],y[0]+b,y[1]+b,0),n.vec3.set(F[2],y[0]+b,y[1]-b,0),n.vec3.set(F[3],y[0]-b,y[1]-b,0);for(var _=0;_<4;_++)v.unprojectPoint(F[_],V[_]);a.plane.fromPoints(v.eye,V[0],V[1],L),a.plane.fromPoints(v.eye,V[1],V[2],U),a.plane.fromPoints(v.eye,V[2],V[3],B),a.plane.fromPoints(v.eye,V[3],V[0],N);var x=Number.MAX_VALUE;for(_=0;_<f.length-5;_+=3)if(C[0]=f[_]+r[12],C[1]=f[_+1]+r[13],C[2]=f[_+2]+r[14],T[0]=f[_+3]+r[12],T[1]=f[_+4]+r[13],T[2]=f[_+5]+r[14],!(a.plane.signedDistance(L,C)<0&&a.plane.signedDistance(L,T)<0||a.plane.signedDistance(U,C)<0&&a.plane.signedDistance(U,T)<0||a.plane.signedDistance(B,C)<0&&a.plane.signedDistance(B,T)<0||a.plane.signedDistance(N,C)<0&&a.plane.signedDistance(N,T)<0)){if(v.projectPoint(C,O),v.projectPoint(T,R),O[2]<0&&R[2]>0){n.vec3.subtract(E,C,T);var w=v.frustum,S=-a.plane.signedDistance(w.planes[4],C)/n.vec3.dot(E,w.planes[4]);n.vec3.scale(E,E,S),n.vec3.add(C,C,E),v.projectPoint(C,O)}else if(O[2]>0&&R[2]<0){n.vec3.subtract(E,T,C);w=v.frustum,S=-a.plane.signedDistance(w.planes[4],T)/n.vec3.dot(E,w.planes[4]);n.vec3.scale(E,E,S),n.vec3.add(T,T,E),v.projectPoint(T,R)}else if(O[2]<0&&R[2]<0)continue;var j=c.pointLineSegmentDistanceSquared2D(O,R,y);j<x&&(x=j,n.vec3.copy(A,C),n.vec3.copy(M,T))}var G=i.p0,z=i.p1;if(x<b*b){var H=Number.MAX_VALUE;if(a.lineSegment.closestLineSegmentPoint(a.lineSegment.fromPoints(A,M,I),a.lineSegment.fromPoints(G,z,D),P)){n.vec3.subtract(P,P,G);var k=n.vec3.length(P);n.vec3.scale(P,P,1/k),H=k/n.vec3.distance(G,z)}u(H,P)}}},t.prototype.getGLMaterials=function(){return{color:m,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:g}},t.prototype.getAllTextureIds=function(){return[]},t}(u),m=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.writeDepth?6:9)},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.colorPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})},t.prototype.bind=function(e,t){var r=this.program,i=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",i.color),r.setUniform1f("miterLimit",i.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===i.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",i.width*t.pixelRatio)):r.setUniform1f("extLineWidth",i.width),null!=i.stippleLength){var n=i.stippleLength?1/(2*i.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",n)}i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(i.color[3]>=1&&i.writeDepth)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setBlendingEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;h.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(l),g=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(d.highlightPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})},t.prototype.bind=function(e,t){var r=this.program,i=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",i.color),r.setUniform1f("miterLimit",i.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===i.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",i.width*t.pixelRatio)):r.setUniform1f("extLineWidth",i.width),null!=i.stippleLength){var n=i.stippleLength?1/(2*i.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",n)}i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(i.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;h.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(l),v={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},y=o.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec2f(c.VertexAttrConstants.UV0).vec3f(c.VertexAttrConstants.AUXPOS1).vec3f(c.VertexAttrConstants.AUXPOS2).vec4f(c.VertexAttrConstants.COLOR).f32(c.VertexAttrConstants.SIZE),b=function(){function e(e){this.canBeMerged=e,this.vertexBufferLayout=y,this.numVertsAtJoin=4,this.numVertsAtCap=2}return e.prototype.allocate=function(e){return y.createBuffer(e)},e.prototype.elementCount=function(e){var t=(e.indices[c.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t},e.prototype.write=function(e,t,r,i,n){var a=t.vertexAttr[c.VertexAttrConstants.POSITION].data,o=t.indices&&t.indices[c.VertexAttrConstants.POSITION];o&&o.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var s=t.vertexAttr[c.VertexAttrConstants.COLOR]?t.vertexAttr[c.VertexAttrConstants.COLOR].data:w,l=t.vertexAttr[c.VertexAttrConstants.SIZE]?t.vertexAttr[c.VertexAttrConstants.SIZE].data:S,u=a.length/3,h=e.transformation,d=i.position.typedBuffer,p=0,f=this.vertexBufferLayout.stride/4,m=n*f,g=m;this.canBeMerged&&(m+=f);var v=a[0],y=a[1],b=a[2];if(h){var _=v,x=y,C=b;v=h[0]*_+h[4]*x+h[8]*C+h[12],y=h[1]*_+h[5]*x+h[9]*C+h[13],b=h[2]*_+h[6]*x+h[10]*C+h[14]}var T=a[3],E=a[4],P=a[5];if(h){_=T,x=E,C=P;T=h[0]*_+h[4]*x+h[8]*C+h[12],E=h[1]*_+h[5]*x+h[9]*C+h[13],P=h[2]*_+h[6]*x+h[10]*C+h[14]}for(var O=v,R=y,A=b,M=0;M<u;M++){var I=3*M;if(M<u-1&&(T=a[I+3],E=a[I+4],P=a[I+5],h)){_=T,x=E,C=P;T=h[0]*_+h[4]*x+h[8]*C+h[12],E=h[1]*_+h[5]*x+h[9]*C+h[13],P=h[2]*_+h[6]*x+h[10]*C+h[14]}p+=Math.sqrt((O-v)*(O-v)+(R-y)*(R-y)+(A-b)*(A-b)),d[m++]=O,d[m++]=R,d[m++]=A,d[m++]=p,d[m++]=0===M?-1.2:-1,d[m++]=v,d[m++]=y,d[m++]=b,d[m++]=T,d[m++]=E,d[m++]=P,d[m++]=s[0],d[m++]=s[1],d[m++]=s[2],d[m++]=s[3],d[m++]=l[0],d[m++]=O,d[m++]=R,d[m++]=A,d[m++]=p,d[m++]=0===M?1.2:1,d[m++]=v,d[m++]=y,d[m++]=b,d[m++]=T,d[m++]=E,d[m++]=P,d[m++]=s[0],d[m++]=s[1],d[m++]=s[2],d[m++]=s[3],d[m++]=l[0],M>0&&M<u-1&&(d[m++]=O,d[m++]=R,d[m++]=A,d[m++]=p,d[m++]=-1.2,d[m++]=v,d[m++]=y,d[m++]=b,d[m++]=T,d[m++]=E,d[m++]=P,d[m++]=s[0],d[m++]=s[1],d[m++]=s[2],d[m++]=s[3],d[m++]=l[0],d[m++]=O,d[m++]=R,d[m++]=A,d[m++]=p,d[m++]=1.2,d[m++]=v,d[m++]=y,d[m++]=b,d[m++]=T,d[m++]=E,d[m++]=P,d[m++]=s[0],d[m++]=s[1],d[m++]=s[2],d[m++]=s[3],d[m++]=l[0]),v=O,y=R,b=A,O=T,R=E,A=P}if(this.canBeMerged){for(M=g;M<g+f;M++)d[M]=d[M+f];var D=m-f;for(M=0;M<f;M++)d[m++]=d[D++]}},e}(),_=o.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec2f(c.VertexAttrConstants.UV0),x=function(){function e(){this.vertexBufferLayout=_,this.numVertsAtJoin=2,this.numVertsAtCap=2,this.tmpCurrent=n.vec3f64.create(),this.tmpLast=n.vec3f64.create()}return e.prototype.allocate=function(e){return y.createBuffer(e)},e.prototype.elementCount=function(e){return(e.indices[c.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap},e.prototype.write=function(e,t,r,i,a){var o=t.vertexAttr[c.VertexAttrConstants.POSITION].data,s=t.indices&&t.indices[c.VertexAttrConstants.POSITION];s&&s.length!==2*(o.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var l=o.length/3,u=e.transformation,h=0,d=this.tmpCurrent,p=this.tmpLast;n.vec3.set(d,o[0],o[1],o[2]);for(var f=a,m=0;m<l;m++){var g=3*m;n.vec3.copy(p,d),n.vec3.set(d,o[g],o[g+1],o[g+2]),u&&n.vec3.transformMat4(d,d,u),h+=n.vec3.squaredDistance(p,d),i.position.setVec(f,d),i.uv0.set(f,0,h),i.uv0.set(f,1,-1),++f,i.position.setVec(f,d),i.uv0.set(f,0,h),i.uv0.set(f,1,1),++f}},e}(),w=[255,255,255,255],S=[0,0,0,0],C=n.vec3f64.create(),T=n.vec3f64.create(),E=n.vec3f64.create(),P=n.vec3f64.create(),O=n.vec3f64.create(),R=n.vec3f64.create(),A=n.vec3f64.create(),M=n.vec3f64.create(),I=a.lineSegment.create(),D=a.lineSegment.create(),F=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],V=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],L=a.plane.create(),U=a.plane.create(),B=a.plane.create(),N=a.plane.create();return f}.apply(null,i))||(e.exports=n)},1633:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(83),r(114),r(38),r(1563),r(72),r(1566)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var u=function(){function e(e,t,r){this.type="draped",this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.stage=null,this._visible=!1}return e.prototype.initialize=function(e,t){this.stage=t},e.prototype.setVisibility=function(e){if(null!=this.stage)return this._visible!==e&&(this._visible=e,this._visible?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0)},e.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),this._visible=!1,this.stage=null},e.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(e,t){return Math.max(e,t.bsRadius)},0)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=a.vec3f64.create()),a.vec3.set(e,0,0,0)},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=o.create()),o.empty(e)},e.prototype.addHighlight=function(e,t){var r=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(i){var n=r.addRenderGeometryHighlight(i,t);e.addRenderGeometry(i,r,n)})},e.prototype.removeHighlight=function(e){this.renderGeometries.forEach(function(t){e.removeRenderGeometry(t)})},e.prototype.getProjectedBoundingBox=function(e,t,r,a){return n(this,void 0,void 0,function(){var n,s,u,h;return i(this,function(i){switch(i.label){case 0:for(o.empty(a),n=0;n<this.renderGeometries.length;n++)s=this.renderGeometries[n],this._getRenderGeometryProjectedBoundingRect(s,e,c,r),o.expand(a,c);if(!t)return[3,5];o.center(a,d),u=void 0,h=l.demResolutionForBoundingBox(a,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.service.queryElevation(d[0],d[1],h)];case 2:return u=i.sent(),[3,4];case 3:return i.sent(),u=null,[3,4];case 4:null!=u&&(a[2]=Math.min(a[2],u),a[5]=Math.max(a[5],u)),i.label=5;case 5:return[2,a]}})})},e.prototype._getRenderGeometryProjectedBoundingRect=function(e,t,r,i){if(this.boundingBox)o.set(h,this.boundingBox);else{var n=e.center,a=e.bsRadius;h[0]=n[0]-a,h[1]=n[1]-a,h[2]=n[2]-a,h[3]=n[0]+a,h[4]=n[1]+a,h[5]=n[2]+a}return t(h,0,2),this.calculateRelativeScreenBounds&&i.push({location:o.center(h),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),o.toRect(h,r)},e}(),c=s.create(),h=o.create(),d=[0,0,0];return u}.apply(null,i))||(e.exports=n)},1634:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73)],void 0===(n=function(e,t,r){function i(e){var t=[];return e.components.forEach(function(e){t.push(e.geometry)}),r.unique(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.materialsFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.material)})}),r.unique(t)},t.texturesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){e.textures&&t.push.apply(t,e.textures)})}),r.unique(t)},t.geometriesFromLodLevelResources=i,t.geometriesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.geometry)})}),r.unique(t)},t.computeFaceCount=function(e){var t=0;return i(e).forEach(function(e){t+=e.data.indexCount/3}),t}}.apply(null,i))||(e.exports=n)},1635:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8),r(5),r(9),r(1742)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,i){for(var n="",a=0;a<i;){var o=e[t+a];if(o<128)n+=String.fromCharCode(o),a++;else if(o>=192&&o<224){if(a+1>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&o)<<6|63&e[t+a+1];n+=String.fromCharCode(s),a+=2}else if(o>=224&&o<240){if(a+2>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&o)<<12|(63&e[t+a+1])<<6|63&e[t+a+2];n+=String.fromCharCode(s),a+=3}else{if(!(o>=240&&o<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(a+3>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&o)<<18|(63&e[t+a+1])<<12|(63&e[t+a+2])<<6|63&e[t+a+3])>=65536){var l=55296+(s-65536>>10),u=56320+(1023&s);n+=String.fromCharCode(l,u)}else n+=String.fromCharCode(s);a+=4}}return n}function s(e,r){for(var i={byteOffset:0,byteCount:0,fields:Object.create(null)},n=0,a=0;a<r.length;a++){var o=r[a],s=o.valueType||o.type,l=t.valueType2ArrayBufferReader[s];i.fields[o.property]=l(e,n),n+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return i.byteCount=n,i}function l(e,t,i){var n,a,s=[],l=0;for(a=0;a<e;a+=1){if((n=t[a])>0){if(s.push(o(i,l,n-1)),0!==i[l+n-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);l+=n}return s}function u(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function c(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function h(e,t,n){for(var a=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:n}},o={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)},l=a.byteCount,u=0;u<t.ordering.length;u++){var c=t.ordering[u],h=i.clone(t[c]);if(h.count=a.fields.count,"String"===h.valueType){if(h.byteOffset=l,h.byteCount=a.fields[c+"ByteCount"],"UTF-8"!==h.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:h.encoding})}else{if(!p(h.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:h.valueType});var d=f(h.valueType);l+=l%d!=0?d-l%d:0,h.byteOffset=l,h.byteCount=d*h.valuesPerElement*h.count}l+=h.byteCount,o.entries[c]=h}return o.byteCount=l-o.byteOffset,o}function d(e,t,i){if(t!==e&&m.error("Invalid "+i+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function p(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function f(e){return p(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var m=n.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=l,t.createTypedView=u,t.createRawView=c,t.createAttributeDataIndex=h,t.createGeometryDataIndex=function(e,t,r){var n=s(e,t&&t.header),a=n.byteCount,o={header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:i.clone(t.vertexAttributes)},l=o.vertexAttributes;r||null==l.region||delete l.region;for(var u=n.fields,c=null!=u.vertexCount?u.vertexCount:u.count,h=0;h<t.ordering.length;h++){var p=t.ordering[h];null!=l[p]&&(l[p].byteOffset=a,l[p].count=c,a+=f(l[p].valueType)*l[p].valuesPerElement*c)}var m=u.faceCount;if(t.faces&&m){o.faces=i.clone(t.faces);var g=o.faces;for(h=0;h<t.ordering.length;h++){var v=t.ordering[h];null!=g[v]&&(g[v].byteOffset=a,g[v].count=m,a+=f(g[v].valueType)*g[v].valuesPerElement*m)}}var y=u.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&y){o.featureAttributes=i.clone(t.featureAttributes);var b=o.featureAttributes;for(h=0;h<t.featureAttributeOrder.length;h++){var _=t.featureAttributeOrder[h];b[_].byteOffset=a,b[_].count=y;var x=f(b[_].valueType);"UInt64"===b[_].valueType&&(x=8),a+=x*b[_].valuesPerElement*y}}return d(a,e.byteLength,"geometry"),o.byteCount=a-o.byteOffset,o},t.readBinaryAttribute=function(e,t,i){if("lepcc-rgb"===e.encoding)return a.decodeRGB(t);if("lepcc-intensity"===e.encoding)return a.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(m.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(m.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var n=h(t,e,i);d(n.byteOffset+n.byteCount,t.byteLength,"attribute");var o=n.entries.attributeValues||n.entries.objectIds;if(o){if("String"===o.valueType){var s=n.entries.attributeByteCounts,p=u(t,s),f=c(t,o);return l(s.count,p,f)}return u(t,o)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=p,t.getBytesPerValue=f}.apply(null,i))||(e.exports=n)},1637:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},1638:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(522),r(1603)],void 0===(n=function(e,t,r,i){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.hasOffsetAdjustment=!1,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.hasOffsetAdjustment=e.hasOffsetAdjustment,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.setOffsetRenderUnits=function(e){this._meterUnitOffset=0,this._renderUnitOffset=e},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=i.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(139)],void 0===(n=function(e,t,r){return{now:r}}.apply(null,i))||(e.exports=n)},1644:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1686)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,i=this.buffers;t<i.length;t++){var n=i[t];if(n.availableCount>=e)return n}if(e>r.MAX_INDEX_COUNT)return null;var a=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(a),a},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=i}.apply(null,i))||(e.exports=n)},1645:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1639)],void 0===(n=function(e,t,r){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=r.now()},e.prototype.stop=function(){var e=r.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,i))||(e.exports=n)},1646:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(25),r(58),r(58),r(27),r(38)],void 0===(n=function(e,t,r,i,n,a,o){function s(e,t,s){if(i.isNone(t))return null;var l=o.vec4f64.fromArray(r.toUnitRGBA(t.color)),u=s.opacity;switch(t.type){case"solid":return e.createSolidEdgeMaterial({color:l,size:a.pt2px(t.size),extensionLength:a.pt2px(t.extensionLength),opacity:u});case"sketch":return e.createSketchEdgeMaterial({color:l,size:a.pt2px(t.size),extensionLength:a.pt2px(t.extensionLength),opacity:u});default:n.neverReached(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,r){return s(e,function(e){return e&&e.enabled&&e.edges||null}(t),r)},t.createMaterialFromEdges=s}.apply(null,i))||(e.exports=n)},1648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(1649),r(1650),r(1580),r(1651)],void 0===(n=function(e,t,r,i,n,a,o){function s(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._lineWidth=1,this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=a.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=o.loadCapabilities(e,t);var i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]};var s=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:s?this.gl.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)},r("esri-webgl-debug")&&(this.instanceCounter=new n),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},r("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e)},e.prototype.setBlendColor=function(e,t,r,i){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&i===this._blendColorState.a||(this.gl.blendColor(e,t,r,i),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=i)},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t)},e.prototype.setBlendFunctionSeparate=function(e,t,r,i){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=i)},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e)},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t)},e.prototype.setColorMask=function(e,t,r,i){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===i||(this.gl.colorMask(e,t,r,i),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=i)},e.prototype.setClearColor=function(e,t,r,i){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=i)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e)},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e)},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t))},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e)},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e)},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,r,i){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=i)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e)},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e)},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e)},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t)},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e)},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r)},e.prototype.setStencilFunctionSeparate=function(e,t,r,i){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=i)},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e)},e.prototype.setStencilOp=function(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r)},e.prototype.setStencilOpSeparate=function(e,t,r,i){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=i)},e.prototype.setLineWidth=function(e){var t=this._lineWidth;return this._lineWidth!==e&&(this.gl.lineWidth(e),this._lineWidth=e),t},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(i.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.drawArrays=function(e,t,i){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,i)),this.gl.drawArrays(e,t,i)},e.prototype.drawElements=function(e,t,i,n){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,t)),5123!==i?5125===i&&this.gl.drawElements(e,t,i,n):this.gl.drawElements(e,t,i,n)},e.prototype.logIno=function(){r("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,r,i){var n=this._viewport;n.x===e&&n.y===t&&n.width===r&&n.height===i||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,r){void 0===r&&(r=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),(r>=e._MAX_TEXTURE_IMAGE_UNITS||r<0)&&console.error("Input texture unit is out of range of available units!");var i=this._textureUnitMap[r];return this.setActiveTexture(r),null==t||null==t.glName?(null!=i&&(this.gl.bindTexture(i.descriptor.target,null),i.setBoundToUnit(r,!1)),void(this._textureUnitMap[r]=null)):i&&i.id===t.id?void t.applyChanges():(this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(r,!0),t.applyChanges(),void(this._textureUnitMap[r]=t))},e.prototype.bindFramebuffer=function(e){if(!e)return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this._capabilities.vao;t&&t.bindVertexArray(null);for(var n=0;n<this.parameters.maxVertexAttributes;n++)e.disableVertexAttribArray(n);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var a=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(a)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(this._lineWidth),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(i.BASE_TEXTURE_UNIT+o),e.bindTexture(3553,null);var s=this._textureUnitMap[o];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(i.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),r("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,r,i){return t?i===t?i:(e.bindBuffer(r,t.glName),t):(e.bindBuffer(r,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,i))||(e.exports=n)},1649:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,i))||(e.exports=n)},1650:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}return e.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}},e.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}},e.prototype.printResourceCount=function(){console.log("Live objects:"),console.log("Textures: "+this._instanceCount.textureCount),console.log("Buffers: "+this._instanceCount.bufferCount),console.log("VAOs: "+this._instanceCount.vaoCount),console.log("Programs: "+this._instanceCount.programCount),console.log("Framebuffers: "+this._instanceCount.framebufferCount),console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)},e}()}.apply(null,i))||(e.exports=n)},1651:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1652),r(1653),r(1580),r(1654)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){if(n.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}function s(e,t){if(n.default(e))return!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float")?{R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F}:null;if(e instanceof WebGLRenderingContext){var r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return r||i?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}}function l(e,t,r,i,a){if(i&&n.default(e))return!0;if(t[r])return!1;for(var o=0,s=a;o<s.length;o++){var l=s[o];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var n=t&&t.disabledExtensions||{};return l(e,n,"standardDerivatives",!0,["OES_standard_derivatives"]),{instancing:i.load(e),vao:a.load(e,n),compressedTextureS3TC:function(e,t){if(t.compressedTextureS3TC)return null;var r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,n),textureFilterAnisotropic:function(e,t){if(t.textureFilterAnisotropic)return null;var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,n),disjointTimerQuery:r.load(e,n),colorBufferFloat:s(e,n),blendMinMax:o(e,n),depthTexture:l(e,n,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:l(e,n,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:l(e,n,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:l(e,n,"fragDepth",!0,["EXT_frag_depth"])}}}.apply(null,i))||(e.exports=n)},1652:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var i=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return i?r.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(i.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return i.createQueryEXT()},resultAvailable:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return i.endQueryEXT(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,i))||(e.exports=n)},1653:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(r.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,i))||(e.exports=n)},1654:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(r.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}}.apply(null,i))||(e.exports=n)},1656:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var r=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var i={};return this._listeners[e].set(i,t),{remove:function(){return r._listeners[e].delete(i)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=r}.apply(null,i))||(e.exports=n)},1657:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):t&&t.yoffset?Math.max(e,Math.abs(t.yoffset)):e}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){if(!e)return 6;if("simple"===e.type)return r(6,e.symbol);if("unique-value"===e.type){var t=6;return e.uniqueValueInfos.forEach(function(e){t=r(t,e.symbol)}),t}if("class-breaks"===e.type){var i=6;return e.classBreakInfos.forEach(function(e){i=r(i,e.symbol)}),i}return 6}}.apply(null,i))||(e.exports=n)},1659:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1739),r(1585),r(1757),r(1605),r(1619)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(e){function t(t,r,i){var n=e.call(this)||this;n.symbol=t,n.referenced=0;var o=t.symbolLayers;i&&(o=i.concat(o));var s=o.length;n.childGraphics3DSymbols=new Array(o.length),n.childGraphics3DSymbolPromises=new Array(o.length);for(var l=r.layerOrder,u=0,c=0,h=function(e,t){t&&(n.childGraphics3DSymbols[e]=t,c++),u--,!n.isRejected()&&u<1&&(c>0?n.resolve():n.reject())},d=0;d<s;d++){var p=o.getItemAt(d);if(!1!==p.enabled){r.layerOrder=l+(1-(1+d)/s),r.layerOrderDelta=1/s;var f=a.make(n.symbol,p,r,p._ignoreDrivers);f&&(u++,n.childGraphics3DSymbolPromises[d]=f)}}if(r.layerOrder=l,0===u)n.resolve();else{var m=this;for(d=0;d<s;d++)!function(e){var t=m.childGraphics3DSymbolPromises[e];t&&t.then(function(){return h(e,t)},function(){return h(e,null)})}(d)}return n}return r(t,e),t.prototype.createGraphics3DGraphic=function(e,t){for(var r=e.graphic,n=new Array(this.childGraphics3DSymbols.length),a=0;a<this.childGraphics3DSymbols.length;a++){var o=this.childGraphics3DSymbols[a];o&&(n[a]=o.createGraphics3DGraphic(e))}return new i(r,t||this,n,e.layer)},Object.defineProperty(t.prototype,"complexity",{get:function(){return o.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(e){return e&&e.complexity}))},enumerable:!0,configurable:!0}),t.prototype.layerPropertyChanged=function(e,t){for(var r=this.childGraphics3DSymbols.length,i=this,a=0;a<r;a++){var o=function(r){var a=i.childGraphics3DSymbols[r];if(a&&!a.layerPropertyChanged(e,t,function(e){var t=e._graphics[r];return t instanceof n?t:null}))return{value:!1}}(a);if("object"==typeof o)return o.value}return!0},t.prototype.applyRendererDiff=function(e,t){return!!this.isResolved()&&this.childGraphics3DSymbols.reduce(function(r,i,n){return r&&(!i||i.applyRendererDiff(e,t))},!0)},t.prototype.getFastUpdateStatus=function(){var e=0,t=0,r=0;return this.childGraphics3DSymbolPromises.forEach(function(i){i&&!i.isFulfilled()?e++:i&&i.isFastUpdatesEnabled()?r++:i&&t++}),{loading:e,slow:t,fast:r}},t.prototype.setDrawOrder=function(e,t){for(var r=this.childGraphics3DSymbols.length,i=1/r,n=0;n<r;n++){var a=this.childGraphics3DSymbols[n];if(a){var o=e+(1-(1+n)/r);a.setDrawOrder(o,i,t)}}},t.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.isFulfilled()||this.reject();for(var e=0;e<this.childGraphics3DSymbolPromises.length;e++)this.childGraphics3DSymbolPromises[e]&&this.childGraphics3DSymbolPromises[e].destroy();this.childGraphics3DSymbolPromises=null,this.childGraphics3DSymbols=null}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0}),t}(s.Promise)}.apply(null,i))||(e.exports=n)},1660:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1638)],void 0===(n=function(e,t,r,i){return function(e){function t(t){var r=e.call(this,t)||this;return r.centerPointInElevationSR=null,r}return r(t,e),t}(i)}.apply(null,i))||(e.exports=n)},1661:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(262),r(1586),r(1559)],void 0===(n=function(e,t,r,i,n,a){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return i.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;i.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return a.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var i=t._model.content[n.OBJECT][r];i&&i.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],i=[],o=[],s=this,l=0;l<e.length;l++)!function(l){var u=e[l],c=s._dirtyGeomRecords.get(u);if(!c)return"continue";c.forEach(function(e,s){var l=t._ensureGeomRecord(u,s);e.forEach(function(e,u){var c,h=e[0],d=e[1],p=e[2],f=2&d&&1&p;(4&d||f)&&((c=l.get(u))?i.push.apply(i,c[1]):4===d&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),c&&l.delete(u));if(1&d||f){var m=[h,[]],g=t._model.get(n.OBJECT,s);t._model.getGeometryRenderGeometries(g,h,m[1]),r.push.apply(r,m[1]),l.set(u,m)}if(2&d&&!f)if(c=l.get(u)){var v=c[1],y=v.length;if(16&p){g=t._model.get(n.OBJECT,s);for(var b=0;b<y;b++){var _=v[b];t._model.updateRenderGeometryTransformation(g,h,_)}}for(b=0;b<y;b++){_=v[b];o.push({renderGeometry:_,updateType:p})}}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===l.size&&t._residentGeomRecords.get(u).delete(s)}),0===s._residentGeomRecords.get(u).size&&s._residentGeomRecords.delete(u),s._dirtyGeomRecords.delete(u)}(l);return[r,i,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=this._residentGeomRecords.get(i);n&&n.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,2);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,2)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,32);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,32)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryAdded(t,i[n],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryRemoved(t,i[n],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,i){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,i)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,i,n,o,s,l,u){r=r||this._getParentLayerId(e);var c=e.id,h=t.id,d=this._ensureDirtyRecord(r,c),p=d.get(h);if(p){var f=p[1];f&n?d.delete(h):f&o?(p[1]=i,p[2]=u):f&s?p[2]|=u:f&l||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else d.set(h,[t,i,u])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,i){e.forEach(function(e,n){r.length>0&&(r+="\n"),r+=i+"."+n;var a=[];e.forEach(function(e){var t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(var o=0;o<a.length;o++)if(a[o]){r+=" "+t[o-1]+": ";for(var s=0;s<a[o].length;s++)r+=a[o][s]+", "}})}),r},e}()}.apply(null,i))||(e.exports=n)},1662:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(19),r(9),r(7),r(38),r(1663),r(1700),r(1701),r(1807),r(1702),r(1597),r(1608),r(1704),r(267),r(519),r(1562),r(1648)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y){var b=n.getLogger("esri.views.3d.webgl-engine.parts.View"),_=function(){function e(e,t,r,i){var n=this;this.options=i,this._backgroundColor=o.vec4f64.fromValues(1,1,1,1),this._lightDirection=o.vec3f64.fromValues(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(i),this._programRepository=new c(this._rctx),this._programRepository.globalOptions.viewingMode=i.viewingMode;this._textureRep=new u(t.getAll(p.ContentType.TEXTURE),this._programRepository,function(){return n._viewport.getCamera().viewport},this._rctx),this._materialRep=new l(this._textureRep,this._programRepository),this._viewport=new f(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new s(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){h.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,x.lightDirection=e._lightDirection,x.disableSlice=!1,e._viewport.render(x))},postRender:function(){h.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=g.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=h.instrumentContext(r);var n={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new y(this._gl,n),!e.alpha&&this._rctx.contextAttributes.alpha&&b.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&i("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){o.vec3.set(this._lightDirection,0,0,0);for(var t=0,r=e.lights;t<r.length;t++){var i=r[t];if(i instanceof d.MainLight){o.vec3.negate(this._lightDirection,i.direction);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t={};return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},e.prototype.getIdleSuspend=function(){return this._idleSuspend},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,r,i){this._viewport.modify(e,t,r,i)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,r=a.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==r})});return this._screenshotQueue.push({settings:e,resolver:r}),this._needsRender=!0,r.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._renderScreenshotOverlay=function(e,t,r){if(this.options.renderScreenshotOverlay){e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.save(),i.translate(0,t.height),i.scale(1,-1),r.region&&i.translate(-r.region.x,-r.region.y),i.scale(r.pixelRatio,r.pixelRatio),this.options.renderScreenshotOverlay(e,t),i.restore()}},e.prototype._readbackScreenshot=function(e){var t=e.framebufferWidth,i=e.framebufferHeight,n=e.region,a=e.resample,o=this._ensureScreenshotEncodeCanvas();if(a){var s=m.createEmptyImageData(t,i,o);this._gl.readPixels(0,0,t,i,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(o,s,r({},e,{region:null}));var l=m.createEmptyImageData(n.width,n.height,o);return m.resampleHermite(s,l,!0,a.region.x,i-(a.region.y+a.region.height),a.region.width,a.region.height)}s=m.createEmptyImageData(n.width,n.height,o);return this._gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(o,s,e),s},e.prototype._renderScreenshot=function(e){var t=null,r=this._viewport.getCamera(),i=m.screenshotSuperSampleSettings(e,this._supersampleScreenshots),n=i.framebufferWidth,a=i.framebufferHeight,o=!1;if(n!==r.fullWidth||a!==r.fullHeight||e.disableSlice){var s=r.copy();s.fullWidth=n,s.fullHeight=a;var l=r.fovX-s.fovX,u=r.fovY-s.fovY;l<0&&l<u?s.fovX=r.fovX:u<0&&u<l&&(s.fovY=r.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(s),o=!0,t=new v(this._rctx,{width:s.fullWidth,height:s.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clear(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:s,pixelRatio:i.pixelRatio,disableSlice:e.disableSlice})}var c=this._readbackScreenshot(i);return t&&t.dispose(),this._rctx.bindFramebuffer(null),o&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(r),c},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var r=t[e],i=r.settings;if(this._gl){var n=this._ensureScreenshotEncodeCanvas(),a=this._renderScreenshot(i),o=m.encodeResult(a,i,n,{flipY:!0,premultipliedAlpha:!0});r.resolver(o)}else r.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},e}(),x={lightDirection:o.vec3f64.create(),camera:null,fbo:null,pixelRatio:1,disableSlice:!1};return _}.apply(null,i))||(e.exports=n)},1663:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1589),r(1594),r(1572),r(1587),r(1578),r(1613),r(1610),r(1622),r(1624),r(1597),r(1699),r(1562),r(1560),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g){var v=function(){function e(e,t,i,n,a,o){var s=this;this._renderTargets={},this._clearColor=r.vec4f64.fromValues(0,0,0,0),this._uniqueIdx=0,this._localOrigins=new l,this._rctx=e,this._canvas=t,this._programRep=i,this._modelDirtySet=o,this._modelDirtySet.onMaterialChanged=function(e){return s.materialChanged(e)},this._renderer=new c(i,n,a,this._rctx,!0),this._sliceHelper=new h,this._renderer.onHasHighlightsChanged=function(e){s.onHasHighlightsChanged&&s.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new d.AmbientLight(r.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t._localOrigins.getOrigin(e.center)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var r=e.instanceParameters,i=u.generateHighlightId();return r.componentHighlights=a.addHighlight(r.componentHighlights,null,t,i),this.updateRenderGeometries([e],32),i},e.prototype.removeRenderGeometryHighlight=function(e,t){var r=e.instanceParameters;r.componentHighlights=a.removeHighlight(r.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!i.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(0,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},e.prototype.drawPass=function(e,t,n){if(this.isEmpty()||4===e&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!n.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var a=this._renderTargets[t];if(!a)return!1;var o=this._rctx,s=o.gl,l=n.width,u=n.height;a.width===l&&a.height===u||(a.resize(l,u),a.colorTexture.setSamplingMode(9729));var c=b.camera;b.fbo=a,b.pixelRatio=n.pixelRatio||1,c.near=1,c.far=1e4,o.bindFramebuffer(a),o.setDepthTestEnabled(!1),o.setBlendFunctionSeparate(770,771,1,771),o.setClearColor.apply(o,this._clearColor),o.clear(s.COLOR_BUFFER_BIT);for(var h=0;h<n.views.length;h++){var d=n.views[h];c.viewport=d.viewport,r.mat4.ortho(c.projectionMatrix,0,d.extent[2]-d.extent[0],0,d.extent[3]-d.extent[1],c.near,c.far),r.mat4.identity(c.viewMatrix),r.mat4.translate(c.viewMatrix,c.viewMatrix,[-d.extent[0],-d.extent[1],0]),c.setGLViewport(this._rctx),i.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(l,u,y[n.index%y.length]),this._renderer.renderGeometryPass(e,b,null,null,this._sliceHelper)}return o.setDepthTestEnabled(!0),o.setBlendFunctionSeparate(770,771,1,771),o.bindFramebuffer(null),o.setViewport(0,0,this._canvas.width,this._canvas.height),a.colorTexture.descriptor.hasMipmap&&a.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,i){var n=this._rctx,a=n.gl;if(!this._testPatternMat){for(var l=new Uint8Array(e*t*4),u=0,c=0;c<t;c++)for(var h=0;h<e;h++){var d=Math.floor(h/10),f=Math.floor(c/10);d<2||f<2||10*d>e-20||10*f>t-20?(l[u++]=255,l[u++]=255,l[u++]=255,l[u++]=255):(l[u++]=255,l[u++]=255,l[u++]=255,l[u++]=1&d&&1&f?1&h^1&c?0:255:1&d^1&f?0:128)}var v=new m(n,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},l);this._testPatternMat=new p(this._programRep,v,[1,1,1,1],!0,a.ALWAYS),this._testPatternBindParams={proj:r.mat4f64.create(),view:r.mat4f64.create(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(n,o.Pos3Tex)}this._testPatternMat.setColor([i[0],i[1],i[2],1]),this._testPatternMat.bind(n,this._testPatternBindParams),this._testPatternMat.bindView(n,this._testPatternBindParams),n.bindVAO(this._quadVAO),n.drawArrays(5,0,g.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(n)},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,i=0;this._renderTargets[r];)r=e+"_"+ ++i;return this._renderTargets[r]=f.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e}(),y=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],b={fbo:null,camera:new n,pixelRatio:1};return v}.apply(null,i))||(e.exports=n)},1664:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1559)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e,t,r,a){n.assert(e.length>=1),n.assert(r.length%t==0),n.assert(r.length>=e.length*t),n.assert(3===a.size||4===a.size),this.primitiveIndices=e,this.indices=r,this._position=a,this._numIndexPerPrimitive=t;var s=a.data,l=a.offsetIdx,u=a.strideIdx,c=0,h=e.length,d=l+u*r[t*e[c]];for(o.clear(),o.push(d),this.bbMin=i.vec3f64.fromValues(s[d],s[d+1],s[d+2]),this.bbMax=i.vec3f64.clone(this.bbMin);c<h;++c)for(var p=t*e[c],f=0;f<t;++f){d=l+u*r[p+f],o.push(d);var m=s[d];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=s[d+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=s[d+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}this.center=i.vec3f64.create(),i.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var g=this.bsRadius*this.bsRadius;for(c=0;c<o.length;++c){var v=s[d=o.data[c]]-this.center[0],y=s[d+1]-this.center[1],b=s[d+2]-this.center[2],_=v*v+y*y+b*b;if(!(_<=g)){var x=Math.sqrt(_),w=.5*(x-this.bsRadius);this.bsRadius=this.bsRadius+w,g=this.bsRadius*this.bsRadius;var S=w/x;this.center[0]+=v*S,this.center[1]+=y*S,this.center[2]+=b*S}}o.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=i.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,n=new Uint8Array(r),a=new Array(8),o=0;o<8;++o)a[o]=0;var s=this._position,l=s.data,u=s.offsetIdx,c=s.strideIdx;for(o=0;o<r;++o){for(var h=0,d=this._numIndexPerPrimitive*this.primitiveIndices[o],p=u+c*this.indices[d],f=l[p],m=l[p+1],g=l[p+2],v=1;v<this._numIndexPerPrimitive;++v){var y=l[p=u+c*this.indices[d+v]],b=l[p+1],_=l[p+2];y<f&&(f=y),b<m&&(m=b),_<g&&(g=_)}f<t[0]&&(h|=1),m<t[1]&&(h|=2),g<t[2]&&(h|=4),n[o]=h,++a[h]}var x=0;for(o=0;o<8;++o)a[o]>0&&++x;if(x<2)return;var w=new Array(8);for(o=0;o<8;++o)w[o]=a[o]>0?new Uint32Array(a[o]):void 0;for(o=0;o<8;++o)a[o]=0;for(o=0;o<r;++o){w[h=n[o]][a[h]++]=this.primitiveIndices[o]}this.children=new Array(8);for(o=0;o<8;++o)void 0!==w[o]&&(this.children[o]=new e(w[o],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}(),o=new r({deallocator:null});return a}.apply(null,i))||(e.exports=n)},1665:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1577)],void 0===(n=function(e,t,r){return function(){function e(t,r,i,n,a,o){this.id=e._idGen.gen(t.id),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=n,this.origin=a,this.shaderTransformation=o}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},1666:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({WALL:e.wall,SCREENSCALE:e.screenScale,STIPPLE:e.stipple,SLICE:e.slice})};t.colorPass={name:"ribbon-line-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"ribbon-line-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1667:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=0,this.shadowMap=null,this.slot=0,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.sliceHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1668:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(92)],void 0===(n=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,i;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return i=new Float32Array(r),t&&i.set(this.array),this.array=i,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var n=2*this.size;r>=n;)r=Math.floor(r/2);return i=new Float32Array(r),t&&i.set(this.array.subarray(0,r)),this.array=i,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,i))||(e.exports=n)},1669:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1564),r(1647),r(1567)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new i(e,o.shader.vertex,o.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new n(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindProgram(this.program),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/i.width,1/i.height),r.setFaceCullingEnabled(!1),r.drawArrays(4,0,3)},e}(),o={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return a}.apply(null,i))||(e.exports=n)},1670:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1562)],void 0===(n=function(e,t,r){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null}return e.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)},Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.prepareHighlightPass=function(e){var t=this._rctx,r=t.gl,i=e.fullViewport,n=i[2],a=i[3];this.updateFBO(n,a),this.viewportToRestore=i,this._rctx.setViewport(0,0,n,a),t.bindFramebuffer(this.fbo),t.setClearColor(0,0,0,0),t.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.updateFBO=function(e,t){this.fbo?this.fbo.resize(e,t):this.fbo=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:e,height:t},{colorTarget:0,depthStencilTarget:1})},e}()}.apply(null,i))||(e.exports=n)},1671:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(92)],void 0===(n=function(e,t,r){return function(){function e(e,t){null==t&&(t=4);var i=r.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(i),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,r){this.array.set(r,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],r=e*this.perInstanceDataSize,i=t*this.perInstanceDataSize;this.array.set(this.array.subarray(r,r+this.perInstanceDataSize),i),this.array.set(this.zeroItem,r);var n=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=n,this.id2slot[n]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,r;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(r=new Float32Array(t)).set(this.array),this.array=r}else if(e<=this.array.length/2){t=this.array.length;for(var i=2*e;t>=i;)t/=2;(r=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=r}},e}()}.apply(null,i))||(e.exports=n)},1672:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push([i[0],i[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];i[0]=i[0]*t,i[1]=i[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],i=0;i<e.length;i++){var n=e[i];if(!(n[1]<t[0]||n[0]>t[1])){var a=[n[0],n[1]];a[0]<t[0]&&(a[0]=t[0]),a[1]>t[1]&&(a[1]=t[1]),r.push(a)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var i=t[t.length-1];i[1]+1<e[r][0]?t.push(e[r]):i[1]<e[r][1]&&(i[1]=e[r][1],t.pop(),t.push(i))}return t},e.invertIntervals=function(e,t){for(var r=[],i=0,n=0;n<e.length;n++){var a=e[n];a[0]>i&&r.push([i,a[0]-1]),i=a[1]+1}return i<=t&&r.push([i,t]),r},e.offsetIntervals=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i];r.push([n[0]+t,n[1]+t])}return r},e}()}.apply(null,i))||(e.exports=n)},1673:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559),r(1562)],void 0===(n=function(e,t,r,i){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){r.assert(!this.enabled),this._depthFBO=i.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){r.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,i))||(e.exports=n)},1674:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559),r(1562)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){r.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=i.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},1675:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1609)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<23;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var i=e[r];this.slots[i].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var i=r[t];i.prepareRender&&i.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,i=0,n=this.slots[e];i<n.length;i++){var a=n[i];a.render(t)&&(a.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=n;t.near=1/0,t.far=-1/0;for(var i=0,a=this.renderPlugins;i<a.length;i++){var o=a[i];if(o.queryDepthRange){var s=o.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}();t.RenderPluginManager=i;var n={near:0,far:0}}.apply(null,i))||(e.exports=n)},1676:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1601),r(1564),r(1562),r(1647),r(1560),r(1567)],void 0===(n=function(e,t,i,n,a,o,s,l){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(86).then(function(){var i=[r(1838)];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,i)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new o(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new o(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new o(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(e,34962,35044,t)}),this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setFaceCullingEnabled(!0),r.setCullFace(1029),r.setFrontFace(2305),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!1),r.setViewport(i.x,i.y,i.width,i.height),this.tmpFramebufferEdges.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3),r.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,r){var n=new s(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return i.requestImage(e).then(function(e){n.resize(e.width,e.height),n.setData(e)}),n},e}()}.apply(null,i))||(e.exports=n)},1677:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559)],void 0===(n=function(e,t,r){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){r.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,i))||(e.exports=n)},1678:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(114),r(83),r(73),r(7),r(182),r(141),r(38),r(92),r(1588),r(1583),r(1614),r(1613),r(1623),r(1685),r(1727),r(1644),r(1756),r(1803),r(1518),r(1689),r(1691),r(1692),r(1564),r(1567),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E,P){Object.defineProperty(t,"__esModule",{value:!0});var O=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new g.LocalOriginManager(new f),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new x,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=u.vec3f64.create(),this.tmpCameraPosition=u.vec3f64.create(),this.componentColorManager=new y.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;l.open(s.getAbsMid("./EdgeProcessingWorker",e,P)).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=b.VertexLayout.createBuffer(4),i=0;i<4;i++)r.sideness.set(i,0,0===i||3===i?0:1),r.sideness.set(i,1,0===i||1===i?0:1);this.verticesBufferObject=T.createVertex(this.rctx,35044,r.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,s,l,u,c,h;return n(this,function(n){switch(n.label){case 0:if(this.hasObject(e))return[2];if(i=new Array,l={loaded:o.create(function(e){return s=e}),renderables:[]},this.perObjectData.set(e,l),a&&a.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))i.push(this.addObjectMergedGeometries(e,l,t,r));else for(u=0;u<e.geometries.length;u++)c=e.geometries[u],h=e.geometryRecords[u],h.material.supportsEdges&&(c.data instanceof v?i.push(this.addGeometryPreinterleaved(e,l,c,c.data,h,t,r)):i.push(this.addGeometryNonPreinterleaved(e,l,c,c.data,h,t[0],r)));return[4,o.all(i)];case 1:return n.sent(),this.callbacks.setNeedsRender(),s(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r=n.sent(),i=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var n=i(r),a=e.components.meta[r],o=a.index;a.material.opacity=n,e.components.buffer.textureBuffer.setDataElement(o,1,3,255*n)}e.allTransparent=C.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t,r,a){return void 0===a&&(a=!0),i(this,void 0,void 0,function(){var i,o,s=this;return n(this,function(n){switch(n.label){case 0:return[4,this.getObjectEntry(e)];case 1:return i=n.sent(),o=r.slicePlaneEnabled||!1,i.renderables.forEach(function(e){var r=t[0],i=C.determineRequiresUberRenderer(t),n=w.EdgeRenderer.getKey(i,r.type,o);if(n!==e.rendererKey){var l=s.renderers.get(e.rendererKey),u=s.acquireRenderer(i,r,o);l.removeRenderable(e),l.refCount.decrement(),e.rendererKey=n,u.addRenderable(e)}for(var c=0;c<t.length;c++)e.components.meta[c].material=t[c];a&&s.updateComponentBuffer(e.components),e.allTransparent=C.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return i(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.getObjectEntry=function(e){return i(this,void 0,void 0,function(){var t;return n(this,function(r){switch(r.label){case 0:if(!(t=this.perObjectData.get(e)))throw"no object";return[4,t.loaded];case 1:return r.sent(),[2,t]}})})},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},R,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},A,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,i=0,n=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){i+=e.statistics.averageEdgeLength,n++})});var a={distanceFalloffFactor:40*(i/n),minimumEdgeLength:C.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},o=this.rctx.capabilities.blendMinMax;o?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,o.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,a),t.renderSilhouetteEdges(r,e,a)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var i=u.vec3.set(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.aquire(i)}return m.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,i=0;i<t.length;i++){var n=t[i].material,a=t[i].index,o=c.clamp(Math.round(n.size*w.LINE_WIDTH_FRACTION_FACTOR),0,255),s=c.clamp(n.extensionLength,-w.EXTENSION_LENGTH_OFFSET,255-w.EXTENSION_LENGTH_OFFSET)+w.EXTENSION_LENGTH_OFFSET,l="solid"===n.type?0:1,u=255*n.opacity,h=n.color,d=255*h[0],p=255*h[1],f=255*h[2],m=255*h[3];r.textureBuffer.setData(a,0,d,p,f,m),r.textureBuffer.setData(a,1,o,s,l,u)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),i=0;i<e.length;i++){var n=e[i],a=r.aquireIndex();t.push({index:a,material:n})}var o={meta:t,buffer:r};return this.updateComponentBuffer(o),o},t.prototype.extractEdges=function(e,t,r,i){return this.worker.process({data:t,originalIndices:i,writerSettings:e,skipDeduplicate:r},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new E(this.rctx,b.EdgeShaderAttributeLocations,{vertices:b.glVertexLayout,instances:_.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:T.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new E(this.rctx,b.EdgeShaderAttributeLocations,{vertices:b.glVertexLayout,instances:_.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:T.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,a,o,s,l){return i(this,void 0,void 0,function(){var r,i,c,h;return n(this,function(n){switch(n.label){case 0:return r=a.getAttribute("position"),i=this.computeModelTransformWithLocalOrigin(e,o,u.mat4f64.create()),c=o.origin,h={position:r,indices:a.getIndices("position"),modelTransform:i,origin:c},[4,this.addNonPreinterleaved(e,t,h,s,l)];case 1:return n.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,r,a,o){return i(this,void 0,void 0,function(){var e,i,s,l,u,c,h,d,p,f,m,g,v,y,_;return n(this,function(n){switch(n.label){case 0:for(e=this.acquireRenderer(!1,a,o.slicePlaneEnabled||!1),i=r.modelTransform,s=r.origin,l=r.indices,u=r.position,c=u.data.length/u.strideIdx,h=b.EdgeInputBufferLayout.createBuffer(c),d=0;d<c;d++)h.position.set(d,0,u.data[u.offsetIdx+d*u.strideIdx+0]),h.position.set(d,1,u.data[u.offsetIdx+d*u.strideIdx+1]),h.position.set(d,2,u.data[u.offsetIdx+d*u.strideIdx+2]);return p=this.createComponentBuffers([a]),C.fillComponenBufferIndices(p.meta,[0,h.componentIndex.count],h.componentIndex),[4,this.extractEdges(e.writerSettings,h,!1,l)];case 1:return f=n.sent(),m=this.createEdgeResources(f),g=m.regular,v=m.silhouette,y=(g?g.vao.size:0)+(v?v.vao.size:0),_={regular:g,silhouette:v,transform:{modelMatrix:i,origin:s},statistics:{gpuMemoryUsage:y,averageEdgeLength:f.averageEdgeLength},components:p,visible:!0,allTransparent:C.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(_),e.addRenderable(_),this.gpuMemoryUsage+=y,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,a,o,s,l){return i(this,void 0,void 0,function(){var r,i,c,f,m,g,v,y,_,x,w,S,T,E,P,O,R;return n(this,function(n){switch(n.label){case 0:return(r=a.getAttribute("position"))&&d.isFloat32Array(r.data)?(i=s[0],c=C.determineRequiresUberRenderer(s),f=this.acquireRenderer(c,i,l.slicePlaneEnabled||!1),m=this.computeModelTransformWithLocalOrigin(e,o,u.mat4f64.create()),g=o.origin,v=a.getIndices("position"),y=new h.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),_=b.EdgeInputBufferLayout.createBuffer(y.count),p.vec3.copy(_.position,y),x=this.createComponentBuffers(s),C.fillComponenBufferIndices(x.meta,a.componentOffsets,_.componentIndex,v),w=a.hasPositionData,[4,this.extractEdges(f.writerSettings,_,w,v)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return S=n.sent(),T=this.createEdgeResources(S),E=T.regular,P=T.silhouette,O=(E?E.vao.size:0)+(P?P.vao.size:0),R={regular:E,silhouette:P,transform:{modelMatrix:m,origin:g},statistics:{gpuMemoryUsage:O,averageEdgeLength:S.averageEdgeLength},components:x,visible:!e.isHidden(o),allTransparent:C.determineAllTransparent(x.meta),distanceToCamera:0,rendererKey:f.key},t.renderables.push(R),f.addRenderable(R),this.gpuMemoryUsage+=O,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,i=0;i<e.geometries.length;i++){var n=e.geometries[i],o=e.geometryRecords[i];if(o.material.supportsEdges){if(n.data instanceof v)return!1;if(t){if(!a.equals(t,o.transformation))return!1}else t=o.transformation;if(!r&&o.origin)r=o;else if(r&&o.origin&&r.origin.id!==o.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,o,s,l,c,h,p,f,m,g,v,y,b,_,x,w,S,C,T,E;return n(this,function(n){switch(n.label){case 0:for(i=new Map,o=0,s=null,l=null,T=0;T<e.geometries.length;T++)m=e.geometries[T],c=e.geometryRecords[T],c.material.supportsEdges&&(!l&&c.origin&&(l=c),y=m.data.getIndices("position"),o+=y?y.length:0,(y&&null==s||s===Uint16Array)&&(s=d.isUint16Array(y)?Uint16Array:Uint32Array));for(h=o?new s(o):null,p=[],f=0,T=0;T<e.geometries.length;T++)if(m=e.geometries[T],g=e.geometryRecords[T],g.material.supportsEdges){if(v=m.data.getAttribute("position"),y=m.data.getIndices("position"),null==(b=i.get(v.data))){for(b=p.length/3,_=v.offsetIdx;_<v.data.length;_+=v.strideIdx)p.push(v.data[_+0]),p.push(v.data[_+1]),p.push(v.data[_+2]);i.set(v.data,b)}if(y)for(x=0;x<y.length;x++)h[f++]=b+y[x]}for(w=l||e.geometryRecords[0],S=this.computeModelTransformWithLocalOrigin(e,w,u.mat4f64.create()),C=w.origin,T=0;T<e.geometryRecords.length;T++)e.geometryRecords[T].origin=C;return E={position:{data:p,offsetIdx:0,strideIdx:3},indices:h,modelTransform:S,origin:C},[4,this.addNonPreinterleaved(e,t,E,r[0],a)];case 1:return n.sent(),[2]}})})},t.prototype.acquireRenderer=function(e,t,r){var i=w.EdgeRenderer.getKey(e,t.type,r),n=this.renderers.get(i);return this.strokesTexture||(this.strokesTexture=S.generateStrokesTexture(this.rctx)),n||(n=new w.EdgeRenderer(this.rctx,this.programRepository,{type:t.type,slicePlaneEnabled:r,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(i,n)),n.refCount.increment(),n},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,i=e.components.meta;r<i.length;r++){var n=i[r];e.components.buffer.releaseIndex(n.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;u.vec3.set(this.tmpCameraPosition,r[3],r[7],r[11]),this.perObjectData.forEach(function(e,r){var i=u.vec3.distance(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=i})})},t.prototype.renderRegularEdges=function(e,t,r){var i=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.regular&&!n.allTransparent){var a=C.computeEdgeCount(n.regular.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderRegularEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var i=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.silhouette&&!n.allTransparent){var a=C.computeEdgeCount(n.silhouette.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderSilhouetteEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t}();t.EdgeView=O;var R={color:u.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1},A={color:u.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,i))||(e.exports=n)},1679:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c){for(var h=0;h<9;++h)i[l+h]=a[u+h];l+=n,u+=o}}}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c){for(var h=0;h<16;++h)i[l+h]=a[u+h];l+=n,u+=o}}}.apply(null,i))||(e.exports=n)},1681:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[u],l+=n,u+=o},t.makeDense=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var i=0;i<r;i++)t[i]=e.get(i);return t}}.apply(null,i))||(e.exports=n)},1682:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1655)],void 0===(n=function(e,t,r){function i(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[u],i[l+1]=a[u+1],l+=n,u+=o}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=i,t.normalizeIntegerBuffer=function(e,t,n){var a=e.typedBuffer,o=e.typedBufferStride,s=t.typedBuffer,l=t.typedBufferStride,u=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*o,h=(n&&n.srcIndex?n.srcIndex:0)*l;if(r.isInteger(t.elementType)){var d=r.maximumValue(t.elementType);if(r.isSigned(t.elementType))for(var p=0;p<u;++p)a[c]=Math.max(s[h]/d,-1),a[c+1]=Math.max(s[h+1]/d,-1),c+=o,h+=l;else for(p=0;p<u;++p)a[c]=s[h]/d,a[c+1]=s[h+1]/d,c+=o,h+=l}else i(e,t,n);return e}}.apply(null,i))||(e.exports=n)},1683:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[u],i[l+1]=a[u+1],i[l+2]=a[u+2],l+=n,u+=o}}.apply(null,i))||(e.exports=n)},1684:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*n,u=(r&&r.srcIndex?r.srcIndex:0)*o,c=0;c<s;++c)i[l]=a[u],i[l+1]=a[u+1],i[l+2]=a[u+2],i[l+3]=a[u+3],l+=n,u+=o}}.apply(null,i))||(e.exports=n)},1685:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1623)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:r.mat4f64.create(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4.copy(t.viewMatrix,e),i.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=n}.apply(null,i))||(e.exports=n)},1686:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1687),r(1688)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var n=function(){function e(e,n){void 0===n&&(n=1),this.textureBuffer=new i.TextureBackedBuffer(e,n),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},1687:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,i))||(e.exports=n)},1688:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1588),r(1560)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new i(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,i,n,a){var o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,r),this.data.set(o,1,i),this.data.set(o,2,n),this.data.set(o,3,a)},e.prototype.setDataElement=function(e,t,r,i){var n=e*this.fieldCount+t;this.dirty=!0,this.data.set(n,r,i)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var i=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,n=new r.BufferViewVec4u8(new ArrayBuffer(4*i));n.typedBuffer.set(this.data.typedBuffer),this.data=n}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},1689:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(26),r(38),r(92),r(1568),r(1690)],void 0===(n=function(e,t,r,i,n,a,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var l={type:"solid",slicePlaneEnabled:!1,uber:!0,strokesTexture:null},u=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),c=function(){function e(t,i,a){this.rctx=t,this.programRepository=i,this.refCount=new u,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=n.mat3f64.create(),this.settings=r({},l,a),this.key=e.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);var o=this.settings.strokesTexture.variants;this.writerSettings={variants:o},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,i,n){this.setUniforms(e,t,i);var a=this.rctx;a.bindVAO(r),a.capabilities.instancing.drawArraysInstanced(6,0,4,n)},e.prototype.setUniforms=function(e,r,i){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",i.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var a=i.viewInvTransp,s=n.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,a);e.setUniform3f("uCameraPosition",a[3],a[7],a[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",s),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(i.fovY/2)/(i.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3),this.settings.slicePlaneEnabled&&o.bindSlicePlane(r.transform.origin.vec3,i.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",a.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return r({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t,r){return e?"edges-uber:"+r:"edges-t:"+t+":"+r},e}();t.EdgeRenderer=c,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,i))||(e.exports=n)},1690:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1565),r(1573)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return i.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,i))||(e.exports=n)},1691:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(92),r(1559),r(1560)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){if(!e)return null;for(var r=e.length/2,i=s*r,n=new Array(r),a=0,o=1===t,u=0;u<e.length;u+=2){var c=(e[u]+e[u+1])/2;n[a++]=o?Math.min(i,1-(1-c)*l):Math.min(i,c*l)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,l=new Uint8Array(4*r*r),u=4*r*s,c=t.strokesDefinition.amplitude,h=2*c,d=4*r,p=i.log2(r)+1,f=t.strokesDefinition.strokes.length,m=(p-1)*f*d,g=0,v=t.strokesDefinition.strokes;g<v.length;g++){for(var y=v[g],b=y.distance,_=y.pressure,x=m,w=0;w<p;w++){0!==w&&(b=o(b,0),_=o(_,1));for(var S=0;S<t.strokesDefinition.resolution;S++){var C=.5+(b?b[S%b.length]/h:0),T=_?_[S%_.length]:1;n.packFloatRGBA(C,l,x),n.packFloatRGBA(T,l,x+u),x+=4}x-=d*(f+1)}m+=d}return{resolution:r,texture:new a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},l),normalizationScale:h,amplitude:c,variants:f}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,i))||(e.exports=n)},1692:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(58),r(1583)],void 0===(n=function(e,t,r,i,n){function a(e){return e.size*e.color[3]*e.opacity>0}function o(e,t){var i=r.binaryIndexOf(e,t,!0);return-1===i?t<e[0]?0:e.length:i}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=null,r=0,n=e;r<n.length;r++){var o=n[r],s=o.type;if(a(o))if(i.isNone(t))t=s;else if(t!==s)return!0}return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++)if(a(e[t].material))return!1;return!0},t.cloneIndices=function(e){if(Uint16Array.from)return n.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=n.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,i){return r*(i/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=o,t.computeEdgeCount=function(e,t,r){return e.length-o(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,i){for(var n=0;n<e.length;n++){var a=e[n].index,o=t[n],s=t[n+1];if(i)for(var l=o;l<s;l++){var u=i[l];r.set(u,a)}else for(l=o;l<s;l++)r.set(l,a)}}}.apply(null,i))||(e.exports=n)},1693:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1694)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=r.vec3f64.create(),a=function(){function e(){this._renderLighting={main:{intensity:r.vec3f64.create(),direction:r.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=r.vec3f64.create(),this._oldSpecular=r.vec4f64.create(),this._oldDiffuse=r.vec4f64.create(),this._oldAmbient=r.vec4f64.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var i=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),r.vec3.negate(this._oldDirection,this._renderLighting.main.direction);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var a=r.vec3.copy(n,this._oldDiffuse);r.vec3.scale(a,a,.4*this._info.globalFactor),r.vec3.add(this._oldAmbient,this._oldAmbient,a)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=a}.apply(null,i))||(e.exports=n)},1694:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1695),r(1597)],void 0===(n=function(e,t,r,i,n,a){function o(e){return(e+1)*(e+1)}function s(e){return i.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){var i=e[0],n=e[1],a=e[2],s=r||[];return s.length=o(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*i*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*i*a,s[8]=.54627421529*(i*i-n*n)),s}function u(e,t){var r=o(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(var n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function c(e,t){for(var i=s(t.r.length),a=0,o=e;a<o.length;a++){var u=o[a];r.vec3.negate(v,u.direction),l(v,i,m),n.elementwiseProduct(m,y),n.scalarProduct(m,u.intensity[0],g),n.add(t.r,g),n.scalarProduct(m,u.intensity[1],g),n.add(t.g,g),n.scalarProduct(m,u.intensity[2],g),n.add(t.b,g)}return t}function h(e,t){l(v,0,m);for(var r=0,i=e;r<i.length;r++){var n=i[r];t.r[0]+=m[0]*y[0]*n.intensity[0]*4*Math.PI,t.g[0]+=m[0]*y[0]*n.intensity[1]*4*Math.PI,t.b[0]+=m[0]*y[0]*n.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=o,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=l,t.initSHCoefficients=u,t.projectFillLights=c,t.projectAmbientLights=h,t.combineLights=function(e,t,i,o){u(t,o.sh),r.vec3.set(i.intensity,0,0,0);var s=!1,l=d,m=p,g=f;l.length=0,m.length=0,g.length=0;for(var v=0,y=e;v<y.length;v++)(x=y[v])instanceof a.MainLight&&!s?(r.vec3.copy(i.direction,x.direction),i.intensity[0]=x.intensity[0],i.intensity[1]=x.intensity[1],i.intensity[2]=x.intensity[2],i.castShadows=x.castShadows,s=!0):x instanceof a.MainLight||x instanceof a.FillLight?l.push(x):x instanceof a.AmbientLight?m.push(x):x instanceof a.SphericalHarmonicsLight&&g.push(x);c(l,o.sh),h(m,o.sh);for(var b=0,_=g;b<_.length;b++){var x=_[b];n.add(o.sh.r,x.sh.r),n.add(o.sh.g,x.sh.g),n.add(o.sh.b,x.sh.b)}};var d=[],p=[],f=[],m=[0],g=[0],v=r.vec3f64.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,i))||(e.exports=n)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,i=0;i<e.length;i++)r+=e[i]*t[i];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t[i];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}}.apply(null,i))||(e.exports=n)},1696:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){return e instanceof Float32Array&&e.length>=16}function i(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=r,t.isMat4f64=i,t.isMat4=function(e){return r(e)||i(e)}}.apply(null,i))||(e.exports=n)},1697:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion,SLICE:e.slice})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:r.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:function(e){return n.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})}(e)+i.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:i.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1698:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var i=e.capabilities.disjointTimerQuery;if(!i)return null;if(i.timestampBits()<=0)return null;var n=i.createQuery();i.createTimestamp(n);var a=function(){var e=i.resultAvailable(n),o=i.disjoint();if(!e||o)o?t():setTimeout(a,r);else{var s=i.getResult(n);t(s/1e6)}};a()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,i))||(e.exports=n)},1699:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1568),r(1598)],void 0===(n=function(e,t,r,i,n){var a=r.vec4f64.fromValues(1,1,1,1);return function(){function e(e,t,r,i,a){this.program=e.getProgram(n.texOnly),this.color=r,this.depthFunc=a,this.blend=i,this.texGLName=t}return e.prototype.beginSlot=function(e){return 1===e},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",i.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:a),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){i.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e}()}.apply(null,i))||(e.exports=n)},1700:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559)],void 0===(n=function(e,t,r){function i(e,t){return e+"_"+t}var n=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var r,a=i(e.id,t),o=this.id2glMaterialRef[a];if(null==o){var s=e.getGLMaterials()[t];r=s?new s(e,this.programRep,this.textureRep):void 0,o=new n(r),this.id2glMaterialRef[a]=o}else r=o.getGLMaterial();return o.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var r=i(e,t),n=this.id2glMaterialRef[r];if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&(this.decreaseProgramReferences(a),a.dispose()),delete this.id2glMaterialRef[r]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[i(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var r=this.id2glMaterialRef[i(e,"depth")];r&&r.getGLMaterial()&&this.updateParamsForMat(r.getGLMaterial());var n=this.id2glMaterialRef[i(e,"depthShadowMap")];n&&n.getGLMaterial()&&this.updateParamsForMat(n.getGLMaterial());var a=this.id2glMaterialRef[i(e,"normal")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial());var o=this.id2glMaterialRef[i(e,"highlight")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.increaseRefCount(t[i])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.decreaseRefCount(t[i])},e}()}.apply(null,i))||(e.exports=n)},1701:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(1559),r(1560)],void 0===(n=function(e,t,r,i,n){var a=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),o=function(){function e(e,t,r,i){this.NUM_PARALLEL=8,this._fallbackTexture=null,this._fallbackTextureTransparent=null,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=i,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=i.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?i.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var n=0;n<this._fallbackTextureData.length;++n)this._fallbackTextureData[n]=255,this._fallbackTextureTransparentData[n]=(n+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(t,r,n){var o=this,s=this.id2textureRef[t];if(null==s){var l=this.textures[t];i.assert(void 0!==l),l.setUnloadFunc(this._unload.bind(this));var u=!0===r,c=this._createGLTextureDescription(l);if(s=new e.TextureRef(null),i.assert(null==this.id2textureRef[t]),this.id2textureRef[t]=s,l.initializeThroughRender){var h=l.initializeThroughRender(this._rctx,c);s.setGLTexture(h),n&&n(s)}else if(l.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(t,c,n):this._queue.push([t,c,n]);else try{l.initializeThroughUpload(this._rctx,c,this._programRepository,this.getViewportToRestore(),function(e){s.setGLTexture(e),o._needsRender=!0,n&&n(s)})}catch(e){a.error("#aquire","Error loading texture: "+e.toString())}null==s.getGLTexture()&&s.setGLTexture(u?this.fallbackTextureTransparent:this.fallbackTexture),this._needsRender=!0}return s.incRefCnt(),s},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),i.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrap;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(i){i(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var n=this;i.assert(null==this.loading[e]),this.loading[e]=!0;var a=this.textures[e];i.assert(void 0!==a),setTimeout(function(){var i=n.id2textureRef[e];i&&i.getRefCnt()&&a.initializeThroughUpload(n._rctx,t,n._programRepository,n.getViewportToRestore(),function(t){n.next(e),n._needsRender=!0,i&&i.getRefCnt()&&(i.setGLTexture(t),r&&r(i))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],i=this.id2textureRef[r];void 0!==i&&(0===i.getRefCnt()?(i.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var n=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<n;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,n)},Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){return this._fallbackTexture||(this._fallbackTexture=new n(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){return this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new n(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent},enumerable:!0,configurable:!0}),e}();return function(e){var t=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,i.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();e.TextureRef=t}(o||(o={})),o}.apply(null,i))||(e.exports=n)},1702:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1703),r(1580)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=null,a=[];t.enabled=!1,t.begin=function(){t.enabled&&(n=[])},t.trace=function(e){t.enabled&&null!=n&&n.push(e)},t.end=function(){if(t.enabled){var e=n;return n=null,e&&(a.forEach(function(t){return t(e)}),a.length=0),e}},t.instrumentContext=function(e){return t.enabled?i.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,function(e,i){t.enabled&&n&&n.push("gl."+e+"("+r.glFunctionArgsToString(e,i)+")")}):e},t.request=function(e){a.push(e)}}.apply(null,i))||(e.exports=n)},1703:function(e,t,r){var i;void 0===(i=function(){function e(e){if(null==l)for(var t in l={},u={},e)"number"==typeof e[t]&&(l[e[t]]=t,u[t]=e[t])}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=l[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function i(e,t,i,n){var a;if(void 0!==(a=s[e])&&(void 0!==(a=a[t])&&a[i])){if("object"==typeof a[i]&&void 0!==a[i].enumBitwiseOr){for(var o=a[i].enumBitwiseOr,l=0,c=[],h=0;h<o.length;++h){var d=u[o[h]];0!=(n&d)&&(l|=d,c.push(r(d)))}return l===n?c.join(" | "):r(n)}return r(n)}return null===n?"null":void 0===n?"undefined":n.toString()}function n(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function a(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var o=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,u=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==l[e]},glEnumToString:r,glFunctionArgToString:i,glFunctionArgsToString:function(e,t){for(var r="",n=t.length,a=0;a<n;++a)r+=(0==a?"":", ")+i(e,n,a,t[a]);return r},makeDebugContext:function t(a,s,l,u){function c(e,t){return function(){l&&l(t,arguments);var r=e[t].apply(e,arguments),i=u.getError();return 0!=i&&(h[i]=!0,s(i,t,arguments)),r}}u=u||a,e(a),s=s||function(e,t,n){for(var a="",s=n.length,l=0;l<s;++l)a+=(0==l?"":", ")+i(t,s,l,n[l]);o("WebGL error "+r(e)+" in "+t+"("+a+")")};var h={},d={};for(var p in a)if("function"==typeof a[p])if("getExtension"!=p)d[p]=c(a,p);else{var f=c(a,p);d[p]=function(){return t(f.apply(a,arguments),s,l,u)}}else n(d,a,p);return d.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return a.NO_ERROR},d},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){++m,d||f==m&&e.loseContext()}function i(e,t){var i=e[t];return function(){if(r(),!d)return i.apply(e,arguments)}}function o(e){return{statusMessage:e,preventDefault:function(){g=!0}}}var s,l=[],u=[],c={},h=1,d=!1,p=[],f=0,m=0,g=!1,v=0,y={};e.getContext=function(t){return function(){var a=t.apply(e,arguments);if(a instanceof WebGLRenderingContext){if(a!=s){if(s)throw"got different context";c=function(e){for(var t in e)"function"==typeof e[t]?c[t]=i(e,t):n(c,e,t);c.getError=function(){if(r(),!d)for(;e=s.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return c.NO_ERROR};for(var a=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],o=0;o<a.length;++o)c[f=a[o]]=function(t){return function(){if(r(),d)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=h,p.push(i),i}}(e[f]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(o=0;o<l.length;++o)c[f=l[o]]=function(t){return function(){return r(),d?null:t.apply(e,arguments)}}(c[f]);var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(o=0;o<u.length;++o){var f;c[f=u[o]]=function(t){return function(){return r(),!d&&t.apply(e,arguments)}}(c[f])}return c.checkFramebufferStatus=function(t){return function(){return r(),d?c.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(c.checkFramebufferStatus),c.getAttribLocation=function(t){return function(){return r(),d?-1:t.apply(e,arguments)}}(c.getAttribLocation),c.getVertexAttribOffset=function(t){return function(){return r(),d?0:t.apply(e,arguments)}}(c.getVertexAttribOffset),c.isContextLost=function(){return d},c}(s=a)}return c}return a}}(e.getContext);var b=function(e){l.push(t(e))},_=function(e){u.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":b(i);break;case"webglcontextrestored":_(i);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!d){for(d=!0,f=0,++h;s.getError(););(function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e]})(),y[s.CONTEXT_LOST_WEBGL]=!0;var t=o("context lost"),r=l.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);v>=0&&setTimeout(function(){e.restoreContext()},v)},0)}},e.restoreContext=function(){d&&u.length&&setTimeout(function(){if(!g)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<p.length;++e){var t=p[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),a(s),d=!1,m=0,g=!1;for(var e=u.slice(),t=o("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(d)throw"You can not ask a lost contet to be lost";f=m+e},e.getNumCalls=function(){return m},e.setRestoreTimeout=function(e){v=e},e},resetToInitialState:a}}.apply(null,[]))||(e.exports=i)},1704:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(38),r(1594),r(1645),r(1705)],void 0===(n=function(e,t,r,i,n,a,o){var s=r("dojo-debug-messages"),l=function(){function e(e,t,r,l,u){this._content=new Map,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=u,this._gl=u.gl,this._visualizer=new o(e,t,r,l,this._rctx),this._camera=new n(i.vec3f64.fromValues(0,100,-100)),s&&(this._stats.visualizerRenderTimer=new a(10),this._stats.viewportRenderTimer=new a(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var r in t)e[r]=t[r];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var i=this._gl.getUsedTextureMemoryStats();for(var n in i)e["texMem type: "+n]=i[n]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,r,i){this._visualizer.modify(e,t,r,i),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._visualizer.getFramebufferTexture(e)},e.prototype.render=function(e){s&&this._stats.viewportRenderTimer.start(),s&&this._stats.visualizerRenderTimer.start(),u.camera=e.camera||this._camera,u.fbo=e.fbo,u.lightDirection=e.lightDirection,u.pixelRatio=e.pixelRatio||1,u.disableSlice=e.disableSlice||!1,this._visualizer.render(u),s&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e}(),u={fbo:null,lightDirection:null,camera:null,pixelRatio:1,disableSlice:!1};return l}.apply(null,i))||(e.exports=n)},1705:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1709),r(38),r(1589),r(1609),r(1710),r(1711),r(1706),r(1622),r(1713),r(1715),r(1624),r(1716),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f){var m=f.assert;return function(){function e(e,t,r,i,n){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=n,this._renderer=new u(t,r,i,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new h(t,this._rctx),ssao:new p(t,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,this._rctx),renderOccluded:new c(t,this._rctx),slice:new d,offscreenRendering:new l(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._helpers.slice.plane=e.slicePlane),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades,this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._helpers.offscreenRendering.colorTexture;case"hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(e)},e.prototype.modify=function(e,t,r,i){this._renderer.modify(e,t,r,i);for(var n=0;n<t.length;++n)this._content.delete(t[n].uniqueName);for(n=0;n<e.length;++n)this._content.set(e[n].uniqueName,e[n]);for(n=0;n<r.length;++n)m(this._content.get(r[n].renderGeometry.uniqueName)===r[n].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getProjectionMatrix=function(e,t,r,n,a){var o=f.fovx2fovy(t,e[2],e[3]);i.mat4.perspective(a,180*o/Math.PI,e[2]/e[3],r,n)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e){var t=e.camera,a=e.fbo,o=e.lightDirection,s=t.viewport,l=this._helpers.slice.plane;if(e.disableSlice&&(this._helpers.slice.plane=null),this._renderer.prepareRender(t),this._helpers.shadowMap.enabled){n.ENABLE_PROFILE_DEPTH_RANGE&&r.begin("depthRange");var u=this.computeDepthRange(t);n.ENABLE_PROFILE_DEPTH_RANGE&&r.end("depthRange"),this._helpers.shadowMap.prepare(t,o,this._content,u);for(var c=this._helpers.shadowMap.getCascades(),h=0;h<c.length;++h){var d=c[h];d.camera.setGLViewport(this._rctx),e.camera=d.camera,this._renderer.renderGeometryPass(3,e,null,null,this._helpers.slice)}e.camera=t,this._helpers.shadowMap.finish(a),t.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,this._helpers),this._renderer.render(e,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var p=i.mat4.ortho(i.mat4f64.create(),s[0],s[2],s[1],s[3],-1,1);this._helpers.shadowMap.drawDebugQuad(p)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){p=i.mat4.ortho(i.mat4f64.create(),s[0],s[2],s[1],s[3],-1,1);this._helpers.ssao.drawQuad(p)}this._helpers.slice.plane=l},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=o.depthRangeFromScene(e,this._content,this._stage.getLayers());return a.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,i))||(e.exports=n)},1706:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(1578),r(1707),r(1559),r(1708),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s){var l=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._rctx=t,this.renderTargetHelper=new n.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(o.compositePass),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(o.compositeTransparentToHUDVisibilityPass)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){a.assert(this.enabled);var r=this._rctx,i=r.gl,n=e.fullViewport;this.dimensions.width=n[2],this.dimensions.height=n[3],this.mainFbo=t,this.bindTarget(this.mainColor,this.mainDepth),r.setClearStencil(0);var o=this._background.color;r.setClearColor(o[0]*o[3],o[1]*o[3],o[2]*o[3],o[3]),r.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=u),void 0===r&&(r=c),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,h)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(r),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,s.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,i){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.mainFbo),void 0===i&&(i=c);var n=this._rctx,a=this._compositeProgram;switch(n.bindFramebuffer(t),n.setDepthTestEnabled(!1),n.bindProgram(a),a.setUniform1i("tex",1),n.bindTexture(e,1),i){case"none":n.setBlendingEnabled(!1);break;case"alpha":n.setBlendFunctionSeparate(770,771,1,771),n.setBlendingEnabled(!0);break;case"premultiplied-alpha":n.setBlendFunction(1,771),n.setBlendingEnabled(!0);break;default:r.neverReached(i)}n.bindVAO(this.quadVAO),n.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry")),n.setDepthTestEnabled(!0),n.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=i.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,i,n){var a=this._rctx,o=a.gl;this.bindTarget(t,r);var s=0;if(i){var l=Math.max(1e-13,i[3]);a.setClearColor(i[0],i[1],i[2],l),s|=o.COLOR_BUFFER_BIT}n&&(s|=o.DEPTH_BUFFER_BIT),a.clear(s),e(),o.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(r)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),u=[0,0,0,0],c="none",h=[0,1,0,1];return l}.apply(null,i))||(e.exports=n)},1707:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(1562),r(1612),r(1560)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o={dataType:5121},s={},l=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var i=this.depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new n(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,i)),i}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r)),r},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},o,e)},e.prototype.getFramebuffer=function(e,t,r){var n=this.getKey(t,r),a=this.framebuffers.get(n),o=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o||a.depthStencilTexture!==s)&&(a.detachColorTexture(),a.detachDepthStencilTexture(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilTexture(s)),a):(a=r?i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:4},s):i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(n,a),a)}var l=r?this.getDepthBuffer(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o)&&(a.detachColorTexture(),a.detachDepthStencilBuffer(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilBuffer(l)),a):(a=i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:r?3:0},l),this.framebuffers.set(n,a),a)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=l}.apply(null,i))||(e.exports=n)},1708:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.compositePass={name:"offscreen-composite",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/offscreen.frag")},attributes:r.Default3D},t.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1709:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in n||(n[t]=new e(t)),n[t]}function r(e){console.log(t(e).toJSON())}var i=1e3,n={},a={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,n){void 0===n&&(n=!0),t(e).end();var o=performance.now();!n||e in a&&!(o>=a[e]+i)||(r(e),a[e]=o)},e.log=r,e.logAll=function(){for(var e in n)r(e)}}(r||(r={})),r}.apply(null,i))||(e.exports=n)},1710:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(38),r(1571),r(92),r(1572),r(1609),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){function u(e,t){if(t.isVisible){var r=s.empty(),i=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var i=t.eye,n=t.viewForward,a=t.frustum,o=function(e){return!e.areAllComponentsHidden()},l=r.objectCount;if(l<m)s.set(C,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,"front-to-back",C,function(r,i){c(e,t,r),C.far=e.near,i.setRange(C)},a,o),s.set(C,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,"back-to-front",C,function(r,i){c(e,t,r),C.near=e.far,i.setRange(C)},a,o);else{var u=Math.max(Math.min(l,g),Math.ceil(l*v)),h=r.findClosest(n,"front-to-back",a,o,u),p=r.findClosest(n,"back-to-front",a,o,u);h&&p&&(d(e,t,h.getCenter(),h.getBSRadius()),d(e,t,p.getCenter(),p.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){T.clear(),r.forEach(function(e){e.areAllComponentsHidden()||T.add(e)}),T.empty||(T.sort(t),s.set(C,t.near,Math.min(e.near,t.far)),T.forEachInDepthRange(C,"front-to-back",function(r,i,n){i<e.near&&c(e,t,r)}),s.set(C,Math.max(e.far,t.near),t.far),T.forEachInDepthRange(C,"back-to-front",function(t,r,i){e.far=Math.max(e.far,i)}))}(r,e,i),r}}function c(e,t,r){if(!r.areAllComponentsHidden()&&n.frustum.intersectsSphere(t.frustum,n.sphere.wrap(r.getBSRadius(),r.getCenter()))){var o=r.objectTransformation,s=S;r.geometryRecords.forEach(function(r){i.mat4.multiply(s,o,r.getShaderTransformation());var n=a.maxScale(s);h(e,t,r.geometry.boundingInfo,s,n)})}}function h(e,t,r,a,o){var s=t.eye,l=t.viewForward;i.vec3.transformMat4(w,r.center,a);var u=l[0]*(w[0]-s[0])+l[1]*(w[1]-s[1])+l[2]*(w[2]-s[2]),c=r.bsRadius*o;if(!(u-c>e.near&&u+c<e.far)&&n.frustum.intersectsSphere(t.frustum,n.sphere.wrap(c,w)))if(r.bsRadius>f&&r.getChildren())for(var d=r.getChildren(),p=0;p<8;++p)d[p]&&h(e,t,d[p],a,o);else P.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,a,r.bbMin,r.bbMax)}function d(e,t,r,i){var n=t.eye,a=t.viewForward,o=(r[0]-n[0])*a[0]+(r[1]-n[1])*a[1]+(r[2]-n[2])*a[2];e.near=Math.min(e.near,o-i),e.far=Math.max(e.far,o+i)}Object.defineProperty(t,"__esModule",{value:!0});var p=1e4,f=100,m=500,g=500,v=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<p)return E.compute(e,t);var i=s.empty();for(var n in r){var a=r[n];a.isVisible&&s.union(i,u(e,a))}return i},t.depthRangeFromLayer=u;var y=function(){function e(){this._items=new r({allocator:function(e){return e||{obj:null,distance:0,near:0,far:0}},deallocator:function(e){return e.obj=null,e.distance=0,e.near=0,e.far=0,e}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var i=e.obj,n=i.getCenter(),a=i.getBSRadius(),o=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-t[2])*r[2];e.distance=o,e.near=o-a,e.far=o+a}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var i=0;i<this._items.length;++i){(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(i=this._items.length-1;i>=0;--i){var n;(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}},e}(),b=function(){function e(){this.view=i.mat4f64.create(),this.viewProj=i.mat4f64.create(),this.frustum=n.frustum.create(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),i.mat4.copy(this.view,e.viewMatrix),i.mat4.multiply(this.viewProj,e.projectionMatrix,this.view),n.frustum.copy(e.frustum,this.frustum);var a=this.view,s=a[2],l=a[6],u=a[10],c=a[14],h=this.range,d=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,i=e.componentOffsets;if(!o.isAllHidden(t,i)&&e.castShadow){var n,a;e.hasShaderTransformation?(n=e.getBoundingSphere(e.getShaderTransformation(),1,w),a=w):(n=e.bsRadius,a=e.center);var h=s*a[0]+l*a[1]+u*a[2]+c,p=h-n,f=h+n;r.geometries[d]=e,r.near[d]=-f,r.far[d]=-p,++d}}),0===this.geometries.length)return h;for(var p=0;p<this.geometries.length;++p)this.near[p]>h.far&&(h.far=this.near[p]),this.near[p]>2&&this.far[p]<h.near&&(h.near=this.far[p]);var f=this.looseRange;f.near=Math.max(.5*h.near,2),f.far=2*h.far;var m=0,g=0;for(p=0;p<this.geometries.length;++p)this.near[p]<h.near&&(this.near[p]>=f.near?h.near=this.near[p]:this.nearCandidates[m++]=p),this.far[p]>h.far&&(this.far[p]<=f.far?h.far=this.far[p]:this.farCandidates[g++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return h;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var v=this.nearCandidates[p];if(this.near[v]<h.near){var y=(b=this.geometries[v]).boundingInfo;this.includeNearBoundingInfoRec(y,b.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){v=this.farCandidates[p];if(this.far[v]>h.far){var b;y=(b=this.geometries[v]).boundingInfo;this.includeFarBoundingInfoRec(y,b.getShaderTransformation())}}return h},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.vec3.transformMat4(w,n,t);var o=a.maxScale(t),s=w[0],l=w[1],u=w[2];r*=o;var c=this.frustum.planes;if(!(c[0][0]*s+c[0][1]*l+c[0][2]*u+c[0][3]>r||c[1][0]*s+c[1][1]*l+c[1][2]*u+c[1][3]>r||c[2][0]*s+c[2][1]*l+c[2][2]*u+c[2][3]>r||c[3][0]*s+c[3][1]*l+c[3][2]*u+c[3][3]>r)){var h=this.view[2]*s+this.view[6]*l+this.view[10]*u+this.view[14],d=h+r;if(!(-(h-r)<2||-d>=this.range.near)){if(-d>this.looseRange.near)return void(this.range.near=-d);if(r>f){var p=e.getChildren();if(void 0!==p){for(var m=0;m<8;++m)void 0!==p[m]&&this.includeNearBoundingInfoRec(p[m],t);return}}P.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.vec3.transformMat4(w,n,t);var o=a.maxScale(t),s=w[0],l=w[1],u=w[2];r*=o;var c=this.frustum.planes;if(!(c[0][0]*s+c[0][1]*l+c[0][2]*u+c[0][3]>r||c[1][0]*s+c[1][1]*l+c[1][2]*u+c[1][3]>r||c[2][0]*s+c[2][1]*l+c[2][2]*u+c[2][3]>r||c[3][0]*s+c[3][1]*l+c[3][2]*u+c[3][3]>r)){var h=this.view[2]*s+this.view[6]*l+this.view[10]*u+this.view[14]-r;if(!(-h<=this.range.far)){if(-h<this.looseRange.far)return void(this.range.far=-h);if(r>f){var d=e.getChildren();if(void 0!==d){for(var p=0;p<8;++p)void 0!==d[p]&&this.includeFarBoundingInfoRec(d[p],t);return}}P.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=b;var _=function(){function e(){this.modelViewProj=i.mat4f64.create(),this.clipPosition=[i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create(),i.vec4f64.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,n,a){var o=this.modelViewProj;i.mat4.multiply(o,t,r);for(var s=!1,l=0;l<8;++l){var u=this.clipPosition[l],c=0===l||3===l||4===l||7===l?n[0]:a[0],h=0===l||1===l||4===l||5===l?n[1]:a[1],d=l<4?n[2]:a[2];u[0]=o[0]*c+o[4]*h+o[8]*d+o[12],u[1]=o[1]*c+o[5]*h+o[9]*d+o[13],u[2]=o[2]*c+o[6]*h+o[10]*d+o[14],u[3]=o[3]*c+o[7]*h+o[11]*d+o[15]}for(l=0;l<12;++l){for(var p=this.clipPosition[x[l][0]],f=this.clipPosition[x[l][1]],m=this.clipPosition[x[l][2]],g=this.clipTriangle(p,f,m),v=!0,y=0;y<g.length;++y){if((b=g[y][3])>=2){v=!1;break}}if(!v){s=!0;for(y=0;y<g.length;++y){var b;(b=g[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void l.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),i.vec4.lerp(i.vec4f64.create(),e,t,n)},e.prototype.clipTriangle=function(e,t,r){for(var i=[e,t,r],n=0;n<4;++n){var a=i;i=[];for(var o=0;o<a.length;++o){var s=a[o],l=a[(o+1)%a.length];this.inside(l,n)?(this.inside(s,n)||i.push(this.intersect(s,l,n)),i.push(l)):this.inside(s,n)&&i.push(this.intersect(s,l,n))}}return i},e}(),x=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],w=i.vec3f64.create(),S=i.mat4f64.create(),C=s.empty(),T=new y,E=new b,P=new _}.apply(null,i))||(e.exports=n)},1711:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1589),r(1561),r(1587),r(1578),r(1559),r(1712),r(1564),r(1562),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){var p=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=r.vec4f64.create(),this.defaultOptions={color:r.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(l.blurPass,{gaussianSamples:p}),this.blurGridProgram=e.getProgram(l.blurPass,{gaussianSamples:p,gridOptimization:!0}),this.applyProgram=e.getProgram(l.applyPass),this.applyGridProgram=e.getProgram(l.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(l.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(l.downsamplePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return i.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t){var n=!i.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,a=i.HIGHLIGHTS_VISUALIZE_BLOCKS,o=e.camera,l=e.fbo,u=this._rctx;s.assert(this.enabled),r.vec4.copy(this.viewportToRestore,o.fullViewport);var c=t.width,d=t.height,p=Math.ceil(c/1),f=Math.ceil(d/1);this.blur0Fbo.resize(p,f),this.blur1Fbo.resize(p,f),u.bindVAO(this.quadVAO),u.setDepthWriteEnabled(!1),u.setDepthTestEnabled(!1),u.setBlendingEnabled(!1);var m=null,g=null,v=null,y=null;if(n){var b=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),v=b.vao,y=4,m=this.blurGridProgram,u.bindProgram(m),u.bindTexture(b.coverageMipmap[b.mipmapLevels].colorTexture,1),m.setUniform1i("coverageTex",1)}else v=this.quadVAO,y=5,m=this.blurProgram,u.bindProgram(m);if(u.bindVAO(v),u.bindFramebuffer(this.blur0Fbo),u.setViewport(0,0,p,f),u.setClearColor(0,0,0,0),u.clear(u.gl.COLOR_BUFFER_BIT),m.setUniform1i("tex",0),u.bindTexture(t.colorTexture,0),m.setUniform2f("blurSize",1/p,0),u.drawArrays(y,0,h.vertexCount(v,"geometry")),u.bindFramebuffer(this.blur1Fbo),u.clear(u.gl.COLOR_BUFFER_BIT),u.bindTexture(this.blur0Fbo.colorTexture,0),m.setUniform2f("blurSize",0,1/f),u.drawArrays(y,0,h.vertexCount(v,"geometry")),u.bindFramebuffer(l),u.setBlendingEnabled(!0),u.setBlendFunctionSeparate(770,771,1,771),u.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),n){g=a?this.applyGridDebugProgram:this.applyGridProgram,u.bindProgram(g),g.setUniform1i("coverageTex",2);var _=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;u.bindTexture(_,2)}else g=this.applyProgram,u.bindProgram(g);g.setUniform1i("tex",0),u.bindTexture(this.blur1Fbo.colorTexture,0),g.setUniform1i("origin",1),u.bindTexture(t.colorTexture,1);var x=e.pixelRatio||1;g.setUniform4fv("color",this.defaultOptions.color),g.setUniform1f("outlineSize",8.6*x),g.setUniform1f("blurSize",.4*x),g.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),u.drawArrays(y,0,h.vertexCount(v,"geometry")),u.bindVAO(null),u.setDepthWriteEnabled(!0),u.setDepthTestEnabled(!0),u.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=o.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=c.createWithAttachments(this._rctx,t,e),this.blur1Fbo=c.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,i=this._grid,o=!1;if(null===i.coverageMipmap&&(i.coverageMipmap=[e],o=!0),i.viewportWidth===e.width&&i.viewportHeight===e.height||(o=!0,i.viewportWidth=e.width,i.viewportHeight=e.height),i.coverageMipmap[0]=e,i.cellPixelSize!==t&&(i.cellPixelSize=t,o=!0),o){for(var s=1;s<i.coverageMipmap.length;s++)i.coverageMipmap[s].dispose();i.mipmapLevels=Math.ceil(Math.log(i.cellPixelSize)*Math.LOG2E),i.coverageMipmap.length=i.mipmapLevels+1;for(s=0;s<i.mipmapLevels;s++){var l=i.coverageMipmap[s],h={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},f=c.createWithAttachments(r,h,p);i.coverageMipmap[s+1]=f}}var m=Math.ceil(e.height/i.cellPixelSize),g=Math.ceil(e.width/i.cellPixelSize);if(!i.vao||i.verticalCellCount!==m||i.horizontalCellCount!==g){i.verticalCellCount=m,i.horizontalCellCount=g;for(var v=m+1,y=g+1,b=1/m,_=1/g,x=new Float32Array(24*v*y),w=0,S=0;S<v;S++)for(var C=0;C<y;C++)x[w+0]=(C-.5)*_*2-1,x[w+1]=(S-.5)*b*2-1,x[w+2]=C*_,x[w+3]=S*b,x[w+4]=(C+.5)*_*2-1,x[w+5]=(S-.5)*b*2-1,x[w+6]=C*_,x[w+7]=S*b,x[w+8]=(C-.5)*_*2-1,x[w+9]=(S+.5)*b*2-1,x[w+10]=C*_,x[w+11]=S*b,x[w+12]=(C-.5)*_*2-1,x[w+13]=(S+.5)*b*2-1,x[w+14]=C*_,x[w+15]=S*b,x[w+16]=(C+.5)*_*2-1,x[w+17]=(S-.5)*b*2-1,x[w+18]=C*_,x[w+19]=S*b,x[w+20]=(C+.5)*_*2-1,x[w+21]=(S+.5)*b*2-1,x[w+22]=C*_,x[w+23]=S*b,w+=24;i.vao&&i.vao.dispose(!0),i.vao=new d(r,n.Default3D,{geometry:a.Pos2Tex},{geometry:u.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var i=0;i<t.mipmapLevels;i++){e.bindFramebuffer(t.coverageMipmap[i+1]),e.bindTexture(t.coverageMipmap[i].colorTexture,0);var n=t.coverageMipmap[i+1].width,a=t.coverageMipmap[i+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/n,1/a),e.setViewport(0,0,n,a),e.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"))}},e}()}.apply(null,i))||(e.exports=n)},1712:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},o=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:i.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:i.resolveIncludes("renderer/highlight/downsample.frag")},attributes:r.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:a(e)+i.resolveIncludes("renderer/highlight/blur.frag")}},attributes:r.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:o(e)+i.resolveIncludes("renderer/highlight/apply.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1713:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(1578),r(1559),r(1714),r(1562),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(e,t){this._quadVAO=null,this._rctx=t,this._colorFBO=void 0,this._viewportToRestore=r.vec4f64.create(),this._combineProgram=e.getProgram(a.combinePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){n.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this._combineProgram;e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,s.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=i.createQuadVAO(this._rctx),this._colorFBO=o.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},1714:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.combinePass={name:"occluded-combine",shaders:{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:i.resolveIncludes("renderer/occluded/combine.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1715:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(92),r(1594),r(1561),r(1587),r(1578),r(1559),r(1598),r(1564),r(1562),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f){function m(e,t,i,n,a,o,s,u){r.vec2.set(N,0,0);for(var c=0;c<4;++c)r.vec2.add(N,N,e[c]);r.vec2.scale(N,N,.25),r.vec2.set(j,0,0);for(c=4;c<8;++c)r.vec2.add(j,j,e[c]);r.vec2.scale(j,j,.25),r.vec2.lerp(G[0],e[4],e[5],.5),r.vec2.lerp(G[1],e[5],e[6],.5),r.vec2.lerp(G[2],e[6],e[7],.5),r.vec2.lerp(G[3],e[7],e[4],.5);var h=0,d=r.vec2.squaredDistance(G[0],N);for(c=1;c<4;++c){var p=r.vec2.squaredDistance(G[c],N);p<d&&(d=p,h=c)}r.vec2.subtract(z,G[h],e[h+4]);var f,m,g=z[0];z[0]=-z[1],z[1]=g,r.vec2.subtract(H,j,N),r.vec2.lerp(z,z,H,i),r.vec2.normalize(z,z),f=m=r.vec2.dot(r.vec2.subtract(k,e[0],N),z);for(c=1;c<8;++c){var v=r.vec2.dot(r.vec2.subtract(k,e[c],N),z);v<f?f=v:v>m&&(m=v)}r.vec2.copy(n,N),r.vec2.scale(k,z,f-t),r.vec2.add(n,n,k);var y=-1,b=1,_=0,x=0;for(c=0;c<8;++c){r.vec2.subtract(W,e[c],n),r.vec2.normalize(W,W);var w=z[0]*W[1]-z[1]*W[0];w>0?w>y&&(y=w,_=c):w<b&&(b=w,x=c)}l.verify(y>0,"leftArea"),l.verify(b<0,"rightArea"),r.vec2.scale(q,z,f),r.vec2.add(q,q,N),r.vec2.scale(X,z,m),r.vec2.add(X,X,N),Y[0]=-z[1],Y[1]=z[0];var S=l.rayRay2D(n,e[x],X,r.vec2.add(k,X,Y),1,a),C=l.rayRay2D(n,e[_],X,k,1,o),T=l.rayRay2D(n,e[_],q,r.vec2.add(k,q,Y),1,s),E=l.rayRay2D(n,e[x],q,k,1,u);l.verify(S,"rayRay"),l.verify(C,"rayRay"),l.verify(T,"rayRay"),l.verify(E,"rayRay")}function g(e,t){return 3*t+e}function v(e,t){return r.vec2.set(Q,e[t],e[t+3]),Q}function y(e,t,i,n,a){r.vec2.subtract(Z,i,n),r.vec2.scale(Z,Z,.5),K[0]=Z[0],K[1]=Z[1],K[2]=0,K[3]=Z[1],K[4]=-Z[0],K[5]=0,K[6]=Z[0]*Z[0]+Z[1]*Z[1],K[7]=Z[0]*Z[1]-Z[1]*Z[0],K[8]=1,K[g(0,2)]=-r.vec2.dot(v(K,0),e),K[g(1,2)]=-r.vec2.dot(v(K,1),e);var o=r.vec2.dot(v(K,0),i)+K[g(0,2)],s=r.vec2.dot(v(K,1),i)+K[g(1,2)],l=r.vec2.dot(v(K,0),n)+K[g(0,2)],u=r.vec2.dot(v(K,1),n)+K[g(1,2)];o=-(o+l)/(s+u),K[g(0,0)]+=K[g(1,0)]*o,K[g(0,1)]+=K[g(1,1)]*o,K[g(0,2)]+=K[g(1,2)]*o,o=1/(r.vec2.dot(v(K,0),i)+K[g(0,2)]),s=1/(r.vec2.dot(v(K,1),i)+K[g(1,2)]),K[g(0,0)]*=o,K[g(0,1)]*=o,K[g(0,2)]*=o,K[g(1,0)]*=s,K[g(1,1)]*=s,K[g(1,2)]*=s,K[g(2,0)]=K[g(1,0)],K[g(2,1)]=K[g(1,1)],K[g(2,2)]=K[g(1,2)],K[g(1,2)]+=1,o=-.5*((o=r.vec2.dot(v(K,1),t)+K[g(1,2)])/(s=r.vec2.dot(v(K,2),t)+K[g(2,2)])+(l=r.vec2.dot(v(K,1),i)+K[g(1,2)])/(u=r.vec2.dot(v(K,2),i)+K[g(2,2)])),K[g(1,0)]+=K[g(2,0)]*o,K[g(1,1)]+=K[g(2,1)]*o,K[g(1,2)]+=K[g(2,2)]*o,o=r.vec2.dot(v(K,1),t)+K[g(1,2)],l=-(s=r.vec2.dot(v(K,2),t)+K[g(2,2)])/o,K[g(1,0)]*=l,K[g(1,1)]*=l,K[g(1,2)]*=l,a[0]=K[0],a[1]=K[1],a[2]=0,a[3]=K[2],a[4]=K[3],a[5]=K[4],a[6]=0,a[7]=K[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=K[6],a[13]=K[7],a[14]=0,a[15]=K[8]}for(var b=function(){return function(){this.camera=new n,this.lightMat=r.mat4f64.create()}}(),_=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var r=0;r<4;++r)this.cascades.push(new b)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=i.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)L[e]=this.cascades[e];return L.length=this.numCascades,L},e.prototype.prepare=function(e,t,n,a){l.assert(this.enabled),r.mat4.multiply(w,e.projectionMatrix,e.viewMatrix);var o=a.near,s=a.far;o<2&&(o=2),s<2&&(s=2),o>=s&&(o=2,s=4),this.numCascades=Math.min(1+Math.floor(l.logWithBase(s/o,4)),this.maxNumCascades);for(var u=Math.pow(s/o,1/this.numCascades),c=0;c<this.numCascades+1;++c)this.cascadeDistances[c]=o*Math.pow(u,c);r.mat4.invert(S,w),r.mat4.lookAt(F,[0,0,0],[-t[0],-t[1],-t[2]],[0,1,0]);var h=e.viewMatrix,d=e.projectionMatrix;for(c=0;c<this.numCascades;++c){var p=this.cascades[c],f=-this.cascadeDistances[c],g=-this.cascadeDistances[c+1],v=(d[10]*f+d[14])/Math.abs(d[11]*f+d[15]),b=(d[10]*g+d[14])/Math.abs(d[11]*g+d[15]);l.assert(v<b);for(var _=0;_<8;++_){var E=_%4==0||_%4==3?-1:1,L=_%4==0||_%4==1?-1:1,U=_<4?v:b;r.vec4.set(C,E,L,U,1),r.vec4.transformMat4(T[_],C,S);for(var B=0;B<3;++B)T[_][B]/=T[_][3]}r.vec3.negate(V,T[0]),r.mat4.translate(x,F,V),p.camera.viewMatrix=x;for(_=0;_<8;++_)r.vec3.transformMat4(T[_],T[_],p.camera.viewMatrix);r.vec3.copy(P,T[0]),r.vec3.copy(O,T[0]);for(_=1;_<8;++_)for(B=0;B<3;++B)P[B]=Math.min(P[B],T[_][B]),O[B]=Math.max(O[B],T[_][B]);P[2]-=200,O[2]+=200,p.camera.near=-O[2],p.camera.far=-P[2],o=1/T[0][3],s=1/T[4][3],l.assert(o<s);var N=o+Math.sqrt(o*s),j=Math.sin(i.acos(h[2]*t[0]+h[6]*t[1]+h[10]*t[2]));m(T,N/=j,j,R,A,M,I,D),y(R,A,I,D,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(P[2]-O[2]),p.camera.projectionMatrix[14]=-(P[2]+O[2])/(P[2]-O[2]),r.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);var G=this.textureRes/2;p.camera.viewport[0]=c%2==0?0:G,p.camera.viewport[1]=0===Math.floor(c/2)?0:G,p.camera.viewport[2]=G,p.camera.viewport[3]=G}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*s;var z=this.rctx,H=z.gl;z.bindFramebuffer(this.fbo),z.bindTexture(null,7),z.setClearColor(1,1,1,1),z.clear(H.COLOR_BUFFER_BIT|H.DEPTH_BUFFER_BIT),z.setBlendingEnabled(!1)},e.prototype.finish=function(e){l.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var i=this.lastOrigin;if(!i||i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]){this.lastOrigin=this.lastOrigin||r.vec3f64.create(),r.vec3.copy(this.lastOrigin,t);for(var n=0;n<this.numCascades;++n){r.mat4.translate(U,this.cascades[n].lightMat,t);for(var a=0;a<16;++a)B[16*n+a]=U[a]}}e.setUniformMatrix4fv("shadowMapMatrix",B)}},e.prototype.drawDebugQuad=function(e){l.assert(this.enabled);var t=this.rctx,r=t.gl;if(!this.debugQuadVAO){var i=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new f(t,a.Default3D,{geometry:o.Pos2Tex},{geometry:c.createVertex(t,r.STATIC_DRAW,i)})}var n=this.programRep.getProgram(u.showDepth),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(n),n.setUniformMatrix4fv("proj",e),n.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),p.assertCompatibleVertexAttributeLocations(s,n),t.drawArrays(r.TRIANGLE_STRIP,0,p.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new d(this.rctx,t),this.fbo=h.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=r.mat4f64.create(),w=r.mat4f64.create(),S=r.mat4f64.create(),C=r.vec4f64.create(),T=[],E=0;E<8;++E)T.push(r.vec4f64.create());var P=r.vec3f64.create(),O=r.vec3f64.create(),R=r.vec2f64.create(),A=r.vec2f64.create(),M=r.vec2f64.create(),I=r.vec2f64.create(),D=r.vec2f64.create(),F=r.mat4f64.create(),V=r.vec3f64.create(),L=[],U=r.mat4f64.create(),B=new Float32Array(64),N=r.vec2f64.create(),j=r.vec2f64.create(),G=[r.vec2f64.create(),r.vec2f64.create(),r.vec2f64.create(),r.vec2f64.create()],z=r.vec2f64.create(),H=r.vec2f64.create(),k=r.vec2f64.create(),W=r.vec2f64.create(),q=r.vec2f64.create(),X=r.vec2f64.create(),Y=r.vec2f64.create(),Q=r.vec2f64.create(),Z=r.vec2f64.create(),K=r.mat3f64.create();return _}.apply(null,i))||(e.exports=n)},1716:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(38),r(1601),r(1561),r(1587),r(1578),r(1559),r(1598),r(1717),r(1564),r(1562),r(1560),r(1569),r(1567)],void 0===(n=function(e,t,i,n,a,o,s,l,u,c,h,d,p,f,m,g){var v=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=n.vec4f64.create(),this._rctx=t,this._programRep=e,this._requestRender=r,this._emptyTexture=l.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r,i){if(this._noiseTexture){u.assert(this.enabled);var a=this._rctx,o=r.width,s=r.height,c=o/this._BLUR_F,h=s/this._BLUR_F;this._ssaoFBO.resize(o,s),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);var d=1*o,p=1*s;a.bindFramebuffer(this._ssaoFBO),n.vec4.copy(this._viewportToRestore,e.fullViewport),a.setViewport(0,0,o,s);var f=this._ssaoProgram,g=this._blurProgram;f.setUniform2f("rnmScale",o/this._noiseTexture.descriptor.width,s/this._noiseTexture.descriptor.height),f.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),a.bindProgram(f);var v=this._data.minDiscrepancy,y=this._samples<v.length?v[this._samples]:5779;f.setUniform1f("numSpiralTurns",y);var x=_,w=b;u.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,w),f.setUniform4fv("projInfo",x),f.setUniform2fv("zScale",w),f.setUniform2f("nearFar",e.near,e.far);var S=1/e.computePixelSizeAtDist(1);f.setUniform1f("projScale",1*S),f.setUniform2f("screenDimensions",d,p);var C=2*this._radius,T=n.vec3.distance(e.eye,e.center);C=20*e.computePixelSizeAtDist(T),C=Math.max(.1,C),f.setUniform1f("radius",C),f.setUniform1f("intensity",4*this._attenuation/Math.pow(C,6)),f.setUniform1i("rnm",0),f.setUniform1i("normalMap",1),f.setUniform1i("depthMap",2),a.bindTexture(this._noiseTexture,0),a.bindTexture(i.colorTexture,1),a.bindTexture(r.colorTexture,2);var E=l.createQuadVAO(this._rctx);a.bindVAO(E),a.drawArrays(5,0,m.vertexCount(E,"geometry")),a.bindTexture(this._ssaoFBO.colorTexture,0),a.setViewport(0,0,d/this._BLUR_F,p/this._BLUR_F),a.bindFramebuffer(this._blur0FBO),g.setUniform2f("screenDimensions",d,p),g.setUniform1i("tex",0),g.setUniform1i("normalMap",1),g.setUniform1i("depthMap",2),g.setUniform2f("blurSize",0,1*this._BLUR_F/p),g.setUniform1i("radius",4),g.setUniform1f("g_BlurFalloff",.08),g.setUniform2f("nearFar",e.near,e.far),T>5e4&&(S=Math.max(0,S-(T-5e4))),g.setUniform1f("projScale",S),g.setUniform2f("zScale",1,0),a.drawArrays(5,0,m.vertexCount(E,"geometry")),g.setUniform2f("blurSize",1*this._BLUR_F/d,0),a.bindFramebuffer(this._blur1FBO),a.bindTexture(this._blur0FBO.colorTexture,0),a.drawArrays(5,0,m.vertexCount(E,"geometry")),a.bindFramebuffer(t),a.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.drawQuad=function(e){u.assert(this.enabled);var t=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new g(this._rctx,o.Default3D,{geometry:s.Pos2Tex},{geometry:d.createVertex(this._rctx,35044,x)}));var r=this._rctx;r.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),r.bindTexture(this._ssaoFBO.colorTexture,0),r.bindVAO(this._debugQuadVAO),r.drawArrays(5,0,m.vertexCount(this._debugQuadVAO,"geometry")),r.setDepthTestEnabled(!0)},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(h.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(h.blurPass,{radius:4}),this._showDepthProgram=this._programRep.getProgram(c.showDepth)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void v.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(63).then(function(){var i=[r(1839)];(function(r){t._data=r,e()}).apply(null,i)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,t,r),this._blur0FBO=p.createWithAttachments(this._rctx,t,r),this._blur1FBO=p.createWithAttachments(this._rctx,t,r),a.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new f(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e}(),b=n.vec2f64.create(),_=n.vec4f64.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return y}.apply(null,i))||(e.exports=n)},1717:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define SAMPLES "+e.samples+"\n"}(e)+i.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:r.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define RADIUS "+e.radius+"\n"}(e)+i.resolveIncludes("renderer/ssao/blur.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1718:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1560)],void 0===(n=function(e,t,r){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var n=542327876,a=131072,o=4,s=33776,l=33778,u=33779,c=i("DXT1"),h=i("DXT3"),d=i("DXT5"),p=31,f=0,m=1,g=2,v=3,y=4,b=7,_=20,x=21;t.createDDSTexture=function(e,t,i,w){var S=new Int32Array(i,0,p);if(S[f]!==n)return console.error("Invalid magic number in DDS header"),null;if(!(S[_]&o))return console.error("Unsupported format, must contain a FourCC code"),null;var C,T,E=S[x];switch(E){case c:C=8,T=s;break;case h:C=16,T=l;break;case d:C=16,T=u;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(E)),null}var P=1;S[g]&a&&!1!==w&&(P=Math.max(1,S[b]));for(var O,R,A=S[y],M=S[v],I=S[m]+4,D=[],F=0;F<P;++F)R=Math.floor((A+3)/4)*Math.floor((M+3)/4)*C,O=new Uint8Array(i,I,R),D.push(O),I+=R,A=Math.max(1,A>>1),M=Math.max(1,M>>1);t.samplingMode=P>1?9987:9729,t.hasMipmap=P>1,t.width=S[y],t.height=S[v],t.internalFormat=T;var V=new r(e,t,{type:"compressed",levels:D});return e.bindTexture(V),V}}.apply(null,i))||(e.exports=n)},1719:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===e.viewingMode,VIEWING_MODE_LOCAL:"local"===e.viewingMode,TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TEXTURE_ALPHA_TEST:e.textureAlphaTest,ALPHA_COVERAGE_CORRECTION:e.alphaCoverageCorrection,BIAS_SHADOWMAP:e.shadowMap,TREE_RENDERING:e.treeRendering,IOS_SAFARI_FIX:e.iosSafariFix})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1720:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(9),r(38),r(1571),r(1590),r(1572),r(1604),r(1591),r(1559),r(1595),r(1568),r(1759)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p){var f,m=i.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),g=function(e){function t(t,r){var i=e.call(this,r)||this;return i.bufferWriter=new x,i.canBeMerged=!0,i.params=d.copyParameters(t,b),i}return r(t,e),t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.getParameterValues=function(){return d.copyParameters(this.params)},t.prototype.intersect=function(e,t,r,i,o,l,u,h){if(i.isSelection&&!s.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!c.isTranslationMatrix(r))return void m.error("intersection assumes a translation-only matrix");var d=e.data.getVertexAttr().position.data,p=i.camera,f=i.point;n.vec3.set(I[0],f[0]-2,f[1]+2,0),n.vec3.set(I[1],f[0]+2,f[1]+2,0),n.vec3.set(I[2],f[0]+2,f[1]-2,0),n.vec3.set(I[3],f[0]-2,f[1]-2,0);for(var g=0;g<4;g++)p.unprojectPoint(I[g],D[g]);a.plane.fromPoints(p.eye,D[0],D[1],F),a.plane.fromPoints(p.eye,D[1],D[2],V),a.plane.fromPoints(p.eye,D[2],D[3],L),a.plane.fromPoints(p.eye,D[3],D[0],U);var v=Number.MAX_VALUE;for(g=0;g<d.length-5;g+=3)if(w[0]=d[g]+r[12],w[1]=d[g+1]+r[13],w[2]=d[g+2]+r[14],S[0]=d[g+3]+r[12],S[1]=d[g+4]+r[13],S[2]=d[g+5]+r[14],!(a.plane.signedDistance(F,w)<0&&a.plane.signedDistance(F,S)<0||a.plane.signedDistance(V,w)<0&&a.plane.signedDistance(V,S)<0||a.plane.signedDistance(L,w)<0&&a.plane.signedDistance(L,S)<0||a.plane.signedDistance(U,w)<0&&a.plane.signedDistance(U,S)<0)){if(p.projectPoint(w,E),p.projectPoint(S,P),E[2]<0&&P[2]>0){n.vec3.subtract(C,w,S);var y=p.frustum,b=-a.plane.signedDistance(y.planes[4],w)/n.vec3.dot(C,y.planes[4]);n.vec3.scale(C,C,b),n.vec3.add(w,w,C),p.projectPoint(w,E)}else if(E[2]>0&&P[2]<0){n.vec3.subtract(C,S,w);y=p.frustum,b=-a.plane.signedDistance(y.planes[4],S)/n.vec3.dot(C,y.planes[4]);n.vec3.scale(C,C,b),n.vec3.add(S,S,C),p.projectPoint(S,P)}else if(E[2]<0&&P[2]<0)continue;var _=c.pointLineSegmentDistanceSquared2D(E,P,f);_<v&&(v=_,n.vec3.copy(O,w),n.vec3.copy(R,S))}var x=i.p0,B=i.p1;if(v<4){var N=Number.MAX_VALUE;if(a.lineSegment.closestLineSegmentPoint(a.lineSegment.fromPoints(O,R,A),a.lineSegment.fromPoints(x,B,M),T)){n.vec3.subtract(T,T,x);var j=n.vec3.length(T);n.vec3.scale(T,T,1/j),N=j/n.vec3.distance(x,B)}u(N,T)}}},t.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:y}},t.prototype.getAllTextureIds=function(){return[]},t}(u),v=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(p.colorPass,{slice:this.params.slicePlaneEnabled})},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform4fv("color",i.color),e.setBlendingEnabled(i.color[3]<1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){this.params.color[3]<1&&e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;d.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&d.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 1},t}(l),y=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(p.highlightPass,{slice:this.params.slicePlaneEnabled})},t.prototype.bind=function(e,t){e.bindProgram(this.program),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;d.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&d.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 1},t}(l),b={color:[1,1,1,1],slicePlaneEnabled:!1},_=o.newLayout().vec3f(c.VertexAttrConstants.POSITION),x=function(){function e(){this.vertexBufferLayout=_}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[c.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){var a=t.vertexAttr[c.VertexAttrConstants.POSITION].data,o=a,s=e.transformation;if(s){(!f||f.length<a.length)&&(f=new Float32Array(a.length)),o=f;for(var l=0;l<a.length;l+=3){var u=a[l],d=a[l+1],p=a[l+2];o[l]=s[0]*u+s[4]*d+s[8]*p+s[12],o[l+1]=s[1]*u+s[5]*d+s[9]*p+s[13],o[l+2]=s[2]*u+s[6]*d+s[10]*p+s[14]}}var m=t.indices[c.VertexAttrConstants.POSITION];h.writeBufferVec3(m,o,i.position,n)},e}(),w=n.vec3f64.create(),S=n.vec3f64.create(),C=n.vec3f64.create(),T=n.vec3f64.create(),E=n.vec3f64.create(),P=n.vec3f64.create(),O=n.vec3f64.create(),R=n.vec3f64.create(),A=a.lineSegment.create(),M=a.lineSegment.create(),I=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],D=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],F=a.plane.create(),V=a.plane.create(),L=a.plane.create(),U=a.plane.create();return g}.apply(null,i))||(e.exports=n)},1721:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1576),r(1559),r(1720),r(1632)],void 0===(n=function(e,t,r,i,n,a){function o(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}Object.defineProperty(t,"__esModule",{value:!0});var s=i.VertexAttrConstants;t.createRibbonMaterial=function(e){var t={width:e.width,color:e.color,miterLimit:e.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:e.slicePlaneEnabled};return"miter"===e.join||"bevel"===e.join?t.join=e.join:e.join&&console.warn("unsupported join type for line symbol: "+e.join),new a(t,e.idHint+"_ribbonlinemat")},t.createNativeMaterial=function(e){var t={color:e.color,slicePlaneEnabled:e.slicePlaneEnabled};return new n(t,e.idHint+"_nativelinemat")},t.isClosed=o,t.createPolylineGeometry=function(e,t,i,n,a){var l,u,c,h;if(i=i&&!o(e)){for(var d=new Float32Array(e.length+3),p=0;p<e.length;p++)d[p]=e[p];var f=d.length;d[f-3]=e[0],d[f-2]=e[1],d[f-1]=e[2],u=d,l=e.length/3+1,c=new Uint32Array(2*(l-1)),h=new Uint32Array(2*(l-1))}else l=e.length/3,c=new Uint32Array(2*(l-1)),h=new Uint32Array(2*(l-1)),u=e;var m=new Float32Array(1);m[0]=a;for(var g=0,v=0,y=0;y<l-1;y++)c[g++]=y,c[g++]=y+1,h[v++]=0,h[v++]=0;var b={},_={};return b[s.POSITION]=c,b[s.COLOR]=h,b[s.SIZE]=h,_[s.POSITION]={size:3,data:u,offsetIdx:0,strideIdx:3},_[s.COLOR]={size:4,data:n,offsetIdx:0,strideIdx:4},_[s.SIZE]={size:1,data:m,offsetIdx:0,strideIdx:1},t&&(b.mapPos=c,_.mapPos={size:3,data:t,offsetIdx:0,strideIdx:3}),new r(_,b,r.DefaultOffsets,"line")}}.apply(null,i))||(e.exports=n)},1722:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){void 0===r&&(r=""),this.major=e,this.minor=t,this._context=r}return e.prototype.lessThan=function(e,t){return this.major<e||e===this.major&&this.minor<t},e.prototype.since=function(e,t){return!this.lessThan(e,t)},e.prototype.validate=function(e){if(this.major!==e.major){var t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new r(t+"unsupported-version","Required major "+i+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:e})}},e.prototype.clone=function(){return new e(this.major,this.minor,this._context)},e.parse=function(t,i){void 0===i&&(i="");var n=t.split("."),a=n[0],o=n[1],s=/^\s*\d+\s*$/;if(!a||!a.match||!a.match(s))throw new r((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!o||!o.match||!o.match(s))throw new r((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});return new e(parseInt(a,10),parseInt(o,10),i)},e}();t.Version=i}.apply(null,i))||(e.exports=n)},1723:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(1563),r(1570),r(1596)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o=i.fromValues(-.5,-.5,-.5,.5,.5,.5),s=i.fromValues(-.5,-.5,0,.5,.5,1),l=i.fromValues(-.5,-.5,0,.5,.5,.5);t.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},t.primitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return s;case"tetrahedron":return l;default:r.neverReached(e)}},t.primitiveGeometryData=function(e){switch(e){case"sphere":return a.createPolySphereGeometry(.5,2,!0);case"cube":return a.createBoxGeometry(1);case"cylinder":return a.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case"cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!1));case"inverted-cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!0));case"tetrahedron":return a.cgToGIS(a.createTetrahedronGeometry(1));case"diamond":return a.cgToGIS(a.createDiamondGeometry(1));default:r.neverReached(e)}},t.primitiveLodResources=function(e,t,i){var o=function(e,r,o){return void 0===o&&(o=!1),{levels:e.map(function(e,s){var l=r(e.tesselation);return o&&a.cgToGIS(l),{components:[{geometry:new n(l,i+"_lod"+s),material:t}],faceCount:l.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})}};switch(e){case"sphere":return o([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(e){return a.createPolySphereGeometry(.5,e,!0)});case"cube":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createBoxGeometry(1)});case"cone":return o(u,function(e){return a.createConeGeometry(1,.5,e,!1)},!0);case"inverted-cone":return o(u,function(e){return a.createConeGeometry(1,.5,e,!0)},!0);case"cylinder":return o(u,function(e){return a.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])});case"tetrahedron":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createTetrahedronGeometry(1)},!0);case"diamond":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createDiamondGeometry(1)},!0);default:r.neverReached(e)}};var u=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]}.apply(null,i))||(e.exports=n)},1724:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(26),r(38),r(1571),r(92),r(1576),r(1596),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){var c;!function(e){var t=function(){function e(e){this.pos=e,this.mapPos=n.vec3f32.create(),this.vRight=n.vec3f32.create(),this.vLeft=n.vec3f32.create(),this.frame={forward:n.vec3f32.create(),up:n.vec3f32.create(),right:n.vec3f32.create()},this.rotationAxis=n.vec3f32.create(),this.angle=0}return e.prototype.profileSpaceToVertexSpace=function(e,t){e[0]=t[0]*this.frame.right[0]+t[1]*this.frame.up[0],e[1]=t[0]*this.frame.right[1]+t[1]*this.frame.up[1],e[2]=t[0]*this.frame.right[2]+t[1]*this.frame.up[2]},e}();e.PathVertex=t;var c=function(){function e(){this.vertices=[],this.vertexIndices=[],this.normals=null,this.normalIndices=null,this.uvs=null,this.uvIndices=null}return e.prototype.addVertex=function(e){return this.vertices.push(n.vec2f32.clone(e)),this.vertices.length-1},e.prototype.addNormal=function(e){return this.normals||(this.normals=[],this.normalIndices=[]),this.normals.push(n.vec2f32.clone(e)),this.normals.length-1},e.prototype.addUV=function(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1},e.prototype.addSegment=function(e,t,r,i,n,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===a&&(a=null),this.vertexIndices.push(e),this.vertexIndices.push(t),null!==r&&null!==i&&(this.normalIndices.push(r),this.normalIndices.push(i)),null!==n&&null!==a&&(this.uvIndices.push(n),this.uvIndices.push(a))},Object.defineProperty(e.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0}),e.prototype.hasNormals=function(){return null!=this.normals},e.prototype.hasUV=function(){return null!=this.uvs},e.prototype.normalize=function(){for(var e=0,t=0,r=this.vertices;t<r.length;t++){var i=r[t];e=Math.max(e,n.vec2.length(i))}for(var a=1/e,o=0,s=this.vertices;o<s.length;o++){i=s[o];n.vec2.scale(i,i,a)}},e.tube=function(t){void 0===t&&(t=20);for(var r=new e,i=0;i<t;++i){var a=2*i*Math.PI/t;r.addVertex(n.vec2f32.fromValues(1*Math.cos(a),1*Math.sin(a))),r.addUV(i/t)}r.addUV(1);for(i=0;i<t-1;++i)r.addSegment(i,i+1,null,null,i,i+1);return r.addSegment(t-1,0,null,null,t-1,t),r},e.line=function(t,r){var i=new e,a=r[0]-t[0],o=r[1]-t[1];return i.addVertex(t),i.addVertex(r),i.addNormal(n.vec2f32.fromValues(-o,a)),i.addUV(0),i.addUV(1),i.addSegment(0,1,0,0,0,1),i},e.point=function(t){var r=new e;return r.addVertex(t),r},e.wall=function(t,r){void 0===t&&(t=.2),void 0===r&&(r=1);var i=new e;return i.addVertex(n.vec2f32.fromValues(.5*-t,0)),i.addVertex(n.vec2f32.fromValues(.5*t,0)),i.addVertex(n.vec2f32.fromValues(.5*t,r)),i.addVertex(n.vec2f32.fromValues(.5*-t,r)),i.addNormal(n.vec2f32.fromValues(0,-1)),i.addNormal(n.vec2f32.fromValues(1,0)),i.addNormal(n.vec2f32.fromValues(0,1)),i.addNormal(n.vec2f32.fromValues(-1,0)),i.addUV(0),i.addUV(1),i.addSegment(0,1,0,0,0,1),i.addSegment(1,2,1,1,0,1),i.addSegment(2,3,2,2,0,1),i.addSegment(3,0,3,3,0,1),i},e.strip=function(){return this.line(n.vec2f32.fromValues(-1,0),n.vec2f32.fromValues(1,0))},e.fence=function(){return this.line(n.vec2f32.fromValues(0,0),n.vec2f32.fromValues(0,1))},e}();e.Profile=c;var _=function(){return function(e,r,i,s,u,c){this.vertices=[],this.offset=n.vec3f32.create(),n.vec3.copy(this.offset,c);for(var h=i;h<i+s;++h){var d=new t(n.vec3f32.fromValues(e[3*h+0],e[3*h+1],e[3*h+2]));n.vec3.set(d.mapPos,r[3*h+0],r[3*h+1],r[3*h+2]),this.vertices.push(d)}var p,f,g=n.vec3f32.create(),v=n.vec3f32.create(),y=n.vec3f32.create(),b=n.vec3f32.create(),_=n.vec3f32.create(),x=n.vec3f64.create(),w=n.vec3f32.create(),S=n.vec3f32.create(),C=n.vec3f32.create(),T=n.vec3f32.create(),E=a.plane.create(),P=this.vertices[0];n.vec3.set(w,0,1,0),n.vec3.subtract(v,this.vertices[1].pos,P.pos),p=0,f=n.vec3.length(v),n.vec3.normalize(v,v),u?(n.vec3.add(x,P.pos,this.offset),n.vec3.normalize(y,x)):n.vec3.set(y,0,0,1),l.makeOrthoBasisDirUpFallback(v,y,w,w,_,y,.99619469809),n.vec3.copy(b,y),n.vec3.copy(T,_),n.vec3.copy(P.vRight,v),n.vec3.copy(P.vLeft,g),n.vec3.copy(P.frame.forward,v),n.vec3.copy(P.frame.up,y),n.vec3.copy(P.frame.right,_),P.vLeftLength=p,P.vRightLength=f,P.index=0,n.vec3.cross(P.rotationAxis,P.vLeft,P.vRight),n.vec3.normalize(P.rotationAxis,P.rotationAxis),P.angle=0;for(var O=1;O<s;++O)P=this.vertices[O],n.vec3.copy(g,v),p=f,O<s-1&&(n.vec3.subtract(v,this.vertices[O+1].pos,P.pos),f=n.vec3.length(v),n.vec3.normalize(v,v)),n.vec3.add(S,g,v),n.vec3.normalize(S,S),n.vec3.add(C,this.vertices[O-1].pos,b),a.plane.fromPositionAndNormal(this.vertices[O].pos,S,E),a.plane.intersectRay(E,a.ray.wrap(C,g),x)?(n.vec3.subtract(x,x,this.vertices[O].pos),n.vec3.normalize(y,x),n.vec3.cross(_,S,y),n.vec3.normalize(_,_)):l.makeOrthoBasisDirUpFallback(S,b,T,w,_,y,.99619469809),n.vec3.copy(b,y),n.vec3.copy(T,_),n.vec3.copy(P.vRight,v),n.vec3.copy(P.vLeft,g),n.vec3.copy(P.frame.forward,S),n.vec3.copy(P.frame.up,y),n.vec3.copy(P.frame.right,_),P.vLeftLength=p,P.vRightLength=f,P.index=O,n.vec3.cross(P.rotationAxis,P.vLeft,P.vRight),n.vec3.normalize(P.rotationAxis,P.rotationAxis),n.vec3.negate(m,P.vLeft),P.angle=Math.PI-o.acos(n.vec3.dot(m,P.vRight))}}();e.Path=_;var x=function(){return function(){}}();e.Extruder=x;var w=function(){function e(){}return e.prototype.numVertices=function(e){return e.vertices.length},e.prototype.extrude=function(e,t,r){for(var i=0;i<t.vertices.length;++i){var n=t.vertices[i];n.profileSpaceToVertexSpace(p,e),r(n.pos,p,i)}},e}();e.SimpleExtruder=w;var S=function(){function e(e){void 0===e&&(e=1),this._segmentsPerRadian=e/Math.PI}return e.prototype.getNumSegments=function(e){return Math.ceil(e*this._segmentsPerRadian)},e.prototype.numVertices=function(e){for(var t=2,r=1;r<e.vertices.length-1;++r)t+=this.getNumSegments(e.vertices[r].angle)+1;return t},e.prototype.extrude=function(e,t,r){t.vertices[0].profileSpaceToVertexSpace(p,e),r(t.vertices[0].pos,p,0),n.vec3.copy(g,p);for(var i=1;i<t.vertices.length-1;++i){var a=t.vertices[i];a.profileSpaceToVertexSpace(p,e);var o=this.getNumSegments(a.angle);if(n.mat4.identity(b),n.mat4.rotate(b,b,.5*-a.angle,a.rotationAxis),n.vec3.transformMat4(v,p,b),n.vec3.dot(v,a.vRight)>=0){for(var s=0;s<o+1;++s)r(a.pos,p,i);n.vec3.copy(g,p)}else{n.mat4.identity(b),n.mat4.rotate(b,b,a.angle/o,a.rotationAxis),r(a.pos,v,i),n.vec3.copy(y,v);for(s=0;s<o;++s)n.vec3.transformMat4(y,y,b),r(a.pos,y,i);n.vec3.copy(g,y)}}var l=t.vertices.length-1;t.vertices[l].profileSpaceToVertexSpace(p,e),r(t.vertices[l].pos,p,l)},e}();e.RoundExtruder=S;var C=function(e){function t(){return e.call(this,1)||this}return i(t,e),t}(S);e.BevelExtruder=C;var T=function(){function e(e,t,r){this.vvData=null,this._extrusionVertexCount=0,this._extrusionNormalCount=0,this._numExtrusionVertices=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this._capNormalsOffset=0,this._profile=t,this._profile.normalize(),this.path=e,this._extruder=r,this._numExtrusionVertices=r.numVertices(e),this.numVerticesTotal=t.vertices.length*this._numExtrusionVertices,this._profile.hasNormals()?this.numNormalsTotal=this._profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal,this.numNormalsTotal+=2,this.originData=new Float32Array(3*this.numVerticesTotal),this.directionData=new Float32Array(4*this.numVerticesTotal),this.normalData=new Float32Array(3*this.numNormalsTotal),this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this._profile.hasUV()&&(this.numUVTotal=this._profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.buildGeometry(),this.buildTopology()}return e.prototype.setVisualVariableValue=function(e){this.vvData||(this.vvData=new Float32Array(4*this.path.vertices.length));for(var t=0;t<this.path.vertices.length;++t)this.vvData[4*t+0]=e[0],this.vvData[4*t+1]=e[1]},e.queryVertexPosition=function(e,t){n.vec3.copy(e,t.direction),t.vvSizeEnabled?(n.vec3.copy(f,t.vvSizeFactor),n.vec3.scale(f,f,t.auxpos2X),n.vec3.add(f,f,t.vvSizeOffset),function(e,t,r){e[0]=Math.min(Math.max(e[0],t[0]),r[0]),e[1]=Math.min(Math.max(e[1],t[1]),r[1]),e[2]=Math.min(Math.max(e[2],t[2]),r[2])}(f,t.vvSizeMinSize,t.vvSizeMaxSize),n.vec3.multiply(e,e,f)):n.vec3.scale(e,e,t.size),n.vec3.add(e,e,t.origin)},e.prototype.emitVertex=function(e,t,r){this.originData[3*this._extrusionVertexCount+0]=e[0],this.originData[3*this._extrusionVertexCount+1]=e[1],this.originData[3*this._extrusionVertexCount+2]=e[2],this.directionData[4*this._extrusionVertexCount+0]=t[0],this.directionData[4*this._extrusionVertexCount+1]=t[1],this.directionData[4*this._extrusionVertexCount+2]=t[2],this.directionData[4*this._extrusionVertexCount+3]=r/(this.path.vertices.length-1),this.pathVertexData[this._extrusionVertexCount]=r,++this._extrusionVertexCount},e.prototype.emitNormal=function(e,t,r){n.vec3.normalize(f,t),this.normalData[3*this._extrusionNormalCount+0]=f[0],this.normalData[3*this._extrusionNormalCount+1]=f[1],this.normalData[3*this._extrusionNormalCount+2]=f[2],++this._extrusionNormalCount},e.prototype.buildGeometry=function(){var e=this.emitVertex.bind(this),t=this.emitNormal.bind(this);this._extrusionVertexCount=0,this._extrusionNormalCount=0;for(var r=0;r<this._profile.vertices.length;++r)this._extruder.extrude(this._profile.vertices[r],this.path,e);if(this._profile.hasNormals())for(var i=0;i<this._profile.normals.length;++i)this._extruder.extrude(this._profile.normals[i],this.path,t);else for(i=0;i<this._extrusionVertexCount;++i)n.vec3.set(f,this.directionData[4*i+0],this.directionData[4*i+1],this.directionData[4*i+2]),n.vec3.normalize(f,f),this.normalData[3*this._extrusionNormalCount+0]=f[0],this.normalData[3*this._extrusionNormalCount+1]=f[1],this.normalData[3*this._extrusionNormalCount+2]=f[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;var a=this.path.vertices[0],o=this.path.vertices[this.path.vertices.length-1];if(this.normalData[3*this._extrusionNormalCount+0]=-a.vRight[0],this.normalData[3*this._extrusionNormalCount+1]=-a.vRight[1],this.normalData[3*this._extrusionNormalCount+2]=-a.vRight[2],++this._extrusionNormalCount,this.normalData[3*this._extrusionNormalCount+0]=o.vRight[0],this.normalData[3*this._extrusionNormalCount+1]=o.vRight[1],this.normalData[3*this._extrusionNormalCount+2]=o.vRight[2],++this._extrusionNormalCount,this._profile.hasUV())for(i=0;i<this._profile.uvs.length;++i)this.uvData[2*i+0]=this._profile.uvs[i],this.uvData[2*i+1]=0},e.prototype.buildTopology=function(){var e=this._profile.numSegments,t=this._numExtrusionVertices-1,r=3*(2*(e*t));this._profile.vertices.length>2&&(r+=2*(this._profile.vertices.length-2)*3),this._vertexIndices=new Uint32Array(r),this._normalIndices=new Uint32Array(r),this._pathVertexIndices=new Uint32Array(r),this._profile.hasUV()&&(this._uvIndices=new Uint32Array(r));for(var i=0,n=0;n<e;++n){var a=w=this._profile.vertexIndices[2*n],o=E=this._profile.vertexIndices[2*n+1],s=0,l=0;this._profile.hasNormals()&&(a=this._profile.normalIndices[2*n],o=this._profile.normalIndices[2*n+1]),this._profile.hasUV()&&(s=this._profile.uvIndices[2*n],l=this._profile.uvIndices[2*n+1]);for(var u=0;u<t;++u){var c=w*this._numExtrusionVertices+u,h=w*this._numExtrusionVertices+u+1,d=E*this._numExtrusionVertices+u+1,p=E*this._numExtrusionVertices+u,f=a*this._numExtrusionVertices+u,m=a*this._numExtrusionVertices+u+1,g=o*this._numExtrusionVertices+u+1,v=o*this._numExtrusionVertices+u,y=s,b=s,_=l,x=l;this._vertexIndices[3*i+0]=c,this._vertexIndices[3*i+1]=h,this._vertexIndices[3*i+2]=d,this._pathVertexIndices[3*i+0]=this.pathVertexData[c],this._pathVertexIndices[3*i+1]=this.pathVertexData[h],this._pathVertexIndices[3*i+2]=this.pathVertexData[d],this._normalIndices[3*i+0]=f,this._normalIndices[3*i+1]=m,this._normalIndices[3*i+2]=g,this._vertexIndices[3*i+3]=c,this._vertexIndices[3*i+4]=d,this._vertexIndices[3*i+5]=p,this._pathVertexIndices[3*i+3]=this.pathVertexData[c],this._pathVertexIndices[3*i+4]=this.pathVertexData[d],this._pathVertexIndices[3*i+5]=this.pathVertexData[p],this._normalIndices[3*i+3]=f,this._normalIndices[3*i+4]=g,this._normalIndices[3*i+5]=v,this._profile.hasUV()&&(this._uvIndices[3*i+0]=y,this._uvIndices[3*i+1]=b,this._uvIndices[3*i+2]=_,this._uvIndices[3*i+3]=y,this._uvIndices[3*i+4]=_,this._uvIndices[3*i+5]=x),i+=2}}if(this._profile.vertices.length>2){var w,S=this._profile.vertices.length-2,C=(w=0)*this._numExtrusionVertices+0,T=(w+1)*this._numExtrusionVertices-1;for(u=0;u<S;++u){var E,P=(E=u+1)*this._numExtrusionVertices+0,O=(E+1)*this._numExtrusionVertices-1,R=u+2,A=R*this._numExtrusionVertices+0,M=(R+1)*this._numExtrusionVertices-1;this._vertexIndices[3*i+0]=C,this._vertexIndices[3*i+1]=P,this._vertexIndices[3*i+2]=A,this._normalIndices[3*i+0]=this._capNormalsOffset+0,this._normalIndices[3*i+1]=this._capNormalsOffset+0,this._normalIndices[3*i+2]=this._capNormalsOffset+0,this._pathVertexIndices[3*i+0]=this.pathVertexData[C],this._pathVertexIndices[3*i+1]=this.pathVertexData[P],this._pathVertexIndices[3*i+2]=this.pathVertexData[A],++i,this._vertexIndices[3*i+0]=M,this._vertexIndices[3*i+1]=O,this._vertexIndices[3*i+2]=T,this._normalIndices[3*i+0]=this._capNormalsOffset+1,this._normalIndices[3*i+1]=this._capNormalsOffset+1,this._normalIndices[3*i+2]=this._capNormalsOffset+1,this._pathVertexIndices[3*i+0]=this.pathVertexData[M],this._pathVertexIndices[3*i+1]=this.pathVertexData[O],this._pathVertexIndices[3*i+2]=this.pathVertexData[T],++i}}},e.prototype.createBakedGeometryData=function(t){for(var i=new Float32Array(3*this.numVerticesTotal),a=new Float32Array(4*this.numVerticesTotal),o=r({},t,{origin:d,direction:p,auxpos2X:0}),l=0;l<this.numVerticesTotal;++l)n.vec3.set(o.origin,this.originData[3*l+0],this.originData[3*l+1],this.originData[3*l+2]),n.vec3.set(o.direction,this.directionData[4*l+0],this.directionData[4*l+1],this.directionData[4*l+2]),t.vvSizeEnabled&&(o.auxpos2X=this.vvData[4*this._pathVertexIndices[l]+0]),e.queryVertexPosition(h,o),i[3*l+0]=h[0],i[3*l+1]=h[1],i[3*l+2]=h[2];var c={};c[u.VertexAttrConstants.POSITION]=this._vertexIndices,c[u.VertexAttrConstants.NORMAL]=this._normalIndices,c[u.VertexAttrConstants.AUXPOS1]=this._vertexIndices;var f={};return f[u.VertexAttrConstants.POSITION]={size:3,data:i},f[u.VertexAttrConstants.NORMAL]={size:3,data:this.normalData},f[u.VertexAttrConstants.AUXPOS1]={size:4,data:a},new s(f,c,s.DefaultOffsets,"triangle")},e.prototype.createGeometryData=function(){var e={};e[u.VertexAttrConstants.POSITION]=this._vertexIndices,e[u.VertexAttrConstants.AUXPOS1]=this._vertexIndices,e[u.VertexAttrConstants.NORMAL]=this._normalIndices;var t={};return t[u.VertexAttrConstants.POSITION]={size:3,data:this.originData},t[u.VertexAttrConstants.AUXPOS1]={size:4,data:this.directionData},t[u.VertexAttrConstants.NORMAL]={size:3,data:this.normalData},this._profile.hasUV()&&(e[u.VertexAttrConstants.UV0]=this._uvIndices,t[u.VertexAttrConstants.UV0]={size:2,data:this.uvData}),this.vvData&&(e[u.VertexAttrConstants.AUXPOS2]=this._pathVertexIndices,t[u.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData}),new s(t,e,s.DefaultOffsets,"triangle")},e}();e.Builder=T}(c||(c={}));var h=n.vec3f32.create(),d=n.vec3f32.create(),p=n.vec3f32.create(),f=n.vec3f32.create(),m=n.vec3f32.create(),g=n.vec3f32.create(),v=n.vec3f32.create(),y=n.vec3f32.create(),b=n.mat4f32.create();return c}.apply(null,i))||(e.exports=n)},1732:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58)],void 0===(n=function(e,t,r){function i(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var i=e[r],n=t[r];if(i.length!==n.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==n[a])return!1}return!0}function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}function a(e,t){return e===t||e&&t&&e.equals(t)}function o(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!a(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&n(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&n(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!a(e.spatialReference,t.spatialReference)&&i(e.points,t.points)}(e,t);case"mesh":return!1;default:r.neverReached(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!o(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var n=0,a=r;n<a.length;n++){var o=a[n];if(e[o]!==t[o])return!1}return!0}(e.attributes,t.attributes)}}.apply(null,i))||(e.exports=n)},1738:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2}.apply(null,i))||(e.exports=n)},1739:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(83),r(114),r(263),r(84),r(38),r(1563),r(72),r(1593),r(1603),r(93)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h){var d=new a(Array,function(e){return s.set(e,s.ZERO)},null,10,5),p=l.create();return function(){function e(e,t,r,i){this.addedToSpatialIndex=!1,this._labelGraphics=[],this._auxiliaryGraphics=[],this._visibilityFlags=function(e,t){for(var r=new Array(e),i=0;i<r.length;i++)r[i]=new Array(t);return r}(2,3),this._featureExpressionFeature=null,this.extent=null,++t.referenced,this.graphics3DSymbol=t,this.graphic=e,this._graphics=r,this._featureExpressionFeature=c.createFeature(e,i)}return e.prototype.initialize=function(e,t){var r=this;this._layer=e,this._stage=t,this.forEachSymbolLayerGraphic(function(i){i.initialize(e,t),i.setVisibility(r.isVisible())})},e.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(e){return e.destroy()}),this._graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null},Object.defineProperty(e.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0}),e.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(e){return e.destroy()}),this._labelGraphics.length=0},e.prototype.addLabelGraphic=function(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))},e.prototype.addAuxiliaryGraphic=function(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._layer,this._stage),e.setVisibility(this.isVisible()))},e.prototype.isDraped=function(){var e=!1;return this.forEachSymbolLayerGraphic(function(t){"draped"===t.type&&(e=!0)}),e},e.prototype.areVisibilityFlagsSet=function(e,t,r){void 0===r&&(r=0);var i=this._visibilityFlags[r];if(null!=e)return i[e];for(var n=!0,a=0;a<i.length;a++)if(a!==t){var o=i[a];n=n&&(null==o||!0===o)}return n},e.prototype.isVisible=function(e){void 0===e&&(e=0);for(var t=0;t<=e;t++)for(var r=this._visibilityFlags[t],i=0;i<r.length;i++){var n=r[i];if(null!==n&&!1===n)return!1}return!0},e.prototype.setVisibilityFlag=function(e,t,r){void 0===r&&(r=0);var i=this.isVisible(r);this._visibilityFlags[r][e]=t;var n=this.isVisible(r);if(i===n)return!1;if(1===r)this.forEachLabelGraphic(function(e){return e.setVisibility(n)});else{this.forEachSymbolLayerGraphic(function(e){return e.setVisibility(n)});var a=this.isVisible(1);this.forEachLabelGraphic(function(e){return e.setVisibility(a)})}return!0},e.prototype.getBSRadius=function(){var e=0;return this.forEachSymbolLayerGraphic(function(t){e=Math.max(e,t.getBSRadius())}),e},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),this._graphics[0].getCenterObjectSpace(e)},e.prototype.computeExtent=function(e){if(!this.extent){this.extent=l.create();var t=this.graphic.geometry,r=t.spatialReference;if(u.computeAABR(t,this.extent),!r.equals(e)&&!h.boundingRectToBoundingRect(this.extent,r,this.extent,e))return this.extent=null,!1}return!0},Object.defineProperty(e.prototype,"usedMemory",{get:function(){var e=this,t=0;return this.forEachSymbolLayerGraphic(function(r){var i=r.graphics3DSymbolLayer.complexity,n="draped"===r.type?i.memory.draped:i.memory;t+=n.bytesPerFeature,n.bytesPerCoordinate&&(t+=u.numVertices(e.graphic.geometry)*n.bytesPerCoordinate)}),t},enumerable:!0,configurable:!0}),e.prototype.getProjectedBoundingBox=function(e,t,a,o){return i(this,void 0,void 0,function(){var u=this;return r(this,function(c){switch(c.label){case 0:return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?s.empty(o.boundingBox):o.boundingBox=s.empty(),o.requiresDrapedElevation=!1,[4,n.forEach(this._graphics,function(n){return i(u,void 0,void 0,function(){var i,l,u;return r(this,function(r){switch(r.label){case 0:return n?(i="draped"===n.type?t:e,l=d.acquire(),[4,n.getProjectedBoundingBox(i,a,o.screenSpaceObjects,l)]):[2];case 1:return u=r.sent(),isFinite(u[2])&&isFinite(u[5])||(o.requiresDrapedElevation=!0),u&&s.expand(o.boundingBox,l),d.release(l),[2]}})})})];case 1:return c.sent(),s.allFinite(o.boundingBox)||l.allFinite(s.toRect(o.boundingBox,p))?[2,o]:[2,null]}})})},e.prototype.needsElevationUpdates=function(){for(var e=0,t=this._graphics;e<t.length;e++){if((n=t[e])&&("object3d"===n.type||"lod-instance"===n.type)&&n.needsElevationUpdates)return!0}for(var r=0,i=this._labelGraphics;r<i.length;r++){var n;if((n=i[r])&&n.needsElevationUpdates)return!0}return!1},e.prototype.alignWithElevation=function(e,t){var r=this;this.forEachRenderedGraphic(function(i){"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,r._featureExpressionFeature)})},e.prototype.addHighlight=function(e,t){this.forEachSymbolLayerGraphic(function(r){return r.addHighlight(e,t)})},e.prototype.removeHighlight=function(e){this.forEachSymbolLayerGraphic(function(t){return t.removeHighlight(e)})},e.prototype.forEachGraphicList=function(e,t){e.forEach(function(e,r){return e&&t(e,r)})},e.prototype.forEachSymbolLayerGraphic=function(e){this.forEachGraphicList(this._graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)},e.prototype.forEachLabelGraphic=function(e){this.forEachGraphicList(this._labelGraphics,e)},e.prototype.forEachRenderedGraphic=function(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)},e}()}.apply(null,i))||(e.exports=n)},1740:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,a,o){if(void 0===o&&(o=0),null==e||"ignore"===t)return a[o+0]=255,a[o+1]=255,a[o+2]=255,void(a[o+3]=255);a[o+0]=Math.floor(255*e[0]),a[o+1]=Math.floor(255*e[1]),a[o+2]=Math.floor(255*e[2]);var s=Math.floor(e[3]*r);a[o+3]=0===s?0:"tint"===t?s:"replace"===t?s+i:s+n},t.isOpaqueSymbolColor=function(e,t){void 0===t&&(t=0);var r=e[t+3];return r===i||r===n||r===a};var r=85,i=r,n=2*r,a=3*r}.apply(null,i))||(e.exports=n)},1741:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1605),r(1619)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r){var i=e.call(this)||this;return i.symbol=t,i.graphics3DSymbol=null,i.referenced=0,t.fetchSymbol().then(function(e){if(i.isRejected())throw new Error;e.id=i.symbol.id,i.graphics3DSymbol=r(e)}).then(function(){if(i.isRejected())throw new Error;i.graphics3DSymbol.then(function(){i.isRejected()||i.resolve()},function(e){i.isRejected()||i.reject(e)})}).catch(function(e){i.isRejected()||i.reject(e)}),i}return r(t,e),t.prototype.createGraphics3DGraphic=function(e){return this.graphics3DSymbol.createGraphics3DGraphic(e,this)},Object.defineProperty(t.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:i.emptySymbolComplexity},enumerable:!0,configurable:!0}),t.prototype.layerPropertyChanged=function(e,t){return this.graphics3DSymbol.layerPropertyChanged(e,t)},t.prototype.applyRendererDiff=function(e,t){return this.graphics3DSymbol.applyRendererDiff(e,t)},t.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}},t.prototype.setDrawOrder=function(e,t){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(e,t)},t.prototype.destroy=function(){this.isFulfilled()||this.reject(),this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0}),t}(n.Promise)}.apply(null,i))||(e.exports=n)},1742:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8)],void 0===(n=function(e,t,r){function i(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+c.identifierOffset,c.identifierLength)),version:t.getUint16(r+c.versionOffset,u),checksum:t.getUint32(r+c.checksumOffset,u)}}function n(e,t){return{sizeLo:e.getUint32(t+h.sizeLo,u),sizeHi:e.getUint32(t+h.sizeHi,u),minX:e.getFloat64(t+h.minX,u),minY:e.getFloat64(t+h.minY,u),minZ:e.getFloat64(t+h.minZ,u),maxX:e.getFloat64(t+h.maxX,u),maxY:e.getFloat64(t+h.maxY,u),maxZ:e.getFloat64(t+h.maxZ,u),errorX:e.getFloat64(t+h.errorX,u),errorY:e.getFloat64(t+h.errorY,u),errorZ:e.getFloat64(t+h.errorZ,u),count:e.getUint32(t+h.count,u),reserved:e.getUint32(t+h.reserved,u)}}function a(e,t,r){var i=[];t=o(e,t,i);for(var n=[],a=0;a<i.length;a++){n.length=0,t=o(e,t,n);for(var s=0;s<n.length;s++)r.push(n[s]+i[a])}return t}function o(e,t,i){var n=new DataView(e,t),a=n.getUint8(0),o=31&a,s=!!(32&a),l=(192&a)>>6,c=0;if(0===l)c=n.getUint32(1,u),t+=5;else if(1===l)c=n.getUint16(1,u),t+=3;else{if(2!==l)throw new r("lepcc-decode-error","Bad count type");c=n.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var h=Math.ceil(c*o/8),d=new Uint8Array(e,t,h),p=0,f=0,m=0,g=-1>>>32-o,v=0;v<c;v++){for(;f<o;)p|=d[m]<<f,f+=8,m+=1;i[v]=p&g,p>>>=o,(f-=o)+o>32&&(p|=d[m-1]>>8-f)}return t+m}function s(e,t){return{sizeLo:e.getUint32(t+d.sizeLo,u),sizeHi:e.getUint32(t+d.sizeHi,u),count:e.getUint32(t+d.count,u),colorMapCount:e.getUint16(t+d.colorMapCount,u),lookupMethod:e.getUint8(t+d.lookupMethod),compressionMethod:e.getUint8(t+d.compressionMethod)}}function l(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,u),sizeHi:e.getUint32(t+p.sizeHi,u),count:e.getUint32(t+p.count,u),scaleFactor:e.getUint16(t+p.scaleFactor,u),bitsPerPoint:e.getUint8(t+p.bitsPerPoint),reserved:e.getUint8(t+p.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var u=!0,c={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},h={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),o=0,s=i(e,t,o),l=s.identifier,u=s.version;if(o+=c.byteCount,"LEPCC     "!==l)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var d=n(t,o);if(o+=h.byteCount,d.sizeHi*Math.pow(2,32)+d.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Float64Array(3*d.count),f=[],m=[],g=[],v=[];if((o=a(e,o=a(e,o=a(e,o=a(e,o,f),m),g),v))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var y=0,b=0,_=0;_<f.length;_++){b+=f[_];for(var x=0,w=0;w<m[_];w++){x+=g[y];var S=v[y];p[3*y]=Math.min(d.maxX,d.minX+2*d.errorX*x),p[3*y+1]=Math.min(d.maxY,d.minY+2*d.errorY*b),p[3*y+2]=Math.min(d.maxZ,d.minZ+2*d.errorZ*S),y++}}return{errorX:d.errorX,errorY:d.errorY,errorZ:d.errorZ,result:p}};var d={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),n=0,a=i(e,t,n),o=a.identifier,l=a.version;if(n+=c.byteCount,"ClusterRGB"!==o)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var u=s(t,n);if(n+=d.byteCount,u.sizeHi*Math.pow(2,32)+u.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==u.lookupMethod&&1!==u.lookupMethod||0!==u.compressionMethod){if(0===u.lookupMethod&&0===u.compressionMethod){if(3*u.count+n!==e.byteLength||0!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,n).slice()}if(u.lookupMethod<=2&&1===u.compressionMethod){if(n+3!==e.byteLength||1!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var h=t.getUint8(n),p=t.getUint8(n+1),f=t.getUint8(n+2),m=new Uint8Array(3*u.count),g=0;g<u.count;g++)m[3*g]=h,m[3*g+1]=p,m[3*g+2]=f;return m}throw new r("lepcc-decode-error","Bad method "+u.lookupMethod+","+u.compressionMethod)}if(3*u.colorMapCount+u.count+n!==e.byteLength||u.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var v=new Uint8Array(e,n,3*u.colorMapCount),y=new Uint8Array(e,n+3*u.colorMapCount,u.count);for(m=new Uint8Array(3*u.count),g=0;g<u.count;g++){var b=y[g];m[3*g]=v[3*b],m[3*g+1]=v[3*b+1],m[3*g+2]=v[3*b+2]}return m};var p={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),n=0,a=i(e,t,n),s=a.identifier,u=a.version;if(n+=c.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var h=l(t,n);if(n+=p.byteCount,h.sizeHi*Math.pow(2,32)+h.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var d=new Uint16Array(h.count);if(8===h.bitsPerPoint){if(h.count+n!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var f=new Uint8Array(e,n,h.count),m=0;m<h.count;m++)d[m]=f[m]*h.scaleFactor}else if(16===h.bitsPerPoint){if(2*h.count+n!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(f=new Uint16Array(e,n,h.count),m=0;m<h.count;m++)d[m]=f[m]*h.scaleFactor}else{if(o(e,n,f=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(m=0;m<h.count;m++)d[m]=f[m]*h.scaleFactor}return d}}.apply(null,i))||(e.exports=n)},1746:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1755)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=i}.apply(null,i))||(e.exports=n)},1751:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38)],void 0===(n=function(e,t,r){function i(e,t,i,n,a,s,l,u,c,h,d){return function(e,t,i){for(var n=r.vec3.squaredDistance(e.maxVert[0],e.minVert[0]),a=0,o=1;o<7;++o){var s=r.vec3.squaredDistance(e.maxVert[o],e.minVert[o]);s>n&&(n=s,a=o)}r.vec3.copy(t,e.minVert[a]),r.vec3.copy(i,e.maxVert[a])}(e,n,a),r.vec3.squaredDistance(n,a)<p?1:(r.vec3.subtract(l,n,a),r.vec3.normalize(l,l),function(e,t,i,n){for(var a=e.data,o=e.offsetIdx,s=e.strideIdx,l=Number.NEGATIVE_INFINITY,u=0,c=o;c<a.length;c+=s){r.vec3.set(C,a[c]-t[0],a[c+1]-t[1],a[c+2]-t[2]);var h=i[0]*C[0]+i[1]*C[1]+i[2]*C[2],d=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=C[0]*C[0]+C[1]*C[1]+C[2]*C[2],f=p-h*h/d;f>l&&(l=f,u=c)}return r.vec3.set(n,a[u],a[u+1],a[u+2]),l}(t,n,l,s)<p?2:(r.vec3.subtract(u,a,s),r.vec3.normalize(u,u),r.vec3.subtract(c,s,n),r.vec3.normalize(c,c),r.vec3.cross(i,u,l),r.vec3.normalize(i,i),o(t,i,l,u,c,h),0))}function n(e,t,i,n,s,l,u,c,h,d){a(e,t,i,n,s,g,v),void 0!==g[0]&&(r.vec3.subtract(y,g,i),r.vec3.normalize(y,y),r.vec3.subtract(b,g,n),r.vec3.normalize(b,b),r.vec3.subtract(_,g,s),r.vec3.normalize(_,_),r.vec3.cross(x,b,l),r.vec3.normalize(x,x),r.vec3.cross(w,_,u),r.vec3.normalize(w,w),r.vec3.cross(S,y,c),r.vec3.normalize(S,S),o(e,x,l,b,y,h),o(e,w,u,_,b,h),o(e,S,c,y,_,h)),void 0!==v[0]&&(r.vec3.subtract(y,v,i),r.vec3.normalize(y,y),r.vec3.subtract(b,v,n),r.vec3.normalize(b,b),r.vec3.subtract(_,v,s),r.vec3.normalize(_,_),r.vec3.cross(x,b,l),r.vec3.normalize(x,x),r.vec3.cross(w,_,u),r.vec3.normalize(w,w),r.vec3.cross(S,y,c),r.vec3.normalize(S,S),o(e,x,l,b,y,h),o(e,w,u,_,b,h),o(e,S,c,y,_,h))}function a(e,t,i,n,a,o,s){!function(e,t,i,n,a){var o=e.data,s=e.offsetIdx,l=e.strideIdx;r.vec3.set(n,o[s],o[s+1],o[s+2]),r.vec3.copy(a,n),i[0]=r.vec3.dot(I,t),i[1]=i[0];for(var u=s+l;u<o.length;u+=l){var c=o[u]*t[0]+o[u+1]*t[1]+o[u+2]*t[2];c<i[0]&&(i[0]=c,r.vec3.set(n,o[u],o[u+1],o[u+2])),c>i[1]&&(i[1]=c,r.vec3.set(a,o[u],o[u+1],o[u+2]))}}(e,t,T,s,o);var l=r.vec3.dot(i,t);T[1]-p<=l&&(o[0]=void 0),T[0]+p>=l&&(s[0]=void 0)}function o(e,t,i,n,a,o){if(!(r.vec3.squaredLength(t)<p)){r.vec3.cross(E,i,t),r.vec3.cross(P,n,t),r.vec3.cross(O,a,t),s(e,t,T),A[1]=T[0],R[1]=T[1],M[1]=R[1]-A[1];for(var l=[i,n,a],u=[E,P,O],c=0;c<3;++c){s(e,l[c],T),A[0]=T[0],R[0]=T[1],s(e,u[c],T),A[2]=T[0],R[2]=T[1],M[0]=R[0]-A[0],M[2]=R[2]-A[2];var h=d(M);h<o.quality&&(r.vec3.copy(o.b0,l[c]),r.vec3.copy(o.b1,t),r.vec3.copy(o.b2,u[c]),o.quality=h)}}}function s(e,t,r){var i=e.data,n=e.offsetIdx,a=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var o=n;o<i.length;o+=a){var s=i[o]*t[0]+i[o+1]*t[1]+i[o+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function l(e,t,i){r.vec3.copy(i.center,e),r.vec3.scale(i.halfSize,t,.5),r.quat.identity(i.quaternion)}function u(e,t,i){r.vec3.copy(D,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?D[0]=0:Math.abs(t[1])>Math.abs(t[2])?D[1]=0:D[2]=0,r.vec3.squaredLength(D)<p&&(D[0]=D[1]=D[2]=1),r.vec3.cross(F,t,D),r.vec3.normalize(F,F),r.vec3.cross(V,t,F),r.vec3.normalize(V,V),c(e,t,F,V,L,U),r.vec3.subtract(B,U,L),h(t,F,V,L,U,B,i)}function c(e,t,r,i,n,a){s(e,t,T),n[0]=T[0],a[0]=T[1],s(e,r,T),n[1]=T[0],a[1]=T[1],s(e,i,T),n[2]=T[0],a[2]=T[1]}function h(e,t,i,n,a,o,s){j[0]=e[0],j[1]=e[1],j[2]=e[2],j[3]=t[0],j[4]=t[1],j[5]=t[2],j[6]=i[0],j[7]=i[1],j[8]=i[2],r.quat.fromMat3(s.quaternion,j),r.vec3.add(G,n,a),r.vec3.scale(G,G,.5),r.vec3.scale(s.center,e,G[0]),r.vec3.scale(N,t,G[1]),r.vec3.add(s.center,s.center,N),r.vec3.scale(N,i,G[2]),r.vec3.add(s.center,s.center,N),r.vec3.scale(s.halfSize,o,.5)}function d(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var p=1e-6,f=r.vec3f64.create(),m=r.vec3f64.create();t.computeOBB=function(e,t){var a=e.data,o=e.strideIdx,s=a.length/o;if(!(s<=0)){var p=new H(e);r.vec3.add(f,p.minProj,p.maxProj),r.vec3.scale(f,f,.5),r.vec3.subtract(m,p.maxProj,p.minProj);var g=d(m),v=new k;v.quality=g,s<14&&(e={data:new Float64Array(p.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=r.vec3f64.create(),b=r.vec3f64.create(),_=r.vec3f64.create(),x=r.vec3f64.create(),w=r.vec3f64.create(),S=r.vec3f64.create(),C=r.vec3f64.create();switch(i(p,e,C,y,b,_,x,w,S,v)){case 1:return void l(f,m,t);case 2:return void u(e,x,t)}n(e,C,y,b,_,x,w,S,v),c(e,v.b0,v.b1,v.b2,L,U);var T=r.vec3f64.create();r.vec3.subtract(T,U,L),v.quality=d(T),v.quality<g?h(v.b0,v.b1,v.b2,L,U,T,t):l(f,m,t)}};var g=r.vec3f64.create(),v=r.vec3f64.create(),y=r.vec3f64.create(),b=r.vec3f64.create(),_=r.vec3f64.create(),x=r.vec3f64.create(),w=r.vec3f64.create(),S=r.vec3f64.create(),C=r.vec3f64.create(),T=r.vec2f64.create(),E=r.vec3f64.create(),P=r.vec3f64.create(),O=r.vec3f64.create(),R=r.vec3f64.create(),A=r.vec3f64.create(),M=r.vec3f64.create(),I=r.vec3f64.create(),D=r.vec3f64.create(),F=r.vec3f64.create(),V=r.vec3f64.create(),L=r.vec3f64.create(),U=r.vec3f64.create(),B=r.vec3f64.create(),N=r.vec3f64.create(),j=r.mat3f32.create(),G=r.vec3f64.create(),z=7,H=function(){return function(e){this.minVert=new Array(z),this.maxVert=new Array(z);var t=64*z;this.buffer=new ArrayBuffer(t);var i=0;this.minProj=new Float64Array(this.buffer,i,z),i+=8*z,this.maxProj=new Float64Array(this.buffer,i,z),i+=8*z;for(var n=0;n<z;++n)this.minVert[n]=r.vec3f64.createView(this.buffer,i),i+=24;for(n=0;n<z;++n)this.maxVert[n]=r.vec3f64.createView(this.buffer,i),i+=24;for(n=0;n<z;++n)this.minProj[n]=Number.POSITIVE_INFINITY,this.maxProj[n]=Number.NEGATIVE_INFINITY;var a=new Array(z),o=new Array(z),s=e.data,l=e.offsetIdx,u=e.strideIdx;for(n=l;n<s.length;n+=u){var c=s[n];c<this.minProj[0]&&(this.minProj[0]=c,a[0]=n),c>this.maxProj[0]&&(this.maxProj[0]=c,o[0]=n),(c=s[n+1])<this.minProj[1]&&(this.minProj[1]=c,a[1]=n),c>this.maxProj[1]&&(this.maxProj[1]=c,o[1]=n),(c=s[n+2])<this.minProj[2]&&(this.minProj[2]=c,a[2]=n),c>this.maxProj[2]&&(this.maxProj[2]=c,o[2]=n),(c=s[n]+s[n+1]+s[n+2])<this.minProj[3]&&(this.minProj[3]=c,a[3]=n),c>this.maxProj[3]&&(this.maxProj[3]=c,o[3]=n),(c=s[n]+s[n+1]-s[n+2])<this.minProj[4]&&(this.minProj[4]=c,a[4]=n),c>this.maxProj[4]&&(this.maxProj[4]=c,o[4]=n),(c=s[n]-s[n+1]+s[n+2])<this.minProj[5]&&(this.minProj[5]=c,a[5]=n),c>this.maxProj[5]&&(this.maxProj[5]=c,o[5]=n),(c=s[n]-s[n+1]-s[n+2])<this.minProj[6]&&(this.minProj[6]=c,a[6]=n),c>this.maxProj[6]&&(this.maxProj[6]=c,o[6]=n)}for(n=0;n<z;++n){var h=a[n];r.vec3.set(this.minVert[n],s[h],s[h+1],s[h+2]),h=o[n],r.vec3.set(this.maxVert[n],s[h],s[h+1],s[h+2])}}}(),k=function(){return function(){this.b0=r.vec3f64.fromValues(1,0,0),this.b1=r.vec3f64.fromValues(0,1,0),this.b2=r.vec3f64.fromValues(0,0,1),this.quality=0}}()}.apply(null,i))||(e.exports=n)},1752:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(190),r(1628),r(269),r(1753),r(1754),r(1746)],void 0===(n=function(e,t,r,i,n,a,o,s){function l(e){return n(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function u(e){return n(e,["YYYY-M-D"]).toDate()}function c(e){return!0===e}function h(e){return Array.isArray(e)?e:[e]}function d(e){return null!==e?!0!==e:null}function p(e,t){if(null==e)return null;for(var r=!1,i=0,n=t;i<n.length;i++){var a=n[i];if(null==a)r=null;else if(e===a){r=!0;break}}return r}function f(e,t,r){if(null==e)return null;for(var i=t,n=r,a="",o="-[]/{}()*+?.\\^$|",s=0,l=0;l<i.length;l++){var u=i.charAt(l);switch(s){case 0:u===n?s=1:o.indexOf(u)>=0?a+="\\"+u:a+="%"===u?".*":"_"===u?".":u;break;case 1:o.indexOf(u)>=0?a+="\\"+u:a+=u,s=0}}return new RegExp("^"+a+"$").test(e)}function m(e){return e instanceof Date?e.valueOf():e}function g(e){for(var t=[],r={},i=0,n=e;i<n.length;i++){var a=n[i],o=a.toLowerCase();void 0===r[o]&&(t.push(a),r[o]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null,this._hasStandardizedFunctions=null,this._hasAggregateFunctions=null}return e.create=function(t){var r=new e;r.parseTree=s.WhereGrammar.parse(t);var i=!0,n=!0;return r.visitAll(r.parseTree,function(e){if("function"===e.type){var t=e.name,r=e.args.value.length;i&&(i=o.isStandardized(t,r)),n&&(n=a.isAggregate(t,r))}}),r._hasStandardizedFunctions=i,r._hasAggregateFunctions=n,r},e.prototype.isStandardized=function(){return this._hasStandardizedFunctions},e.prototype.isAggregate=function(){return this._hasAggregateFunctions},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testSet=function(e){var t=this,r=new i.default;this.visitAll(this.parseTree,function(e){"column_ref"!==e.type||r.has(e.column)||r.set(e.column,e)});for(var n={},a=0,o=e;a<o.length;a++){!function(e){r.forEach(function(r,i){var a=t.featureValue(e,i,r);n[i]?n[i].push(a):n[i]=[a]})}(o[a])}return!!this.evaluateNode(this.parseTree,{attributes:n})},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),g(e)},e.prototype.getExpressions=function(){var e=new i.default;return this.visitAll(this.parseTree,function(t){if("function"===t.type){var r=t.name.toLowerCase(),i=t.args.value[0];if("column_ref"===i.type){var n=i.column,a=r+"-"+n;e.has(a)||e.set(a,{aggregateType:r,field:n})}}}),r.from(e.values())},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),g(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),g(e)},e.prototype.featureValue=function(e,t,r){var i=function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e,n=i[t];if(void 0!==n)return n;for(var a in i)if(t.toLowerCase()===a.toLowerCase())return r.column=a,i[a];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,i=e.clauses;r<i.length;r++){var n=i[r];this.visitAll(n,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var a=0,o=e.value;a<o.length;a++){n=o[a];this.visitAll(n,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=m(this.evaluateNode(e.operand,t)),i=0;i<e.clauses.length;i++)if(r===m(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(i=0;i<e.clauses.length;i++)if(c(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var n=[],s=0,g=e.value;s<g.length;s++){var v=g[s];n.push(this.evaluateNode(v,t))}return n;case"unary_expr":return d(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return function(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return function(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var y=h(this.evaluateNode(e.right,t));return p(this.evaluateNode(e.left,t),y);case"NOT IN":y=h(this.evaluateNode(e.right,t));return d(p(this.evaluateNode(e.left,t),y));case"BETWEEN":var b=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==b||null==_[0]||null==_[1]?null:b>=_[0]&&b<=_[1];case"NOTBETWEEN":b=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==b||null==_[0]||null==_[1]?null:b<_[0]||b>_[1];case"LIKE":return f(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return d(f(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return function(e,t,r){if(null==t||null==r)return null;var i=m(t),n=m(r);switch(e){case"<>":return i!==n;case"=":return i===n;case">":return i>n;case"<":return i<n;case">=":return i>=n;case"<=":return i<=n}}(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return u(e.value);case"timestamp":return l(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((v=new Date).setHours(0,0,0,0),v):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var x=this.evaluateNode(e.args,t);return this.isAggregate()?a.aggregateFunction(e.name,x):o.evaluateFunction(e.name,x)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,i))||(e.exports=n)},1753:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function i(e){for(var t=r(e),i=e.length,n=0,a=0,o=e;a<o.length;a++){var s=o[a];n+=Math.pow(s-t,2)}return i>1?n/(i-1):0}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isAggregate=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:r(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(i(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:i(e[0])}}}}.apply(null,i))||(e.exports=n)},1754:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(187)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var i={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var i=e[2];return null==t||null==r||null==i?null:i<=0?"":t.toString().substring(r-1,r+i-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,i=t?e[1]:" ",n=t?e[2]:e[1];if(null==i||null==n)return null;var a="("+r.escapeString(i)+")";switch(e[0]){case"BOTH":return n.replace(new RegExp("^"+a+"*|"+a+"*$","g"),"");case"LEADING":return n.replace(new RegExp("^"+a+"*","g"),"");case"TRAILING":return n.replace(new RegExp(a+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,i))||(e.exports=n)},1755:function(e,t,r){var i;void 0===(i=function(){"use strict";function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function a(e){return o[e.type](e)}var o={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?n(e.parts[t][0])+"-"+n(e.parts[t][1]):n(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+(t?'"'+i(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,r){function i(e,t){return{type:"literal",text:e,ignoreCase:t}}function n(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function a(e){var r,i=fn[e];if(i)return i;for(r=e-1;!fn[r];)r--;for(i={line:(i=fn[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return fn[e]=i,i}function o(e,t){var r=a(e),i=a(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function s(e){pn<mn||(pn>mn&&(mn=pn,gn=[]),gn.push(e))}function l(){var e,t;return e=pn,he()!==ve&&(t=c())!==ve&&he()!==ve?e=_e(t):(pn=e,e=ve),e}function u(){var e,t,r,i,n,a,o,s;if(e=pn,(t=c())!==ve){for(r=[],i=pn,(n=he())!==ve&&(a=le())!==ve&&(o=he())!==ve&&(s=c())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=he())!==ve&&(a=le())!==ve&&(o=he())!==ve&&(s=c())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=xe(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function c(){var e,t,r,i,n,a,o,s;if(e=pn,(t=h())!==ve){for(r=[],i=pn,(n=he())!==ve&&(a=X())!==ve&&(o=he())!==ve&&(s=h())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=he())!==ve&&(a=X())!==ve&&(o=he())!==ve&&(s=h())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function h(){var e,t,r,i,n,a,o,s;if(e=pn,(t=d())!==ve){for(r=[],i=pn,(n=he())!==ve&&(a=q())!==ve&&(o=he())!==ve&&(s=d())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=he())!==ve&&(a=q())!==ve&&(o=he())!==ve&&(s=d())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function d(){var e,r,i,n,a;return e=pn,(r=W())===ve&&(r=pn,33===t.charCodeAt(pn)?(i=Se,pn++):(i=ve,0===vn&&s(Ce)),i!==ve?(n=pn,vn++,61===t.charCodeAt(pn)?(a=Te,pn++):(a=ve,0===vn&&s(Ee)),vn--,a===ve?n=void 0:(pn=n,n=ve),n!==ve?r=i=[i,n]:(pn=r,r=ve)):(pn=r,r=ve)),r!==ve&&(i=he())!==ve&&(n=d())!==ve?e=r=Pe(n):(pn=e,e=ve),e===ve&&(e=function(){var e,t,r;return e=pn,(t=g())!==ve&&he()!==ve?((r=function(){var e;return(e=function(){var e,t,r,i,n,a;if(pn,e=[],t=pn,(r=he())!==ve&&(i=p())!==ve&&(n=he())!==ve&&(a=g())!==ve?t=r=[r,i,n,a]:(pn=t,t=ve),t!==ve)for(;t!==ve;)e.push(t),t=pn,(r=he())!==ve&&(i=p())!==ve&&(n=he())!==ve&&(a=g())!==ve?t=r=[r,i,n,a]:(pn=t,t=ve);else e=ve;return e!==ve&&(e=Re(e)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=m())!==ve&&he()!==ve&&(r=ue())!==ve&&he()!==ve&&(i=u())!==ve&&he()!==ve&&ce()!==ve?(t=Qe(t,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=m())!==ve&&he()!==ve&&(r=ue())!==ve&&he()!==ve&&(i=ce())!==ve?(t=Ze(t),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=m())!==ve&&he()!==ve&&(r=T())!==ve?(t=Ke(t,r),e=t):(pn=e,e=ve))),e}())===ve&&(e=function(){var e,t,r,i,n,a;return e=pn,(t=W())!==ve&&he()!==ve&&(r=Y())!==ve&&he()!==ve&&(i=g())!==ve&&he()!==ve&&(n=q())!==ve&&he()!==ve&&(a=g())!==ve?(t=ke(r,i,a),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=Y())!==ve&&he()!==ve&&(r=g())!==ve&&he()!==ve&&(i=q())!==ve&&he()!==ve&&(n=g())!==ve?(t=We(t,r,n),e=t):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=z())!==ve&&he()!==ve&&(r=W())!==ve&&he()!==ve&&(i=g())!==ve?(t=ze(t,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=z())!==ve&&he()!==ve&&(r=g())!==ve?(t=He(t,r),e=t):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=f())!==ve&&he()!==ve&&(r=P())!==ve&&he()!==ve&&k()!==ve&&he()!==ve&&(i=O())!==ve?(t=Xe(t,r,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=f())!==ve&&he()!==ve&&(r=P())!==ve?(t=Ye(t,r),e=t):(pn=e,e=ve)),e}()),e}())===ve&&(r=null),r!==ve?(t=Oe(t,r),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}function p(){var e;return t.substr(pn,2)===Ae?(e=Ae,pn+=2):(e=ve,0===vn&&s(Me)),e===ve&&(62===t.charCodeAt(pn)?(e=Ie,pn++):(e=ve,0===vn&&s(De)),e===ve&&(t.substr(pn,2)===Fe?(e=Fe,pn+=2):(e=ve,0===vn&&s(Ve)),e===ve&&(t.substr(pn,2)===Le?(e=Le,pn+=2):(e=ve,0===vn&&s(Ue)),e===ve&&(60===t.charCodeAt(pn)?(e=Be,pn++):(e=ve,0===vn&&s(Ne)),e===ve&&(61===t.charCodeAt(pn)?(e=Te,pn++):(e=ve,0===vn&&s(Ee)),e===ve&&(t.substr(pn,2)===je?(e=je,pn+=2):(e=ve,0===vn&&s(Ge)))))))),e}function f(){var e,t,r,i,n;return e=pn,t=pn,(r=W())!==ve&&(i=he())!==ve&&(n=H())!==ve?t=r=[r,i,n]:(pn=t,t=ve),t!==ve&&(t=qe(t)),(e=t)===ve&&(e=H()),e}function m(){var e,t,r,i,n;return e=pn,t=pn,(r=W())!==ve&&(i=he())!==ve&&(n=G())!==ve?t=r=[r,i,n]:(pn=t,t=ve),t!==ve&&(t=qe(t)),(e=t)===ve&&(e=G()),e}function g(){var e,t,r,i,n,a,o,s;if(e=pn,(t=y())!==ve){for(r=[],i=pn,(n=he())!==ve&&(a=v())!==ve&&(o=he())!==ve&&(s=y())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=he())!==ve&&(a=v())!==ve&&(o=he())!==ve&&(s=y())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function v(){var e;return 43===t.charCodeAt(pn)?(e=Je,pn++):(e=ve,0===vn&&s($e)),e===ve&&(45===t.charCodeAt(pn)?(e=et,pn++):(e=ve,0===vn&&s(tt))),e}function y(){var e,t,r,i,n,a,o,s;if(e=pn,(t=_())!==ve){for(r=[],i=pn,(n=he())!==ve&&(a=b())!==ve&&(o=he())!==ve&&(s=_())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=he())!==ve&&(a=b())!==ve&&(o=he())!==ve&&(s=_())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=rt(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function b(){var e;return 42===t.charCodeAt(pn)?(e=it,pn++):(e=ve,0===vn&&s(nt)),e===ve&&(47===t.charCodeAt(pn)?(e=at,pn++):(e=ve,0===vn&&s(ot))),e}function _(){var e,t;return(e=function(){var e;return(e=O())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=function(){var e,t,r,i;return e=pn,(t=I())!==ve&&(r=D())!==ve&&(i=F())!==ve?(t=Yt(t,r,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=I())!==ve&&(r=D())!==ve?(t=Qt(t,r),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=I())!==ve&&(r=F())!==ve?(t=Zt(t,r),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=I())!==ve&&(t=Kt(t)),e=t))),e}())!==ve?(r=pn,vn++,i=w(),vn--,i===ve?r=void 0:(pn=r,r=ve),r!==ve?(t=Xt(t),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t;return e=pn,(t=N())!==ve&&(t=Rt()),(e=t)===ve&&(e=pn,(t=j())!==ve&&(t=At()),e=t),e}())===ve&&(e=function(){var e;return pn,(e=B())!==ve&&(e=Ot()),e}())===ve&&(e=function(){var e,t,r;return e=pn,(t=re())!==ve&&he()!==ve&&(r=P())!==ve?(t=Pt(r),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r;return e=pn,(t=te())!==ve&&he()!==ve&&(r=P())!==ve?(t=Et(r),e=t):(pn=e,e=ve),e}()),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=J())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve&&(r=function(){var e;return(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===_i?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(xi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=wi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,5).toLowerCase()===Si?(r=t.substr(pn,5),pn+=5):(r=ve,0===vn&&s(Ci)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Ti(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Ei?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Pi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Oi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Ri?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Ai)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Mi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Ii?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Di)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Fi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Vi?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Li)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Ui(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}())!==ve&&he()!==ve&&Q()!==ve&&he()!==ve&&(i=c())!==ve&&he()!==ve&&ce()!==ve?(t=_t(r,i),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r,i,n,a,o,s,l;return e=pn,(t=K())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve&&(r=c())!==ve&&he()!==ve&&Q()!==ve&&he()!==ve&&(i=c())!==ve&&he()!==ve?(n=pn,(a=Z())!==ve&&(o=he())!==ve&&(s=c())!==ve&&(l=he())!==ve?n=a=[a,o,s,l]:(pn=n,n=ve),n===ve&&(n=null),n!==ve&&(a=ce())!==ve?(t=xt(r,i,n),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r,i,n;return e=pn,(t=$())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve?((r=E())===ve&&(r=null),r!==ve&&he()!==ve&&(i=c())!==ve&&he()!==ve&&Q()!==ve&&he()!==ve&&(n=c())!==ve&&he()!==ve&&ce()!==ve?(t=wt(r,i,n),e=t):(pn=e,e=ve)):(pn=e,e=ve),e===ve&&(e=pn,(t=$())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve?((r=E())===ve&&(r=null),r!==ve&&he()!==ve&&(i=c())!==ve&&he()!==ve&&ce()!==ve?(t=St(r,i),e=t):(pn=e,e=ve)):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=ee())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve&&(r=c())!==ve&&he()!==ve&&G()!==ve&&he()!==ve&&(i=c())!==ve&&he()!==ve&&ce()!==ve?(t=Ct(r,i),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r;return e=pn,(t=pe())!==ve&&he()!==ve&&ue()!==ve&&he()!==ve?((r=u())===ve&&(r=null),r!==ve&&he()!==ve&&ce()!==ve?(t=Tt(t,r),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e;return(e=function(){var e,t,r,i,n,a;if(e=pn,(t=ie())!==ve)if(he()!==ve)if((r=c())!==ve)if(he()!==ve){for(i=[],n=A();n!==ve;)i.push(n),n=A();i!==ve&&(n=he())!==ve&&(a=ne())!==ve?(t=Gt(r,i),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;if(e===ve)if(e=pn,(t=ie())!==ve)if(he()!==ve)if((r=c())!==ve)if(he()!==ve){for(i=[],n=A();n!==ve;)i.push(n),n=A();i!==ve&&(n=he())!==ve&&(a=M())!==ve&&he()!==ve&&ne()!==ve?(t=zt(r,i,a),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;return e}())===ve&&(e=function(){var e,t,r,i,n;if(e=pn,(t=ie())!==ve)if(he()!==ve){for(r=[],i=R();i!==ve;)r.push(i),i=R();r!==ve&&(i=he())!==ve&&(n=ne())!==ve?(t=Ht(r),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;if(e===ve)if(e=pn,(t=ie())!==ve)if(he()!==ve){for(r=[],i=R();i!==ve;)r.push(i),i=R();r!==ve&&(i=he())!==ve&&(n=M())!==ve&&he()!==ve&&ne()!==ve?(t=kt(r,n),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;return e}()),e}())===ve&&(e=function(){var e;return pn,(e=function(){var e;return pn,(e=function(){var e,t,r,i;if(e=pn,(t=w())!==ve){for(r=[],i=C();i!==ve;)r.push(i),i=C();r!==ve?(t=ct(t,r),e=t):(pn=e,e=ve)}else pn=e,e=ve;return e}())!==ve&&(e=ut(e)),e}())!==ve&&(e=lt(e)),e}())===ve&&(e=T())===ve&&(e=pn,ue()!==ve&&he()!==ve&&(t=c())!==ve&&he()!==ve&&ce()!==ve?e=st(t):(pn=e,e=ve)),e}function x(){var e,t,r,i;if(e=pn,(t=w())!==ve){for(r=[],i=S();i!==ve;)r.push(i),i=S();r!==ve?e=t=ct(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function w(){var e;return ht.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(dt)),e}function S(){var e;return pt.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(ft)),e}function C(){var e;return mt.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(gt)),e}function T(){var e,r,i;return pn,e=pn,64===t.charCodeAt(pn)?(r=vt,pn++):(r=ve,0===vn&&s(yt)),r!==ve&&(i=x())!==ve?e=r=[r,i]:(pn=e,e=ve),e!==ve&&(e=bt(e)),e}function E(){var e;return(e=function(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===hi?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(di)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=pi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,8).toLowerCase()===fi?(r=t.substr(pn,8),pn+=8):(r=ve,0===vn&&s(mi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=gi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===vi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(yi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=bi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}function P(){var e;return(e=O())===ve&&(e=T()),e}function O(){var e,r,i,n,a;if(e=pn,39===t.charCodeAt(pn)?(r=Mt,pn++):(r=ve,0===vn&&s(It)),r===ve&&(t.substr(pn,2)===Dt?(r=Dt,pn+=2):(r=ve,0===vn&&s(Ft))),r!==ve){for(i=[],n=pn,t.substr(pn,2)===Vt?(a=Vt,pn+=2):(a=ve,0===vn&&s(Lt)),a!==ve&&(a=Ut()),(n=a)===ve&&(Bt.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(Nt)));n!==ve;)i.push(n),n=pn,t.substr(pn,2)===Vt?(a=Vt,pn+=2):(a=ve,0===vn&&s(Lt)),a!==ve&&(a=Ut()),(n=a)===ve&&(Bt.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(Nt)));i!==ve?(39===t.charCodeAt(pn)?(n=Mt,pn++):(n=ve,0===vn&&s(It)),n!==ve?e=r=jt(i):(pn=e,e=ve)):(pn=e,e=ve)}else pn=e,e=ve;return e}function R(){var e,t,r;return e=pn,ae()!==ve&&he()!==ve&&(t=c())!==ve&&he()!==ve&&oe()!==ve&&he()!==ve&&(r=c())!==ve?e=Wt(t,r):(pn=e,e=ve),e}function A(){var e,t,r;return e=pn,ae()!==ve&&he()!==ve&&(t=c())!==ve&&he()!==ve&&oe()!==ve&&he()!==ve&&(r=c())!==ve?e=Wt(t,r):(pn=e,e=ve),e}function M(){var e,t;return e=pn,se()!==ve&&he()!==ve&&(t=c())!==ve?e=qt(t):(pn=e,e=ve),e}function I(){var e,r,i;return(e=V())===ve&&(e=pn,45===t.charCodeAt(pn)?(r=et,pn++):(r=ve,0===vn&&s(tt)),r===ve&&(43===t.charCodeAt(pn)?(r=Je,pn++):(r=ve,0===vn&&s($e))),r!==ve&&(i=V())!==ve?e=r=Jt(r,i):(pn=e,e=ve)),e}function D(){var e,r,i;return e=pn,46===t.charCodeAt(pn)?(r=$t,pn++):(r=ve,0===vn&&s(er)),r!==ve?((i=V())===ve&&(i=null),i!==ve?e=r=tr(i):(pn=e,e=ve)):(pn=e,e=ve),e}function F(){var e,t,r;return e=pn,(t=U())!==ve&&(r=V())!==ve?e=t=rr(t,r):(pn=e,e=ve),e}function V(){var e,t;if(pn,e=[],(t=L())!==ve)for(;t!==ve;)e.push(t),t=L();else e=ve;return e!==ve&&(e=ir(e)),e}function L(){var e;return nr.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(ar)),e}function U(){var e,r,i;return e=pn,or.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=ve,0===vn&&s(sr)),r!==ve?(lr.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=ve,0===vn&&s(ur)),i===ve&&(i=null),i!==ve?e=r=cr(r,i):(pn=e,e=ve)):(pn=e,e=ve),e}function B(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===hr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(dr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function N(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===pr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(fr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function j(){var e,r,i,n;return e=pn,t.substr(pn,5).toLowerCase()===mr?(r=t.substr(pn,5),pn+=5):(r=ve,0===vn&&s(gr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function G(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===vr?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(yr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=br():(pn=e,e=ve)):(pn=e,e=ve),e}function z(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===_r?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(xr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=wr():(pn=e,e=ve)):(pn=e,e=ve),e}function H(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Sr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Cr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Tr():(pn=e,e=ve)):(pn=e,e=ve),e}function k(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Er?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Pr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Or():(pn=e,e=ve)):(pn=e,e=ve),e}function W(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Rr?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Ar)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Mr():(pn=e,e=ve)):(pn=e,e=ve),e}function q(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Ir?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Dr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Fr():(pn=e,e=ve)):(pn=e,e=ve),e}function X(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===Vr?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(Lr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Ur():(pn=e,e=ve)):(pn=e,e=ve),e}function Y(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===Br?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(Nr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=jr():(pn=e,e=ve)):(pn=e,e=ve),e}function Q(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Gr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(zr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Hr():(pn=e,e=ve)):(pn=e,e=ve),e}function Z(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===kr?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Wr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=qr():(pn=e,e=ve)):(pn=e,e=ve),e}function K(){var e,r,i,n;return e=pn,t.substr(pn,9).toLowerCase()===Xr?(r=t.substr(pn,9),pn+=9):(r=ve,0===vn&&s(Yr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Qr():(pn=e,e=ve)):(pn=e,e=ve),e}function J(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===Zr?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(Kr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Jr():(pn=e,e=ve)):(pn=e,e=ve),e}function $(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===$r?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(ei)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ti():(pn=e,e=ve)):(pn=e,e=ve),e}function ee(){var e,r,i,n;return e=pn,t.substr(pn,8).toLowerCase()===ri?(r=t.substr(pn,8),pn+=8):(r=ve,0===vn&&s(ii)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ni():(pn=e,e=ve)):(pn=e,e=ve),e}function te(){var e,r,i,n;return e=pn,t.substr(pn,9).toLowerCase()===ai?(r=t.substr(pn,9),pn+=9):(r=ve,0===vn&&s(oi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=si():(pn=e,e=ve)):(pn=e,e=ve),e}function re(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===li?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(ui)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ci():(pn=e,e=ve)):(pn=e,e=ve),e}function ie(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Bi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Ni)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ji():(pn=e,e=ve)):(pn=e,e=ve),e}function ne(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Gi?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(zi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Hi():(pn=e,e=ve)):(pn=e,e=ve),e}function ae(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===ki?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Wi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=qi():(pn=e,e=ve)):(pn=e,e=ve),e}function oe(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Xi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Yi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Qi():(pn=e,e=ve)):(pn=e,e=ve),e}function se(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Zi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Ki)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Ji():(pn=e,e=ve)):(pn=e,e=ve),e}function le(){var e;return 44===t.charCodeAt(pn)?(e=$i,pn++):(e=ve,0===vn&&s(en)),e}function ue(){var e;return 40===t.charCodeAt(pn)?(e=tn,pn++):(e=ve,0===vn&&s(rn)),e}function ce(){var e;return 41===t.charCodeAt(pn)?(e=nn,pn++):(e=ve,0===vn&&s(an)),e}function he(){var e,t;for(e=[],t=de();t!==ve;)e.push(t),t=de();return e}function de(){var e;return on.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(sn)),e}function pe(){var e,r,i,n;if(e=pn,(r=x())!==ve&&(r=ut(r)),(e=r)===ve)if(e=pn,96===t.charCodeAt(pn)?(r=ln,pn++):(r=ve,0===vn&&s(un)),r!==ve){if(i=[],cn.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(hn)),n!==ve)for(;n!==ve;)i.push(n),cn.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(hn));else i=ve;i!==ve?(96===t.charCodeAt(pn)?(n=ln,pn++):(n=ve,0===vn&&s(un)),n!==ve?e=r=dn(i):(pn=e,e=ve)):(pn=e,e=ve)}else pn=e,e=ve;return e}function fe(e,t,r,i){var n={type:"binary_expr",operator:e,left:t,right:r};return void 0!==i&&(n.escape=i),n}function me(e,t){for(var r=e,i=0;i<t.length;i++)r=fe(t[i][1],r,t[i][3]);return r}r=void 0!==r?r:{};var ge,ve={},ye={start:l},be=l,_e=function(e){return e},xe=function(e,t){var r={type:"expr_list"},i=function(e,t,r){return function(e,t){for(var r=[e],i=0;i<t.length;i++)r.push(t[i][3]);return r}(e,t)}(e,t);return r.value=i,r},we=function(e,t){return me(e,t)},Se="!",Ce=i("!",!1),Te="=",Ee=i("=",!1),Pe=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)},Oe=function(e,t){return""==t||void 0==t||null==t?e:"arithmetic"==t.type?me(e,t.tail):fe(t.op,e,t.right,t.escape)},Re=function(e){return{type:"arithmetic",tail:e}},Ae=">=",Me=i(">=",!1),Ie=">",De=i(">",!1),Fe="<=",Ve=i("<=",!1),Le="<>",Ue=i("<>",!1),Be="<",Ne=i("<",!1),je="!=",Ge=i("!=",!1),ze=function(e,t){return{op:e+"NOT",right:t}},He=function(e,t){return{op:e,right:t}},ke=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}},We=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}},qe=function(e){return e[0]+" "+e[2]},Xe=function(e,t,r){return{op:e,right:t,escape:r.value}},Ye=function(e,t){return{op:e,right:t,escape:""}},Qe=function(e,t){return{op:e,right:t}},Ze=function(e){return{op:e,right:{type:"expr_list",value:[]}}},Ke=function(e,t){return{op:e,right:t}},Je="+",$e=i("+",!1),et="-",tt=i("-",!1),rt=function(e,t){return me(e,t)},it="*",nt=i("*",!1),at="/",ot=i("/",!1),st=function(e){return e.paren=!0,e},lt=function(e){return{type:"column_ref",table:"",column:e}},ut=function(e){return e},ct=function(e,t){return e+t.join("")},ht=/^[A-Za-z_\x80-\uFFFF]/,dt=n([["A","Z"],["a","z"],"_",["",""]],!1,!1),pt=/^[A-Za-z0-9_]/,ft=n([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),mt=/^[A-Za-z0-9_.\x80-\uFFFF]/,gt=n([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),vt="@",yt=i("@",!1),bt=function(e){return{type:"param",value:e[1]}},_t=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}},xt=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}},wt=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}},St=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}},Ct=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}},Tt=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}},Et=function(e){return{type:"timestamp",value:e.value}},Pt=function(e){return{type:"date",value:e.value}},Ot=function(){return{type:"null",value:null}},Rt=function(){return{type:"bool",value:!0}},At=function(){return{type:"bool",value:!1}},Mt="'",It=i("'",!1),Dt="N'",Ft=i("N'",!1),Vt="''",Lt=i("''",!1),Ut=function(){return"'"},Bt=/^[^']/,Nt=n(["'"],!0,!1),jt=function(e){return{type:"string",value:e.join("")}},Gt=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}},zt=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}},Ht=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}},kt=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}},Wt=function(e,t){return{type:"when_clause",operand:e,value:t}},qt=function(e){return{type:"else_clause",value:e}},Xt=function(e){return{type:"number",value:e}},Yt=function(e,t,r){return parseFloat(e+t+r)},Qt=function(e,t){return parseFloat(e+t)},Zt=function(e,t){return parseFloat(e+t)},Kt=function(e){return parseFloat(e)},Jt=function(e,t){return e[0]+t},$t=".",er=i(".",!1),tr=function(e){return"."+(null!=e?e:"")},rr=function(e,t){return e+t},ir=function(e){return e.join("")},nr=/^[0-9]/,ar=n([["0","9"]],!1,!1),or=/^[eE]/,sr=n(["e","E"],!1,!1),lr=/^[+\-]/,ur=n(["+","-"],!1,!1),cr=function(e,t){return"e"+(null===t?"":t)},hr="null",dr=i("NULL",!0),pr="true",fr=i("TRUE",!0),mr="false",gr=i("FALSE",!0),vr="in",yr=i("IN",!0),br=function(){return"IN"},_r="is",xr=i("IS",!0),wr=function(){return"IS"},Sr="like",Cr=i("LIKE",!0),Tr=function(){return"LIKE"},Er="escape",Pr=i("ESCAPE",!0),Or=function(){return"ESCAPE"},Rr="not",Ar=i("NOT",!0),Mr=function(){return"NOT"},Ir="and",Dr=i("AND",!0),Fr=function(){return"AND"},Vr="or",Lr=i("OR",!0),Ur=function(){return"OR"},Br="between",Nr=i("BETWEEN",!0),jr=function(){return"BETWEEN"},Gr="from",zr=i("FROM",!0),Hr=function(){return"FROM"},kr="for",Wr=i("FOR",!0),qr=function(){return"FOR"},Xr="substring",Yr=i("SUBSTRING",!0),Qr=function(){return"SUBSTRING"},Zr="extract",Kr=i("EXTRACT",!0),Jr=function(){return"EXTRACT"},$r="trim",ei=i("TRIM",!0),ti=function(){return"TRIM"},ri="position",ii=i("POSITION",!0),ni=function(){return"POSITION"},ai="timestamp",oi=i("TIMESTAMP",!0),si=function(){return"TIMESTAMP"},li="date",ui=i("DATE",!0),ci=function(){return"DATE"},hi="leading",di=i("LEADING",!0),pi=function(){return"LEADING"},fi="trailing",mi=i("TRAILING",!0),gi=function(){return"TRAILING"},vi="both",yi=i("BOTH",!0),bi=function(){return"BOTH"},_i="year",xi=i("YEAR",!0),wi=function(){return"YEAR"},Si="month",Ci=i("MONTH",!0),Ti=function(){return"MONTH"},Ei="day",Pi=i("DAY",!0),Oi=function(){return"DAY"},Ri="hour",Ai=i("HOUR",!0),Mi=function(){return"HOUR"},Ii="minute",Di=i("MINUTE",!0),Fi=function(){return"MINUTE"},Vi="second",Li=i("SECOND",!0),Ui=function(){return"SECOND"},Bi="case",Ni=i("CASE",!0),ji=function(){return"CASE"},Gi="end",zi=i("END",!0),Hi=function(){return"END"},ki="when",Wi=i("WHEN",!0),qi=function(){return"WHEN"},Xi="then",Yi=i("THEN",!0),Qi=function(){return"THEN"},Zi="else",Ki=i("ELSE",!0),Ji=function(){return"ELSE"},$i=",",en=i(",",!1),tn="(",rn=i("(",!1),nn=")",an=i(")",!1),on=/^[ \t\n\r]/,sn=n([" ","\t","\n","\r"],!1,!1),ln="`",un=i("`",!1),cn=/^[^`]/,hn=n(["`"],!0,!1),dn=function(e){return e.join("")},pn=0,fn=[{line:1,column:1}],mn=0,gn=[],vn=0;if("startRule"in r){if(!(r.startRule in ye))throw new Error("Can't start parsing from rule \""+r.startRule+'".');be=ye[r.startRule]}if((ge=be())!==ve&&pn===t.length)return ge;throw ge!==ve&&pn<t.length&&s({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(gn,mn<t.length?t.charAt(mn):null,mn<t.length?o(mn,mn+1):o(mn,mn))}}}.apply(null,[]))||(e.exports=i)},1757:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(9),r(1760),r(1761),r(1763),r(1758),r(1764),r(1789),r(1790),r(1794),r(1797)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d){Object.defineProperty(t,"__esModule",{value:!0});var p=i.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");t.make=function(e,t,r,i){var n=m[e.type]&&m[e.type][t.type]||f[t.type];return n?new n(e,t,r,i):(p.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)};var f={icon:a,object:l,line:o,path:r("enable-feature:dkoerner/new-path-geometry")?c:u,fill:h,extrude:n,text:d},m={"mesh-3d":{fill:s}}}.apply(null,i))||(e.exports=n)},1758:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(25),r(58),r(58),r(38),r(1563),r(528),r(31),r(146),r(1599),r(1585),r(1574),r(1584),r(1646),r(1740),r(1589),r(93),r(1575),r(1570),r(1576),r(1581),r(1600),r(1559),r(1592),r(1720)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E){var P=C.VertexAttrConstants,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._edgeStageObjects=new Set,t._materials={},t._textures={},t}return r(t,e),t.prototype._prepareResources=function(){v.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new E({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new E({color:[0,1,1,1]},"debugFAceNormal")),this.resolve()},t.prototype.destroy=function(){for(var t in e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._materials){var r=this._materials[t];this._context.stage.remove(b.ModelContentType.MATERIAL,r.material.id)}for(var t in this._textures){var i=this._textures[t];this._context.stage.remove(b.ModelContentType.TEXTURE,i.id)}this._materials={},this._textures={}},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("mesh"!==t.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,i=this.getGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,n,i,r,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getLayerOpacity();for(var t in this._materials){var r=this._materials[t];r.material.setParameterValues({layerOpacity:e});var i=r.material.getParameterValues();this._setMaterialTransparentParameter(i,r.isComponentTransparent),r.material.setParameterValues({transparent:i.transparent})}if(this._edgeStageObjects.size>0){var n=this._context.stage.view.getEdgeView(),a=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){n.updateAllComponentOpacities(e,[a])})}return!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,p.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;for(var i in this._materials)this._materials[i].material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(this._edgeStageObjects.size>0){var a=this._context.stage.view.getEdgeView(),o=this._createEdgeMaterial(a);if(n.isSome(o)){var s=[o];this._edgeStageObjects.forEach(function(e){a.updateAllComponentMaterials(e,s,{slicePlaneEnabled:r._context.slicePlaneEnabled},!1)})}}return!0},t.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._colorUid=function(e){var t=e.material&&e.material.color;if(!t)return"-";if(t)switch(t.type){case"value":return t.value.toHex();case"image":return t.uid;default:a.neverReached(t)}},t.prototype._materialProperties=function(e,t,r){var i=this._requiresSymbolVertexColors(),n=t.material&&t.material.color,a=this._colorUid(t),o=!!e.vertexAttributes.color;return{hasSymbolVertexColors:i,hasVertexColors:o,color:n,uid:"vc:"+o+",vct"+r+",svc:"+i+",cmuid:"+a}},t.prototype._setInternalColorValueParameters=function(e,t){t.diffuse=i.toUnitRGB(e.value),t.opacity=e.value.a},t.prototype._getLoadableTextureResource=function(e){return e.data?e.data instanceof HTMLImageElement?e.data.complete?e.data:e.data.src:e.data:e.url},t.prototype._setInternalColorImageParameters=function(e,t,r){var i=this._getLoadableTextureResource(e);if(i){var n=this._textures[e.uid];n||(n=new S(i,t+"_"+e.uid+"_tex",{mipmap:!0,wrap:{s:10497,t:10497},noUnpackFlip:!0}),this._textures[e.uid]=n,this._context.stage.add(b.ModelContentType.TEXTURE,n)),r.textureId=n.id}},t.prototype._setInternalMaterialParameters=function(e,t,r){var i=e.material&&e.material.color;if(i)switch(i.type){case"value":this._setInternalColorValueParameters(i,r);break;case"image":this._setInternalColorImageParameters(i,t,r)}},t.prototype._setExternalMaterialParameters=function(e){if(this._isPropertyDriven("color"))e.externalColor=A;else{var t=this.symbol.material?i.toUnitRGBA(this.symbol.material.color):A;e.externalColor=t}var r=this.symbol.material&&this.symbol.material.colorMixMode;r&&(e.colorMixMode=r)},t.prototype._hasTransparentVertexColors=function(e){var t=e.vertexAttributes.color;if(!t)return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1},t.prototype._getOrCreateMaterial=function(e,t){var r=this._hasTransparentVertexColors(e)||!!t.get("material.color.transparent"),i=this._materialProperties(e,t,r),n=this._materials[i.uid];if(n)return n.material;var a=this._getStageIdHint(),o={specular:M,vertexColors:i.hasVertexColors,symbolColors:i.hasSymbolVertexColors,ambient:M,diffuse:R,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};this._setInternalMaterialParameters(t,a,o),this._setExternalMaterialParameters(o),this._setMaterialTransparentParameter(o,r);var s=new T(o,a+"_"+i.uid+"_mat");return this._materials[i.uid]={material:s,isComponentTransparent:r},this._context.stage.add(b.ModelContentType.MATERIAL,s),s},t.prototype._setMaterialTransparentParameter=function(e,t){var r=this._isPropertyDriven("opacity");e.transparent=r||t||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1},t.prototype._addDebugNormals=function(e,t,r,i){for(var n,a,s,l,u=t.length,c=e.spatialReference.isWGS84?20015077/180:1,h=.1*Math.max(e.extent.width*c,e.extent.height*c,e.extent.zmax-e.extent.zmin),d=[],p=[],f=[],m=[],g=0;g<u;g++)for(var v=t[g],y=v.data.getAttribute(P.POSITION),b=v.data.getAttribute(P.NORMAL),w=v.data.getIndices(P.POSITION),S=v.data.getIndices(P.NORMAL),C=y.data,T=b.data,E=0;E<w.length;E++){for(var O=3*w[E],R=3*S[E],A=0;A<3;A++)d.push(C[O+A]);for(A=0;A<3;A++)d.push(C[O+A]+T[R+A]*h);if(p.push(p.length),p.push(p.length),E%3==0){this._calculateFaceNormal(C,w,E,L),this._getFaceVertices(C,w,E,D,F,V),o.vec3.add(D,D,F),o.vec3.add(D,D,V),o.vec3.scale(D,D,1/3);for(A=0;A<3;A++)f.push(D[A]);for(A=0;A<3;A++)f.push(D[A]+L[A]*h);m.push(m.length),m.push(m.length)}}var M=((n={})[P.POSITION]={data:new Float64Array(d),size:3},n),I=((a={})[P.POSITION]=new Uint32Array(p),a),U=new x(M,I,void 0,"line");(B=new _(U,"debugVertexNormal")).singleUse=!0,t.push(B),r.push(this._debugVertexNormalMaterial),i.push(o.mat4f64.clone(i[0]));var B;(s={})[P.POSITION]={data:new Float64Array(f),size:3},M=s,(l={})[P.POSITION]=new Uint32Array(m),I=l,U=new x(M,I,void 0,"line");(B=new _(U,"debugFaceNormal")).singleUse=!0,t.push(B),r.push(this._debugFaceNormalMaterial),i.push(o.mat4f64.clone(i[0]))},t.prototype._createAs3DShape=function(e,t,r,i,a){var o=this,s=e.geometry;if("mesh"!==s.type)return null;var l=this._createGeometryInfo(s,t,i);if(!l)return null;var u=l.geometries,c=l.materials,f=l.transformations,m=l.objectTransformation;v.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,u,c,f);var g=new w({geometries:u,materials:c,transformations:f,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:a},idHint:i});g.setObjectTransformation(m);var y=function(e){var t=o._context.stage.view.getEdgeView();if(t){t.removeObject(e),o._edgeStageObjects.delete(e);var r=o._createEdgeMaterial(t);n.isSome(r)&&(o._edgeStageObjects.add(e),t.addObject(e,[r],{slicePlaneEnabled:o._context.slicePlaneEnabled},{mergeGeometries:!0}))}};y(g);var b=function(e,t,r,i,n){var a=h.perObjectElevationAligner(e,t,r,i,n);return y(g),a},_=new d(this,g,u,null,null,b,r);_.needsElevationUpdates=p.needsElevationUpdates3D(r.mode);var x=s.extent.center.clone();return x.z=0,_.elevationContext.centerPointInElevationSR=x,_.alignedTerrainElevation=b(_,_.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext),_},t.prototype._createComponentNormals=function(e,t,r,i){var n=r.shading||"flat";switch(n){case"source":return this._createComponentNormalsSource(e,t,r,i);case"flat":return this._createComponentNormalsFlat(e,r,i);case"smooth":return this._createComponentNormalsSmooth(e,r,i);default:a.neverReached(n)}},t.prototype._createComponentNormalsSource=function(e,t,r,i){if(!t)return this._createComponentNormalsFlat(e,r,i);for(var n=!1,a=0;a<i.length;a+=3){this._calculateFaceNormal(e,i,a,L);for(var s=0;s<3;s++){var l=3*i[a+s];D[0]=t[l+0],D[1]=t[l+1],D[2]=t[l+2],o.vec3.dot(L,D)<0&&(t[l+0]=-t[l+0],t[l+1]=-t[l+1],t[l+2]=-t[l+2],n=!0)}}return{normals:t,indices:i,didFlipNormals:n}},t.prototype._createComponentNormalsFlat=function(e,t,r){for(var i=new Float32Array(r.length),n=new Uint32Array(3*r.length),a=0;a<r.length;a+=3)for(var o=this._calculateFaceNormal(e,r,a,L),s=0;s<3;s++)i[a+s]=o[s],n[a+s]=a/3;return{normals:i,indices:n,didFlipNormals:!1}},t.prototype._createComponentNormalsSmooth=function(e,t,r){for(var i={},n=0;n<r.length;n+=3)for(var a=this._calculateFaceNormal(e,r,n,L),s=0;s<3;s++){(h=i[c=r[n+s]])||(h={normal:o.vec3f64.create(),count:0},i[c]=h),o.vec3.add(h.normal,h.normal,a),h.count++}var l=new Float32Array(3*r.length),u=new Uint32Array(3*r.length);for(n=0;n<r.length;n++){var c,h;1!==(h=i[c=r[n]]).count&&(o.vec3.normalize(h.normal,h.normal),h.count=1);for(s=0;s<3;s++)l[3*n+s]=h.normal[s];u[n]=n}return{normals:l,indices:u,didFlipNormals:!1}},t.prototype._getFaceVertices=function(e,t,r,i,n,a){var o=3*t[r+0],s=3*t[r+1],l=3*t[r+2];i[0]=e[o+0],i[1]=e[o+1],i[2]=e[o+2],n[0]=e[s+0],n[1]=e[s+1],n[2]=e[s+2],a[0]=e[l+0],a[1]=e[l+1],a[2]=e[l+2]},t.prototype._calculateFaceNormal=function(e,t,r,i){return this._getFaceVertices(e,t,r,D,F,V),o.vec3.subtract(F,F,D),o.vec3.subtract(V,V,D),o.vec3.cross(D,F,V),o.vec3.normalize(i,D),i},t.prototype._getOrCreateComponents=function(e){return e.components?e.components:j},t.prototype._createPositionBuffer=function(e){var t=e.vertexAttributes.position,r=new Float64Array(t.length),i=this._context.renderSpatialReference;return p.reproject(e.vertexAttributes.position,0,e.spatialReference,r,0,i,t.length/3),r},t.prototype._createNormalBuffer=function(e,t){var r=e.vertexAttributes.normal;if(!r)return null;if("local"===this._context.layerView.view.viewingMode)return r;var i=e.vertexAttributes.position,n=new Float32Array(r.length);return c.projectNormalToECEF(r,i,t,e.spatialReference,n)},t.prototype._createColorBuffer=function(e){return e.vertexAttributes.color},t.prototype._createSymbolColorBuffer=function(e){if(this._requiresSymbolVertexColors()){var t=this._getVertexOpacityAndColor(e),r=this.symbol.material&&this.symbol.material.colorMixMode||null,i=new Uint8Array(4);return g.encodeSymbolColor(t,r,i),i}return null},t.prototype._createColorIndices=function(e,t){for(var r=new Uint32Array(t.length),i=0;i<r.length;i++)r[i]=0;return r},t.prototype._createBuffers=function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var i=e.vertexAttributes.normal,n=e.vertexAttributes.uv;if(i&&i.length!==r.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var a=this._createPositionBuffer(e),o=this._createColorBuffer(e),s=this._createSymbolColorBuffer(t),l=this._createNormalBuffer(e,a);return{positionBuffer:a,normalBuffer:l,uvBuffer:n,colorBuffer:o,symbolColorBuffer:s,objectTransformation:this._transformCenterLocal(e,a,l)}},t.prototype._transformCenterLocal=function(e,t,r){var i=e.extent.center,n=this._context.renderSpatialReference;I[0]=i.x,I[1]=i.y,I[2]=0;var a=o.mat4f64.create();y.computeLinearTransformation(e.spatialReference,I,a,n),o.mat4.invert(U,a);for(var s=0;s<t.length;s+=3)D[0]=t[s+0],D[1]=t[s+1],D[2]=t[s+2],o.vec3.transformMat4(D,D,U),t[s+0]=D[0],t[s+1]=D[1],t[s+2]=D[2];if(r){o.mat3.fromMat4(B,a),o.mat3.transpose(B,B);for(s=0;s<r.length;s+=3)D[0]=r[s+0],D[1]=r[s+1],D[2]=r[s+2],o.vec3.transformMat3(D,D,B),r[s+0]=D[0],r[s+1]=D[1],r[s+2]=D[2]}return a},t.prototype._validateFaces=function(e,t){var r=e.vertexAttributes.position.length/3,i=t.faces;if(i){for(var n=-1,a=0;a<i.length;a++){var o=i[a];o>n&&(n=o)}if(r<=n)return this._logWarning("Vertex index "+n+" is out of bounds of the mesh position buffer"),!1}else if(r%3!=0)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0},t.prototype._getOrCreateFaces=function(e,t){if(t.faces)return t.faces;for(var r=new Uint32Array(e.vertexAttributes.position.length/3),i=0;i<r.length;i++)r[i]=i;return r},t.prototype._isOutsideClippingArea=function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var r,i=this._context.elevationProvider.spatialReference,n=t.length/3;return e.spatialReference.equals(i)?r=t:(r=new Float64Array(t.length),p.reproject(e.vertexAttributes.position,0,e.spatialReference,r,0,i,n)),p.computeBoundingBox(r,0,n,N),p.boundingBoxClipped(N,this._context.clippingExtent)},t.prototype._createGeometryInfo=function(e,t,r){var i,n;if(!u.canProject(e,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var a=this._createBuffers(e,t);if(!a)return null;for(var s=a.positionBuffer,l=a.uvBuffer,c=a.colorBuffer,h=a.symbolColorBuffer,d=a.normalBuffer,p=a.objectTransformation,f=[],m=[],g=[],v=!1,y=0,b=this._getOrCreateComponents(e);y<b.length;y++){var w=b[y];if(!this._validateFaces(e,w))return null;var S=this._getOrCreateFaces(e,w);if(0!==S.length){var C=this._createComponentNormals(s,d,w,S);C.didFlipNormals&&(v=!0);var T=((i={})[P.POSITION]={size:3,data:s},i[P.NORMAL]={size:3,data:C.normals},i),E=((n={})[P.POSITION]=S,n[P.NORMAL]=C.indices,n);c&&(T[P.COLOR]={size:4,data:c},E[P.COLOR]=S),h&&(T[P.SYMBOLCOLOR]={size:4,data:h},E[P.SYMBOLCOLOR]=this._createColorIndices(w,S)),e.vertexAttributes.uv&&(T[P.UV0]={size:2,data:l},E[P.UV0]=S);var O=new x(T,E),R=new _(O,r+"_mesh");R.singleUse=!0,f.push(R),m.push(o.mat4f64.create()),g.push(this._getOrCreateMaterial(e,w))}}return v&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:m,materials:g,objectTransformation:p}},t.prototype._createEdgeMaterial=function(e){var t={opacity:this._getLayerOpacity()};return m.createMaterial(e,this.symbol,t)},t}(f),R=[1,1,1],A=[1,1,1,1],M=[0,0,0],I=o.vec3f64.create(),D=o.vec3f64.create(),F=o.vec3f64.create(),V=o.vec3f64.create(),L=o.vec3f64.create(),U=o.mat4f64.create(),B=o.mat3f64.create(),N=s.create(),j=[new l];return O}.apply(null,i))||(e.exports=n)},1759:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({SLICE:e.slice})};t.colorPass={name:"native-line-color",shaders:function(e){return{vertexShader:i.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"native-line-highlight",shaders:function(e){return{vertexShader:i.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1760:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(58),r(516),r(38),r(43),r(1593),r(1585),r(1574),r(1584),r(1566),r(1646),r(93),r(1575),r(1570),r(1576),r(1581),r(1559),r(1592)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b){function _(e,t,r,i,n,a,o,s,l,u,c,h,d,p){var f=r.length/3,m=0;c+=2*i.count,x(e,t,i.index,i.count,r,0,f,n,a,o,s,l,u,c,h,d,p),l+=2*i.count,c+=2*f,c-=2*i.count+2*f,S(n,a,s,o,m,i.pathLengths[0],i.count,l,u,c,h),l+=4*i.pathLengths[0],c+=2*i.pathLengths[0],m+=i.pathLengths[0];for(var g=1;g<i.pathLengths.length;++g)S(n,a,s,o,m,i.pathLengths[g],i.count,l,u,c,h),l+=4*i.pathLengths[g],c+=2*i.pathLengths[g],m+=i.pathLengths[g]}function x(e,t,r,i,n,o,s,l,u,c,h,d,p,f,m,g,v){a.vec3.copy(P,g);for(var y=m>0?1:-1,b=3*r,_=d,x=3*_,w=d+i,S=3*w,C=0;C<i;++C)v&&(P[0]=e[b+0],P[1]=e[b+1],P[2]=e[b+2],a.vec3.normalize(P,P)),l[x+0]=e[b+0],l[x+1]=e[b+1],l[x+2]=e[b+2],u[x+0]=t[b+0],u[x+1]=t[b+1],u[x+2]=t[b+2],c[x+0]=-y*P[0],c[x+1]=-y*P[1],c[x+2]=-y*P[2],h[_]=0,l[S+0]=e[b+0]+m*P[0],l[S+1]=e[b+1]+m*P[1],l[S+2]=e[b+2]+m*P[2],u[S+0]=t[b+0],u[S+1]=t[b+1],u[S+2]=t[b+2],c[S+0]=y*P[0],c[S+1]=y*P[1],c[S+2]=y*P[2],h[w]=m,x+=3,S+=3,b+=3,_+=1,w+=1;b=3*o,x=3*f,S=3*(f+s),x=3*(f+s),S=3*f;var T=O,E=R;m<0&&(T=R,E=O);for(C=0;C<s;++C)p[x+0]=n[b+T[0]],p[x+1]=n[b+T[1]],p[x+2]=n[b+T[2]],p[S+0]=n[b+E[0]]+i,p[S+1]=n[b+E[1]]+i,p[S+2]=n[b+E[2]]+i,x+=3,S+=3,b+=3}function w(e,t,r,i,n,a,o){i[a]=i[o],o*=3,e[(a*=3)+0]=e[o+0],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a+0]=t[o+0],t[a+1]=t[o+1],t[a+2]=t[o+2],r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2]}function S(e,t,r,i,n,a,o,s,l,u,c){var h=n,d=n+1,p=n+o,f=n+o+1,m=s,g=s+1,v=s+2*a,y=s+2*a+1;c<0&&(h=n+o+1,f=n),u*=3;for(var b=0;b<a;++b)b===a-1&&(c>0?(d=n,f=n+o):(d=n,h=n+o)),C(e,h,d,p,D),w(e,t,i,r,D,m,h),w(e,t,i,r,D,g,d),w(e,t,i,r,D,v,p),w(e,t,i,r,D,y,f),l[u++]=m,l[u++]=v,l[u++]=y,l[u++]=m,l[u++]=y,l[u++]=g,h++,d++,p++,f++,m+=2,g+=2,v+=2,y+=2}function C(e,t,r,i,n){t*=3,r*=3,i*=3,a.vec3.set(F,e[t++],e[t++],e[t++]),a.vec3.set(V,e[r++],e[r++],e[r++]),a.vec3.set(L,e[i++],e[i++],e[i++]),a.vec3.subtract(U,V,F),a.vec3.subtract(B,L,F),a.vec3.cross(n,B,U),a.vec3.normalize(n,n)}function T(e,t,r,i){A.spatialReference=r.spatialReference;for(var n=e.getGeometryRecords(),a=n.length,o="absolute-height"!==t.mode,s=0,l=0;l<a;l++){var c=n[l].geometry,h=n[l].transformation;j[0]=h[12],j[1]=h[13],j[2]=h[14],c.invalidateBoundingInfo();for(var d=c.data.getVertexAttr(),p=d[y.VertexAttrConstants.POSITION].data,f=d[y.VertexAttrConstants.SIZE].data,m=d.mapPos.data,g=p.length/3,v=0,b=0,_=!1,x=0,w=0;w<g;w++){A.x=m[b],A.y=m[b+1],A.z=m[b+2],N[0]=p[v],N[1]=p[v+1],N[2]=p[v+2];var S=u.computeElevation(r,A,t,i,o?M:null);o&&(x+=M.terrainElevation),E[0]=p[v]+j[0],E[1]=p[v+1]+j[1],E[2]=p[v+2]+j[2],i.setAltitude(S+f[v/3],E),p[v]=E[0]-j[0],p[v+1]=E[1]-j[1],p[v+2]=E[2]-j[2];var C=.01/i.unitInMeters;(Math.abs(N[0]-p[v])>C||Math.abs(N[1]-p[v+1])>C||Math.abs(N[2]-p[v+2])>C)&&(_=!0),b+=3,v+=3}_&&e.geometryVertexAttrsUpdated(l),s+=x/g}return s/a}var E=a.vec3f64.create(),P=a.vec3f64.create(),O=[0,2,1],R=[0,1,2],A=s.makeDehydratedPoint(0,0,0,null),M={verticalDistanceToGround:0,terrainElevation:0},I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._edgeStageObjects=new Set,t}return r(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=h.validateSymbolLayerSize(this._getSymbolSize());if(e)return this._logWarning(e),void this.reject()}var t=this._getStageIdHint(),r=this._getMaterialOpacityAndColor(),i=a.vec3f64.fromArray(r),n=r[3],o={diffuse:i,ambient:i,opacity:n,transparent:n<1||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new b(o,t+"_3dlinemat"),this._context.stage.add(f.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&this._context.stage.remove(f.ModelContentType.MATERIAL,this._material.id)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,i=r.geometry;if("polygon"!==i.type&&"extent"!==i.type)return this._logWarning("unsupported geometry type for extrude symbol: "+i.type),null;if(!this._validateGeometry(i))return null;var n="polygon"===i.type||"extent"===i.type?"rings":"paths",a="graphic"+r.uid,o=this._getVertexOpacityAndColor(t,Float32Array,255),s=this.getGraphicElevationContext(r);return this._createAs3DShape(r,n,t,o,s,a,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getMaterialOpacity(),t=e<1||this._isPropertyDriven("opacity");if(this._material.setParameterValues({opacity:e,transparent:t}),this._edgeStageObjects.size>0){var r=this._context.stage.view.getEdgeView(),i=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){r.updateAllComponentOpacities(e,[i])})}return!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,u.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;if(this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._edgeStageObjects.size>0){var n=this._context.stage.view.getEdgeView(),a=this._createEdgeMaterial(n);if(i.isSome(a)){var o=[a];this._edgeStageObjects.forEach(function(e){n.updateAllComponentMaterials(e,o,{slicePlaneEnabled:r._context.slicePlaneEnabled},!1)})}}return!0},t.prototype._getExtrusionSize=function(e){return(e.size&&this._isPropertyDriven("size")?u.getSingleSizeDriver(e.size,2):this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){return this.symbol.size||1},t.prototype._createAs3DShape=function(e,t,r,s,c,h,d){var f=this,g=e.geometry;"extent"===g.type&&(g=o.fromExtent(g));var y=g[t],b=[],x=[],w=[],S=a.vec3f64.create(),C=new Array(6),E=this._context.renderSpatialReference===p.SphericalECEFSpatialReference,P=this._getExtrusionSize(r),O=a.vec3f64.create();E||this._context.renderCoordsHelper.worldUpAtPosition(null,O);var R=u.getGeometryVertexData3D(y,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);if(this._logGeometryCreationWarnings(R,y,t,"ExtrudeSymbol3DLayer"),y.length>0){for(var A=R.geometryData.polygons,M=R.eleVertexData,I=R.vertexData,D=I.length/3,F=new Float64Array(3*D*6),V=new Float64Array(3*D*6),L=new Float64Array(3*D*6),U=new Float64Array(1*D*6),B=0,N=this,j=0;j<A.length;++j)!function(e){var t=A[e],r=t.count,i=t.index;if(N._context.clippingExtent&&(u.computeBoundingBox(M,i,r,C),u.boundingBoxClipped(C,N._context.clippingExtent)))return"continue";var o=new Float64Array(M.buffer,3*i*F.BYTES_PER_ELEMENT,3*r),l=t.holeIndices.map(function(e){return e-i}),c=n(o,l,3);if(c.length>0){u.chooseOrigin(I,i,r,S);var d=3*r*2+2*c.length,p=new Uint32Array(d),f=6*r,g=new Float64Array(F.buffer,3*B*F.BYTES_PER_ELEMENT,3*f),v=new Float64Array(V.buffer,3*B*V.BYTES_PER_ELEMENT,3*f),y=new Float64Array(L.buffer,3*B*L.BYTES_PER_ELEMENT,3*f),T=new Float64Array(U.buffer,1*B*U.BYTES_PER_ELEMENT,1*f);_(I,M,c,t,g,y,v,T,0,p,0,P,O,E),u.subtractCoordinates(g,0,f,S),B+=6*r;var R=N._createExtrudeGeometry(p,{positions:g,elevation:y,normals:v,heights:T},s),D=new m(R,h+"path"+e);D.singleUse=!0,b.push(D),x.push(N._material);var j=a.mat4f64.create();a.mat4.translate(j,j,S),w.push(j)}}(j);if(b.length>0){var G=new v({geometries:b,materials:x,transformations:w,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:h}),z=function(e){var t=f._context.stage.view.getEdgeView();if(t){t.removeObject(e),f._edgeStageObjects.delete(e);var r=f._createEdgeMaterial(t);i.isSome(r)&&(f._edgeStageObjects.add(e),t.addObject(e,[r],{slicePlaneEnabled:f._context.slicePlaneEnabled}))}};z(G);var H=new l(this,G,b,null,null,function(e,t,r,i){var n=T(e.stageObject,t,r,i);return z(G),n},c);return H.alignedTerrainElevation=R.terrainElevation,H.needsElevationUpdates=u.needsElevationUpdates3D(c.mode),H}return null}return null},t.prototype._createExtrudeGeometry=function(e,t,r){for(var i=e.length,n=e,a=new Uint32Array(i),o=0;o<i;o++)a[o]=0;var s={},l={};return s[y.VertexAttrConstants.POSITION]=n,s[y.VertexAttrConstants.NORMAL]=n,s[y.VertexAttrConstants.COLOR]=a,l[y.VertexAttrConstants.POSITION]={size:3,data:t.positions},l[y.VertexAttrConstants.NORMAL]={size:3,data:t.normals},l[y.VertexAttrConstants.COLOR]={size:4,data:r},l[y.VertexAttrConstants.SIZE]={size:1,data:t.heights},t.elevation&&(l.mapPos={size:3,data:t.elevation},s.mapPos=n),new g(l,s)},t.prototype._createEdgeMaterial=function(e){var t={opacity:this._getLayerOpacity()};return d.createMaterial(e,this.symbol,t)},t}(c),D=a.vec3f64.create(),F=a.vec3f64.create(),V=a.vec3f64.create(),L=a.vec3f64.create(),U=a.vec3f64.create(),B=a.vec3f64.create(),N=a.vec3f64.create(),j=a.vec3f64.create();return I}.apply(null,i))||(e.exports=n)},1761:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(26),r(116),r(25),r(8),r(19),r(5),r(7),r(27),r(17),r(38),r(532),r(1599),r(1633),r(1585),r(1574),r(1584),r(1566),r(1762),r(1625),r(93),r(1575),r(1570),r(1596),r(1607),r(1600),r(1615)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E,P,O){function R(e){return"cross"===e||"x"===e}function A(e){var t,r=U,i=r*B;switch("primitive:"===e.substring(0,10)&&(e=e.substring(10)),e){case j.PRIM_CIRCLE:t=_.computeSignedDistancefieldCicle(r,i);break;case j.PRIM_SQUARE:t=_.computeSignedDistancefieldSquare(r,i,!1);break;case j.PRIM_KITE:t=_.computeSignedDistancefieldSquare(r,i,!0);break;case j.PRIM_CROSS:t=_.computeSignedDistancefieldCrossAndX(r,i,!1);break;case j.PRIM_X:t=_.computeSignedDistancefieldCrossAndX(r,i,!0)}return new P(t,"sdf_"+e,{mipmap:!1,wrap:{s:33071,t:33071},width:U,height:U,components:4})}var M=d.mat4f64.create(),I=d.vec3f64.fromValues(0,0,1),D=[0,0,0,0],F=d.vec3f64.fromValues(0,0,0),V=d.vec3f64.fromValues(1,1,1),L=["center","bottom","top","left","right","bottom-left","bottom-right","top-left","top-right"],U=128,B=.5,N=[B/2,B/2,1-B/2,1-B/2],j={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},G=[U*B,U*B],z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},t}return i(t,e),t.prototype._prepareResources=function(){var e=this.symbol,t=Math.round(null!=e.size?c.pt2px(e.size):16);this._size=null,this._symbolTextureRatio=1,this._primitive=null;var r=this._getStageIdHint();if(!this._isPropertyDriven("size")){var i=b.validateSymbolLayerSize(t);if(i)return this._logWarning(i),void this.reject()}this._isPropertyDriven("size")&&t<64&&(t=64);var n=e.resource||{primitive:"circle",href:void 0},a={anchorPos:this._getAnchorPos(e)},o=this.symbolContainer;if(this._hasVisibleVerticalOffset(o)){var s=o.verticalOffset,l=s.screenLength,u=s.minWorldLength,h=s.maxWorldLength;a.verticalOffset={screenLength:c.pt2px(l),minWorldLength:u||0,maxWorldLength:null!=h?h:1/0}}if(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),n.href)this._outlineSize=this._getOutlineSize(e,null),a.color=this._getFillColor(e,null),a.outlineColor=this._getOutlineColor(e),a.outlineSize=this._outlineSize,a.textureIsSignedDistanceField=!1,this._prepareImageResources(t,a,r);else{var d=n.primitive||"circle",p="primitive:"+d;if(this._primitive=d,this._outlineSize=this._getOutlineSize(e,d),a.color=this._getFillColor(e,d),a.outlineColor=this._getOutlineColor(e),a.outlineSize=this._outlineSize,R(d)&&0===a.outlineSize)return void this.reject();this.texture=this._context.sharedResources.textures.acquire(p,A),this._textureURI=p,a.textureIsSignedDistanceField=!0,a.distanceFieldBoundingBox=N,a.textureId=this.texture.id,this._size=[t,t],this._symbolTextureRatio=1/B,this._createMaterialsAndAddToStage(a,this._context.stage,r),this.resolve()}},t.prototype._getOutlineSize=function(e,t){var r;return r=e.outline&&null!=e.outline.size?c.pt2px(e.outline.size):R(t)?1.5:0,Math.max(r,0)},t.prototype._getOutlineColor=function(e){var t=this._getLayerOpacity();if(e.outline){if(null!=e.outline.color){var r=a.toUnitRGB(e.outline.color),i=e.outline.color.a*t;return[r[0],r[1],r[2],i]}return[0,0,0,t]}return[0,0,0,t]},t.prototype._getFillColor=function(e,t){return R(t)?D:this._getMaterialOpacityAndColor()},t.prototype._getAnchorPos=function(e){return L.indexOf(e.anchor)>-1?e.anchor:"center"},t.prototype._prepareImageResources=function(e,t,r){var i=this,a=p.getIconHref(this.symbolContainer,this.symbol);if(!s("esri-canvas-svg-support")&&h.isSVG(a)){var l="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)";return this._logWarning(l),void this.reject(new o("SVG Not Supported",l))}u.when(this._context.sharedResources.textures.acquire(a,e)).then(function(n){if(!i.isRejected()){var a=n.params,o=a.width/a.height;i._size=e?o>1?[e,Math.round(e/o)]:[Math.round(e*o),e]:[a.width,a.height],t.textureId=n.id,i._createMaterialsAndAddToStage(t,i._context.stage,r),i.resolve()}},function(e){if(e instanceof n)i.reject();else{var t="IconSymbol3DLayer failed to load (Request for icon resource failed: "+a+")";i._logWarning(t),i.reject(new o("Request Failed",t))}}),this._textureURI=a},t.prototype._createMaterialsAndAddToStage=function(e,t,i){this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&l.mixin(e,this._fastUpdates.materialParameters);var n=r({},e);n.verticalOffset=null,n.screenSizePerspective=null,n.occlusionTest=!1,n.slicePlaneEnabled=!1,n.shaderPolygonOffset=0,this._drapedMaterial=new O(n,i+"_iconDraped"),t.add(S.ModelContentType.MATERIAL,this._drapedMaterial),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,this._material=new O(e,i+"_icon"),t.add(S.ModelContentType.MATERIAL,this._material)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(S.ModelContentType.MATERIAL,this._material.id),this._material=null),this._drapedMaterial&&(this._context.stage.remove(S.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null),this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)},t.prototype._getScaleFactor=function(e){if(this._isPropertyDriven("size")&&e.size){for(var t=0;t<3;t++){var r=e.size[t];r&&"symbolValue"!==r&&"proportional"!==r&&(e.size[t]=c.pt2px(r))}var i=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic;if(!this._validateGeometry(r.geometry))return null;var i=v.placePointOnGeometry(r.geometry);if(!i)return this._logWarning("unsupported geometry type for icon symbol: "+r.geometry.type),null;var n="graphic"+r.uid,a=this._getVertexOpacityAndColor(t),o=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(o=this._getScaleFactor(t)),o*=this._symbolTextureRatio;var s=[this._size[0]*o,this._size[1]*o],l=this.getGraphicElevationContext(r);return"on-the-ground"===l.mode?this._createAsOverlay(r,i,a,s,l,n,r.uid):this._createAs3DShape(r,i,a,s,l,n,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getFillColor(this.symbol,this._primitive);this._drapedMaterial.setParameterValues({color:e}),this._material.setParameterValues({color:e});var t=this._getOutlineColor(this.symbol);return this._drapedMaterial.setParameterValues({outlineColor:t}),this._material.setParameterValues({outlineColor:t}),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var i=this._elevationContext.mode;if("on-the-ground"===r&&"on-the-ground"===i)return!0;if(r!==i&&("on-the-ground"===r||"on-the-ground"===i))return!1;var n=v.needsElevationUpdates2D(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return n})},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!x.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._drapedMaterial&&(this._drapedMaterial.renderPriority=e,r.add(this._drapedMaterial.id))},t.prototype._defaultElevationInfoNoZ=function(){return H},t.prototype._createAs3DShape=function(e,t,r,i,n,a,o){var s=this,l=this.getFastUpdateAttrValues(e),u=l?function(e){return x.evaluateModelTransform(s._fastUpdates.materialParameters,l,e)}:null,c=T.createPointGeometry(I,null,r,i,k,null,l),h=[new C(c,a)],d=v.createStageObjectForPoint(this._context,t,h,[this._material],null,null,n,a,this._context.layer.uid,o,!0,u);if(null===d)return null;var p=f.perObjectElevationAligner,m=new g(this,d.object,h,null,null,p,n);return m.alignedTerrainElevation=d.terrainElevation,m.needsElevationUpdates=v.needsElevationUpdates2D(n.mode)||"absolute-height"===n.mode,m.getScreenSize=this._createScreenSizeGetter(i,u),m.calculateRelativeScreenBounds=function(e){return s._material.calculateRelativeScreenBounds(m.getScreenSize(),1,e)},v.extendPointGraphicElevationContext(m,t,this._context.elevationProvider),m},t.prototype._createAsOverlay=function(e,t,r,i,n,a,o){var s=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;var l=d.vec3f64.create();w.pointToVector(t,l,this._context.overlaySR),l[2]=this._getDrapedZ();var u=this._context.clippingExtent;if(u&&!v.pointInBox2D(l,u))return null;var c=this.getFastUpdateAttrValues(e),h=c?function(e){return x.evaluateModelTransform(s._fastUpdates.materialParameters,c,e)}:null,p=T.createPointGeometry(I,l,r,i,null,null,c),f=new E(p);f.material=this._drapedMaterial,f.center=l,f.bsRadius=0,f.transformation=M,f.name=a,f.uniqueName=a+"#"+p.id;var g=new m(this,[f],null);return g.getScreenSize=this._createScreenSizeGetter(i,h),g.calculateRelativeScreenBounds=function(e){return s._drapedMaterial.calculateRelativeScreenBounds(g.getScreenSize(),1,e)},g},t.prototype._createScreenSizeGetter=function(e,t){var r=this._outlineSize+2;if(this._fastUpdates.enabled){var i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return function(e){void 0===e&&(e=d.vec2f64.create());var a=t(M);return e[0]=a[0]*i+r,e[1]=a[5]*n+r,e}}var a=e[0]/this._symbolTextureRatio+r,o=e[1]/this._symbolTextureRatio+r;return function(e){return void 0===e&&(e=d.vec2f64.create()),e[0]=a,e[1]=o,e}},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=d.vec3f64.fromValues(e,e,e),r=c.px2pt(1),i=e*r;return{modelSize:t,symbolSize:d.vec3f64.fromValues(i,i,i),unitInMeters:r,transformation:{anchor:F,scale:V,rotation:F}}},t.prototype._hasVisibleVerticalOffset=function(e){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()},t.PRIMITIVE_SIZE=G,t.VALID_ANCHOR_STRINGS=L,t}(y),H={mode:"relative-to-ground",offset:0},k=d.vec4f64.fromValues(0,0,0,1);return z}.apply(null,i))||(e.exports=n)},1762:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1559)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.computeSignedDistancefieldCicle=function(e,t){for(var i=e,n=new Uint8Array(4*i*i),a=i/2-.5,o=t/2,s=0;s<i;s++)for(var l=0;l<i;l++){var u=l+i*s,c=l-a,h=s-a,d=Math.sqrt(c*c+h*h)-o;d=d/e+.5,r.packFloatRGBA(d,n,4*u)}return n},t.computeSignedDistancefieldSquare=function(e,t,i){i&&(t/=Math.SQRT2);for(var n=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*(e-.5),l=a-.5*(e-.5),u=a*e+o;if(i){var c=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=c}var h=Math.max(Math.abs(s),Math.abs(l))-.5*t;h=h/e+.5,r.packFloatRGBA(h,n,4*u)}return n},t.computeSignedDistancefieldCrossAndX=function(e,t,i){i&&(t*=Math.SQRT2);for(var n=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,u=o-.5*e,c=o*e+s;if(i){var h=(l+u)/Math.SQRT2;u=(u-l)/Math.SQRT2,l=h}var d=void 0;d=(d=(l=Math.abs(l))>(u=Math.abs(u))?l>n?Math.sqrt((l-n)*(l-n)+u*u):u:u>n?Math.sqrt(l*l+(u-n)*(u-n)):l)/e+.5,r.packFloatRGBA(d,a,4*c)}return a}}.apply(null,i))||(e.exports=n)},1763:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(27),r(38),r(43),r(1563),r(1599),r(1633),r(1585),r(1574),r(1584),r(1566),r(1721),r(1575),r(1570),r(1581),r(1607)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v){function y(e){return null!=e.size?i.pt2px(e.size):1}return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._prepareResources=function(){var e=this.symbol,t=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),r={idHint:this._getStageIdHint(),width:y(e),color:this._getMaterialOpacityAndColor(),slicePlaneEnabled:this._context.slicePlaneEnabled};if(!this._isPropertyDriven("size")){var i=d.validateSymbolLayerSize(r.width);if(i)return this._logWarning(i),void this.reject()}if(t||r.width>=1.5)this._isPropertyDriven("size")&&(r.width=0),this._material=p.createRibbonMaterial(r);else{if(!(r.width>0))return void this.reject();this._material=p.createNativeMaterial(r)}this._context.stage.add(f.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(f.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,n=r.geometry;if("polyline"!==n.type&&"polygon"!==n.type&&"extent"!==n.type)return this._logWarning("unsupported geometry type for line symbol: "+n.type),null;if(!this._validateGeometry(n))return null;var a="polygon"===n.type||"extent"===n.type?"rings":"paths",o="graphic"+r.uid,s=this._getVertexOpacityAndColor(t,Float32Array,255),l=0;t.size&&this._isPropertyDriven("size")&&(l=c.getSingleSizeDriver(t.size),l=i.pt2px(l));var u=this.getGraphicElevationContext(r);return"on-the-ground"===u.mode?this._createAsOverlay(r,a,s,l,u,o):this._createAs3DShape(r,a,s,l,u,o,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._material.getColor(),t={color:[e[0],e[1],e[2],this._getMaterialOpacity()]};return this._material.setParameterValues(t),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var i=this._elevationContext.mode;if(null==r||null==i)return!1;if("on-the-ground"===r&&"on-the-ground"===i)return!0;if(r!==i&&("on-the-ground"===r||"on-the-ground"===i))return!1;var n=c.needsElevationUpdates2D(i);return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return n})},t.prototype.slicePlaneEnabledChanged=function(e,t){var r={slicePlaneEnabled:this._context.slicePlaneEnabled};return this._material.setParameterValues(r),!0},t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getGeometry=function(e){var t=e.geometry;return"extent"===t.type&&(t=a.fromExtent(t)),t},t.prototype._createAs3DShape=function(e,t,r,i,a,o,l){var h=this._getGeometry(e),d=h[t],f=this._getOutlineGeometry(h,d),v=[],y=[],b=[],_=n.vec3f64.create(),x=new Array(6),w=c.getGeometryVertexData3D(f,h.hasZ,h.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,a);if(this._logGeometryCreationWarnings(w,d,t,"LineSymbol3DLayer"),f.length>0){for(var S=w.geometryData.outlines,C=w.eleVertexData,T=w.vertexData,E=0;E<S.length;++E){var P=S[E];if(!(P.count<=1)){var O=P.index,R=P.count;if(!this._context.clippingExtent||(c.computeBoundingBox(C,O,R,x),!c.boundingBoxClipped(x,this._context.clippingExtent))){c.chooseOrigin(T,O,R,_),c.subtractCoordinates(T,O,R,_);var A=new Float64Array(C.buffer,3*O*C.BYTES_PER_ELEMENT,3*R),M=new Float64Array(T.buffer,3*O*T.BYTES_PER_ELEMENT,3*R),I=p.createPolylineGeometry(M,A,"rings"===t,r,i),D=new m(I,o+"path"+E);D.singleUse=!0,v.push(D),y.push(this._material);var F=n.mat4f64.create();n.mat4.translate(F,F,_),b.push(F)}}}if(v.length>0){var V=new g({geometries:v,materials:y,transformations:b,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:l},idHint:o}),L=s.perVertexElevationAligner,U=new u(this,V,v,null,null,L,a);return U.alignedTerrainElevation=w.terrainElevation,U.needsElevationUpdates=c.needsElevationUpdates2D(a.mode),U}}return null},t.prototype._createAsOverlay=function(e,t,r,i,a,s){var u=this._getGeometry(e);this._material.renderPriority=this._symbolLayerOrder;var h=u[t],d=this._getOutlineGeometry(u,h),f=[],m=new Array(6),g=o.empty(),y=n.vec3f64.create(),b=c.getGeometryVertexDataDraped(d,u.spatialReference,this._context.overlaySR);if(this._logGeometryCreationWarnings(b,h,t,"LineSymbol3DLayer"),d.length>0){for(var _=b.vertexData,x=b.geometryData.outlines,w=0;w<x.length;++w){var S=x[w],C=S.index,T=S.count;if(c.computeBoundingBox(_,C,T,m),!c.boundingBoxClipped(m,this._context.clippingExtent)){o.expand(g,m),c.chooseOrigin(_,C,T,y),c.subtractCoordinates(_,C,T,y),c.setZ(_,C,T,this._getDrapedZ());var E=new Float64Array(_.buffer,3*C*_.BYTES_PER_ELEMENT,3*T),P=n.mat4f64.create();n.mat4.translate(P,P,y);var O=p.createPolylineGeometry(E,null,"rings"===t,r,i),R=new v(O);R.material=this._material,R.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0],R.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1])),R.transformation=P,R.name=s,R.uniqueName=s+"#"+O.id,f.push(R)}}return new l(this,f,g)}return null},t}(h)}.apply(null,i))||(e.exports=n)},1764:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(116),r(25),r(263),r(5),r(27),r(38),r(1563),r(147),r(1599),r(1765),r(1574),r(1584),r(1566),r(1766),r(1767),r(1723),r(1605),r(1625),r(93),r(1575),r(1559),r(1782),r(1634),r(1592)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E){var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._instanceIndexToGraphicUid=new Map,t}return r(t,e),Object.defineProperty(t.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0}),t.prototype._prepareResources=function(){var e=this.symbol,t=this._getStageIdHint();if(this._optionalFields=[],!this._isPropertyDriven("size")){var r=m.validateSymbolLayerSize(this.symbol);if(r)return this._logWarning(r),void this.reject()}if(e.resource&&e.resource.href)this._prepareModelResources(e.resource.href,t);else{var i=e.resource?e.resource.primitive:"sphere";this._preparePrimitiveResources(i,t)}},t.prototype._preparePrimitiveResources=function(e,t){if(!y.isValidPrimitive(e))return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();var r=this.symbol;this._resourceBoundingBox=u.create(y.primitiveBoundingBox(e)),this._resourceSize=l.vec3f64.fromArray(u.size(this._resourceBoundingBox)),this._symbolSize=l.vec3f64.fromArray(m.computeSizeWithResourceSize(this._resourceSize,r));var i=this._getMaterialOpacity(),a={specular:[0,0,0],opacity:i,transparent:i<1||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:O,diffuse:O,slicePlaneEnabled:this._context.slicePlaneEnabled},c=this.symbolContainer;if("point-3d"===c.type&&c.verticalOffset){var h=c.verticalOffset,d=h.screenLength,p=h.minWorldLength,f=h.maxWorldLength;a.verticalOffset={screenLength:s.pt2px(d),minWorldLength:p||0,maxWorldLength:null!=f?f:1/0},a.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._isPropertyDriven("color"))a.externalColor=R;else{var g=r.material?n.toUnitRGBA(r.material.color):R;a.externalColor=g}this._fastUpdates=_.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(o.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(a.instanced.push("color"),this._optionalFields.push("color"));var v=new E(a,t+"_objectmat");if(this._lodResources=y.primitiveLodResources(e,v,t),this._originalOpacities=T.materialsFromLodResources(this._lodResources).map(function(){return 1}),!this._lodResources)return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();this.finalizeSymbolResources(),this.initializeLodRenderer(),this.complexity=this.computeComplexity(),this.resolve()},t.prototype._prepareModelResources=function(e,t){var r=this,n=["transformation"],c={materialParamsMixin:{instanced:n,slicePlaneEnabled:this._context.slicePlaneEnabled},idHint:t,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=_.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(o.mixin(c.materialParamsMixin,this._fastUpdates.materialParameters),n.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(n.push("color"),this._optionalFields.push("color"));var h=this.symbolContainer;if("point-3d"===h.type&&h.verticalOffset){var d=h.verticalOffset,p=d.screenLength,f=d.minWorldLength,y=d.maxWorldLength;c.materialParamsMixin.verticalOffset={screenLength:s.pt2px(p),minWorldLength:f||0,maxWorldLength:null!=y?y:1/0},c.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=a.safeCast(v.fetch(e,c)),this._symbolLoaderPromise.then(function(e){if(r._symbolLoaderPromise=null,!r.isRejected()){var t=g.makeLodResources(e.lods);g.fillEstimatedMinScreenSpaceRadius(t),t.levels.sort(function(e,t){return e.minScreenSpaceRadius-t.minScreenSpaceRadius}),t.levels[0].minScreenSpaceRadius=Math.min(2,t.levels[0].minScreenSpaceRadius),r._lodResources=t;var i=r._context,n=r.symbol.material,a=r._getExternalColorParameters(n),o=r._getMaterialOpacity(),s=r._isPropertyDriven("opacity"),c=T.materialsFromLodResources(r._lodResources);r._originalOpacities=c.map(function(e){return e.getParameterValues().opacity||1}),c.forEach(function(e){var t=e.getParameterValues();e.setParameterValues(a);var r=t.opacity*o,n=r<1||s||t.transparent;e.setParameterValues({opacity:r,transparent:n}),i.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:i.sharedResources.screenSizePerspectiveSettings})}),r._resourceBoundingBox=e.referenceBoundingBox,r._resourceSize=l.vec3f64.fromArray(u.size(r._resourceBoundingBox)),r._pivotOffset=l.vec3f64.fromArray(r._lodResources.levels[0].pivotOffset),r._symbolSize=l.vec3f64.fromArray(m.computeSizeWithResourceSize(r._resourceSize,r.symbol)),_.updateFastSymbolUpdatesState(r._fastUpdates,r._context.renderer,r._fastVisualVariableConvertOptions())&&c.forEach(function(e){return e.setParameterValues(r._fastUpdates.materialParameters)}),r.finalizeSymbolResources(),r.initializeLodRenderer(),r.complexity=r.computeComplexity(),r.resolve()}},function(e){if(r._symbolLoaderPromise=null,!r.isFulfilled()){if(!(e instanceof i)){var t="ObjectSymbol3DLayer failed to load";e&&e.message&&(t+=" ("+e.message+")"),r._logWarning(t)}r.reject()}})},t.prototype.finalizeSymbolResources=function(){var e=this._context.stage;this._materials=T.materialsFromLodResources(this._lodResources),this._materials.forEach(function(t){e.add(w.ModelContentType.MATERIAL,t)}),this._textures=T.texturesFromLodResources(this._lodResources),this._textures.forEach(function(t){e.add(w.ModelContentType.TEXTURE,t)}),this._geometries=T.geometriesFromLodResources(this._lodResources),this._geometries.forEach(function(t){e.add(w.ModelContentType.GEOMETRY,t)})},t.prototype.initializeLodRenderer=function(){var e=this,t=this._context.stage,r=this._fastUpdates.enabled?{applyTransform:function(t,r,i){t.getFeatureAttribute(r,F),l.mat4.copy(i,_.evaluateModelTransform(e._fastUpdates.materialParameters,F,i))},scaleFactor:function(t,r){return t.getFeatureAttribute(r,F),_.evaluateModelTransformScaleFactor(e._fastUpdates.materialParameters,F)}}:null;this._lodRenderer=new C.LodRenderer(this._lodResources,this._optionalFields,function(t){return{layerUid:e._context.layer.uid,graphicUid:e._instanceIndexToGraphicUid.get(t)}},r),this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled,t.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)},t.prototype._getExternalColorParameters=function(e){var t={};return this._isPropertyDriven("color")?t.externalColor=R:e&&e.color?t.externalColor=n.toUnitRGBA(e.color):(t.externalColor=R,t.colorMixMode="ignore"),t},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var t=this._context.stage;this._lodRenderer&&(t.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy()),this._materials&&this._materials.forEach(function(e){return t.remove(w.ModelContentType.MATERIAL,e.id)}),this._textures&&this._textures.forEach(function(e){return t.remove(w.ModelContentType.TEXTURE,e.id)}),this._geometries&&this._geometries.forEach(function(e){return t.remove(w.ModelContentType.GEOMETRY,e.id)})},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=p.placePointOnGeometry(t.geometry);if(!r)return this._logWarning("unsupported geometry type for icon symbol: "+t.geometry.type),null;var i="graphic"+t.uid,n=this.getGraphicElevationContext(t),a=e.renderingInfo;return this._createAs3DShape(t,r,a,n,i,t.uid)},t.prototype.notifyDestroyGraphicLayer=function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)},t.prototype.graphicLayerToGraphicId=function(e){return 0},t.prototype.layerOpacityChanged=function(){var e=this,t=this._isPropertyDriven("opacity");return this._materials.forEach(function(r,i){var n=e._getMaterialOpacity()*e._originalOpacities[i];r.setParameterValues({opacity:n,transparent:n<1||t})}),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,p.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled,this._materials.forEach(function(e){e.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})}),!0},t.prototype.applyRendererDiff=function(e,t){var r=this;for(var i in e.diff)switch(i){case"visualVariables":if(!_.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._materials.forEach(function(e){return e.setParameterValues(r._fastUpdates.materialParameters)}),this._lodRenderer.notifyShaderTransformationChanged();break;default:return!1}return!0},t.prototype.computeComplexity=function(){return this._lodResources?{primitivesPerFeature:T.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(e,t){return e+t.data.getIndices(S.VertexAttrConstants.POSITION).length},0)/3,primitivesPerCoordinate:0,memory:b.defaultSymbolLayerMemoryComplexity(this.symbolContainer,this.symbol)}:e.prototype.computeComplexity.call(this)},t.prototype._createAs3DShape=function(e,t,r,i,n,a){var o=this.getFastUpdateAttrValues(e),s=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?m.mixinColorAndOpacity(r.color,r.opacity):null,u=this._context.clippingExtent;if(x.pointToVector(t,M,this._context.elevationProvider.spatialReference),u&&!p.pointInBox2D(M,u))return null;x.pointToVector(t,M,this._context.renderSpatialReference);var c="absolute-height"!==i.mode,f=p.computeElevation(this._context.elevationProvider,t,i,this._context.renderCoordsHelper,c?V:null),g=l.mat4.identity(I);this._applyObjectRotation(r,g),this._applyObjectRotation(this.symbol,g),this._applyObjectScale(r,g),this._applyAnchor(g),M[0]=t.x,M[1]=t.y,M[2]=f;var v=D;x.computeLinearTransformation(t.spatialReference,M,v,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");var y=this._lodRenderer.instanceData,b=y.addInstance();this._instanceIndexToGraphicUid.set(b,a),y.setLocalTransform(b,g,!1),y.setGlobalTransform(b,v),o&&y.setFeatureAttribute(b,o),s&&y.setColor(b,s);var _=h.perLodInstanceElevationAligner,w=new d(this,b,_,i);return c&&(w.alignedTerrainElevation=V.terrainElevation),w.needsElevationUpdates=p.needsElevationUpdates3D(i.mode),p.extendPointGraphicElevationContext(w,t,this._context.elevationProvider),w},t.prototype._applyObjectScale=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var r=this._isPropertyDriven("size")&&e.size?e.size:this._symbolSize,i=m.computeObjectScale(r,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters);1===i[0]&&1===i[1]&&1===i[2]||l.mat4.scale(t,t,i)}},t.prototype._applyObjectRotation=function(e,t){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&e instanceof c))return m.computeObjectRotation(e.heading,e.tilt,e.roll,t)},t.prototype._computeAnchor=function(){var e=l.vec3f64.create();switch(this.symbol.anchor){case"center":l.vec3.copy(e,u.center(this._resourceBoundingBox)),l.vec3.negate(e,e);break;case"top":var t=u.center(this._resourceBoundingBox);l.vec3.set(e,-t[0],-t[1],-this._resourceBoundingBox[5]);break;case"bottom":t=u.center(this._resourceBoundingBox);l.vec3.set(e,-t[0],-t[1],-this._resourceBoundingBox[2]);break;case"relative":t=u.center(this._resourceBoundingBox);var r=u.size(this._resourceBoundingBox),i=this.symbol.anchorPosition,n=i?l.vec3f64.fromValues(i.x,i.y,i.z):A;l.vec3.multiply(e,r,n),l.vec3.add(e,e,t),l.vec3.negate(e,e);break;case"origin":default:this._pivotOffset?l.vec3.negate(e,this._pivotOffset):l.vec3.copy(e,A)}return e},t.prototype._applyAnchor=function(e){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var t=this._computeAnchor();t&&l.mat4.translate(e,e,t)}},t.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._resourceBoundingBox?l.vec3f64.fromArray(u.size(this._resourceBoundingBox)):O,t=this._resourceBoundingBox?this._computeAnchor():A,r=this._context.renderCoordsHelper.unitInMeters,i=m.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,r),n=l.vec3f64.fromValues(this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0);return{modelSize:e,symbolSize:this._symbolSize||O,unitInMeters:r,transformation:{anchor:t,scale:i,rotation:n}}},t}(f),O=l.vec3f64.fromValues(1,1,1),R=l.vec4f64.fromValues(1,1,1,1),A=l.vec3f64.fromValues(0,0,0),M=l.vec3f64.create(),I=l.mat4f64.create(),D=l.mat4f64.create(),F=l.vec4f64.create(),V={verticalDistanceToGround:0,terrainElevation:0};return P}.apply(null,i))||(e.exports=n)},1765:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(83),r(114),r(38),r(1563),r(1603),r(1660),r(1566),r(1610)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){var h=function(){function e(e,t,r,i){this.type="lod-instance",this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=new l(i)}return e.prototype.initialize=function(e,t){},e.prototype.setVisibility=function(e){var t=this.lodRenderer.instanceData;return e!==t.getVisible(this.instanceIndex)&&(t.setVisible(this.instanceIndex,e),!0)},e.prototype.destroy=function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))},e.prototype.alignWithElevation=function(e,t,r){if(this.elevationAligner){s.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var i=this.elevationAligner(this,this.elevationContext,e,t);null!=i&&(this.alignedTerrainElevation=i)}},e.prototype.getBSRadius=function(){var e=this.lodRenderer;return e.baseBoundingSphere.radius*e.instanceData.getCombinedScaleFactor(this.instanceIndex)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=a.vec3f64.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,g),a.vec3.transformMat4(e,this.lodRenderer.baseBoundingSphere.center,g)},e.prototype.getBoundingBoxObjectSpace=function(e){void 0===e&&(e=o.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,g);var t=this.lodRenderer.baseBoundingBox;o.empty(e);for(var r=0;r<8;++r)a.vec3.set(p,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),a.vec3.transformMat4(p,p,g),o.expandPointInPlace(e,p);return e},e.prototype.getProjectedBoundingBox=function(e,t,r,s){return n(this,void 0,void 0,function(){var n,l,c,h,v,y,b,_,x;return i(this,function(i){switch(i.label){case 0:for(n=this.getBoundingBoxObjectSpace(s),l=m,c=o.isPoint(n)?1:l.length,this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,g),y=0;y<c;y++)h=l[y],p[0]=n[h[0]],p[1]=n[h[1]],p[2]=n[h[2]],a.vec3.transformMat4(p,p,g),d[3*y+0]=p[0],d[3*y+1]=p[1],d[3*y+2]=p[2];if(!e(d,0,c))return[2,null];for(o.empty(n),v=null,this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds()),y=0;y<3*c;y+=3){for(b=0;b<3;b++)n[b]=Math.min(n[b],d[y+b]),n[b+3]=Math.max(n[b+3],d[y+b]);v&&r.push({location:d.slice(y,y+3),screenSpaceBoundingRect:v})}if(!t)return[3,5];if(o.center(n,f),"absolute-height"===this.elevationContext.mode)return[3,5];_=void 0,x=u.demResolutionForBoundingBox(n,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.service.queryElevation(f[0],f[1],x)];case 2:return _=i.sent(),[3,4];case 3:return i.sent(),_=null,[3,4];case 4:null!=_&&o.offset(n,0,0,-this.alignedTerrainElevation+_),i.label=5;case 5:return[2,n]}})})},e.prototype.addHighlight=function(e,t){var r=this,i=c.generateHighlightId();this.addHighlightId(i),e.addExternal(function(e){r.removeHighlightId(e)},i)},e.prototype.removeHighlight=function(e){this.highlights&&this.highlights.forEach(function(t){return e.remove(t)})},e.prototype.addHighlightId=function(e){this.highlights=this.highlights||new Set,this.highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)},e.prototype.removeHighlightId=function(e){this.highlights&&(this.highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this.highlights.size>0),0===this.highlights.size&&(this.highlights=null))},Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0}),e}(),d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=a.vec3f64.create(),f=a.vec3f64.create(),m=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],g=a.mat4f64.create();return h}.apply(null,i))||(e.exports=n)},1766:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(83),r(114),r(1634)],void 0===(n=function(e,t,r,i,n){function a(e){var t=[];return e.stageResources.geometries.forEach(function(r,i){var n=e.stageResources.materials[i],a=e.stageResources.textures;t.push({material:n,geometry:r,textures:a})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function o(e,t){void 0===t&&(t=s);var r=n.computeFaceCount(e);return Math.sqrt(r/(t*Math.PI))}Object.defineProperty(t,"__esModule",{value:!0}),t.makeLodLevelResources=a,t.makeLodResources=function(e){return{levels:e.map(function(e){return a(e)})}},t.estimateMinScreenSpaceRadius=o,t.fillEstimatedMinScreenSpaceRadius=function(e){e.levels.forEach(function(e){e.minScreenSpaceRadius||(e.minScreenSpaceRadius=o(e))})};var s=.05}.apply(null,i))||(e.exports=n)},1767:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(83),r(114),r(10),r(73),r(1768),r(1769),r(1781)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){function c(e,t){void 0===t&&(t=0);for(var r,i=e.lods[t],n={stageResources:{textures:new Array,materials:new Array,geometries:new Array},pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:i.boundingBox,lodThreshold:i.lodThreshold},a=0,s=i.components;a<s.length;a++){var l=s[a];n.stageResources.geometries.push(l.geometry),n.stageResources.materials.push(l.material),(r=n.stageResources.textures).push.apply(r,l.textures),n.numberOfVertices+=l.geometry.vertexCount}return n.stageResources.geometries=o.unique(n.stageResources.geometries),n.stageResources.materials=o.unique(n.stageResources.materials),n.stageResources.textures=o.unique(n.stageResources.textures),n}function h(e){e.materialParamsMixin=a({textureAlphaCutoff:.1},e.materialParamsMixin)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){var r,n,a,o,d,p;return i(this,function(i){switch(i.label){case 0:return"gltf"!==(r=function(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return{fileType:t?"gltf":"wosr",url:t?t[1]:e,specifiedLodIndex:t&&null!=t[4]?Number(t[4]):null}}(e)).fileType?[3,2]:(h(t),n=new s.DefaultLoadingContext(t.streamDataSupplier),[4,l.load(n,r.url,t)]);case 1:return a=i.sent(),o=a.lods[0].boundingBox,null!=r.specifiedLodIndex?(d=Math.min(r.specifiedLodIndex,a.lods.length-1),[2,{lods:[c(a,d)],referenceBoundingBox:o}]):[2,{lods:a.lods.map(function(e,t){return c(a,t)}),referenceBoundingBox:o}];case 2:return[4,u.load(r.url,t)];case 3:return[2,{lods:[p=i.sent()],referenceBoundingBox:p.boundingBox}]}})})}}.apply(null,i))||(e.exports=n)},1768:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(114),r(83),r(10),r(116),r(21),r(8),r(7),r(17)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e){this.streamDataSupplier=e}return e.prototype.loadJson=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,this.load("json",e)]})})},e.prototype.loadBinary=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){return u.isDataProtocol(e)?[2,u.dataToArrayBuffer(e)]:[2,this.load("binary",e)]})})},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,this.load("image",e)]})})},e.prototype.load=function(e,t){return r(this,void 0,void 0,function(){var r,n=this;return i(this,function(i){switch(i.label){case 0:return this.streamDataSupplier?(r=this.streamDataSupplier.request(t,e),[2,l.create(function(e,t){r.then(function(t,r){e(r)},function(e){t(e instanceof a?e:new s("","Request for resource failed: "+e))})},function(){n.streamDataSupplier.cancelRequest(r)})]):[3,1];case 1:return[4,o(t,h[e])];case 2:return[2,i.sent().data]}})})},e}();t.DefaultLoadingContext=c;var h={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}}.apply(null,i))||(e.exports=n)},1769:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(114),r(83),r(10),r(5),r(7),r(38),r(1563),r(1771),r(1772),r(1770),r(1773),r(92),r(1588),r(1777),r(1614),r(1570),r(1576),r(1600),r(1592)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_){function x(e,t){switch(t){case 4:return h.trianglesToTriangles(e);case 5:return h.triangleStripToTriangles(e);case 6:return h.triangleFanToTriangles(e)}}function w(e,t){return r(this,void 0,void 0,function(){function n(o,s){return r(this,void 0,void 0,function(){var r,l,u,c,h,d,p,f;return i(this,function(i){switch(i.label){case 0:if(r=a.nodes[o],l=e.getNodeTransform(o),O.warnUnsupportedIf(null!=r.weights,"Morph targets are not supported."),null==r.mesh)return[3,4];u=a.meshes[r.mesh],c=0,h=u.primitives,i.label=1;case 1:return c<h.length?(d=h[c],[4,t(d,l,s,u.name)]):[3,4];case 2:i.sent(),i.label=3;case 3:return c++,[3,1];case 4:p=0,f=r.children||[],i.label=5;case 5:return p<f.length?[4,n(f[p],s)]:[3,8];case 6:i.sent(),i.label=7;case 7:return p++,[3,5];case 8:return[2]}})})}var a,s,l,u,c,h,d,p,f,m;return i(this,function(t){switch(t.label){case 0:a=e.json,s=a.scenes[a.scene||0],l=s.nodes,u=l.length>1,c=0,h=l,t.label=1;case 1:return c<h.length?(d=h[c],p=a.nodes[d],f=[n(d,0)],function(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}(p)&&!u&&(m=p.extensions.MSFT_lod.ids,f.push.apply(f,m.map(function(e,t){return n(e,t+1)}))),[4,o.all(f)]):[3,4];case 2:t.sent(),t.label=3;case 3:return c++,[3,1];case 4:return[2]}})})}function S(e,t){void 0===e&&(e=""),void 0===t&&(t="");var r=a.endsWith(e,"Imposter"),i=e.split("__")[0];if(-1!==t.indexOf("/RealisticTrees/")){var n=c.treeParamsTable[i];if(n)return{crownCenter:n.center,crownDimensions:n.radius,imposter:r}}}function C(e,t){var r=new f.BufferViewVec3f(e.normal.data.buffer),i=new f.BufferViewVec3f(e.position.data.buffer),n=r.count,a=g.createBuffer(f.BufferViewVec4u8,n);e.color={data:a.typedBuffer,size:4};for(var o=s.vec3f64.create(),l=s.vec3f64.create(),u=s.vec3f64.create(),c=0;c<n;c++){i.getVec(c,l),r.getVec(c,o),s.vec3.subtract(u,l,t.crownCenter),s.vec3.divide(u,u,t.crownDimensions);var h=p.clamp(s.vec3.length(u),0,1),d=.6+.4*h*h;s.vec3.lerp(u,u,o,.2),r.setVec(c,u),a.set(c,0,255*d),a.set(c,1,255*d),a.set(c,2,255*d),a.set(c,3,255)}}function T(e,t,r,i){if(void 0===e&&(e=""),1===i)return null;if(e in c.lodThresholdLUT){var n=c.lodThresholdLUT[e].vertexCounts,a=c.lodThresholdLUT[e].thresholds,o=n.length,s=t;if(o<=1)return null;if(s<=n[0]){var l=(n[1]-n[0])/(a[1]-a[0]),u=s-n[0];return Math.max(0,a[0]+u*l)}if(s>=n[o-1]){l=(n[o-1]-n[o-2])/(a[o-1]-a[o-2]),u=s-n[o-1];return a[o-1]+u*l}for(var h=1;h<n.length;++h){var d=n[h-1],p=n[h],f=a[h-1],m=a[h];if(s<p){var g=(s-d)/(p-d);return f*(1-g)+m*g}}}return null}function E(e,t,r){var i=e.materials.get(t);if(!i){var a=e.textures.get(t.colorTexture);if(!a&&t.colorTexture){var o=t.colorTexture;a=new b(o.data,o.name,{wrap:{s:P(o.wrapS),t:P(o.wrapT)},mipmap:R.some(function(e){return e===o.minFilter}),noUnpackFlip:!0}),e.textures.set(t.colorTexture,a)}var s=n({transparent:"BLEND"===t.alphaMode,textureAlphaTest:"MASK"===t.alphaMode,textureAlphaCutoff:t.alphaCutoff,diffuse:[t.color[0],t.color[1],t.color[2]],ambient:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],doubleSided:t.doubleSided,doubleSidedType:"winding-order",vertexColors:t.vertexColors,castShadows:!0,receiveSSAO:!0,textureId:a?a.id:void 0,colorMixMode:t.ESRI_externalColorMixMode},r);i=new _(s,t.name||""),e.materials.set(t,i)}var l=[];return t.colorTexture&&l.push(e.textures.get(t.colorTexture)),{engineMaterial:i,engineTextures:l}}function P(e){if(33071===e||33648===e||10497===e)return e;O.error("Unexpected TextureSampler WrapMode: "+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t,a){return void 0===a&&(a={}),r(this,void 0,void 0,function(){var o,u,c,h,p,b,P,R,I=this;return i(this,function(D){switch(D.label){case 0:return[4,d.Resource.load(e,O,t)];case 1:return o=D.sent(),u={textures:new Map,materials:new Map},c=[],h=0,p=o.json.asset.extras&&"symbolResource"===o.json.asset.extras.ESRI_type,b=null,[4,w(o,function(e,t,d,w){return r(I,void 0,void 0,function(){var r,T,P,R,I,D,F,V,L,U,B,N,j,G,z,H,k,W,q,X,Y,Q,Z;return i(this,function(i){switch(i.label){case 0:return!b&&w&&(b=w.split("__")[0]),r="gltf_"+h++,function(e){switch(e){case 4:case 5:case 6:return!0}return!1}(T=e.mode||4)?e.attributes.NORMAL?(P=p?S(w,o.uri):void 0,R=P?{treeRendering:!0,vertexColors:!0}:{},[4,o.getMaterial(e)]):(O.warnUnsupported("Vertex normals are required. Skipping primitive."),[2]):(O.warnUnsupported("Unsupported primitive mode ("+A[T]+"). Skipping primitive."),[2]);case 1:return I=i.sent(),D=E(u,I,n({},R,a.materialParamsMixin)),F=D.engineMaterial,V=D.engineTextures,L=_.getVertexBufferLayout(F.getParams()),U={},[4,o.getPositionData(e)];case 2:return B=i.sent(),N=new Float32Array(3*B.count),U.position={data:N,size:3},m.vec3.transformMat4(new f.BufferViewVec3f(N.buffer),B,t),G=x,[4,o.getIndexData(e)];case 3:return j=G.apply(void 0,[i.sent()||B.count,T]),L.hasField("normal")?[4,o.getNormalData(e)]:[3,5];case 4:z=i.sent(),W=new Float32Array(3*z.count),U.normal={data:W,size:3},s.mat4.invert(M,t),s.mat4.transpose(M,M),m.vec3.transformMat4(new f.BufferViewVec3f(W.buffer),z,M),i.label=5;case 5:return L.hasField("uv0")?[4,o.getTextureCoordinates(e)]:[3,7];case 6:H=i.sent(),W=new Float32Array(2*H.count),U.uv0={data:W,size:2},g.vec2.copy(new f.BufferViewVec2f(W.buffer),H),i.label=7;case 7:return o.hasVertexColors(e)?[4,o.getVertexColors(e)]:[3,9];case 8:k=i.sent(),W=new Uint8Array(4*k.count),U.color={data:W,size:4},k instanceof f.BufferViewVec4f?m.vec4.scale(new f.BufferViewVec4u8(W.buffer),k,255):g.vec4.copy(new f.BufferViewVec4u8(W.buffer),k),i.label=9;case 9:for(X in P&&C(U,P),q={},U)q[X]=j;return Y=new y(U,q),Q=new v(Y,r),c[d]=c[d]||{components:[],boundingBox:l.empty(),meshName:w,lodThreshold:null,numVertices:0},c[d].components.push({geometry:Q,material:F,textures:V}),c[d].numVertices+=B.count,Z=Q.boundingInfo,l.expand(c[d].boundingBox,Z.getBBMin()),l.expand(c[d].boundingBox,Z.getBBMax()),[2]}})})})];case 2:if(D.sent(),p&&b)for(P=0;P<c.length;++P)(R=c[P]).lodThreshold=T(b,R.numVertices,0,c.length);return[2,{lods:c}]}})})};var O=new u.DefaultErrorContext,R=[9987,9985],A=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"],M=s.mat4f64.create()}.apply(null,i))||(e.exports=n)},1770:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1583),r(1626)],void 0===(n=function(e,t,r,i){function n(e){return i.generateDefaultIndexArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.linearIndexArray=n,t.trianglesToTriangles=function(e){return"number"==typeof e?n(e):r.isUint16Array(e)||r.isUint8Array(e)?new Uint32Array(e):e},t.triangleStripToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,i=new Uint32Array(3*r);if("number"==typeof e){for(var n=0,a=0;a<r;++a)i[n++]=a,i[n++]=a+1,i[n++]=a+2;return i}var o=e[0],s=e[1];for(n=0,a=0;a<r;++a){var l=e[a+2];i[n++]=o,i[n++]=s,i[n++]=l,o=s,s=l}return i},t.triangleFanToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,i=new Uint32Array(3*r);if("number"==typeof e){for(var n=0,a=0;a<r;++a)i[n++]=0,i[n++]=a+1,i[n++]=a+2;return i}var o=e[0],s=e[1];for(n=0,a=0;a<r;++a){var l=e[a+2];i[n++]=o,i[n++]=s,i[n++]=l,s=l}return i}}.apply(null,i))||(e.exports=n)},1771:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r.getLogger("esri.views.3d.glTF"),n=function(){function e(){}return e.prototype.error=function(e){throw new Error("[glTF loader]"+e)},e.prototype.errorUnsupported=function(e){this.error("[Unsupported Feature] "+e)},e.prototype.errorUnsupportedIf=function(e,t){e&&this.error("[Unsupported Feature] "+t)},e.prototype.assert=function(e,t){e||this.error(t)},e.prototype.warn=function(e){i.warn(e)},e.prototype.warnUnsupported=function(e){this.warn("[Unsupported Feature] "+e)},e.prototype.warnUnsupportedIf=function(e,t){e&&this.warnUnsupported(t)},e}();t.DefaultErrorContext=n}.apply(null,i))||(e.exports=n)},1772:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}},t.lodThresholdLUT={Alder_Buckthorn:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant:{thresholds:[2,22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir:{thresholds:[2,64.674],vertexCounts:[18,10266]},Bamboo:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus:{thresholds:[2,56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood:{thresholds:[2,110.805],vertexCounts:[18,10260]},California_Walnut:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm:{thresholds:[2,31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm:{thresholds:[2,34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia:{thresholds:[2,30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,378,1464,4152]},Scots_Pine:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple:{thresholds:[2,28.322,59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde:{thresholds:[2,65.31,198.124],vertexCounts:[18,2010,7668]},Paper_Birch:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas:{thresholds:[2,47.068,192.681],vertexCounts:[18,1044,8160]},Rose:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,336,1932,9030]},Snake_Plant:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum:{thresholds:[2,31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,330,2070,10386]},ATM:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4:{thresholds:[2,69.923],vertexCounts:[144,2304]},Payphone:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3:{thresholds:[2,37.931,70.286],vertexCounts:[144,678,2328]},Rock_4:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},Trash_Can_1:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat:{thresholds:[2,61.105,269.127],vertexCounts:[438,4476,14952]},Bus:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying:{thresholds:[2,94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},Ford_Fusion:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat:{thresholds:[2,67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},Taxi:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},Traffic_Light_1:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]}}}.apply(null,i))||(e.exports=n)},1773:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(114),r(83),r(10),r(58),r(5),r(7),r(17),r(1722),r(38),r(1774),r(1775),r(1776),r(1588),r(1614)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m){function g(e){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,s.create(function(t,r){var i=new Blob([e]),n=new FileReader;n.onload=function(){var e=n.result;t(JSON.parse(e))},n.onerror=function(e){r(e)},n.readAsText(i)})]})})}function v(e,t){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,s.create(function(r,i){var n=new Blob([e],{type:t}),a=URL.createObjectURL(n),o=new Image;o.addEventListener("load",function(){URL.revokeObjectURL(a),r(o)}),o.addEventListener("error",function(e){URL.revokeObjectURL(a),i(e)}),o.src=a})]})})}Object.defineProperty(t,"__esModule",{value:!0});var y,b=1179937895,_=1313821514,x=5130562,w=function(){function e(e,t,r,i,n){this.context=e,this.errorContext=t,this.uri=r,this.json=i,this.glbBuffer=n,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=p.splitURI(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==i.scene,"A scene must be defined."),t.errorUnsupportedIf(null==i.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==i.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==i.nodes,"Nodes must be defined."),this.computeNodeParents()}return e.load=function(t,n,a){return r(this,void 0,void 0,function(){var r,s,l;return i(this,function(i){switch(i.label){case 0:return o.endsWith(a,".gltf")?[4,t.loadJson(a)]:[3,2];case 1:return r=i.sent(),[2,new e(t,n,a,r)];case 2:return o.endsWith(a,".glb")?[4,t.loadBinary(a)]:[3,5];case 3:return s=i.sent(),[4,e.parseGLB(n,s)];case 4:return l=i.sent(),[2,new e(t,n,a,l.json,l.binaryData)];case 5:n.error('URI needs to end in ".gltf" or ".glb"'),i.label=6;case 6:return[2]}})})},e.parseGLB=function(e,t){return r(this,void 0,void 0,function(){var r,n,a,o,s,l,u,c,d;return i(this,function(i){switch(i.label){case 0:r=new h.BinaryStreamReader(t),e.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large."),n=r.readUint32(),a=r.readUint32(),o=r.readUint32(),e.assert(n===b,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=o,"GLB binary data is smalller than header specifies."),e.errorUnsupportedIf(2!==a,"Only GLB container version 2 is supported."),s=0,i.label=1;case 1:return r.remainingBytes()>=8?(c=r.readUint32(),d=r.readUint32(),0!==s?[3,3]:(e.assert(d===_,"First GLB chunck must be JSON."),e.assert(c>=0,"No JSON data found."),[4,g(r.readUint8Array(c))])):[3,5];case 2:return l=i.sent(),[3,4];case 3:1===s?(e.errorUnsupportedIf(d!==x,"Second GLB chunck expected to be BIN."),u=r.readUint8Array(c)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),i.label=4;case 4:return s+=1,[3,1];case 5:return l||e.error("No GLB JSON chunk detected."),[2,{json:l,binaryData:u}]}})})},e.prototype.getBuffer=function(e){return r(this,void 0,void 0,function(){var t,r,n,a;return i(this,function(i){switch(i.label){case 0:return t=this.json.buffers[e],r=this.errorContext,null==t.uri?(r.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(n=this.bufferCache.get(e))?[3,2]:[4,this.context.loadBinary(this.resolveUri(t.uri))];case 1:a=i.sent(),n=new Uint8Array(a),this.bufferCache.set(e,n),r.assert(n.byteLength===t.byteLength,"Buffer byte lengths should match."),i.label=2;case 2:return[2,n]}})})},e.prototype.getAccessor=function(e){return r(this,void 0,void 0,function(){var t,r,n,a,o,s,l,u;return i(this,function(i){switch(i.label){case 0:return t=this.json.accessors[e],(r=this.errorContext).errorUnsupportedIf(null==t.bufferView,"An accessor bufferView is required."),r.errorUnsupportedIf(t.type in["MAT2","MAT3","MAT4"],"AttributeType "+t.type+" is not supported"),n=this.json.bufferViews[t.bufferView],[4,this.getBuffer(n.buffer)];case 1:return a=i.sent(),o=E[t.type],s=P[t.componentType],l=o*s,u=n.byteStride||l,[2,{raw:a.buffer,byteStride:u,byteOffset:a.byteOffset+(n.byteOffset||0)+(t.byteOffset||0),entryCount:t.count,isDenselyPacked:u===l,componentCount:o,componentByteSize:s,componentType:t.componentType,min:t.min,max:t.max,normalized:!!t.normalized}]}})})},e.prototype.getIndexData=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return null==e.indices?[2,null]:[4,this.getAccessor(e.indices)];case 1:if((t=r.sent()).isDenselyPacked)switch(t.componentType){case 5121:return[2,new Uint8Array(t.raw,t.byteOffset,t.entryCount)];case 5123:return[2,new Uint16Array(t.raw,t.byteOffset,t.entryCount)];case 5125:return[2,new Uint32Array(t.raw,t.byteOffset,t.entryCount)]}else switch(t.componentType){case 5121:return[2,m.scalar.makeDense(this.wrapAccessor(f.BufferViewUint8,t))];case 5123:return[2,m.scalar.makeDense(this.wrapAccessor(f.BufferViewUint16,t))];case 5125:return[2,m.scalar.makeDense(this.wrapAccessor(f.BufferViewUint32,t))]}return[2]}})})},e.prototype.getPositionData=function(e){return r(this,void 0,void 0,function(){var t,r;return i(this,function(i){switch(i.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(e.attributes.POSITION)];case 1:return r=i.sent(),t.errorUnsupportedIf(5126!==r.componentType,"[POSITION attribute] Expected type FLOAT, found "+O[r.componentType]),t.errorUnsupportedIf(3!==r.componentCount,"POSITION attribute must have 3 components."),[2,this.wrapAccessor(f.BufferViewVec3f,r)]}})})},e.prototype.getNormalData=function(e){return r(this,void 0,void 0,function(){var t,r;return i(this,function(i){switch(i.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(e.attributes.NORMAL)];case 1:return r=i.sent(),t.errorUnsupportedIf(5126!==r.componentType,"[NORMAL attribute] Expected type FLOAT, found "+O[r.componentType]),t.errorUnsupportedIf(3!==r.componentCount,"NORMAL attribute must have 3 components."),[2,this.wrapAccessor(f.BufferViewVec3f,r)]}})})},e.prototype.getTextureCoordinates=function(e){return r(this,void 0,void 0,function(){var t,r;return i(this,function(i){switch(i.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(e.attributes.TEXCOORD_0)];case 1:return r=i.sent(),t.errorUnsupportedIf(2!==r.componentCount,"TEXCOORD_0 attribute must have 2 components."),5126===r.componentType?[2,this.wrapAccessor(f.BufferViewVec2f,r)]:(t.errorUnsupportedIf(!r.normalized,"[TEXCOORD_0 attribute] Integer ComponentTypes are only supported for a normalized accessor."),[2,m.vec2.normalizeIntegerBuffer(new f.BufferViewVec2f(new ArrayBuffer(2*r.entryCount*4)),function(e){switch(e.componentType){case 5120:return new f.BufferViewVec2i8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new f.BufferViewVec2u8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new f.BufferViewVec2i16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new f.BufferViewVec2u16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new f.BufferViewVec2u32(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new f.BufferViewVec2f(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:a.neverReached(e.componentType)}}(r))])}})})},e.prototype.hasVertexColors=function(e){return!!e.attributes.COLOR_0},e.prototype.getVertexColors=function(e){return r(this,void 0,void 0,function(){var t,r;return i(this,function(i){switch(i.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.COLOR_0,"COLOR_0 vertex data is required."),[4,this.getAccessor(e.attributes.COLOR_0)];case 1:return r=i.sent(),t.errorUnsupportedIf(4!==r.componentCount,"COLOR_0 attribute must have 4 components."),5126===r.componentType?[2,this.wrapAccessor(f.BufferViewVec4f,r)]:5121===r.componentType?[2,this.wrapAccessor(f.BufferViewVec4u8,r)]:(t.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+O[r.componentType]),[2])}})})},e.prototype.getMaterial=function(e){return r(this,void 0,void 0,function(){var t,r,n,a,o,s;return i(this,function(i){switch(i.label){case 0:return t=this.errorContext,(r=this.materialCache.get(e.material))?[3,3]:(n=d.material(this.json.materials[e.material]),a=n.pbrMetallicRoughness,o=this.hasVertexColors(e),s=void 0,a.baseColorTexture?(t.errorUnsupportedIf(0!==(a.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported"),[4,this.getTexture(a.baseColorTexture.index)]):[3,2]);case 1:s=i.sent(),i.label=2;case 2:r={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:a.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:s,name:n.name,vertexColors:o,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode},i.label=3;case 3:return[2,r]}})})},e.prototype.getTexture=function(e){return r(this,void 0,void 0,function(){var t,r,n,a,o,s,l,u;return i(this,function(i){switch(i.label){case 0:return t=this.errorContext,r=this.json.textures[e],n=d.textureSampler(null!=r.sampler?this.json.samplers[r.sampler]:{}),t.errorUnsupportedIf(null==r.source,"source must be defined for a texture"),a=this.json.images[r.source],(o=this.textureCache.get(e))?[3,6]:(s=void 0,a.uri?[4,this.context.loadImage(this.resolveUri(a.uri))]:[3,2]);case 1:return s=i.sent(),[3,5];case 2:return t.errorUnsupportedIf(null==a.bufferView,"Image bufferView must be defined."),t.errorUnsupportedIf(null==a.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[a.bufferView],[4,this.getBuffer(l.buffer)];case 3:return u=i.sent(),t.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,v(new Uint8Array(u.buffer,u.byteOffset+(l.byteOffset||0),l.byteLength),a.mimeType)];case 4:s=i.sent(),i.label=5;case 5:o={data:s,wrapS:n.wrapS,wrapT:n.wrapT,minFilter:n.minFilter,name:a.name},this.textureCache.set(e,o),i.label=6;case 6:return[2,o]}})})},e.prototype.getNodeTransform=function(e){if(void 0===e)return C;var t=this.nodeTransformCache.get(e);if(!t){var r=this.getNodeTransform(this.getNodeParent(e)),i=this.json.nodes[e];i.matrix?t=c.mat4.multiply(c.mat4f64.create(),r,i.matrix):i.translation||i.rotation||i.scale?(t=c.mat4f64.clone(r),i.translation&&c.mat4.translate(t,t,i.translation),i.rotation&&(T[3]=c.quat.getAxisAngle(T,i.rotation),c.mat4.rotate(t,t,T[3],T)),i.scale&&c.mat4.scale(t,t,i.scale)):t=r,this.nodeTransformCache.set(e,t)}return t},e.prototype.wrapAccessor=function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)},e.prototype.resolveUri=function(e){return l.isDataProtocol(e)?e:this.baseUri+e},e.prototype.getNodeParent=function(e){return this.nodeParentMap.get(e)},e.prototype.checkVersionSupported=function(){u.Version.parse(this.json.asset.version,"glTF").validate(S)},e.prototype.checkRequiredExtensionsSupported=function(){var e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupportedIf(!0,"Extensions: "+e.extensionsRequired.join(", "))},e.prototype.computeNodeParents=function(){var e=this;this.json.nodes.forEach(function(t,r){t.children&&t.children.forEach(function(t){e.nodeParentMap.set(t,r)})})},e}();t.Resource=w;var S=new u.Version(2,0,"glTF"),C=c.mat4.fromXRotation(c.mat4f64.create(),Math.PI/2),T=c.quatf64.create(),E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},P=((y={})[5120]=1,y[5121]=1,y[5122]=2,y[5123]=2,y[5126]=4,y[5125]=4,y),O={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}}.apply(null,i))||(e.exports=n)},1774:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data)}return e.prototype.readUint32=function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]},e.prototype.readUint8Array=function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)},e.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4},e}();t.BinaryStreamReader=r}.apply(null,i))||(e.exports=n)},1775:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},n={pbrMetallicRoughness:i,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},a={ESRI_externalColorMixMode:"tint"};t.material=function(e){void 0===e&&(e={});var t=r({},i,e.pbrMetallicRoughness),o=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":break;default:e.ESRI_externalColorMixMode="tint"}return e}(r({},a,e.extras));return r({},n,e,{pbrMetallicRoughness:t,extras:o})};var o={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};t.textureSampler=function(e){return r({},o,e)}}.apply(null,i))||(e.exports=n)},1776:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.splitURI=function(e){var t,r;return e.replace(/^(.*\/)?([^\/]*)$/,function(e,i,n){return t=i,r=n,""}),{dirPart:t,filePart:r}}}.apply(null,i))||(e.exports=n)},1777:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1778),r(1780)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=r,t.vec4=i}.apply(null,i))||(e.exports=n)},1778:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1779)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformMat4=function(e,t,i){if(e.count===t.count)for(var n=e.count,a=i[0],o=i[1],s=i[2],l=i[4],u=i[5],c=i[6],h=i[8],d=i[9],p=i[10],f=i[12],m=i[13],g=i[14],v=e.typedBuffer,y=e.typedBufferStride,b=t.typedBuffer,_=t.typedBufferStride,x=0;x<n;x++){var w=x*y,S=x*_,C=b[S],T=b[S+1],E=b[S+2];v[w]=a*C+l*T+h*E+f,v[w+1]=o*C+u*T+d*E+m,v[w+2]=s*C+c*T+p*E+g}else r.logger.error("source and destination buffers need to have the same number of elements")},t.transformMat3=function(e,t,i){if(e.count===t.count)for(var n=e.count,a=i[0],o=i[1],s=i[2],l=i[3],u=i[4],c=i[5],h=i[6],d=i[7],p=i[8],f=e.typedBuffer,m=e.typedBufferStride,g=t.typedBuffer,v=t.typedBufferStride,y=0;y<n;y++){var b=y*m,_=y*v,x=g[_],w=g[_+1],S=g[_+2];f[b]=a*x+l*w+h*S,f[b+1]=o*x+u*w+d*S,f[b+2]=s*x+c*w+p*S}else r.logger.error("source and destination buffers need to have the same number of elements")}}.apply(null,i))||(e.exports=n)},1779:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logger=r.getLogger("esri.views.3d.support.buffer.math")}.apply(null,i))||(e.exports=n)},1780:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.scale=function(e,t,r){for(var i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,s=t.typedBufferStride,l=0;l<i;l++){var u=l*a,c=l*s;n[u]=r*o[c],n[u+1]=r*o[c+1],n[u+2]=r*o[c+2],n[u+3]=r*o[c+3]}}}.apply(null,i))||(e.exports=n)},1781:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(83),r(114),r(42),r(116),r(21),r(8),r(5),r(9),r(7),r(1722),r(1563),r(1601),r(1570),r(1576),r(1600),r(1592)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y){function b(e){return new l("","Request for object resource failed: "+e)}function _(e){var t=e.params,r=t.topology,i=!0;switch(t.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var n=t.faces;if(n){if(t.vertexAttributes)for(var a in t.vertexAttributes){var o=n[a];o&&o.values?(null!=o.valueType&&"UInt32"!==o.valueType&&(E.warn("Unsupported indexed geometry indices type '"+o.valueType+"', only UInt32 is currently supported"),i=!1),null!=o.valuesPerElement&&1!==o.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+o.valuesPerElement+"', only 1 is currently supported"),i=!1)):(E.warn("Indexed geometry does not specify face indices for '"+a+"' attribute"),i=!1)}}else E.warn("Indexed geometries must specify faces"),i=!1;break;default:E.warn("Unsupported topology '"+r+"'"),i=!1}e.params.material||(E.warn("Geometry requires material"),i=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(E.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function x(e,t){return n(this,void 0,void 0,function(){var r,n,o,s,l,c,h,p,f,v,b,x,E,O,R,A,M,I,D,F,V,L,U,B,N,j,G,z,H,k,W,q;return i(this,function(i){switch(i.label){case 0:return r=[],n=[],o=[],s=[],l=d.Version.parse(e.version||"1.0","wosr"),P.validate(l),c="meshsymbol_"+e.model.name,h=e.textureDefinitions,[4,S(c,h,t)];case 1:for(f in p=i.sent())s.push(p[f].engineTexObj);for(v=e.model.geometries,b=e.materialDefinitions,x=0,E=0;E<v.length;E++)if(_(O=v[E])){for(I in R=C(O),A=O.params.vertexAttributes,M={},A)D=A[I],F=D.values,M[I]={data:F,size:D.valuesPerElement};if(V={},"PerAttributeArray"===O.params.topology)for(B in L=M.position.data.length/M.position.size,U=T(L),M)V[B]=U;else for(j in N=O.params.faces)V[j]=new Uint32Array(N[j].values);G=R.texture?p[R.texture]:null,(z=o[R.material]?o[R.material][R.texture]:null)||(H=R.material.substring(R.material.lastIndexOf("/")+1),1===(k=b[H].params).transparency&&(k.transparency=0),W={ambient:k.diffuse,diffuse:k.diffuse,specular:[0,0,0],opacity:1-(k.transparency||0),transparent:k.transparency>0,textureAlphaCutoff:.33,textureId:G?G.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:k.externalColorMixMode||"tint"},a("enable-feature:jkieboom/alpha-channel-usage")&&(!G||"transparency"!==G.alphaChannelUsage&&"maskAndTransparency"!==G.alphaChannelUsage||(W.transparent=!0)),t&&t.materialParamsMixin&&u.mixin(W,t.materialParamsMixin),z=new y(W,c),o[R.material]||(o[R.material]={}),o[R.material][R.texture]=z),n.push(z),q=new m(new g(M,V),c),x+=V.position?V.position.length:0,r.push(q)}return[2,{stageResources:{textures:s,materials:n,geometries:r},pivotOffset:e.model.pivotOffset,boundingBox:w(r),numberOfVertices:x,lodThreshold:null}]}})})}function w(e){var t=p.empty();return e.forEach(function(e){var r=e.boundingInfo;p.expand(t,r.getBBMin()),p.expand(t,r.getBBMax())}),t}function S(e,t,r){return n(this,void 0,void 0,function(){var n,o,s,l,u,c,d,p;return i(this,function(i){switch(i.label){case 0:for(s in n=[],o=function(i){var o=t[i],s=o.images[0].data;if(!s)return E.warn("Externally referenced texture data is not yet supported"),"continue";var l=o.encoding+";base64,"+s,u="/textureDefinitions/"+i,c={noUnpackFlip:!0,wrap:{s:10497,t:10497}};a("enable-feature:jkieboom/alpha-channel-usage")&&(c.wrap={s:33071,t:33071});var d=r&&r.disableTextures?h.resolve(null):f.requestImage(l);n.push(d.then(function(t){return{refId:u,engineTexObj:new v(t,e,c),alphaChannelUsage:"rgba"===o.channels?o.alphaChannelUsage||"transparency":"none"}}))},t)o(s);return[4,h.all(n)];case 1:for(l=i.sent(),u={},c=0,d=l;c<d.length;c++)p=d[c],u[p.refId]=p;return[2,u]}})})}function C(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}function T(e){for(var t=new Uint32Array(e),r=0;r<e;r++)t[r]=r;return t}Object.defineProperty(t,"__esModule",{value:!0});var E=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");t.load=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,function(e,t){if(t){var r=t.request(e,"json");return h.create(function(e,t){r.then(function(t,r){e(r)},function(e){t(e instanceof o?e:b(e))})},function(){t.cancelRequest(r)})}var i=s(e);return h.create(function(e,t){i.then(function(t){e(t.data)},function(e){t(e instanceof o?e:b(e))})},function(){i.cancel()})}(e,t.streamDataSupplier)];case 1:return[4,x(r.sent(),t)];case 2:return[2,r.sent()]}})})},t.createStageResources=x;var P=new d.Version(1,2,"wosr")}.apply(null,i))||(e.exports=n)},1782:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(1563),r(1589),r(1642),r(1594),r(1561),r(1784),r(1783),r(1785),r(1786),r(1788),r(1592),r(1568),r(1564),r(1569),r(1567)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y){function b(e,t,r,i){p.encodeDoubleVec3(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}Object.defineProperty(t,"__esModule",{value:!0});var _=v.assert,x=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map(function(e){return e.minScreenSpaceRadius});return new h.LevelSelector(t,r)};t.setLevelSelectorFactory=function(e){x=e};var w=function(){function e(e,t){this.glMaterials={};var r=e.rctx,i=t.geometry,n=t.material,a=i.data.toRenderData();this.materialRep=e.materialRep,n.setParameterValues({instancedDoublePrecision:!0});var s=n.bufferWriter,u=s.vertexBufferLayout,c=s.elementCount(a),h=s.allocate(c);s.write({},a,void 0,h,0),this.geometry=i,this.material=n,this.glMaterials=p.acquireGLMaterials(n,this.materialRep),this.vertexBufferLayout=u,this.vbo=g.createVertex(r,35044,h.buffer),this.vao=new y(r,l.Default3D,{geometry:o.glLayout(u)},{geometry:this.vbo}),this.vertexCount=c}return e.prototype.destroy=function(){p.releaseGLMaterials(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()},Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0}),e.prototype.intersect=function(e,t,r,i,n,a){var o=this.geometry.id,s=n.toString();this.material.intersect(this.geometry,null,e.transform,e,r,i,function(r,i,l,u,c,h){if(r>=0){if(null!=t&&!t(e.p0,e.p1,r))return;var d={type:"external",metadata:a(n)};(null==e.minResult.priority||u>=e.minResult.priority)&&(null==e.minResult.dist||r<e.minResult.dist)&&(e.minResult.set(d,s,r,i,e.transform,u,null,o,l),e.minResult.setIntersector("LodRenderer")),(null==e.maxResult.priority||u>=e.maxResult.priority)&&(null==e.maxResult.dist||r>e.maxResult.dist)&&(e.maxResult.set(d,s,r,i,e.transform,u,null,o,l),e.minResult.setIntersector("LodRenderer"))}},null)},e}();t.LodComponentData=w;var S=function(){function e(e,t){var r=this;this.components=[],this.minScreenSpaceRadius=t.minScreenSpaceRadius,t.components.forEach(function(t){r.components.push(new w(e,t))})}return e.prototype.destroy=function(){this.components.forEach(function(e){e.destroy()})},e.prototype.intersect=function(e,t,r,i,n,a){this.components.forEach(function(o){o.intersect(e,t,r,i,n,a)})},Object.defineProperty(e.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var e=n.empty();this.components.forEach(function(t){n.expand(e,t.boundingInfo.bbMin),n.expand(e,t.boundingInfo.bbMax)}),this._boundingBox=e}return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var e=this.boundingBox,t=i.vec3f64.create();n.center(e,t),this._boundingSphere={center:t,radius:.5*n.diameter(e)}}return this._boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.components.reduce(function(e,t){return e+t.triangleCount},0)},enumerable:!0,configurable:!0}),e}();t.LodLevelData=S;var C=function(){function e(e,r,i,n){var a=this;this._levels=[],this._renderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlaneEnabled=!1,this._enableLevelSelection=!0,this._lastCamera=new s,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.didRender=!1,this._symbol=e,this._optionalFields=r,this._instanceToMetadata=i,this._instanceBufferLayout=f.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=o.glLayout(this._instanceBufferLayout,{divisor:1}),this._instanceData=new u.InstanceData(this._optionalFields,n),this._instanceData.on("instance-added",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-removed",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-transform-changed",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-visibility-changed",function(e){a.requestUpdateCycle(!0)}),this._instanceData.on("instance-highlight-changed",function(e){a.requestUpdateCycle(!0)}),this._enableLevelSelection=this._symbol.levels.length>1,t.lodRenderers.push(this)}return e.prototype.destroy=function(){t.lodRenderers.splice(t.lodRenderers.indexOf(this),1)},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var e={cpu:0,gpu:0};return this._renderInstanceData.forEach(function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderStats",{get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach(function(t,i){var n=e._renderInstanceData[i],a=e._highlightRenderInstanceData[i],o=n.size+a.size,s=t.triangleCount;r.push({renderedInstances:o,renderedTriangles:o*s,trianglesPerInstance:s})}),{totalInstances:t,renderedInstances:r.reduce(function(e,t){return e+t.renderedInstances},0),renderedTriangles:r.reduce(function(e,t){return e+t.renderedTriangles},0),levels:r}},enumerable:!0,configurable:!0}),e.prototype.initializeRenderContext=function(e){var t=this,r=e.rctx;this._symbol.levels.forEach(function(i){t._levels.push(new S(e,i)),t._renderInstanceData.push(new d.RenderInstanceData(r,t._instanceBufferLayout)),t._highlightRenderInstanceData.push(new d.RenderInstanceData(r,t._instanceBufferLayout))}),this._levelSelector=x(this)},e.prototype.uninitializeRenderContext=function(e){this._levels.forEach(function(e){e.destroy()}),this._renderInstanceData.forEach(function(e){e.destroy()}),this._highlightRenderInstanceData.forEach(function(e){e.destroy()})},Object.defineProperty(e.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this._highlightRenderInstanceData.reduce(function(e,t){return e+t.size},0)>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRender",{get:function(){return this.needsUpdates()},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)},e.prototype.prepareRender=function(e){this.runUpdates(e)},e.prototype.render=function(e){var t=e.rctx,r=5===e.slot?4:7===e.slot?6:null;if(r){if(!this.baseMaterial.isVisible())return!1;var i={view:e.camera.viewMatrix,proj:e.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:e.camera.viewInverseTransposeMatrix,lightingData:e.lightingData,viewport:e.camera.viewport,fovY:e.camera.fovY,nearFar:[e.camera.near,e.camera.far],framebufferTex:e.offscreenRenderingHelper?e.offscreenRenderingHelper.colorTexture:null,shadowMap:e.shadowMap,shadowMappingEnabled:!!e.shadowMap&&e.shadowMap.enabled,ssaoEnabled:!!e.ssaoHelper&&e.ssaoHelper.enabled,pixelRatio:e.pixelRatio,slicePlane:e.sliceHelper&&e.sliceHelper.plane,cameraAboveGround:e.camera.aboveGround,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null};t.bindVAO();for(var n=0;n<this._levels.length;++n){var a=e.isHighlightPass?this._highlightRenderInstanceData[n]:this._renderInstanceData[n];this.renderLevel(e,r,i,a,n)}return!0}},e.prototype.intersect=function(e,t,r,n,a){var o=this;if(this.baseMaterial.isVisible()){var s=i.vec3f64.create();i.vec3.subtract(s,n,r);var l=function(a){o._instanceData.getCombinedModelTransform(a,P),e.setTransform(P),i.vec3.transformMat4(O,r,e.transformInverse),i.vec3.transformMat4(R,n,e.transformInverse);var s=o._instanceData.getState(a),l=o._instanceData.getLodLevel(a);_(s&u.StateFlags.ACTIVE,"invalid instance state"),_(l>=0&&l<o._levels.length,"invaid lod level"),o._levels[l].intersect(e,t,O,R,a,o._instanceToMetadata)};this.baseMaterial.getParameterValues().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(r,s,l)}},e.prototype.queryDepthRange=function(e){return this.queryDepthRangeOctree(e)},e.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()},e.prototype.requestUpdateCycle=function(e){void 0===e&&(e=!1),this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0)},e.prototype.needsUpdates=function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1},e.prototype.runUpdates=function(e){if(!a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var t=e.equivalent(this._lastCamera);this._lastCamera.copyFrom(e),t||this.requestUpdateCycle()}var r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(e,r)}},Object.defineProperty(e.prototype,"octree",{get:function(){return this._octree||(this._octree=this.buildOctree()),this._octree},enumerable:!0,configurable:!0}),e.prototype.invalidateOctree=function(){this._octree=null},e.prototype.buildOctree=function(){for(var e=new c.InstanceOctree(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null,i=0;i<this._instanceData.capacity;++i)r.get(i)&u.StateFlags.ACTIVE&&e.addInstance(i);return e},e.prototype.queryDepthRangeOctree=function(e){var t=e.eye,r=e.viewForward,n=this.octree.findClosest(r,"front-to-back",e.frustum),a=this.octree.findClosest(r,"back-to-front",e.frustum);if(null!=n&&null!=a){this._instanceData.view.boundingSphere.getVec(n,E),i.vec3.subtract(E,E,t);var o=i.vec3.dot(E,r)-E[3];this._instanceData.view.boundingSphere.getVec(a,E),i.vec3.subtract(E,E,t);var s=i.vec3.dot(E,r)+E[3];return{near:Math.max(e.near,o),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}},e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++,this._renderInstanceData.forEach(function(e){e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(function(e){e.startUpdateCylce()})},e.prototype.updateInstances=function(e,t){var r=this._enableLevelSelection,i=this._levelSelector;i.updateCamera(e),this._renderInstanceData.forEach(function(e){e.beginUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.beginUpdate()});var n=this._instanceData,a=this._instanceData.view,o=n.size,s=n.capacity,l=this._instanceIndex;t=Math.min(o,t);for(var c=0;c<t;++c){0===l&&this.startUpdateCycle();var h=a.state.get(l),d=0;if(h&u.StateFlags.ALLOCATED){var p=a.lodLevel.get(l);if(h&u.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail(),h&u.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail(),h&u.StateFlags.REMOVE)n.freeInstance(l);else if(h&u.StateFlags.VISIBLE){var f=0;if(r&&(a.modelOrigin.getVec(l,T),f=i.selectLevel(T,n.getCombinedScaleFactor(l))),d=h&~(u.StateFlags.ACTIVE|u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED),f>=0){var m=this._renderInstanceData[f],g=m.allocateHead();if(b(a,l,m.view,g),d|=u.StateFlags.ACTIVE,h&u.StateFlags.HIGHLIGHT){var v=this._highlightRenderInstanceData[f],y=v.allocateHead();b(a,l,v.view,y),d|=u.StateFlags.HIGHLIGHT_ACTIVE}}a.state.set(l,d),a.lodLevel.set(l,f)}else d=h&~(u.StateFlags.ACTIVE|u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED),a.state.set(l,d);if(this._octree){var _=!!(h&u.StateFlags.ACTIVE),x=!!(d&u.StateFlags.ACTIVE);!_&&x?this._octree.addInstance(l):_&&!x?this._octree.removeInstance(l):_&&x&&h&u.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l))}l=(l+1)%s}else l=(l+1)%s,t++}this._instanceIndex=l,this._renderInstanceData.forEach(function(e){e.endUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.endUpdate()})},e.prototype.renderLevel=function(e,t,r,i,n){var a=this;this._levels[n].components.forEach(function(o){a.renderComponent(e,t,r,i,o,n)})},e.prototype.renderComponent=function(e,t,r,i,n,o){var s=n.glMaterials[e.pass];if(s&&s.beginSlot(t)&&s.isVisible&&0!==i.size){var u=e.rctx,c=u.capabilities.instancing,h=s.getDrawMode();r.origin=[0,0,0],2===t&&(e.stencilRenderingHelper.enabled=!0,e.stencilRenderingHelper.prepareStencilWritePass()),s.bind(u,r),u.bindVAO(n.vao);var d=s.getProgram();if(v.assertCompatibleVertexAttributeLocations(n.vao,d),e.isHighlightPass){var p=e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null;u.bindTexture(p,5),d.setUniform1i("depthTex",5),d.setUniform4f("highlightViewportPixelSz",0,0,1/r.viewport[2],1/r.viewport[3])}s.bindView(u,r),a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(d.setUniform4fv("externalColor",A[Math.min(o,A.length-1)]),d.setUniform1i("colorMixMode",m.colorMixModes.replace));var f=i.capacity,g=i.headIndex,y=i.tailIndex,b=i.firstIndex,x=this._glInstanceBufferLayout,w=function(e,t){v.bindVertexBufferLayout(u,l.Default3D,i.buffer,x,e),c.drawArraysInstanced(h,0,n.vertexCount,t-e),v.unbindVertexBufferLayout(u,l.Default3D,i.buffer,x)};n.material.getParams().transparent&&null!=b?g>y?(_(b>=y&&b<=g,"invalid firstIndex"),w(b,g),w(y,b)):g<y&&(b<=g?(_(b>=0&&b<=g,"invalid firstIndex"),w(b,g),w(y,f),w(0,b)):(_(b>=y&&b<=f,"invalid firstIndex"),w(b,f),w(0,g),w(y,b))):g>y?w(y,g):g<y&&(w(0,g),w(y,f)),u.bindVAO(null),s.release(u,r)}},e}();t.LodRenderer=C,t.lodRenderers=[];var T=i.vec3f64.create(),E=i.vec4f64.create(),P=i.mat4f64.create(),O=i.vec3f64.create(),R=i.vec3f64.create(),A=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]}.apply(null,i))||(e.exports=n)},1783:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(92),r(1631)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){var n=e.call(this,[0,0,0],1,{getCenter:function(e){var t=n._instanceData.view.boundingSphere,r=n._tmpCenter;return r[0]=t.get(e,0),r[1]=t.get(e,1),r[2]=t.get(e,2),r},getRadius:function(e){return n._instanceData.view.boundingSphere.get(e,3)}},{maximumDepth:25})||this;return n._tmpCenter=i.vec3f64.create(),n._tmpMat4=i.mat4f64.create(),n._instanceData=t,n._boundingSphere=r,n}return r(t,e),t.prototype.addInstance=function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4),a=i.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,r),o=this._boundingSphere.radius*n.maxScale(r);t.set(e,0,a[0]),t.set(e,1,a[1]),t.set(e,2,a[2]),t.set(e,3,o),this.add(e)},t.prototype.removeInstance=function(e){this.remove(e)},t}(a);t.InstanceOctree=o}.apply(null,i))||(e.exports=n)},1784:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(1656),r(92),r(1588),r(1590),r(1569)],void 0===(n=function(e,t,r,i,n,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u,c=l.assert;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.ACTIVE=2]="ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"}(u=t.StateFlags||(t.StateFlags={}));var h=function(){return function(e){this.localTransform=e.getField("localTransform",o.BufferViewMat4f64),this.globalTransform=e.getField("globalTransform",o.BufferViewMat4f64),this.modelOrigin=e.getField("modelOrigin",o.BufferViewVec3f64),this.model=e.getField("model",o.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",o.BufferViewMat3f),this.modelScaleFactor=e.getField("modelScaleFactor",o.BufferViewFloat),this.boundingSphere=e.getField("boundingSphere",o.BufferViewVec4f64),this.color=e.getField("color",o.BufferViewVec4f),this.featureAttribute=e.getField("featureAttribute",o.BufferViewVec4f),this.state=e.getField("state",o.BufferViewUint8),this.lodLevel=e.getField("lodLevel",o.BufferViewUint8)}}();t.View=h;var d=function(e){function t(t,r){var i=e.call(this)||this;return i._capacity=0,i._size=0,i._next=0,i._layout=function(e){var t=s.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").f32("modelScaleFactor");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t.u8("state").u8("lodLevel").alignTo(4)}(t),i._shaderTransformation=r,i}return r(t,e),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),t.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var e=this.findSlot();return this._view.state.set(e,u.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e},t.prototype.removeInstance=function(e){var t=this._view.state;c(e>=0&&e<this._capacity&&t.get(e)&u.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,u.ACTIVE)?this.setStateFlags(e,u.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})},t.prototype.freeInstance=function(e){var t=this._view.state;c(e>=0&&e<this._capacity&&t.get(e)&u.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--},t.prototype.setLocalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getLocalTransform=function(e,t){this._view.localTransform.getMat(e,t)},t.prototype.setGlobalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getGlobalTransform=function(e,t){this._view.globalTransform.getMat(e,t)},t.prototype.updateModelTransform=function(e){var t=this._view,r=m,n=g;t.localTransform.getMat(e,v),t.globalTransform.getMat(e,y);var o=i.mat4.multiply(y,y,v);i.vec3.set(r,o[12],o[13],o[14]),t.modelOrigin.setVec(e,r),i.mat3.fromMat4(n,o),t.model.setMat(e,n),t.modelScaleFactor.set(e,a.maxScale(o)),i.mat3.invert(n,n),i.mat3.transpose(n,n),t.modelNormal.setMat(e,n),this.setStateFlags(e,u.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})},t.prototype.getModelTransform=function(e,t){var r=this._view;r.model.getMat(e,g),r.modelOrigin.getVec(e,m),t[0]=g[0],t[1]=g[1],t[2]=g[2],t[3]=0,t[4]=g[3],t[5]=g[4],t[6]=g[5],t[7]=0,t[8]=g[6],t[9]=g[7],t[10]=g[8],t[11]=0,t[12]=m[0],t[13]=m[1],t[14]=m[2],t[15]=1},t.prototype.applyShaderTransformation=function(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)},t.prototype.getCombinedModelTransform=function(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedLocalTransform=function(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedScaleFactor=function(e){var t=this._view.modelScaleFactor.get(e);return this._shaderTransformation&&(t*=this._shaderTransformation.scaleFactor(this,e)),t},t.prototype.getModel=function(e,t){this._view.model.getMat(e,t)},t.prototype.getScaleFactor=function(e){return this._view.modelScaleFactor.get(e)},t.prototype.setFeatureAttribute=function(e,t){this._view.featureAttribute.setVec(e,t)},t.prototype.getFeatureAttribute=function(e,t){this._view.featureAttribute.getVec(e,t)},t.prototype.setColor=function(e,t){this._view.color.setVec(e,t)},t.prototype.getColor=function(e,t){this._view.color.getVec(e,t)},t.prototype.setVisible=function(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,u.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))},t.prototype.getVisible=function(e){return this.getStateFlag(e,u.VISIBLE)},t.prototype.setHighlight=function(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,u.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))},t.prototype.getHighlight=function(e){return this.getStateFlag(e,u.HIGHLIGHT)},t.prototype.getState=function(e){return this._view.state.get(e)},t.prototype.getLodLevel=function(e){return this._view.lodLevel.get(e)},t.prototype.countFlags=function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t},t.prototype.setStateFlags=function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)},t.prototype.clearStateFlags=function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)},t.prototype.setStateFlag=function(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)},t.prototype.getStateFlag=function(e,t){return!!(this._view.state.get(e)&t)},t.prototype.grow=function(){var e=Math.max(p,Math.floor(this._capacity*f)),t=this._layout.createBuffer(e);if(this._buffer){var r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new h(this._buffer)},t.prototype.findSlot=function(){for(var e=this._view.state,t=this._next;e.get(t)&u.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t},t}(n.Evented);t.InstanceData=d;var p=1024,f=2,m=i.vec3f64.create(),g=i.mat3f64.create(),v=i.mat4f64.create(),y=i.mat4f64.create()}.apply(null,i))||(e.exports=n)},1785:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1594)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.thresholdScale=1,this._camera=new r,this._worldSpaceRadius=e,this._thresholds=t.map(function(e){return e})}return e.prototype.updateCamera=function(e){this._camera.copyFrom(e)},e.prototype.selectLevel=function(e,t){for(var r=this._camera.computePixelSizeAt(e),i=this._worldSpaceRadius*t/r,n=this._thresholds,a=-1,o=0;o<n.length;++o)i>=n[o]*this.thresholdScale&&(a=o);return a},e}();t.LevelSelector=i}.apply(null,i))||(e.exports=n)},1786:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1588),r(1787),r(1569)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=n.assert,o=function(){return function(e){this.modelOriginHi=e.getField("modelOriginHi",r.BufferViewVec3f),this.modelOriginLo=e.getField("modelOriginLo",r.BufferViewVec3f),this.model=e.getField("model",r.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",r.BufferViewMat3f),this.color=e.getField("instanceColor",r.BufferViewVec4f),this.featureAttribute=e.getField("instanceFeatureAttribute",r.BufferViewVec4f)}}();t.View=o;var s=function(){function e(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}return e.prototype.destroy=function(){this._buffer&&this._buffer.destroy()},Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null},e.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0},e.prototype.beginUpdate=function(){a(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex},e.prototype.endUpdate=function(){a(this._updating,"not updating"),this.size<c*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1},e.prototype.allocateHead=function(){a(this._updating,"not updating"),this.isFull&&this.grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),a(this._headIndex!==this._tailIndex,"invalid pointers"),e},e.prototype.freeTail=function(){a(this._updating,"not updating"),a(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)},e.prototype.grow=function(){var e=Math.max(l,Math.floor(this._capacity*u));this.resize(e)},e.prototype.shrink=function(){if(d){var e=Math.max(l,Math.floor(this._capacity*h));this.resize(e)}},e.prototype.resize=function(e){if(a(this._updating,"not updating"),e!==this._capacity){var t=new i(this._rctx,34962,35044,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,n=this.compactInstances(t);a(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new o(this._instanceBufferLayout.createView(this._buffer.array))}},e.prototype.compactInstances=function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0},e.prototype.incrementHead=function(e){void 0===e&&(e=1),this._headIndex=(this._headIndex+e)%this._capacity},e.prototype.incrementTail=function(e){void 0===e&&(e=1),this._tailIndex=(this._tailIndex+e)%this._capacity},e.prototype.transferRange=function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))},e}();t.RenderInstanceData=s;var l=1024,u=2,c=.3,h=.5,d=!0}.apply(null,i))||(e.exports=n)},1787:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1564)],void 0===(n=function(e,t,r){return function(){function e(e,t,i,n,a){this._elementSize=n,this._buffer=new r(e,t,i),this.resize(a)}return e.prototype.destroy=function(){this._buffer.dispose()},Object.defineProperty(e.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0}),e.prototype.copyRange=function(e,t,r,i){void 0===i&&(i=0);var n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)},e.prototype.transferAll=function(){this._buffer.setData(this._array)},e.prototype.transferRange=function(e,t){var r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(this._array,r,r,i)},e.prototype.resize=function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e},e}()}.apply(null,i))||(e.exports=n)},1788:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1864)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.acquireGLMaterials=function(e,t){var r={};return r[0]=t.aquire(e),r[3]=t.aquireDepthShadowMap(e),r[2]=t.aquireNormal(e),r[1]=t.aquireDepth(e),r[4]=t.aquireHighlight(e),r},t.releaseGLMaterials=function(e,t){t.release(e.id),t.releaseDepthShadowMap(e.id),t.releaseNormal(e.id),t.releaseDepth(e.id),t.releaseHighlight(e.id)},t.encodeDoubleVec3=function(e,t,a,o,s){i[0]=e.get(t,0),i[1]=e.get(t,1),i[2]=e.get(t,2),r.encodeDoubleArray(i,n,3),a.set(s,0,n[0]),o.set(s,0,n[1]),a.set(s,1,n[2]),o.set(s,1,n[3]),a.set(s,2,n[4]),o.set(s,2,n[5])};var i=new Float64Array(3),n=new Float32Array(6)}.apply(null,i))||(e.exports=n)},1789:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(22),r(1585),r(1574),r(1584),r(1566),r(93),r(1575),r(1570),r(1596),r(1581),r(1559),r(1592)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m){function g(e,t,r,i){for(var n=e.stageObject,a=n.getGeometryRecords(),s=a.length,l="absolute-height"!==t.mode,u=0,c=0;c<s;c++){var h=a[c].geometry,d=[a[c].transformation[12],a[c].transformation[13],a[c].transformation[14]],p=h.data.getVertexAttr(),f=p[b.POSITION].data,m=p.zOffset.data,g=p.mapPos.data,y=g.length/3;v(f.length/3==y*S+2,"unexpected tube geometry");var C=0,T=0;x.spatialReference=r.spatialReference;for(var E=0,P=0;P<y;P++){x.x=g[3*P],x.y=g[3*P+1],x.z=g[3*P+2];var O=o.computeElevation(r,x,t,i,l?w:null);l&&(E+=w.terrainElevation);var R=S;0!==P&&P!==y-1||R++;for(var A=0;A<R;A++)_[0]=f[C]+d[0],_[1]=f[C+1]+d[1],_[2]=f[C+2]+d[2],i.setAltitude(O+m[T],_),f[C]=_[0]-d[0],f[C+1]=_[1]-d[1],f[C+2]=_[2]-d[2],C+=3,T+=1;h.invalidateBoundingInfo()}n.geometryVertexAttrsUpdated(c),u+=E/y}return u/s}var v=f.assert,y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=l.validateSymbolLayerSize(this._getSymbolSize());if(e)return this._logWarning(e),void this.reject()}var t=this._getStageIdHint(),r=this._getMaterialOpacityAndColor(),n=i.vec3f64.fromArray(r),a=r[3],o={diffuse:n,ambient:n,opacity:a,transparent:a<1||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new m(o,t+"_3dlinemat"),this._context.stage.add(c.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(c.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("polyline"!==t.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,i=this.getGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,n,i,r,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getMaterialOpacity(),t=e<1||this._isPropertyDriven("opacity");return this._material.setParameterValues({opacity:e,transparent:t}),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,o.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype._getPathSize=function(e){return(e.size&&this._isPropertyDriven("size")?o.getSingleSizeDriver(e.size):this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){return this.symbol.size||1},t.prototype._createAs3DShape=function(e,t,r,n,s){var l=e.geometry,c=l.paths,f=[],m=[],v=[],y=i.vec3f64.create(),b=this._context.renderSpatialReference===u.SphericalECEFSpatialReference,_=new Array(6),x=this._getPathSize(t),w=o.getGeometryVertexData3D(c,l.hasZ,l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(w,c,"paths","PathSymbol3DLayer"),c.length>0){for(var C=w.geometryData.outlines,T=w.eleVertexData,E=w.vertexData,P=0;P<C.length;++P){var O=C[P];if(!(O.count<=1)){var R=O.index,A=O.count;if(!this._context.clippingExtent||(o.computeBoundingBox(T,R,A,_),!o.boundingBoxClipped(_,this._context.clippingExtent))){o.chooseOrigin(E,R,A,y),o.subtractCoordinates(E,R,A,y);var M=new Float64Array(T.buffer,3*R*T.BYTES_PER_ELEMENT,3*A),I=o.flatArrayToArrayOfArrays(E,R,A),D=d.createTubeGeometry(I,.5*x,S,b,y);if(D.getVertexAttr().mapPos={size:3,data:M,offsetIdx:0,strideIdx:3},this._material.getParams().vertexColors){var F=this._getVertexOpacityAndColor(t);D=d.addVertexColors(D,F)}var V=new h(D,n+"path"+P);V.singleUse=!0,f.push(V),m.push(this._material);var L=i.mat4f64.create();i.mat4.translate(L,L,y),v.push(L)}}}if(f.length>0){var U=new p({geometries:f,materials:m,transformations:v,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:s},idHint:n}),B=new a(this,U,f,null,null,g,r);return B.alignedTerrainElevation=w.terrainElevation,B.needsElevationUpdates=o.needsElevationUpdates3D(r.mode),B}}return null},t}(s),b=f.VertexAttrConstants,_=i.vec3f64.create(),x=new n,w={verticalDistanceToGround:0,terrainElevation:0},S=10;return y}.apply(null,i))||(e.exports=n)},1790:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(5),r(38),r(22),r(1585),r(1574),r(1584),r(1566),r(1605),r(1625),r(93),r(1575),r(1570),r(1596),r(1581),r(1724),r(1559),r(1791)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b){function _(e,t,r,i){var n=e.stageObject,a=n.getMetadata().pathGeometryBuilder;if(!a)throw new Error("pathgeometry metadata expected");var o=n.getGeometryRecords(),l=o.length;C.spatialReference=r.spatialReference;for(var u="absolute-height"!==t.mode,c=0,h=0;h<l;h++){for(var d=o[h].geometry,p=a[d.id],f=p.path.offset,m=d.data.getVertexAttr()[w.POSITION].data,g=0,v=0;v<p.path.vertices.length;v++){var y=p.path.vertices[v];C.x=y.mapPos[0],C.y=y.mapPos[1],C.z=y.mapPos[2],y.elevation=s.computeElevation(r,C,t,i,u?T:null),u&&(g+=T.terrainElevation)}for(var b=0;b<p.numVerticesTotal;++b){y=p.path.vertices[p.pathVertexData[b]];S[0]=m[3*b+0]+f[0],S[1]=m[3*b+1]+f[1],S[2]=m[3*b+2]+f[2],i.setAltitude(y.elevation,S),m[3*b+0]=S[0]-f[0],m[3*b+1]=S[1]-f[1],m[3*b+2]=S[2]-f[2]}d.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(h),c+=g/p.path.vertices.length}return c/l}var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=u.validateSymbolLayerSize(this._getSymbolSize());if(e)return this._logWarning(e),void this.reject()}var t=this._getStageIdHint(),r=this._getMaterialOpacityAndColor(),a=n.vec3f32.fromValues(r[0],r[1],r[2]),o=r[3],s={diffuse:a,ambient:a,opacity:o,transparent:o<1||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,rotation:!1}},this._fastUpdates=h.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions),i.mixin(s,this._fastUpdates.materialParameters),this._pathMaterial=new b(s,t+"_pathmat"),this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?this._pathMaterial.setParameterValues({size:1}):this._pathMaterial.setParameterValues({size:this._getSymbolSize()/this._context.renderCoordsHelper.unitInMeters}),this._context.stage.add(p.ModelContentType.MATERIAL,this._pathMaterial),this._profile=v.Profile.tube(E),this._extruder=new v.SimpleExtruder,this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._pathMaterial&&(this._context.stage.remove(p.ModelContentType.MATERIAL,this._pathMaterial.id),this._pathMaterial=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("polyline"!==t.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,i=this.getGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,n,i,r,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getMaterialOpacity(),t=e<1||this._isPropertyDriven("opacity");return this._pathMaterial.setParameterValues({opacity:e,transparent:t}),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var i=this;return e.forEach(function(e){var r=t(e);if(r){var n=e.graphic,a=i.getGraphicElevationContext(n);r.needsElevationUpdates=s.needsElevationUpdates3D(a.mode),r.elevationContext.set(a)}}),!0},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._pathMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!h.updateFastSymbolUpdatesState(this._fastUpdates,t,this._vvConvertOptions))return!1;var n={};i.mixin(n,this._fastUpdates.materialParameters),this._pathMaterial.setParameterValues(n);break;default:return!1}return!0},t.prototype.computeComplexity=function(){return{primitivesPerFeature:-4,primitivesPerCoordinate:this._profile.vertices.length/3*2,memory:c.defaultSymbolLayerMemoryComplexity(this.symbolContainer,this.symbol)}},t.prototype._getSymbolSize=function(){return this.symbol.size||1},t.prototype._createAs3DShape=function(e,t,r,i,a){var l={},u=e.geometry,c=u.paths,h=[],p=[],y=[],b=n.vec3f32.create(),x=this._context.renderSpatialReference===d.SphericalECEFSpatialReference,w=new Array(6),S=s.getGeometryVertexData3D(c,u.hasZ,u.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(S,c,"paths","PathSymbol3DLayer"),c.length>0){for(var C=S.geometryData.outlines,T=S.eleVertexData,E=S.vertexData,P=0;P<C.length;++P){var O=C[P],R=O.index,A=O.count;if(!(A<2||this._context.clippingExtent&&(s.computeBoundingBox(T,R,A,w),s.boundingBoxClipped(w,this._context.clippingExtent)))){s.chooseOrigin(E,R,A,b),s.subtractCoordinates(E,R,A,b);var M=n.mat4f64.create();n.mat4.translate(M,M,b);var I=new v.Path(E,T,R,A,x,b),D=new v.Builder(I,this._profile,this._extruder);this._fastUpdates.enabled&&D.setVisualVariableValue(this.getFastUpdateAttrValues(e));var F=D.createGeometryData();if(this._pathMaterial.getParams().vertexColors){var V=this._getVertexOpacityAndColor(t);F=m.addVertexColors(F,V)}var L=new f(F,i+"path"+P);l[L.id]=D,L.singleUse=!0,h.push(L),p.push(this._pathMaterial),y.push(M)}}var U={layerUid:this._context.layer.uid,graphicUid:a,pathGeometryBuilder:l};if(h.length>0){var B=new g({geometries:h,materials:p,transformations:y,castShadow:!0,metadata:U,idHint:i}),N=new o(this,B,h,null,null,_,r);return N.alignedTerrainElevation=S.terrainElevation,N.needsElevationUpdates=s.needsElevationUpdates3D(r.mode),N}}return null},t}(l),w=y.VertexAttrConstants,S=n.vec3f64.create(),C=new a,T={verticalDistanceToGround:0,terrainElevation:0},E=10;return x}.apply(null,i))||(e.exports=n)},1791:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(26),r(38),r(1563),r(1588),r(1590),r(1611),r(1591),r(1724),r(1559),r(1559),r(1792),r(1595),r(1568),r(1568),r(1793)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v){function y(e,t,r){!function(e,t){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}(t)?e.setFaceCullingEnabled(!1):(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029))}function b(e){e.setFaceCullingEnabled(!1)}function _(e,t){return e?6:t?2:4}function x(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}var w=h.assert,S=1,C=function(e){function t(r,i){var n=e.call(this,i)||this;return n.supportsEdges=!0,n.params=g.copyParameters(r,A),n.vertexBufferLayout=t.getVertexBufferLayout(n.params),n.bufferWriter=new M(n.vertexBufferLayout),n}return i(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.vertexColors,i=t.symbolColors,n=t.vvColorEnabled,a="replace"===t.colorMixMode,o=t.opacity>0,s=t.externalColor&&t.externalColor[3]>0;return r&&(n||i)?!!a||o:r?a?s:o:n||i?!!a||o:a?s:o},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return g.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&w(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&w(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),"wireframe"===r&&w(t.wireframe,"wireframe flag affects drawmode (lines instead of triangles) and therefore can only be set during contruction"),!e[r]||"vvSizeMinSize"!==r&&"vvSizeMaxSize"!==r&&"vvSizeOffset"!==r&&"vvSizeFactor"!==r?t[r]=e[r]:n.vec3.set(t[r],e[r][0],e[r][1],e[r][2]);this.notifyDirty("matChanged")},t.prototype.intersectTriangles=function(e,t,i,a,o,s,l,u,h,d,p){for(var f=e[0],m=e[1],v=e[2],y=t[0]-f,b=t[1]-m,_=t[2]-v,x=r({},this.params,{origin:V,direction:L,auxpos2X:0}),w=i;w<a;w++){var S=d?d[w]:w,C=l.offsetIdx+l.strideIdx*o[3*S],T=l.offsetIdx+l.strideIdx*o[3*S+1],E=l.offsetIdx+l.strideIdx*o[3*S+2],P=u.offsetIdx+u.strideIdx*o[3*S],O=u.offsetIdx+u.strideIdx*o[3*S+1],R=u.offsetIdx+u.strideIdx*o[3*S+2],A=[0,0,0];if(x.vvSizeEnabled){var M=h.offsetIdx+h.strideIdx*s[3*S],I=h.offsetIdx+h.strideIdx*s[3*S+1],B=h.offsetIdx+h.strideIdx*s[3*S+2];A[0]=h.data[M],A[1]=h.data[I],A[2]=h.data[B]}n.vec3.set(x.origin,l.data[C],l.data[C+1],l.data[C+2]),n.vec3.set(x.direction,u.data[P],u.data[P+1],u.data[P+2]),x.auxpos2X=A[0],c.Builder.queryVertexPosition(F,x);var N=F[0],j=F[1],G=F[2];n.vec3.set(x.origin,l.data[T],l.data[T+1],l.data[T+2]),n.vec3.set(x.direction,u.data[O],u.data[O+1],u.data[O+2]),x.auxpos2X=A[1],c.Builder.queryVertexPosition(F,x);var z=F[0],H=F[1],k=F[2];n.vec3.set(x.origin,l.data[E],l.data[E+1],l.data[E+2]),n.vec3.set(x.direction,u.data[R],u.data[R+1],u.data[R+2]),x.auxpos2X=A[2],c.Builder.queryVertexPosition(F,x);var W=z-N,q=H-j,X=k-G,Y=F[0]-N,Q=F[1]-j,Z=F[2]-G,K=b*Z-Q*_,J=_*Y-Z*y,$=y*Q-Y*b,ee=W*K+q*J+X*$,te=f-N,re=m-j,ie=v-G,ne=re*X-q*ie,ae=ie*W-X*te,oe=te*q-W*re;if(ee>D){if((se=te*K+re*J+ie*$)<0||se>ee)continue;if((le=y*ne+b*ae+_*oe)<0||se+le>ee)continue}else{if(!(ee<-D))continue;var se,le;if((se=te*K+re*J+ie*$)>0||se<ee)continue;if((le=y*ne+b*ae+_*oe)>0||se+le<ee)continue}var ue=(Y*ne+Q*ae+Z*oe)/ee;ue>=0&&p(ue,g.computeNormal(W,q,X,Y,Q,Z,U),S)}},t.prototype.intersect=function(e,t,r,i,n,o,s,l){if("triangle"===e.data.primitiveType){var u;u=this.params.vvSizeEnabled?Math.max(this.params.vvSizeMaxSize[0],Math.max(this.params.vvSizeMaxSize[1],this.params.vvSizeMaxSize[2])):this.params.size;var c=a.fromValues(e.boundingInfo.bbMin[0]-u,e.boundingInfo.bbMin[1]-u,e.boundingInfo.bbMin[2]-u,e.boundingInfo.bbMax[0]+u,e.boundingInfo.bbMax[1]+u,e.boundingInfo.bbMax[2]+u),h=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],p=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),f=[p/h[0],p/h[1],p/h[2]];if(g.intersectAabbInvDir(c,n,f,i.tolerance)){var m=e.data.indexCount/3;this.intersectTriangles(n,o,0,m,e.data.getIndices(d.VertexAttrConstants.POSITION),e.data.getIndices(d.VertexAttrConstants.AUXPOS2),e.data.getAttribute(d.VertexAttrConstants.POSITION),e.data.getAttribute(d.VertexAttrConstants.AUXPOS1),e.data.getAttribute(d.VertexAttrConstants.AUXPOS2),null,s)}}},t.prototype.getGLMaterials=function(){return{color:T,depth:E,depthShadowMap:this.params.castShadows?P:null,normal:O,highlight:R}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=s.newLayout().vec3f("position");return t.vec4f(d.VertexAttrConstants.AUXPOS1),e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),(e.vvColorEnabled||e.vvSizeEnabled)&&(t=t.vec4f(d.VertexAttrConstants.AUXPOS2)),t},t}(u),T=function(e){function t(t,r,i){var n=this,a=t.getParams();(n=e.call(this,t,r,i,a.textureId,a.textureInitTransparent)||this).params=g.copyParameters(a);var o=n.params;return n.slot=_(o.transparent,o.writeStencil),n.texturing=o.textureId?o.atlasRegions?"AtlasTextured":"Textured":"none",n._createPrograms(),n}return i(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=m.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params,r={viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,groundNormalShading:t.groundNormalShading,compressedNormals:t.compressedNormals,componentColor:null!=t.componentColorBuffer,transparencyDiscard:t.transparent,alphaCoverageCorrection:I,wireframe:t.wireframe};return this.programRep.getProgram(v.colorPass,r)},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return m.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.slot=_(this.params.transparent,this.params.writeStencil),this.updateTexture(this.params.textureId),this._createPrograms()},t.prototype.bind=function(e,t){var r=this.params,i=this.program=m.BindParametersMap.lookup(this.programs,t);e.bindProgram(i),i.setUniform1f("size",r.size),i.setUniform3fv("ambient",r.ambient),i.setUniform3fv("diffuse",r.diffuse),i.setUniform3fv("specular",r.specular),i.setUniform4fv("externalColor",r.externalColor),i.setUniform1i("colorMixMode",g.colorMixModes[r.colorMixMode]),i.setUniform1f("opacity",r.opacity),i.setUniform1f("layerOpacity",r.layerOpacity),g.bindVerticalOffset(r.verticalOffset,t,i),g.bindScreenSizePerspective(r.screenSizePerspective,t,i),x(i,r),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(770,771,1,771),r.inverseWindingOrder&&e.setFrontFace(2304),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(1,1),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(770,771,1,771)):e.setBlendingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),y(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:S}))},t.prototype.release=function(e,t){e.setPolygonOffsetFillEnabled(!1),b(e),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthWriteEnabled(!0),e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program=m.BindParametersMap.lookup(this.programs,t),i=this.params,n=t.origin;g.bindView(n,t.view,r),g.bindCamPos(n,t.viewInvTransp,r),i.slicePlaneEnabled&&g.bindSlicePlane(n,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,n)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(l),E=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=g.copyParameters(t.getParams()),a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.biased=n,a.selectProgram(),a.selectSlot(),a}return i(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(v.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:I})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform1f("size",i.size),r.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(2304),g.bindVerticalOffset(i.verticalOffset,t,r),g.bindScreenSizePerspective(i.screenSizePerspective,t,r),x(r,i),this.bindTexture(e,r),y(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;b(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=t.origin;g.bindView(n,t.view,r),i.slicePlaneEnabled&&g.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&g.bindCamPos(n,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(l),P=function(e){function t(t,r,i){return e.call(this,t,r,i,!0)||this}return i(t,e),t}(E),O=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=g.copyParameters(t.getParams()),a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return i(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(v.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:I})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform1f("size",i.size),this.bindTexture(e,r),g.bindVerticalOffset(i.verticalOffset,t,r),g.bindScreenSizePerspective(i.screenSizePerspective,t,r),x(r,i),y(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;b(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=t.origin;g.bindView(n,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.slicePlaneEnabled&&g.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&g.bindCamPos(n,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(l),R=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=g.copyParameters(t.getParams()),a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return i(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(v.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:I})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform1f("size",i.size),this.bindTexture(e,r),g.bindVerticalOffset(i.verticalOffset,t,r),g.bindScreenSizePerspective(i.screenSizePerspective,t,r),x(r,i),y(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;b(e),t.inverseWindingOrder&&e.setFrontFace(2304)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=t.origin;g.bindView(n,t.view,r),i.slicePlaneEnabled&&g.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&g.bindCamPos(n,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(l),A=r({size:1,wireframe:!1,textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1,atlasRegions:!1},p.Default),M=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,i,n){if(d.VertexAttrConstants.AUXPOS1 in t.vertexAttr){var a=t.vertexAttr[d.VertexAttrConstants.AUXPOS1],s=t.indices[d.VertexAttrConstants.AUXPOS1];w(4===a.size);var l=i.getField(d.VertexAttrConstants.AUXPOS1,o.BufferViewVec4f);if(!l)throw new Error("unable to aquire view for "+d.VertexAttrConstants.AUXPOS1);f.writeBufferVec4(s,a.data,l,n)}if(d.VertexAttrConstants.AUXPOS2 in t.vertexAttr){a=t.vertexAttr[d.VertexAttrConstants.AUXPOS2],s=t.indices[d.VertexAttrConstants.AUXPOS2];w(4===a.size);var u=i.getField(d.VertexAttrConstants.AUXPOS2,o.BufferViewVec4f);if(!u)throw new Error("unable to aquire view for "+d.VertexAttrConstants.AUXPOS2);f.writeBufferVec4(s,a.data,u,n)}f.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)},e}(),I=!0,D=Math.pow(2,-52),F=n.vec3f64.create(),V=n.vec3f64.create(),L=n.vec3f64.create(),U=n.vec3f64.create();return C}.apply(null,i))||(e.exports=n)},1792:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38)],void 0===(n=function(e,t,r){var i;return(i||(i={})).Default={vvSizeEnabled:!1,vvSizeMinSize:r.vec3f32.fromValues(1,1,1),vvSizeMaxSize:r.vec3f32.fromValues(100,100,100),vvSizeOffset:r.vec3f32.fromValues(0,0,0),vvSizeFactor:r.vec3f32.fromValues(1,1,1),vvSizeValue:r.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0]},i}.apply(null,i))||(e.exports=n)},1793:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===e.viewingMode,VIEWING_MODE_LOCAL:"local"===e.viewingMode,TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TRANSPARENCY_DISCARD:e.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:e.alphaCoverageCorrection,BIAS_SHADOWMAP:e.shadowMap,WIREFRAME:e.wireframe})};t.colorPass={name:"path-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"path-depth",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"path-normal",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/pathMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"path-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1794:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(25),r(27),r(516),r(38),r(43),r(1563),r(1599),r(1633),r(1585),r(1574),r(1584),r(1566),r(1721),r(1575),r(1570),r(1576),r(1581),r(1607),r(1559),r(1795)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w){var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},t}return r(t,e),t.prototype._prepareResources=function(){this._prepareFillResources(),this._prepareOutlineResources(),this.resolve()},t.prototype._prepareFillResources=function(){var e=this._getStageIdHint(),t=this._getMaterialOpacityAndColor(),r={color:t,transparent:t[3]<1||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new w(r,e+"_colormat"),this._context.stage.add(g.ModelContentType.MATERIAL,this._material)},t.prototype._prepareOutlineResources=function(){var e=this.symbol.outline;if(this._hasOutline=!!(e&&e.size&&e.size>0&&e.color),this._hasOutline){var t={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:n.pt2px(e.size),slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial=t.width>=1.5?m.createRibbonMaterial(t):m.createNativeMaterial(t),this._context.stage.add(g.ModelContentType.MATERIAL,this._outlineMaterial)}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(g.ModelContentType.MATERIAL,this._material.id),this._material=null),this._outlineMaterial&&(this._context.stage.remove(g.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic,r=t.geometry.type;if("polyline"!==r&&"polygon"!==r&&"extent"!==r)return this._logWarning("unsupported geometry type for fill symbol: "+r),null;if(!this._validateGeometry(t.geometry))return null;var i="graphic"+t.uid,n=this._getVertexOpacityAndColor(e.renderingInfo,Uint8Array,255),a=this.getGraphicElevationContext(t);return"on-the-ground"===a.mode?this._createAsOverlay(t,n,a,i):this._createAs3DShape(t,n,a,i,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._material.getColor(),t=this._getMaterialOpacity();if(this._material.setColor([e[0],e[1],e[2],t]),this._material.setTransparent(t<1||this._isPropertyDriven("opacity")),this._outlineMaterial){var r=this._outlineMaterial.getColor(),i={color:[r[0],r[1],r[2],this._getOutlineOpacity()]};this._outlineMaterial.setParameterValues(i)}return!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var i=this._elevationContext.mode;if(null==r||null==i)return!1;if("on-the-ground"===r&&"on-the-ground"===i)return!0;if(r!==i&&("on-the-ground"===r||"on-the-ground"===i))return!1;var n=d.needsElevationUpdates2D(i);return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return n})},t.prototype.slicePlaneEnabledChanged=function(e,t){if(this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._outlineMaterial){var r={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(r)}return!0},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e+t/2,r.add(this._material.id)),this._outlineMaterial&&(this._outlineMaterial.renderPriority=e,r.add(this._outlineMaterial.id))},t.prototype._createAs3DShape=function(e,t,r,i,n){var a,o=this._getPolyGeometry(e),s=o.rings,l=this._getOutlineGeometry(o,s),c=d.getGeometryVertexData3D(l,o.hasZ,o.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(P.idHint=i,P.color=t,P.data=c,this._hasOutline&&(a=new(0,c.vertexData.constructor)(c.vertexData)),P.outNum=0,P.outGeometries=[],P.outTransforms=[],P.outMaterials=[],this._createAs3DShapeFill(P),P.data.vertexData=a,this._createAs3DShapeOutline(P),this._logGeometryCreationWarnings(P.data,s,"rings","FillSymbol3DLayer"),0===P.outNum)return null;var p=new b({geometries:P.outGeometries,materials:P.outMaterials,transformations:P.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:n},idHint:i}),f=u.perVertexElevationAligner,m=new h(this,p,P.outGeometries,null,null,f,r);return m.alignedTerrainElevation=c.terrainElevation,m.needsElevationUpdates=d.needsElevationUpdates2D(r.mode),m},t.prototype._createAs3DShapeFill=function(e){for(var t=e.data.geometryData.polygons,r=e.data.eleVertexData,i=e.data.vertexData,n=this,s=0;s<t.length;++s)!function(s){var l=t[s],u=l.count,c=l.index;if(n._context.clippingExtent&&(d.computeBoundingBox(r,c,u,C),d.boundingBoxClipped(C,n._context.clippingExtent)))return"continue";var h=new Float64Array(r.buffer,3*c*r.BYTES_PER_ELEMENT,3*u),p=new Float64Array(i.buffer,3*c*i.BYTES_PER_ELEMENT,3*u),f=l.holeIndices.map(function(e){return e-c}),m=a(h,f,3);if(0===m.length)return"continue";d.chooseOrigin(i,c,u,T),d.subtractCoordinates(i,c,u,T);var g=n._createFillGeometry(m,0,p,h,e.color),y=new v(g,e.idHint);y.singleUse=!0;var b=o.mat4f64.create();o.mat4.translate(b,b,T),e.outGeometries.push(y),e.outMaterials.push(n._material),e.outTransforms.push(b),e.outNum++}(s)},t.prototype._createAs3DShapeOutline=function(e){if(this._hasOutline)for(var t=e.data.geometryData.outlines,r=e.data.eleVertexData,i=e.data.vertexData,n=0;n<t.length;++n){var a=t[n],s=a.index,l=a.count;if(!this._context.clippingExtent||(d.computeBoundingBox(r,s,l,C),!d.boundingBoxClipped(C,this._context.clippingExtent))){d.chooseOrigin(i,s,l,T),d.subtractCoordinates(i,s,l,T);var u=new Float64Array(r.buffer,3*s*r.BYTES_PER_ELEMENT,3*l),c=new Float64Array(i.buffer,3*s*i.BYTES_PER_ELEMENT,3*l),h=m.createPolylineGeometry(c,u,!1,E,0),p=new v(h,e.idHint+"outline"+n);p.singleUse=!0;var f=o.mat4f64.create();o.mat4.translate(f,f,T),e.outGeometries.push(p),e.outMaterials.push(this._outlineMaterial),e.outTransforms.push(f),e.outNum++}}},t.prototype._createAsOverlay=function(e,t,r,i){var n=this._getPolyGeometry(e),a=n.rings,o=this._getOutlineGeometry(n,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2,this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);var s,u=d.getGeometryVertexDataDraped(o,n.spatialReference,this._context.overlaySR);return P.idHint=i,P.color=t,P.data=u,this._hasOutline&&(s=new(0,u.vertexData.constructor)(u.vertexData)),P.outNum=0,P.outGeometries=[],P.outBoundingBox=l.empty(),this._createAsOverlayFill(P),P.data.vertexData=s,this._createAsOverlayOutline(P),this._logGeometryCreationWarnings(P.data,a,"rings","FillSymbol3DLayer"),P.outNum>0?new c(this,P.outGeometries,P.outBoundingBox):null},t.prototype._createAsOverlayFill=function(e){for(var t=e.data.vertexData,r=e.data.geometryData.polygons,i=this,n=0;n<r.length;++n)!function(n){var s=r[n],u=s.count,c=s.index,h=new Float64Array(t.buffer,3*c*t.BYTES_PER_ELEMENT,3*u),p=s.holeIndices.map(function(e){return e-c}),f=a(h,p,3);if(0===f.length)return"continue";if(d.computeBoundingBox(t,c,u,C),d.boundingBoxClipped(C,i._context.clippingExtent))return"continue";l.expand(e.outBoundingBox,C),d.chooseOrigin(t,c,u,T),d.subtractCoordinates(t,c,u,T),d.setZ(t,c,u,i._getDrapedZ());var m=o.mat4f64.create();o.mat4.translate(m,m,T);var g=i._createFillGeometry(f,c,t,null,e.color),v=new _(g);v.material=i._material;var y=C;v.center=[.5*(y[0]+y[3]),.5*(y[1]+y[4]),0],v.bsRadius=.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1])),v.transformation=m,v.name=e.idHint,v.uniqueName=e.idHint+"#"+g.id,e.outGeometries.push(v),e.outNum++}(n)},t.prototype._createAsOverlayOutline=function(e){if(this._hasOutline)for(var t=e.data.vertexData,r=e.data.geometryData.outlines,i=0;i<r.length;++i){var n=r[i],a=n.index,s=n.count;if(d.computeBoundingBox(t,a,s,C),!d.boundingBoxClipped(C,this._context.clippingExtent)){l.expand(e.outBoundingBox,C),d.chooseOrigin(t,a,s,T),d.subtractCoordinates(t,a,s,T),d.setZ(t,a,s,this._getDrapedZ());var u=new Float64Array(t.buffer,3*a*t.BYTES_PER_ELEMENT,3*s),c=o.mat4f64.create();o.mat4.translate(c,c,T);var h=m.createPolylineGeometry(u,null,!0,E,0),p=new _(h);p.material=this._outlineMaterial;var f=C;p.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0],p.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1])),p.transformation=c,p.name=e.idHint+"outline",p.uniqueName=e.idHint+"outline#"+h.id,e.outGeometries.push(p),e.outNum++}}},t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a},t.prototype._getOutlineColor=function(){var e=this.symbol.outline.color,t=this._getOutlineOpacity();return f.mixinColorAndOpacity(i.toUnitRGB(e),t)},t.prototype._getPolyGeometry=function(e){var t=e.geometry;return"extent"===t.type?s.fromExtent(t):t},t.prototype._createFillGeometry=function(e,t,r,i,n){for(var a=e.length,o=new Uint32Array(a),s=new Uint32Array(a),l=0;l<a;l++)o[l]=e[l]+t,s[l]=0;var u={},c={};return u[x.VertexAttrConstants.POSITION]=o,u[x.VertexAttrConstants.COLOR]=s,c[x.VertexAttrConstants.POSITION]={size:3,data:r},c[x.VertexAttrConstants.COLOR]={size:4,data:n},i&&(c.mapPos={size:3,data:i},u.mapPos=o),new y(c,u)},t}(p),C=l.create(),T=o.vec3f64.create(),E=new Float32Array([255,255,255,255]),P={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return S}.apply(null,i))||(e.exports=n)},1795:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1590),r(1604),r(1591),r(1559),r(1595),r(1568),r(1796)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){function c(e,t){"none"!==t.cullFace?(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029)):e.setFaceCullingEnabled(!1)}var h=function(e){function t(t,r){var i=e.call(this,r)||this;return i.supportsEdges=!0,i.bufferWriter=new g,i.params=l.copyParameters(t,f),i}return r(t,e),t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return l.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.setTransparent=function(e){this.params.transparent=e,this.notifyDirty("matChanged")},t.prototype.getTransparent=function(){return this.params.transparent},t.prototype.intersect=function(e,t,r,i,n,a,o,s){l.intersectTriangleGeometry(e,t,r,i,n,a,o)},t.prototype.getGLMaterials=function(){return{color:d,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:p}},t.prototype.getAllTextureIds=function(){return[]},t}(a),d=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(u.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})},t.prototype.beginSlot=function(e){var t=4;return this.params.transparent&&(t=this.params.writeDepth?6:1===this.params.order?10:2===this.params.order?11:3===this.params.order?12:4===this.params.order?13:9),e===t},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform4fv("eColor",i.color),c(e,i),i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1)),i.transparent&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(770,771,1,771)),e.setDepthWriteEnabled(i.writeDepth),e.setDepthTestEnabled(i.testDepth)},t.prototype.release=function(e){var t=this.params;e.setPolygonOffsetFillEnabled(!1),t.transparent&&e.setBlendingEnabled(!1),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setFaceCullingEnabled(!1)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;l.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(n),p=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(u.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform4fv("eColor",i.color),c(e,i),i.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1))},t.prototype.release=function(e){e.setPolygonOffsetFillEnabled(!1),e.setFaceCullingEnabled(!1)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;l.bindView(t.origin,t.view,r),i.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(n),f={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,order:0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},m=i.newLayout().vec3f(o.VertexAttrConstants.POSITION).vec4u8(o.VertexAttrConstants.COLOR),g=function(){function e(){this.vertexBufferLayout=m}return e.prototype.allocate=function(e){return m.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[o.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){s.writeDefaultAttributes(t,r,m,e.transformation,e.invTranspTransformation,i,n)},e}();return h}.apply(null,i))||(e.exports=n)},1796:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({VERTEX_COLORS:e.vertexColors,SLICE:e.slice})};t.colorPass={name:"color-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/color/color.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/color/color.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1797:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(25),r(27),r(38),r(264),r(1599),r(1585),r(1574),r(1584),r(1566),r(1570),r(1596),r(1798),r(1615)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m){function g(e,t,r){e&&e.forEach(function(e){var i=t(e);i&&r(i,e.graphic)})}var v=[1,1,1,1],y=[0,0,1],b={mode:"relative-to-ground",offset:0},_=[0,0,0,1];return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},t}return r(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=h.validateSymbolLayerSize(this._getTextSize());if(e)return this._logWarning(e),void this.reject()}this._anchor="center",this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject()},t.prototype.createGraphics3DGraphic=function(e,t,r,i){void 0===t&&(t={});var n=e.graphic,a=u.placePointOnGeometry(n.geometry);if(!a)return this._logWarning("unsupported geometry type for text symbol: "+n.geometry.type),null;var o=t.text||this.symbol.text;if(!o||o.length<1)return null;null!=t.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=t.needsOffsetAdjustment);var s=this.getGraphicElevationContext(n,t.elevationOffset||0),l=this._context.layer.id+"_label_"+n.uid,c="polyline"===n.geometry.type;return this._createAs3DShape(this.symbol,a,o,s,l,n.uid,t,r,i,c)},t.prototype.getGraphicElevationContext=function(t,r){void 0===r&&(r=0);var i=e.prototype.getGraphicElevationContext.call(this,t);return i.addOffsetRenderUnits(r),i},t.prototype.layerOpacityChanged=function(){return this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1},t.prototype.layerElevationInfoChanged=function(e,t){var r=this;return g(e,t,function(e,t){r.updateGraphicElevationContext(t,e)}),!0},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return g(e,t,function(e){for(var t=0,i=e.stageObject.geometryRecords;t<i.length;t++)i[t].material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})}),!0},t.prototype.updateGraphicElevationContext=function(e,t){var r=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(r),t.needsElevationUpdates=u.needsElevationUpdates2D(r.mode)||"absolute-height"===r.mode},t.prototype._defaultElevationInfoNoZ=function(){return b},t.prototype._createAs3DShape=function(e,t,r,c,h,g,b,x,w,S){var C=b.centerOffset||_,T=b.screenOffset||[0,0],E=b.debugDrawBorder||!1,P=b.translation||[0,0,0],O=b.anchor||this._anchor||"center";this._anchor=O;var R,A=e.material?i.toUnitRGBA(e.material.color):v,M=e.halo&&e.halo.color&&e.halo.size>0,I=M?i.toUnitRGBA(e.halo.color):v,D=M?n.pt2px(e.halo.size):0,F=this._getTextSize(e),V=new f(r,{size:F,color:A,font:{family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"},halo:{size:D,color:I}},h);x?R=b:o.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(R=this.symbolContainer);var L={textureId:w?w.textureId:V.id,texCoordScale:w?[1,1]:V.texcoordScale,occlusionTest:!0,screenOffset:T,anchorPos:O,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:b.centerOffsetUnits,debugDrawBorder:E,drawInSecondSlot:!0};if(R&&R.verticalOffset){var U=R.verticalOffset,B=U.screenLength,N=U.minWorldLength,j=U.maxWorldLength;L.verticalOffset={screenLength:n.pt2px(B),minWorldLength:N||0,maxWorldLength:null!=j?j:1/0}}if(this._context.screenSizePerspectiveEnabled){var G=this._context.sharedResources,z=G.screenSizePerspectiveSettings,H=G.screenSizePerspectiveSettingsLabels;L.screenSizePerspective=H.overridePadding(D),L.screenSizePerspectiveAlignment=z}S&&(L.shaderPolygonOffset=1e-4),L.slicePlaneEnabled=this._context.slicePlaneEnabled;var k=null,W=JSON.stringify(L);null!=x?null==(k=x.getMaterial(W))&&(k=new m(L,h),x.addMaterial(W,k)):k=new m(L,h);var q=[k],X=p.createPointGeometry(y,P,void 0,w?[0,0]:[V.textWidth,V.textHeight],C,w?[0,0]:null),Y=[new d(X,h)],Q=this._context.layer.uid,Z=u.createStageObjectForPoint(this._context,t,Y,q,null,null,c,h,Q,g,!0);if(null===Z)return null;var K=s.perObjectElevationAligner,J=new l(this,Z.object,Y,null==x?q:null,w?null:[V],K,c);return J.alignedTerrainElevation=Z.terrainElevation,J.needsElevationUpdates=u.needsElevationUpdates2D(c.mode)||"absolute-height"===c.mode,J.getScreenSize=function(e){return void 0===e&&(e=a.vec2f64.create()),e[0]=w?V.textWidth:V.width,e[1]=w?V.textHeight:V.height,e},J.metadata={labelText:r,elevationOffset:b.elevationOffset||0},u.extendPointGraphicElevationContext(J,t,this._context.elevationProvider),J},t.prototype._getTextSize=function(e){return n.pt2px((e||this.symbol).size)||12},t}(c)}.apply(null,i))||(e.exports=n)},1798:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(92),r(1600),r(1559),r(1560)],void 0===(n=function(e,t,r,i,n,a){function o(){var e=document.createElement("canvas");return e.width=l,e.height=l,e}function s(){return c}for(var l=512,u=function(){function e(e,t,r,i){void 0===i&&(i=!0),this._idHint=r,this._text=e,this._textLines=e.split(/\r?\n/),this._params=t;var n=this._params.halo.size;this._haloSize=Math.round(n),this._autoScale=i}return Object.defineProperty(e.prototype,"id",{get:function(){return null==this._id&&(this._id=i.idGen.gen(this._idHint)),this._id},enumerable:!0,configurable:!0}),e.prototype.getParams=function(){return this._params},e.prototype.getText=function(){return this._text},e.prototype.deferredLoading=function(){return!1},Object.defineProperty(e.prototype,"width",{get:function(){return this._width||(this._width=r.nextHighestPowerOfTwo(this.renderedWidth)),this._width},enumerable:!0,configurable:!0}),e.prototype.getWidth=function(){return this.width},Object.defineProperty(e.prototype,"height",{get:function(){return this._height||(this._height=r.nextHighestPowerOfTwo(this.renderedHeight)),this._height},enumerable:!0,configurable:!0}),e.prototype.getHeight=function(){return this.height},Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight||(this._lineHeight=this._computeLineHeight()),this._lineHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this._textWidth||(this._textWidth=this._computeTextWidth()),this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this._textHeight||(this._textHeight=this._computeTextHeight()),this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedWidth",{get:function(){return this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor)),this._renderedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHeight",{get:function(){return this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor)),this._renderedHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor||(this._autoScale?this._scaleFactor=Math.min(1,Math.min(2048/this.textWidth,2048/this.textHeight)):this._scaleFactor=1,this._autoScale&&n.assert(this.renderedWidth<=2048&&this.renderedHeight<=2048)),this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/this.height]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillStyle",{get:function(){return this._fillStyle||(this._fillStyle=function(e){return"rgba("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+","+e[3]+")"}(this._params.color)),this._fillStyle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"haloStyle",{get:function(){return this._haloStyle||(this._haloStyle=function(e){return"rgb("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+")"}(this._params.halo.color)),this._haloStyle},enumerable:!0,configurable:!0}),e.prototype.initializeThroughRender=function(e,t){var r=this._getTextCanvas();r.width=this._width,r.height=this._height;var i=r.getContext("2d");i.save(),t.samplingMode=9987,t.wrapMode=33071,t.flipped=!0,t.preMultiplyAlpha=!0,t.hasMipmap=!0,this.renderText(this._renderedWidth,this._renderedHeight,i,0,this._height-this._renderedHeight);var n=new a(e,t,r);return i.restore(),n},e.prototype.setUnloadFunc=function(e){this._unloadFunc=e},e.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)},e.prototype.renderText=function(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var a=this.lineHeight*this.scaleFactor,o=this._haloSize,u=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(r.textAlign,e)+o,c=o;r.save();var h=o<3;if(o>0){var d=c,p=this._getHaloCanvas();p.width=Math.max(l,this.renderedWidth),p.height=Math.max(l,this.renderedHeight);var f=p.getContext("2d");if(f.clearRect(0,0,p.width,p.height),this._setFontProperties(f,this._params.size*this.scaleFactor),f.fillStyle=this.haloStyle,f.strokeStyle=this.haloStyle,f.lineJoin=h?"miter":"round",h)for(var m=0,g=this._textLines;m<g.length;m++){for(var v=g[m],y=0,b=s();y<b.length;y++){var _=b[y],x=_[0],w=_[1];f.fillText(v,u+o*x,c+o*w)}d+=a}else for(var S=0,C=this._textLines;S<C.length;S++){v=C[S];for(var T=2*o,E=0;E<5;E++){var P=.6+.1*E;f.lineWidth=P*T,f.strokeText(v,u,d)}d+=a}r.globalAlpha=this._params.halo.color[3],r.drawImage(p,i,n),p.width=l,p.height=l,r.globalAlpha=1}this._setFontProperties(r,this._params.size*this._scaleFactor);d=n+c;for(var O=0,R=this._textLines;O<R.length;O++){v=R[O];r.globalCompositeOperation="destination-out",r.fillStyle="rgb(0, 0, 0)",r.fillText(v,i+u,d),r.globalCompositeOperation="source-over",r.fillStyle=this.fillStyle,r.fillText(v,i+u,d),d+=a}r.restore()},e.preferredAtlasSize=function(){return l},e.prototype._getTextCanvas=function(){return null==e._textCanvas2D&&(e._textCanvas2D=o()),e._textCanvas2D},e.prototype._getHaloCanvas=function(){return null==e._haloCanvas2D&&(e._haloCanvas2D=o()),e._haloCanvas2D},e.prototype._setFontProperties=function(e,t){var r=this._params.font,i=r.style+" "+r.weight+" "+t+"px "+r.family+", sans-serif";e.font=i,e.textAlign="left",e.textBaseline="top"},e.prototype._computeTextWidth=function(){var e=this._getTextCanvas().getContext("2d");this._setFontProperties(e,this._params.size);for(var t=0,r=0,i=this._textLines;r<i.length;r++){var n=i[r],a=e.measureText(n).width;a>t&&(t=a)}var o=this._params.font;return("italic"===o.style||"oblique"===o.style||"string"==typeof o.weight&&("bold"===o.weight||"bolder"===o.weight)||"number"==typeof o.weight&&o.weight>600)&&(t+=.3*e.measureText("A").width),t+=2*this._haloSize,Math.round(t)},e.prototype._computeLineHeight=function(){var e=1.275*this._params.size;return Math.floor(e+2*this._haloSize)},e.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length},e}(),c=[],h=0;h<360;h+=22.5)c.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);return u}.apply(null,i))||(e.exports=n)},1799:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:r,renderGeometry:e,renderer:t})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,i))||(e.exports=n)},1800:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var a=n[i];if(a.toLowerCase()===r)return e[a]}return null}}.apply(null,i))||(e.exports=n)},1810:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(87),n=r(118),a=r(266);if(n.default("es6-object")){var o=i.default.Object;t.assign=o.assign,t.getOwnPropertyDescriptor=o.getOwnPropertyDescriptor,t.getOwnPropertyNames=o.getOwnPropertyNames,t.getOwnPropertySymbols=o.getOwnPropertySymbols,t.is=o.is,t.keys=o.keys}else t.keys=function(e){return Object.keys(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.assign=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(null==e)throw new TypeError("Cannot convert undefined or null to object");var n=Object(e);return r.forEach(function(e){e&&t.keys(e).forEach(function(t){n[t]=e[t]})}),n},t.getOwnPropertyDescriptor=function(e,t){return a.isSymbol(t),Object.getOwnPropertyDescriptor(e,t)},t.getOwnPropertyNames=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.getOwnPropertySymbols=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return Boolean(e.match(/^@@.+/))}).map(function(e){return Symbol.for(e.substring(2))})},t.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};if(n.default("es2017-object")){o=i.default.Object;t.getOwnPropertyDescriptors=o.getOwnPropertyDescriptors,t.entries=o.entries,t.values=o.values}else t.getOwnPropertyDescriptors=function(e){return t.getOwnPropertyNames(e).reduce(function(r,i){return r[i]=t.getOwnPropertyDescriptor(e,i),r},{})},t.entries=function(e){return t.keys(e).map(function(t){return[t,e[t]]})},t.values=function(e){return t.keys(e).map(function(t){return e[t]})}},1832:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasRequiredFields=function(e,t){if(!t)return!0;var i=e.attributes||r;return!t.some(function(e){return!(e in i)})};var r={}}.apply(null,i))||(e.exports=n)},1833:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){if(!e.fields)return!1;var r=t.toLowerCase();return e.fields.some(function(e){return e.name.toLowerCase()===r})}Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e){var t=e.popupTemplate,i=t.requiredFields,n=t.lastEditInfoEnabled,a=e.objectIdField,o=e.editFieldsInfo;if(i&&1===i.length&&"*"===i[0])return i;var s=i&&i.filter(function(t){return r(e,t)});return o&&n&&(o.creatorField&&s.push(o.creatorField),o.creationDateField&&s.push(o.creationDateField),o.editorField&&s.push(o.editorField),o.editDateField&&s.push(o.editDateField)),s&&a&&r(e,a)&&-1===s.indexOf(a)&&s.push(a),s}}.apply(null,i))||(e.exports=n)},1835:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(0),r(18),r(67),r(1593),r(1657)],void 0===(n=function(e,t,r,i,n,a,o,s){function l(e,t,r){var i=r.get("basemapTerrain"),o=r.get("basemapTerrain.overlayManager"),s=o?o.overlayPixelSizeInMapUnits(e):1,l=i&&!i.spatialReference.equals(r.spatialReference)?a.getMetersPerUnitForSR(i.spatialReference)/a.getMetersPerUnitForSR(r.spatialReference):t*s,u=e.clone().offset(-l,-l),c=e.clone().offset(l,l),h=r.spatialReference;return new n({xmin:Math.min(u.x,c.x),ymin:Math.min(u.y,c.y),xmax:Math.max(u.x,c.x),ymax:Math.max(u.y,c.y),spatialReference:h})}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=l,t.queryDrapedGraphics=function(e){var t=e.area,r=e.view,i=e.loadedGraphics,n=e.popupTemplate,a=e.layer,u=e.clientGraphics,c=l(t,s.calculateTolerance(),r),h=[];return i.forEach(function(e){e.visible&&c.intersects(e.geometry)&&(n||o.isHydratedGraphic(e)&&e.popupTemplate)&&h.push(o.hydrateGraphic(e,a))}),u&&u.length?u.concat(h):h}}.apply(null,i))||(e.exports=n)},1836:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(116),r(7)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return i.create(function(r,i){t._deferreds.push({resolve:r,reject:i}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return i.create(function(r,i){t._deferreds.unshift({resolve:r,reject:i}),t._values.unshift(e)})},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=new r,t=0,i=this._deferreds;t<i.length;t++)i[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=n}.apply(null,i))||(e.exports=n)},1853:function(e,t,r){var i;void 0===(i=function(){"use strict";function e(r,i,n,a,o){for(;a>n;){if(a-n>600){var s=a-n+1,l=i-n+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*c/s+h)),Math.min(a,Math.floor(i+(s-l)*c/s+h)),o)}var d=r[i],p=n,f=a;for(t(r,n,i),o(r[a],d)>0&&t(r,n,a);p<f;){for(t(r,p,f),p++,f--;o(r[p],d)<0;)p++;for(;o(r[f],d)>0;)f--}0===o(r[n],d)?t(r,n,f):t(r,++f,a),f<=i&&(n=f+1),i<=f&&(a=f-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,n,a,o){e(t,i,n||0,a||t.length-1,o||r)}}.apply(null,[]))||(e.exports=i)},1865:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(116),r(4),r(73),r(32),r(13),r(19),r(9),r(261),r(181),r(7),r(14),r(1),r(38),r(1752),r(1563),r(1866),r(1867),r(1868),r(1869),r(1618),r(1870),r(1836),r(93),r(1871)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E,P){function O(e,t){return e.length===t.length&&e.every(function(e){return R(t,e.name)>=0})}function R(e,t){for(var r=t.toLowerCase(),i=0;i<e.length;i++)if(e[i].name.toLowerCase()===r)return i;return-1}function A(e){return null!=e&&null!=e.loadedAttributes&&null!=e.attributeData}var M=c.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),I=function(e){function t(t){var r=e.call(this)||this;return r.nodeIndex={},r.screenSizeFactor=0,r.featureTarget=5e4,r.fixedFeatureTarget=!1,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.uncompressedTextureDownsamplingEnabled=!1,r.alwaysLoadEverythingModeEnabled=!1,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._hasFeatures=!1,r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Map,r._progressMaxNumNodes=1,r._poi=null,r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableIDBCache=!1,r.disableMemCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new l,r._idleQueue=new T.IdleQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(P.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(!("definitionExpression"in this.layer&&this.layer.definitionExpression))return null;try{var e=v.create(this.layer.definitionExpression);if(!e.isStandardized())return M.error("definitionExpression is using non standard function"),null;var t=[],r=e.getFields();return S.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(M.error("definitionExpression references unknown fields: "+t.join(", ")),null):e}catch(e){return M.error("Failed to parse definitionExpression: "+e),null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var e=this.parsedDefinitionExpression.getFields();return S.findFieldsCaseInsensitive(e,this._fields)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return S.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return S.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return!e||!this._viewportQueries||this._viewportQueries.isNodeVisible(e)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){return e._updateIdleState(!0)},idleEnd:function(){return e._updateIdleState(!1)}},this.updateEventListenerWhileSuspended={idleBegin:function(){return e._startNodeLoadingWhileSuspended()}},this._lodHandling=new x(this.layerView,function(){return e.updatingChanged()});var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this._rootNodeUrl=t.store.rootNode;var r=this._rootNodeUrl.split("/");this._rootNodeId=r[r.length-1],this.disableIDBCache=u("disable-feature:idb-cache"),"fields"in t&&(this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo);var i=p.all([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var t=e.layerView.view;e.setClippingArea(t.clippingArea);var r=t.pointsOfInterest;e._centerOnSurface=r.centerOnSurfaceFrequent,e._handles.add(e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}));var i=e.layerView.view.resourceController;e._handles.add(i.memoryEvents.on("quality-changed",function(){return e._setCameraDirty()})),e._handles.add(f.init(e.layerView,"suspended",function(t){e._idleFrameWorker&&(e._idleFrameWorker.remove(),e._idleFrameWorker=null,e.restartNodeLoading()),e._removeFrameWorker(),t?e._idleFrameWorker=i.registerIdleFrameWorker(e.updateEventListenerWhileSuspended):(e._idleFrameWorker=i.registerIdleFrameWorker(e.updateEventListener),e._initFrameWorker())}),"layerview"),e._handles.add(e.layer.watch("elevationInfo",function(t){return e._elevationInfoChanged(t)}),"layer"),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch("alwaysLoadEverythingModeEnabled",function(){return e.restartNodeLoading()}),e._handles.add(t.state.watch("camera",function(){return e._setCameraDirty()})),e._handles.add(e.watch(["featureTarget","fixedFeatureTarget"],function(){return e._stableFeatureLOD=!1})),e._handles.add(e.layerView.watch("lodFactor",function(){return e._setCameraDirty()}),"quality"),e._handles.add([e.layer.watch("renderer",function(){return e._requiredFieldsChange()}),e.layer.watch("definitionExpression",function(){return e._requiredFieldsChange()}),e.layer.watch("labelsVisible",function(){return e._labelingChanged()}),e.layer.watch("labelingInfo",function(){return e._labelingChanged()}),e.layerView.watch("additionalRequiredFields",function(){return e._requiredFieldsChange()})],"requiredAttributes")}});this.addResolvingPromise(i),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._removeFrameWorker(),this._idleFrameWorker&&(this._isIdle=!1,this._idleFrameWorker.remove(),this._idleFrameWorker=null),this._handles.destroy(),this._nodeLoader=null},t.prototype._initFrameWorker=function(){var e=this;this._frameWorker=b.addFrameWorker(this.layerView.view.resourceController,function(t,r){return e._frame(t,r),e._index?e._index.getPriority():-1/0})},t.prototype._removeFrameWorker=function(){null!=this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null)},t.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields)return[];var e=Object.create(null);if(this.layer.renderer&&this.layer.renderer.collectRequiredFields(e),this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(t){t._collectRequiredFields(e)}),null!=this.definitionExpressionFields)for(var t=0,r=this.definitionExpressionFields;t<r.length;t++){var i=r[t];e[i]=!0}if(null!=this.layerView.additionalRequiredFields)for(var n=0,a=this.layerView.additionalRequiredFields;n<a.length;n++){i=a[n];e[i]=!0}var o=this._attributeStorageInfo,s=this._fields,l=this.layer.objectIdField;return Object.keys(e).map(function(e){var t=R(o,e),r=R(s,e);return t>=0&&r>=0?{index:t,name:s[r].name,field:s[r],attributeStorageInfo:o[t]}:null}).filter(function(e){return null!=e&&e.name!==l}).sort(function(e,t){return t.index-e.index}).filter(function(e,t,r){return 0===t||r[t-1].index!==e.index})},t.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._labelingChanged=function(){O(this._requiredAttributes,this._getRequiredAttributes())||this._requiredFieldsChange()},t.prototype.setClippingArea=function(e){var t=y.create();E.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))},t.prototype._calculatePointOfInterest=function(e){void 0===e&&(e=g.vec3f64.create());var t=this._centerOnSurface.renderLocation,r=g.vec3f64.create();g.vec3.subtract(r,t,this.camPos),g.vec3.normalize(r,r);var i=this.layerView.view.renderCoordsHelper,n=g.vec3f64.create();i.worldUpAtPosition(t,n);var a=Math.acos(g.vec3.dot(n,r))-.5*Math.PI;return g.vec3.lerp(e,this.camPos,t,Math.max(0,Math.min(1,a/(.5*Math.PI)))),e},t.prototype.updateClippingArea=function(e){this.setClippingArea(e),this._cameraDirty=!0,this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.updatingChanged()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t,r){S.findIntersectingNodes(e,t,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(e){r.push(e)});for(var i=0;i<r.length;i++){var n=r.data[i];this._viewportQueries.invalidateCache(n.id),n.id===this._rootNodeId&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()},t.prototype._elevationInfoChanged=function(e){this._viewportQueries.invalidateCache(),this._initViewData()},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this.updatingChanged()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new n;return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new n;return t})},Object.defineProperty(t.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0}),t.prototype._frame=function(e,t){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(e,t)},t.prototype._processLogError=function(e,t){try{this._process(e,t)}catch(e){this._errorCount<50?M.error("Error during processing: "+e):50===this._errorCount&&M.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){for(this._updateViewData(),e.runWithProgress(function(){return r._processIndex(t)}),this._updateFeatureLOD(),e.runWithProgress(function(){return r._processNodes(e,t)});this._idleQueue.length()>0&&!e.doneWithProgress();)this._idleQueue.process(),e.madeProgress();e.runWithProgress(function(){return r._prefetchIndex(t)}),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingNodes.size,this.updatingChanged(),this._lodHandling.lodGlobalHandling()}},t.prototype._processIndex=function(e){var t=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));this._index.update(o.keysOfSet(this._loadingNodes));var r=this._index.getFeatureEstimate().leafsReached;return this._index.isLoading()||r===this._get("leafsReached")||this._set("leafsReached",r),this._index.load(t)},t.prototype._prefetchIndex=function(e){if(this._loadingNodes.size>0)return!1;var t=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));return this._index.prefetch(t)},t.prototype._updateFeatureLOD=function(){var e=this._index.getFeatureEstimate();if(e.estimate){var t=this.featureTarget*this.baseLOD,r=!this._index.isLoading();if(this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(r&&e.estimate<t){if(e.leafsReached||this._featureLOD>=1e4||this._stableFeatureLOD)return;var i=Math.max(t/e.estimate,1.001);this._featureLOD*=i;var n=this.lod,a=this._index.checkFeatureTarget(t,n);a!==n&&(this._featureLOD=a/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(e.estimate>1.2*t||r&&e.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(e.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestReload()}},t.prototype._processNodes=function(e,t){var r=this,i=(this._isIdle?100:2)-this._loadingNodes.size,n=this._index.getUpdates(i);return n.cancel.forEach(this._cancelNodeIdLoading,this),n.update.some(function(t){return!!e.doneWithProgress()||(r._updateLoadedNode(t),e.madeProgress(),!1)}),n.add.some(function(i){return!!e.doneWithProgress()||!(i.notInCache&&!r._hasNodeLoadToken(t))&&(r._loadNode(i),e.madeProgress(),!1)}),e.hasProgressed},t.prototype._cancelNodeLoading=function(){var e=this;this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.forEach(function(t,r){return e._updatingNodes.get(r).cancel()}),this._updatingNodes.clear()},t.prototype._cancelNodeIdLoading=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e,t){var r=t.numIndexLoading+this._index.getIndexLoading(),i=t.numNodesLoading+this._loadingNodes.size;return Math.floor((12-1*r-2*i)/e)},t.prototype._hasNodeLoadToken=function(e){var t=this._isIdle&&!this._index.isLoading()?5:2;return!(e.numNodesLoading+this._loadingNodes.size>=t)&&this._getAvailableLoadTokens(2,e)>0},t.prototype.updatingChanged=function(){var e=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.getNodesMissing():0)+2*this._loadingNodes.size,t=!(!(e>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length()>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===e&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(e,this._progressMaxNumNodes),t!==this._get("updating")&&this._set("updating",t);var r=100*e/this._progressMaxNumNodes;r!==this._get("updatingPercentage")&&this._set("updatingPercentage",r)},t.prototype._initViewData=function(){var e=this.layerView.view,t=e.state.camera,r=e.renderCoordsHelper;this.camPos=g.vec3f64.clone(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest();var i=this.lod;this._viewportQueries=new C(this.crsIndex,r,t,this._poi,this._clippingArea,e.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer),screenspaceErrorBias:i,angleDependentLoD:i<.5,disableLod:this.alwaysLoadEverythingModeEnabled}),this._cameraDirty=!1,this.notifyChange("rootNodeVisible")},t.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var e=this.layerView.view,t=e.state.camera;this.camPos=g.vec3f64.clone(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.updatePointOfInterest(this._poi),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload(),this._stableFeatureLOD=!1,this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(),this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}},t.prototype._getProgressiveLoadFactor=function(e){return this.layerView.view.resourceController.memoryFactor<1?1:this.layerView.progressiveLoadFactor},Object.defineProperty(t.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseLOD",{get:function(){return this.fixedFeatureTarget?1:this.layerView.lodFactor*this.layerView.view.resourceController.memoryFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodDropFactor",{get:function(){return this.fixedFeatureTarget?0:2*Math.min(this.layerView.view.resourceController.memoryFactor,.5)},enumerable:!0,configurable:!0}),t.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData(),this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()},t.prototype.isGeometryVisible=function(e){return this._viewportQueries.isGeometryVisible(e)},t.prototype.updateVisibility=function(e){return this._viewportQueries.updateNode(e)},t.prototype._shouldLoadNode=function(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e))&&(!e.obb||this._viewportQueries.isGeometryVisible(e))},t.prototype._shouldDropNode=function(e){var t=this.lodDropFactor;return t<1&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.calcCameraDistance(e)>this._viewportQueries.maxDistance*t},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var t=w.TextureFormat.Normal;this.layerView.useCompressedTextures?t=w.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=w.TextureFormat.Downsampled);var r=this._defaultGeometrySchema,i={textureFormat:t,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==r||null==r.ordering};this._nodeLoader=new w(this.streamDataSupplier,M,r,this._requiredAttributes,i);var n=F.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new _(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,n,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,M,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t)},function(t){return e._needsUpdate(t)});var a=this.layerView.view.renderSpatialReference,o=this.crsIndex.equals(a)||this.crsIndex.isWGS84&&a.equals(E.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!o,this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(),this._lodHandling.startNodeLoading(function(t){return e._viewportQueries.isNodeVisible(t)},function(t){return e._viewportQueries.isGeometryVisible(t)},function(t){return e._index.nodeTraversalState(t)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel}),this.updatingChanged()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this._index=null,this._poi=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())},t.prototype._removeInvisibleNodes=function(){var e=this.layerView.getLoadedNodeIDs();D.clear();for(var t=0;t<e.length;t++){var r=this.nodeIndex[e[t]];this._viewportQueries.isGeometryVisible(r)&&!this._shouldDropNode(r)||(this._lodHandling.setLodGlobalDirty(),D.push(r))}return D.length>0&&(this.layerView.removeNodeData(D),D.clear(),!0)},t.prototype._needsUpdate=function(e){if(null==e.featureData||0===e.featureData.length||this._updatingNodes.has(e.id))return!1;var t=this.layerView.getLoadedAttributes(e);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=e.baseUrl,i=O(this.layerView.getLoadedAttributes(e),this._requiredAttributes)?p.resolve(this.layerView.getAttributeData(e)):this._nodeLoader.loadAttributes(e,r,this._requiredAttributes);this._updatingNodes.set(e.id,i),i.then(function(r){return t.schedule(e.id).then(function(){return t.layerView.setAttributeData(e,{loadedAttributes:t._requiredAttributes,attributeData:r})})}).catch(function(r){r instanceof n||t.layerView.setAttributeData(e,{loadedAttributes:t._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){t._updatingNodes.delete(e.id),t.updatingChanged()}),this.updatingChanged()},t.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.id),this.updatingChanged(),this._loadAndAddBundle(e).catch(function(e){return e}).then(function(){t._loadingNodes.delete(e.id),t._hasFeatures=t._hasFeatures||!!e.numFeatures,t.updatingChanged()})},t.prototype._loadAndAddBundle=function(e){return 1!==e.featureData.length&&M.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded."),e.notInCache?this._loadUncached(e):this._loadCached(e).then(function(t){t||(e.notInCache=!0)}).catch(function(t){t instanceof n||(e.notInCache=!0)})},t.prototype._enableFromGPUCache=function(e){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var t=this.layerView.loadCachedGPUData(e);return!!(t&&A(t.attributeInfo)&&O(t.attributeInfo.loadedAttributes,this._requiredAttributes))&&(this.layerView.addCachedGPUData(e,t),this._lodHandling.lodSwapBundleLoaded(e),!0)},t.prototype._loadCached=function(e){var t=this,r=this.layerView;return!this.disableIDBCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.id).then(function(){return r.loadCachedNodeData(e,function(e,r){return t._nodeLoader.loadTextures(e,r)})}).then(function(i){if(null==i)return!1;var n=t._requiredAttributes;return A(i)&&O(i.loadedAttributes,n)?t.reschedule(e.id).then(function(){return r.addCachedNodeData(e,i,i)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0}):t.reschedule(e.id).then(function(){return t._nodeLoader.loadAttributes(e,e.baseUrl,n)}).then(function(r){return t.reschedule(e.id,{loadedAttributes:n,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,i,t)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0})}):p.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.id),this._nodeLoader.loadBundleData(e,0).then(function(r){return t._downloadingNodes.delete(e.id),t.schedule(e.id,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._lodHandling.lodSwapBundleLoaded(e),e.notInCache=!1}).catch(function(t){t instanceof n||(M.error("Failed to load node '"+e.id+"' bundle 0: "+t),e.failed=!0)})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())},t.prototype.updateStats=function(e){e.index=Object.keys(this.nodeIndex).length,this._hasFeatures&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),this._index&&this._index.updateStats(e)},i([m.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),i([m.property({readOnly:!0})],t.prototype,"streamDataSupplier",null),i([m.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],t.prototype,"parsedDefinitionExpression",null),i([m.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),i([m.property({readOnly:!0})],t.prototype,"crsVertex",null),i([m.property({readOnly:!0})],t.prototype,"crsIndex",null),i([m.property({readOnly:!0})],t.prototype,"nodeIndex",void 0),i([m.property()],t.prototype,"camPos",void 0),i([m.property()],t.prototype,"screenSizeFactor",void 0),i([m.property()],t.prototype,"featureTarget",void 0),i([m.property()],t.prototype,"fixedFeatureTarget",void 0),i([m.property()],t.prototype,"layerView",void 0),i([m.property()],t.prototype,"layer",void 0),i([m.property({readOnly:!0})],t.prototype,"updating",void 0),i([m.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),i([m.property({readOnly:!0})],t.prototype,"leafsReached",void 0),i([m.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),i([m.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),i([m.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],t.prototype,"alwaysLoadEverythingModeEnabled",void 0),i([m.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(m.declared(a,d,s)),D=new h,F={factorIM:.2,factor3dObject:.05,distancePenalty:10};return I}.apply(null,i))||(e.exports=n)},1866:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=e.registerFrameWorker(function(e){return t.work(e)})}return e.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)},e.prototype.work=function(e){this.sort();for(var t=this.callbacks,r={numIndexLoading:0,numNodesLoading:0},i=0;i<t.length&&!e.doneWithProgress();++i)t[i].priority=t[i](e,r),this.runIndex=i},e.prototype.sort=function(){for(var e=this.callbacks,t=e.length,r=this.runIndex;r>0;r--){for(var i=e[r-1],n=r;n<e.length&&i.priority<=e[n].priority&&(n!==t||i.priority<e[n].priority);)e[n-1]=e[n],n++;e[n-1]=i,t=n-1}this.runIndex=0},e.prototype.add=function(e){this.sort(),e.priority=1/0,this.callbacks.unshift(e)},e.prototype.remove=function(e){r.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()},e}(),n=new Map;t.addFrameWorker=function(e,t){var r=n.get(e);return null==r&&(r=new i(e),n.set(e,r)),r.add(t),{remove:function(){if(null!=r){if(r.remove(t),r.callbacks.length>0)return void(r=null);n.delete(e),r.destroy(),r=null}}}}}.apply(null,i))||(e.exports=n)},1867:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10),r(261),r(17),r(1618),r(1629)],void 0===(n=function(e,t,r,i,n,a,o){var s=["version","level","sharedResource","attributeData","geometryData","textureData","lodSelection"],l=function(){function e(e,t,r,a,o,s,l,c,h,d,p,f){var m=this;this.rootId=r,this.progressiveLoadPenalty=a,this.nodeIndex=o,this.streamDataSupplier=s,this.viewportQueries=l,this.logger=c,this._isLoaded=h,this._isSelected=d,this._enable=p,this._needsUpdate=f,this._dirty=!0,this._loadingNodes=new Set,this._indexMissing=1,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new i,this._prefetch=new i,this._updates=new u,this.ignoreServiceOBB=!1,this._maxLodLevel=this.viewportQueries.maxLodLevel,this.rootUrl=n.makeAbsolute(t,e),this.traverseVisible(function(e,t){return m.nodeTraversalState(t)})}return e.prototype.requestReload=function(){this._dirty=!0,this._indexMissing=1,++this._version},e.prototype.update=function(e){var t=this;if(this._dirty){this._indexMissing=0,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e);var i=!0,n=new c,a=new c;this.traverseVisible(function(o,s,l){if(t._updateNodeFeatureEstimate(s,a),!s)return++t._indexMissing,t._loadingNodes.has(o.id)||t._missing.push(r({},o,{baseUrl:l})),void(t._maxProcessingPrio=Math.max(t._maxProcessingPrio,t.entryPriority(o)));if(0===t._missing.length&&s.children)for(var u=0,c=s.children;u<c.length;u++){var h=c[u];t.nodeIndex[h.id]||t._loadingNodes.has(h.id)||t._prefetch.push(r({},h,{baseUrl:s.baseUrl}))}if(!s.failed&&s.featureData&&0!==s.featureData.length){if(t._isLoaded(s))return n.known+=s.memory,++n.knownNodes,t._isSelected(s)?s.children&&(i=!1):(n.unremoved+=s.memory,i=!1),void(t._needsUpdate(s)&&(t._maxProcessingPrio=Math.max(t._maxProcessingPrio,t.entryPriority(s)),t._updates.update.push(s)));if(s.memory&&(n.known+=s.memory,++n.knownNodes),t._isSelected(s)){if(++t._nodesMissing,s.children&&(i=!1),s.memory?(n.missing+=s.memory,n.known+=s.memory,++n.knownNodes):++n.missingNodes,e.indexOf(s.id)>=0)return t._maxProcessingPrio=Math.max(t._maxProcessingPrio,t.entryPriority(s)),void(t._updates.cancel=t._updates.cancel.filter(function(e){return e!==s.id}));t._enable(s)||(t._maxProcessingPrio=Math.max(t._maxProcessingPrio,t.entryPriority(s)),t._updates.add.push(s))}}}),this._unloadedMemoryEstimate=n.missing-n.unremoved,n.knownNodes>3&&n.missingNodes>0&&(this._unloadedMemoryEstimate+=n.known/n.knownNodes*n.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(a),this._featureEstimate.leafsReached=i,this._dirty=this._indexMissing>0||this._nodesMissing>0||this._updates.add.length>0||this._updates.update.length>0||this._updates.cancel.length>0}},e.prototype.checkFeatureTarget=function(e,t){for(var r=this.viewportQueries.updateScreenSpaceErrorBias(t),i=t,n=t,a=r,o=10;o--;){var s=new c;if(this._updateFeatureEstimate(i,s),this._computeFeatureEstimate(s)<=e){if(i>=t||s.missingNodes>0||0===o)break;a=i,i=.5*(i+n)}else n=i,i=.5*(i+a)}return++this._version,this.viewportQueries.updateScreenSpaceErrorBias(r),Math.min(t,i)},e.prototype._updateFeatureEstimate=function(e,t){var r=this;++this._version,this.viewportQueries.updateScreenSpaceErrorBias(e),this.traverseVisible(function(e,i){return r._updateNodeFeatureEstimate(i,t)})},e.prototype._updateNodeFeatureEstimate=function(e,t){if(e&&!e.failed&&e.featureData&&0!==e.featureData.length)return this._isLoaded(e)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype._computeFeatureEstimate=function(e){var t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)},e.prototype.load=function(e){var t=this;return a.buildTopNodeMap(this._missing,e,function(e){return t.entryPriority(e)}),!(this._missing.length<=0||(this._maxUnloadedPrio=this.entryPriority(this._missing.front()),this._missing.forEach(function(e){return t._loadNode(e)}),this._missing.clear(),0))},e.prototype.prefetch=function(e){var t=this;return a.buildTopNodeMap(this._prefetch,e,function(e){return t.entryPriority(e)}),!(this._prefetch.length<=0||(this._prefetch.forEach(function(e){return t._loadNode(e)}),this._prefetch.clear(),0))},e.prototype.isLoading=function(){return this._indexMissing>0},e.prototype.getIndexLoading=function(){return this._loadingNodes.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},e.prototype.getNodesMissing=function(){return this._nodesMissing},e.prototype.getUpdates=function(e){var t=this;return a.buildTopNodeMap(this._updates.add,e,function(e){return t.entryPriority(e)},this._maxUnloadedPrio),a.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(e){return t.entryPriority(e)}),this._updates},e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.id];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),i=this.viewportQueries.hasLOD(e),n=!0;if(i)if(e.parentNode){var a=this.nodeIndex[e.parentNode.id];if(null==a)return null;var o=this._nodeTraversalState[a.id];n=o&&r>o.lodLevel}else n=r>0;return t?(t.lodLevel=r,t.isChosen=n,t.version=this._version,t):(this._nodeTraversalState[e.id]={nodeHasLOD:i,lodLevel:r,isChosen:n,version:this._version},this._nodeTraversalState[e.id])},e.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.id);var r=n.makeAbsolute(e.href,e.baseUrl);this.streamDataSupplier.request(r,"json").then(function(e,r){var i=r,n={id:i.id,mbs:i.mbs,parentNode:i.parentNode,children:i.children,featureData:i.featureData};s.forEach(function(e){n[e]=i.hasOwnProperty(e)?i[e]:null}),i.hasOwnProperty("obb")&&!t.ignoreServiceOBB&&(n.obb=o.clone(i.obb),n.hasServiceOBB=!0,t.viewportQueries.updateNode(n.id)),t.nodeIndex[n.id]=n,n.baseUrl=e,n.featureData&&1===n.featureData.length&&n.featureData[0].featureRange&&(n.numFeatures=n.featureData[0].featureRange[1]-n.featureData[0].featureRange[0]+1),t.nodeTraversalState(n),t._loadingNodes.delete(n.id),t._dirty=!0},function(i){t.loadErrorCallback(r),t._loadingNodes.delete(e.id),t._dirty=!0})},e.prototype.entryPriority=function(e){if(null==e.mbs&&e.id===this.rootId)return 1/0;var t=0,r=this.nodeIndex[e.id];if(null!=r&&null!=r.parentNode){var i=this._nodeTraversalState[r.parentNode.id];null!=i&&(t=i.lodLevel)}for(var n=this.progressiveLoadPenalty,a=r;a;a=a.parentNode?this.nodeIndex[a.parentNode.id]:null)if(this._isLoaded(a)){n=0;break}var o=this.viewportQueries.distToPOI(e);return-o-t*(o+this.progressiveLoadPenalty)+n},e.prototype.traverseVisible=function(e){var t=this.nodeIndex[this.rootId];t?this._traverse({id:this.rootId,mbs:t.mbs,href:this.rootUrl},t,e,""):e({id:this.rootId,mbs:null,href:this.rootUrl},null,"")},e.prototype._traverse=function(e,t,r,i){if(t.children&&0!==t.children.length){if(this.viewportQueries.isNodeVisible(t)){r(e,t,i);var n=this.nodeTraversalState(t);if(!n.nodeHasLOD||n.lodLevel!==this._maxLodLevel)for(var a=0,o=t.children;a<o.length;a++){var s=o[a],l=this.nodeIndex[s.id];l?this._traverse(s,l,r,t.baseUrl):this.viewportQueries.isNodeVisible(s)&&r(s,null,t.baseUrl)}}}else this.viewportQueries.isGeometryVisible(t)&&r(e,t,i)},e.prototype.loadErrorCallback=function(e){this.logger.warn("Error loading node: "+e)},e.prototype.updateStats=function(e){if(this._nodesMissing&&(e.nodes+=" + "+Math.round(this._nodesMissing)),this._indexMissing&&(e.index+=" + "+this._indexMissing),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)},e}(),u=function(){function e(){this.update=new i,this.add=new i,this.cancel=[]}return e.prototype.reset=function(e){this.add.clear(),this.update.clear(),this.cancel=e},e}(),c=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}();return l}.apply(null,i))||(e.exports=n)},1868:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261)],void 0===(n=function(e,t,r){var i=function(){function e(e,t){this.layerView=e,this.lodGlobalDirtyChanged=t}return e.prototype.startNodeLoading=function(e,t,r,i,n,a){this._lodGlobalDirty=!1,this._maxLodLevel=a.maxLodLevel,this._nodeIndex=i,this._rootId=n,this._nodeTraversalState=r,this._isNodeVisible=e,this._isGeometryVisible=t,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!t.isChosen&&(t.lodLevel===this._maxLodLevel||this._childrenRequireLoading(e))},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapBundleLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||this.layerView.view.resourceController.usedMemory>1.1)},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var e=this._rootId,t=this.layerView.view.resourceController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));n.clear(),this._lodGlobalHandlingRecursion(e,r),this.layerView.removeNodeData(n),n.clear(),this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)}},e.prototype._lodGlobalHandlingRecursion=function(e,t){var r=this._nodeIndex[e];if(null==r)return!1;var i=this._nodeTraversalState(r),a=i.isChosen&&(!i.nodeHasLOD||i.lodLevel===this._maxLodLevel),o=this.layerView.isNodeLoaded(r);if(o&&null!=this.layerView.setPolygonOffset){var s=!a;this.layerView.setPolygonOffset(r,s)}if(a&&o)return this._removeChildrenRecursive(r),!0;var l=!1;if(null!=r.children&&0!==r.children.length){l=!0;for(var u=0,c=r.children;u<c.length;u++){var h=c[u],d=this._nodeIndex[h.id];if(d?this._isGeometryVisible(d):this._isNodeVisible(h)){var p=this._lodGlobalHandlingRecursion(h.id,t);l=l&&p}}}o&&!a&&(l||n.length<t)&&(n.push(r),o=!1);var f=!r.featureData||0===r.featureData.length;return l||o||f},e.prototype._removeChildrenRecursive=function(e){if(null!=e.children)for(var t=0,r=e.children;t<r.length;t++){var i=r[t],a=this._nodeIndex[i.id];null!=a&&(this._removeChildrenRecursive(a),n.push(a))}},e.prototype.childrenEmpty=function(e){if(null==e.children)return!0;for(var t=0,r=e.children;t<r.length;t++){var i=r[t];if(this._isNodeVisible(i)){var n=this._nodeIndex[i.id];if(null!=n&&(this.layerView.isNodeLoaded(n)||!this.childrenEmpty(n)))return!1}}return!0},e.prototype._childrenRequireLoading=function(e){var t=this,r={finalInvisible:!0},i=function(e,r){var n=t._nodeTraversalState(e);if(n.isChosen&&(0===n.lodLevel||n.lodLevel===t._maxLodLevel)&&t._isGeometryVisible(e)&&(r.finalInvisible=!1),null==e.children)return!0;for(var a=0,o=e.children;a<o.length;a++){var s=o[a];if(t._isNodeVisible(s)){var l=t._nodeIndex[s.id];if(null!=l&&(t.layerView.isNodeLoaded(l)||!i(l,r)))return!1}}return!0};return!!i(e,r)&&!r.finalInvisible},e}(),n=new r;return i}.apply(null,i))||(e.exports=n)},1869:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(116),r(5),r(7),r(17),r(1635),r(1618),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var u=function(){function e(t,r,i,o,s){this.loader=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=o,this.options=s,this.cancelled=!1,this.loadShared=function(t){if(null==t.sharedResource)return n.resolve({});var r=a.makeAbsolute(t.sharedResource.href,t.baseUrl);return this.load(r,"json").then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,r),t})}}return e.prototype.cancelAll=function(){this.cancelled=!0},e.prototype.load=function(e,t){var r=this;return n.create(function(i,n){r.loader.request(e,t).then(function(e,t){i(t)},function(t){n(new Error("Failed to load: "+e))})})},e.prototype.loadAttribute=function(e,t,r){var i=a.makeAbsolute(r,e);return this.load(i,"binary").then(function(e){return o.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var i=this,a=r.map(function(r){return null==e.attributeData||null==e.attributeData[r.index]?(i.logger.error("Missing attributeData for '"+r.name+"' on node '"+e.id+"'"),n.resolve(null)):i.loadAttribute(t,r.attributeStorageInfo,e.attributeData[r.index].href).catch(function(t){return i.logger.error("Failed to load attributeData for '"+r.name+"' on node '"+e.id+"'"),null})});return n.all(a).then(function(e){for(var t={},i=0;i<r.length;++i)e[i]&&(t[r[i].name]=e[i]);return t})},e.prototype.prepareBinaryGeometryData=function(e,t,r,n){var a=e.geometries[0];if(i.mixin(a.params,r),n||null!=r.vertexAttributes.region||delete r.vertexAttributes.region,null!=r.featureAttributes){var l=r.featureAttributes;if(l.faceRange){var u=o.createTypedView(t,l.faceRange),c=l.faceRange.valuesPerElement,h=r.header.fields.featureCount;e.componentOffsets=s.convertFlatRangesToOffsets(u,h,c)}if(l.id){e.featureIds=[];var d=1,p=o.valueType2TypedArrayClassMap[l.id.valueType];"UInt64"===l.id.valueType&&(p=Uint32Array,d=2);for(var f=new p(t,l.id.byteOffset,l.id.count*l.id.valuesPerElement*d),m=0;m<r.header.fields.featureCount;m++)if(e.featureIds[m]=f[m*l.id.valuesPerElement*d],2===d){var g=f[m*l.id.valuesPerElement*d+1];if(g>=2097150)throw new Error("ID exceeded maximum range supported by javascript (max = 53bit-1 = 9007199254740991)");e.featureIds[m]+=4294967296*g}}}},e.prototype.loadBundleData=function(e,t){var r=this,i=e.baseUrl,s=null,l=this.loadShared(e),u=null;null!=this.requiredAttributes&&(u=this.loadAttributes(e,i,this.requiredAttributes));var c=null;if(null!=e.geometryData){var h=e.geometryData[t],d=a.makeAbsolute(h.href,i);c=this.load(d,"binary")}return l.then(function(i){return r.handleCancelled(),(r.options.loadFeatureData?r.loadFeatureData(e,t):n.resolve(null)).then(function(t){r.handleCancelled();var a,l=r.options.loadFeatureData?r.collectGeometries(e,t,i):r.meshPyramidGeometryData(e,i);a=null!=c?c.then(function(e){s=e;var t=Object.keys(i.materialDefinitions)[0],n=i.materialDefinitions[t].params.vertexRegions,a=o.createGeometryDataIndex(e,r.defaultGeometrySchema,n);return r.prepareBinaryGeometryData(l[0],e,a,n),l}):n.resolve(l);var h=r.loadTextures(l,i);return n.all([h,a,u])}).then(function(e){var t=e[0],n=e[1],a=e[2];r.handleCancelled();var o=null;return a&&(o={attributeData:a,loadedAttributes:r.requiredAttributes}),{allGeometryData:n,attributeDataInfo:o,geometryBuffer:s,sharedResource:i,textureData:t}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var i=0,n=Object.keys(r);i<n.length;i++)for(var o=0,s=r[n[i]].images;o<s.length;o++){var l=s[o];Array.isArray(l.href)?l.hrefConcat=l.href.map(function(e){return a.makeAbsolute(e,t)}):l.hrefConcat=a.makeAbsolute(l.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var i=t[r];if(Array.isArray(i.encoding))for(var n=0;n<i.encoding.length;n++){var a;"data:"===(a=i.encoding[n]).substring(0,5)&&(i.encoding[n]=a.substring(5))}else"data:"===(a=i.encoding).substring(0,5)&&(i.encoding=a.substring(5))}},e.prototype.loadTexture=function(e,t,r,i){var n=this;return i===s.DDS_ENCODING_STRING?this.load(e,"binary").then(function(e){return n.handleCancelled(),{i3sTexId:t,data:e,encoding:i}}):this.load(e,"image").then(function(e){var a=e;if(n.handleCancelled(),r&&e.width*e.height>=4096){var o=Math.ceil(e.width/2),s=Math.ceil(e.height/2),l=document.createElement("canvas");l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),a=l}return{i3sTexId:t,data:a,encoding:i}})},e.prototype.loadTextures=function(t,r){for(var i=[],a=0;a<t.length;a++){var o=t[a].geometries;if(null!=o)for(var u=0,c=o;u<c.length;u++){var h=c[u].params.textureID||"none";if("none"!==h){null!=r.textureDefinitions&&null!=r.textureDefinitions[h]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+h);var d=r.textureDefinitions[h];if(l.assert(void 0!==d,"geometry wants unknown texture "+h),0===d.images.length)continue;var p=d.images.length-1,f=d.images[p],m=this.options.textureFormat===e.TextureFormat.Compressed,g=this.options.textureFormat===e.TextureFormat.Downsampled,v=s.getAppropriateTextureEncoding(d.encoding,m),y=v>-1?d.encoding[v]:d.encoding,b=v>-1?f.hrefConcat[v]:f.hrefConcat;this.options.loadTextureData?i.push(this.loadTexture(b,h,g,y)):i.push({i3sTexId:h,encoding:y,data:null})}}}return n.all(i)},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e,t,r){for(var i=[],n=0,a=t.featureData;n<a.length;n++){var o=a[n],s=o.geometries;if(null!=s)for(var l=0;l<s.length;l++){var u=o.geometries[l];i.push({featureIds:[o.id],featureDataPosition:o.position,geometries:[u]})}else null!=o.position&&i.push({featureIds:[o.id],featureDataPosition:o.position,geometries:null})}return i},e.prototype.loadFeatureData=function(e,t){var r=a.makeAbsolute(e.featureData[t].href,e.baseUrl);return this.load(r,"json")},e.prototype.handleCancelled=function(){if(this.cancelled)throw new r},e}();return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(u||(u={})),u}.apply(null,i))||(e.exports=n)},1870:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38),r(22),r(1638),r(1603),r(1574),r(1618),r(1571),r(1629),r(93)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){return function(){function e(e,t,o,s,u,c,h,d){void 0===d&&(d={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=u,this.elevationProvider=c,this.options=d,this._computedOBBs={},this._computedMBSs={},this._isNodeVisibleCached={},this.fp=l.frustum.create(),this._idleCamera=!0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=r.vec3f64.create(),this._tmp2=r.vec3f64.create(),this._tmp3=r.vec3f64.create(),this._tmp0=r.vec3f64.create(),this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"],this.screenspaceErrorBias=d.screenspaceErrorBias||1,this.progressiveLoadFactor=d.progressiveLoadFactor||1,this.enableLoD=!d.disableLod,this.updateCamera(o),this._poi=r.vec3f64.clone(s),this.engineSR=this._renderCoordsHelper.spatialReference,h?(this._elevationContext=new n,this._elevationContext.featureExpressionInfoContext=a.createContext(a.extractExpressionInfo(h,!1)),this._elevationContext.mixinApi(h)):this._elevationContext=null,this.tmpPoint=new i({x:0,y:0,z:0,spatialReference:e})}return e.prototype.updateCamera=function(e){l.frustum.fromMatrix(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/e.perPixelRatio,this._camPos=e.eye,this._isNodeVisibleCached={},this.maxDistance=0},e.prototype.updateNode=function(e){delete this._isNodeVisibleCached[e]},e.prototype.updatePointOfInterest=function(e){r.vec3.copy(this._poi,e)},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.setCameraIdle=function(e){this._idleCamera!==e&&(this._idleCamera=e,this._isNodeVisibleCached={})},e.prototype.updateExtent=function(e){this.extent=e,this._isNodeVisibleCached={}},e.prototype.computeMbs=function(e){var t=this._computedMBSs[e.id];return t||(t=r.vec4f64.fromValues(e.mbs[0],e.mbs[1],e.mbs[2],-1),this._computedMBSs[e.id]=t),t[3]<0&&(r.vec4.copy(t,e.mbs),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),c.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.computeObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)){var t=this._computedOBBs[e.id];return t||((t=u.clone(e.obb)).halfSize[0]=-1,this._computedOBBs[e.id]=t),t.halfSize[0]<0&&(t.halfSize[0]=e.obb.halfSize[0],r.vec3.copy(t.center,e.obb.center),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),c.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype._isNodeVisible=function(e){var t=this.computeMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.hasServiceOBB&&e.obb){var r=this.computeObb(e);return u.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isNodeVisible=function(e){return!this.enableLoD||(this._idleCamera?null!=this._isNodeVisibleCached[e.id]?this._isNodeVisibleCached[e.id]:(this._isNodeVisibleCached[e.id]=this._isNodeVisible(e),this._isNodeVisibleCached[e.id]):this._isNodeVisible(e))},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;if(e.hasServiceOBB)return!0;var t=this.computeObb(e);return!t||u.isVisible(t,this.fp)},e.prototype.invalidateCache=function(e){if(null==e){for(var t=0,r=Object.keys(this._computedMBSs);t<r.length;t++){var i=r[t];this._computedMBSs[i][3]=-1}for(var n=0,a=Object.keys(this._computedOBBs);n<a.length;n++){i=a[n];this._computedOBBs[i].halfSize[0]=-1}}else this._computedMBSs[e]&&(this._computedMBSs[e][3]=-1),this._computedOBBs[e]&&(this._computedOBBs[e].halfSize[0]=-1)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==s.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){return l.frustum.intersectsSphere(this.fp,l.sphere.wrap(e[3],e))},e.prototype.calcScreenSpaceSize=function(e,t){var i=this.computeMbs(e),n=r.vec3.squaredDistance(i,this._camPos),a=i[3];this.maxDistance=Math.max(this.maxDistance,Math.sqrt(n)-a);var o=n-a*a;return o<0?.5*Number.MAX_VALUE:t/Math.sqrt(o)*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){var t=this.computeMbs(e),i=r.vec3.distance(t,this._camPos)-t[3];return this.maxDistance=Math.max(this.maxDistance,i),i},e.prototype.calcAngleDependentLoD=function(e){var t=this.computeMbs(e),i=t[3],n=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/r.vec3.length(t)+i)/r.vec3.distance(t,this._camPos);return Math.min(1,n)},e.prototype.hasLOD=function(e){return null!=e.lodSelection},e.prototype.hasFeatures=function(e){return null!=e.featureData},e.prototype.getDistancePlanarMode=function(e,t,r){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],o=i*i+n*n;if(o<=r*r)return Math.abs(a);var s=Math.sqrt(o)-r;return Math.sqrt(a*a+s*s)},e.prototype.getDistanceGlobeMode=function(e,t,i){var n=r.vec3.length(t),a=r.vec3.length(e)-n;if(r.vec3.scale(this._tmp0,e,r.vec3.dot(e,t)/r.vec3.squaredLength(e)),r.vec3.squaredDistance(t,this._tmp0)<=i*i)return Math.abs(a);var o=r.vec3.scale(this._tmp0,t,1/n),s=i,l=n,u=s*s/2/l,c=r.vec3.scale(this._tmp1,o,l-u),h=e,d=r.vec3.subtract(this._tmp2,h,c),p=r.vec3.subtract(this._tmp2,d,r.vec3.scale(this._tmp3,o,r.vec3.dot(o,d))),f=r.vec3.add(this._tmp2,c,r.vec3.scale(this._tmp2,p,s/r.vec3.length(p))),m=r.vec3.distance(h,f);if(a>=2e5){var g=r.vec3.subtract(this._tmp1,h,f),v=r.vec3.dot(g,o)/r.vec3.length(g);v<.08&&(v=1e-4),m/=v}return m},e.prototype.getDistance=function(e,t,r){return this.engineSR===c.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t,r):this.getDistancePlanarMode(e,t,r)},e.prototype._selectErrorMetric=function(e){for(var t=0;t<e.length;t++)if(this.supportedMetrics.indexOf(e[t].metricType)>=0)return e[t];return null},e.prototype.getLodLevel=function(e){if(!e.lodSelection||e.lodSelection.length<=0||!1===this.hasFeatures(e))return 0;if(null==e.children||0===e.children.length)return this.maxLodLevel;var t=this.enableLoD?this._selectErrorMetric(e.lodSelection):null;if(null==t)return 0;if(this.progressiveLoadFactor<1){var r=this.progressiveLoadFactor*this.screenspaceErrorBias,i=this.screenspaceErrorBias;return this.evaluateLODmetric(e,r,t)?this.evaluateLODmetric(e,i,t)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias,t)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t,r){switch(r.metricType){case"screenSpaceRelative":var i=this.computeMbs(e),n=this.getDistance(this._camPos,i,i[3]);this.maxDistance=Math.max(this.maxDistance,n);var a=2*n/this._screenSizeFactor;return r.maxError*t<=a;case"maxScreenThreshold":var o=this.calcScreenSpaceSize(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(o*=this.calcAngleDependentLoD(e)),o<r.maxError;case"removedFeatureDiameter":return this.calcScreenSpaceSize(e,r.maxError)*t<10;case"distanceRangeFromDefaultCamera":return this.calcCameraDistance(e)>r.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.computeMbs(e);return r.vec3.distance(t,this._poi)-t[3]},e.prototype.distCameraToPOI=function(){return r.vec3.distance(this._camPos,this._poi)},e}()}.apply(null,i))||(e.exports=n)},1871:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(139),r(47),r(1872),r(1874),r(1876),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){function u(){var e={};for(var t in c.ClientType)e[c.ClientType[t]]=0;return e[c.ClientType.TERRAIN]=15,e[c.ClientType.SCENE]=20,e[c.ClientType.SYMBOLOGY]=5,new o(e)}var c=function(){function e(t,o,s){void 0===o&&(o=n),void 0===s&&(s=i);var l=this;this._view=t,this._budget=null,this._memoryController=null,this._streamDataLoader=u(),this._frameWorkers=[],this._nextFrameWorker=0,this._idleWorkers=[],this._nextIdleWorker=0,this._idleUpdatesStartFired=!1,this._forceFrameWorker=!1,this._lastTargetChangeTime=0,this._handles=new r,this._frameTask=null,this.idleTimeout=300,this.idleBudget=100,this._budget=new e.Budget(s),this._lastTargetChangeTime=s(),this._memoryController=new a(this._view),this._debug={memoryController:this._memoryController,idleOff:!1},this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0)),this._frameTask=o.addFrameTask({update:function(e){return l.frameUpdate(e)}})}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._handles.remove(),this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)},Object.defineProperty(e.prototype,"enableBudget",{set:function(e){this._budget.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGpuMemory",{set:function(e){this._memoryController.setMaxGpuMemory(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(e){this._memoryController.setAdditionalCacheMemory(e)},enumerable:!0,configurable:!0}),e.prototype.setMemoryDirty=function(){this._memoryController.setDirty()},Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0}),e.prototype.getMemCache=function(e,t){return this._memoryController.getMemCache(e,t)},e.prototype.getStreamDataSupplier=function(e,t){return new s(e,this._streamDataLoader,t)},e.prototype.registerIdleFrameWorker=function(e){var t=this;l.assert(!e.idleFrame||e.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var r={callbacks:e};return this.addIdleFrameWorker(r),{remove:function(){t.removeIdleFrameWorker(r)}}},e.prototype.registerFrameWorker=function(e,t){var r=this,i={callback:e,needsUpdate:t=t||function(){return!0}};return this.addFrameWorker(i),{remove:function(){return r.removeFrameWorker(i)}}},e.prototype.addIdleFrameWorker=function(e){this._idleWorkers.push(e),this.isIdle()&&this._idleUpdatesStartFired&&e.callbacks.idleBegin&&e.callbacks.idleBegin()},e.prototype.removeIdleFrameWorker=function(e){var t=this._idleWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registered"),this._idleUpdatesStartFired&&e.callbacks.idleEnd&&e.callbacks.idleEnd(),t.splice(r,1),this._nextIdleWorker>=t.length&&(this._nextIdleWorker=0)},e.prototype.addFrameWorker=function(e){this._frameWorkers.push(e)},e.prototype.removeFrameWorker=function(e){var t=this._frameWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registerted"),t.splice(r,1),this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)},e.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now(),this.setMemoryDirty(),this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())},e.prototype.frameUpdate=function(e){var t=e.frameDuration>1.5*e.tickTime?e.tickTime:5;t=this.isIdle()?0:t;var r=e.frameDuration-e.elapsedFrameTime-t,i=this.idleBudget-e.elapsedFrameTime;this._debug.idleOff&&(i=r);var n=Math.max(this.isIdle()?i:r,5);if(this._budget.reset(n),this._view.stateManager&&this._view.stateManager.step(e.deltaTime/1e3),n<t&&!this._forceFrameWorker)this._forceFrameWorker=!0;else{this._forceFrameWorker=!1,this._memoryController.update();for(var a=!1,o=0;o<this._frameWorkers.length;++o){var s=(this._nextFrameWorker+o)%this._frameWorkers.length;if(a&&this._budget.remaining()<t)return void(this._nextFrameWorker=s%this._frameWorkers.length);var l=this._frameWorkers[s];this._budget.resetProgress(),l.needsUpdate(this._budget)&&(a=!0,l.callback(this._budget))}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())}},e.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout},e.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleBegin&&e.callbacks.idleBegin()})},e.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleEnd&&e.callbacks.idleEnd()})},e.prototype.callIdleFrameWorkers=function(){for(var e=0;e<this._idleWorkers.length;++e){var t=(this._nextIdleWorker+e)%this._idleWorkers.length;if(this._budget.done())return void(this._nextIdleWorker=t);var r=this._idleWorkers[t];r.callbacks.needsUpdate&&r.callbacks.needsUpdate()&&(this._budget.resetProgress(),r.callbacks.idleFrame(this._budget))}},Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},enumerable:!0,configurable:!0}),e}();return function(e){!function(e){e.TERRAIN="terrain",e.SCENE="scene",e.SYMBOLOGY="symbology"}(e.ClientType||(e.ClientType={}));var t=function(){function e(e){this._nowFunc=e,this.enabled=!0,this.begin=0,this.budget=0,this._didWork=!1}return e.prototype.now=function(){return this._nowFunc()},e.prototype.reset=function(e){this.begin=this.now(),this.budget=this.enabled?e:Number.MAX_VALUE,this._didWork=!1},e.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget},e.prototype.doneWithProgress=function(){return this.done()&&this._didWork},e.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY},e.prototype.elapsed=function(){return this.now()-this.begin},e.prototype.run=function(e){return!this.done()&&(e(),!0)},e.prototype.runWithProgress=function(e){return!this.doneWithProgress()&&(!0===e()&&(this._didWork=!0),!0)},e.prototype.resetProgress=function(){this._didWork=!1},e.prototype.madeProgress=function(){this._didWork=!0},Object.defineProperty(e.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0}),e}();e.Budget=t}(c||(c={})),c}.apply(null,i))||(e.exports=n)},1872:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(270),r(1873),r(1656)],void 0===(n=function(e,t,r,i,n,a){var o=r.getLogger("esri.views.3d.support.MemoryController");return function(){function e(e){this._view=e,this._minQuality=.1,this._maxQuality=1,this._memoryHWM=1,this._memoryLWM=.75,this._divideRate=1.3,this._throttle=5,this.events=new a.Evented,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._throttled=0,this._memoryUsed=0,this._memoryCommitted=0,this._cacheStorage=new i.Storage,this.updating=!1}return e.prototype.getMemCache=function(e,t){return new i(e,this._cacheStorage,t)},e.prototype.setMaxGpuMemory=function(e){null!=e&&e>0&&(this._maxMemory=e,this.setDirty())},e.prototype.setAdditionalCacheMemory=function(e){null!=e&&e>=0&&(this._additionalCacheMemory=e)},e.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096},e.prototype.getMemoryFactor=function(){return this._quality},e.prototype._updateQuality=function(e){return(e=Math.min(Math.max(e,this._minQuality),this._maxQuality))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),!0)},e.prototype.getUsedMemory=function(){return this._memoryUsed},e.prototype.setDirty=function(){this._stableQuality=0,this._updateQuality(this._maxQuality)},e.prototype.update=function(){if(this._updateMemory(),!(this._memoryCommitted<=0)){this._throttled=Math.max(0,this._throttled-1);var e=this._layersUpdating();if(e){if(this._quality<=this._minQuality)return;(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)&&(this._stableQuality>0?this._updateQuality(this._stableQuality):(0===this._throttled||this._memoryUsed>1.05)&&(this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle))}else if(this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,e=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality){this._stableQuality=this._quality;var t=.1*(this._memoryLWM-this._memoryCommitted+.1);e=this._updateQuality(this._quality+t)}this.updating!==e&&(this.updating=e,this.events.emit("updating-changed",this.updating))}},e.prototype._layersUpdating=function(){var e=!1;return this._view.allLayerViews.forEach(function(t){e=e||t.updating}),e},e.prototype._updateMemory=function(){var e=this,t=0,r=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(t+=this._view.basemapTerrain.getUsedMemory());var i=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();i&&(t+=i.getGpuMemoryUsage()),this._view.allLayerViews&&this._view.allLayerViews.forEach(function(i){if(n.isMemoryManagedLayerView(i)){var a=i.ignoresMemoryFactor()?e._quality:1;t+=i.getUsedMemory()*a,r+=i.getUnloadedMemory()*a}});var a=null==this._warnMemoryUsage||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),s=1048576*this._maxMemory;if(t>s&&a){this._warnMemoryUsage=t;var l=function(e){return(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},u=Math.round(100*this._quality);o.warn("GPU Memory Limit exceeded! Limit: "+l(s)+" Current: "+l(t)+" Projected: "+l(t+r)+" Quality: "+u+"%")}this._memoryUsed=t/s,this._memoryCommitted=(t+r)/s;var c=s-t;this._cacheStorage.maxSize=Math.max(0,c+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)},Object.defineProperty(e.prototype,"debug",{get:function(){return{cacheStorage:this._cacheStorage}},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1873:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMemoryManagedLayerView=function(e){return"function"==typeof e.getUsedMemory}}.apply(null,i))||(e.exports=n)},1874:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(21),r(73),r(5),r(1875),r(1619),r(1639),r(1559)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var u;return function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.CANCELLED=4]="CANCELLED"}(u||(u={})),function(){function e(e){this.tasks=new Map,this.clientPromiseToTask=new Map,this.loadQueue=new a(this.startLoading.bind(this),this.doneLoadingCallback,this,e)}return e.prototype.destroy=function(){var e=this;this.tasks.forEach(function(t){for(var r=0,i=t.clientPromises;r<i.length;r++){var n=i[r];n.isRejected()||n.reject(t.url,null),e.cancelTask(n)}}),this.loadQueue.clear(),this.loadQueue=null,this.tasks=null,this.clientPromiseToTask=null},e.prototype.request=function(e,t,r){var i=this,n=new o.Promise(function(){i.cancel(n)});return this.createOrUpdateTask(e,t,r,n),n},e.prototype.createTask=function(e,t,r,i,n){var a={url:e,docType:t,clientType:r,key:i,result:null,status:u.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,n),this.tasks.set(i,a),this.loadQueue.push(a)},e.prototype.cancel=function(e){this.cancelTask(e)},e.prototype.hasPendingDownloads=function(){return this.tasks.size>0},Object.defineProperty(e.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0}),e.prototype.taskKey=function(e,t,r){return e+":"+t+":"+r},e.prototype.updateTask=function(e,t){this.clientPromiseToTask.set(t,e),e.clientPromises.push(t)},e.prototype.createOrUpdateTask=function(e,t,r,i){var n=this.taskKey(e,t,r),a=this.tasks.get(n);a?this.updateTask(a,i):this.createTask(e,t,r,n,i)},e.prototype.cancelTask=function(e){var t=this.clientPromiseToTask.get(e);t&&(i.removeUnordered(t.clientPromises,e),this.clientPromiseToTask.delete(e),0===t.clientPromises.length&&(t.status===u.DOWNLOADING&&(this.loadQueue.workerCancelled(t),t.status=u.CANCELLED,t.downloadObj.cancel(),t.downloadObj=null),t.status=u.CANCELLED,this.tasks.delete(t.key)))},e.prototype.doneLoadingCallback=function(e,t){l.assert(e.status===u.DOWNLOADING);for(var r=e.result,i=0,a=e.clientPromises;i<a.length;i++){var o=a[i];this.clientPromiseToTask.delete(o),t?o.isRejected()||o.reject(e.url,t):(r||(r=n.clone(e.result)),o.done(e.url,r),r instanceof HTMLImageElement||(r=null))}this.tasks.delete(e.key)},e.prototype.startLoading=function(e,t){if(e.status===u.CANCELLED)return!1;var i,n;switch(e.status=u.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;default:n="json"}return e.startTime=s.now(),e.downloadObj=r(e.url,{responseType:n,timeout:i}),e.downloadObj.then(function(r){e.duration=s.now()-e.startTime,e.size="binary"===e.docType?r.data.byteLength:0,e.result=r.data,t(e)},function(r){e.downloadObj.isCanceled()||t(e,r)}),!0},e}()}.apply(null,i))||(e.exports=n)},1875:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(73),r(1559)],void 0===(n=function(e,t,r,i){return function(){function e(e,t,r,i){for(var n in this.workerFunc=e,this.robin=0,this.type2id={},this.tasks=[],this.typeNumWorkers=[],this.typeWorkerQuota=[],this.typeStatistics=[],this.totalNumWorkers=0,this.maxTotalNumWorkers=0,this.numTypes=0,i)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=i[n],this.type2id[n]=this.robin++,this.maxTotalNumWorkers+=i[n];this.numTypes=this.tasks.length,this.robin=0;var a=this;this.taskCallback=function(e){e._cancelledInQueue||(t.apply(r,arguments),a.taskFinished(e))}}return e.prototype.setWorkerQuota=function(e){for(var t in i.assert(r.equals(Object.keys(this.typeWorkerAllication),Object.keys(e))),this.typeWorkerAllication=e,this.maxTotalNumWorkers=0,e){var n=this.type2id[t];this.typeWorkerQuota[n]=e[t],this.maxTotalNumWorkers+=e[t]}},e.prototype.setWorkerFunc=function(e){this.workerFunc=e},e.prototype.push=function(e){var t=this.type2id[e.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[t]++,this.totalNumWorkers++,this.workerFunc(e,this.taskCallback)):this.tasks[t].push(e)},e.prototype._getStatsForType=function(e){var t=this.type2id[e];return{quota:this.typeWorkerQuota[t],workers:this.typeNumWorkers[t],queueSize:this.tasks[t].length,requestStats:this.typeStatistics[t]}},e.prototype.removeTasks=function(e,t){for(var r=[],i=0,n=this.tasks[this.type2id[t]];i<n.length;i++){var a=n[i];-1===e.indexOf(a)&&r.push(a)}this.tasks[this.type2id[t]]=r},e.prototype.workerCancelled=function(e){this.taskFinished(e),e._cancelledInQueue=!0},e.prototype.clear=function(){for(var e=0;e<this.tasks.length;e++)this.tasks[e]=[]},e.prototype.taskFinished=function(e){var t=this.type2id[e.clientType];this.typeNumWorkers[t]--,this.totalNumWorkers--,this.typeStatistics[t].requests++,this.typeStatistics[t].size+=e.size||0,this.typeStatistics[t].duration+=e.duration||0,this.typeStatistics[t].speed=this.typeStatistics[t].duration>0?this.typeStatistics[t].size/this.typeStatistics[t].duration:0,i.assert(this.typeNumWorkers[t]>=0),this.next()},e.prototype.next=function(){var e=this.robin,t=!1;do{this.typeNumWorkers[e]<this.typeWorkerQuota[e]&&this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);if(!t)do{this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);this.robin=e},e.prototype.processQueue=function(e){for(;this.tasks[e].length>0;)if(this.workerFunc(this.tasks[e].shift(),this.taskCallback))return this.typeNumWorkers[e]++,this.totalNumWorkers++,!0;return!1},e}()}.apply(null,i))||(e.exports=n)},1876:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r){this._clientType=e,this._loader=t,this._activeRequests=null,r&&r.trackRequests&&(this._activeRequests=new Map)}return e.prototype.request=function(e,t){var r=this,i=this._loader.request(e,t,this._clientType);if(this._activeRequests){this._activeRequests.set(e,i);var n=function(){r._activeRequests.delete(e)};i.then(n,n)}return i},e.prototype.cancelRequest=function(e){this._loader.cancel(e)},e.prototype.cancelAll=function(){var e=this;this._activeRequests&&(this._activeRequests.forEach(function(t){e._loader.cancel(t)}),this._activeRequests.clear())},e.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()},e}()}.apply(null,i))||(e.exports=n)},1890:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(261),r(1853)],void 0===(n=function(e,t,r,i){function n(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,i,n){n||(n=g(null,!0)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=t,o=void 0;a<r;a++)o=e.children[a],s(n,e.leaf?i(o):o);return n}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,a-i)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,t,r,n,a){for(var o=[t,r];o.length;)if(!((r=o.pop())-(t=o.pop())<=n)){var s=t+Math.ceil((r-t)/n/2)*n;i(e,s,t,r,a),o.push(t,s,s,r)}}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=u,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var r=this.data,i=this.toBBox;if(m(e,r))for(b.clear();r;){for(var n=0,a=r.children.length;n<a;n++){var o=r.children[n],s=r.leaf?i(o):o;m(e,s)&&(r.leaf?t(o):f(e,s)?this._all(o,t):b.push(o))}r=b.pop()}},e.prototype.collides=function(e){var t=this.data,r=this.toBBox;if(!m(e,t))return!1;for(b.clear();t;){for(var i=0,n=t.children.length;i<n;i++){var a=t.children[i],o=t.leaf?r(a):a;if(m(e,o)){if(t.leaf||f(e,o))return!0;b.push(a)}}t=b.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var r=0,i=t;r<i;r++)this.insert(e[r]);return this}var n=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var a=this.data;this.data=n,n=a}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=g([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var r,i,a,o,s=this.data,l=this.toBBox(e);for(x.clear(),w.clear();s||x.length;){if(s||(s=x.pop(),r=x.data[x.length-1],i=w.pop(),a=!0),s.leaf&&-1!==(o=n(e,s.children,t)))return s.children.splice(o,1),x.push(s),this._condense(x),this;a||s.leaf||!f(s,l)?r?(i++,s=r.children[i],a=!1):s=null:(x.push(s),w.push(i),i=0,r=s,s=s.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(_.clear();e;){if(!0===e.leaf)for(var r=0,i=e.children;r<i.length;r++){t(i[r])}else _.pushArray(e.children);e=_.pop()}},e.prototype._build=function(e,t,r,i){var n,o=r-t+1,s=this._maxEntries;if(o<=s)return a(n=g(e.slice(t,r+1),!0),this.toBBox),n;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(n=g([],!1)).height=i;var l=Math.ceil(o/s),u=l*Math.ceil(Math.sqrt(s));v(e,t,r,u,this.compareMinX);for(var c=t;c<=r;c+=u){var h=Math.min(c+u-1,r);v(e,c,h,l,this.compareMinY);for(var d=c;d<=h;d+=l){var p=Math.min(d+l-1,h);n.children.push(this._build(e,d,p,i-1))}}return a(n,this.toBBox),n},e.prototype._chooseSubtree=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){for(var n=1/0,a=1/0,o=void 0,s=0,l=t.children.length;s<l;s++){var u=t.children[s],h=c(u),p=d(e,u)-h;p<a?(a=p,n=h<n?h:n,o=u):p===a&&h<n&&(n=h,o=u)}t=o||t.children[0]}return t},e.prototype._insert=function(e,t,r){var i=this.toBBox,n=r?e:i(e);x.clear();var a=this._chooseSubtree(n,this.data,t,x);for(a.children.push(e),s(a,n);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;this._adjustParentBBoxes(n,x,t)},e.prototype._split=function(e,t){var r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var o=this._chooseSplitIndex(r,n,i),s=g(r.children.splice(o,r.children.length-o),r.leaf);s.height=r.height,a(r,this.toBBox),a(s,this.toBBox),t?e.data[t-1].children.push(s):this._splitRoot(r,s)},e.prototype._splitRoot=function(e,t){this.data=g([e,t],!1),this.data.height=e.height+1,a(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,r){var i,n,a;i=n=1/0;for(var s=t;s<=r-t;s++){var l=o(e,0,s,this.toBBox),u=o(e,s,r,this.toBBox),h=p(l,u),d=c(l)+c(u);h<i?(i=h,a=s,n=d<n?d:n):h===i&&d<n&&(n=d,a=s)}return a},e.prototype._chooseSplitAxis=function(e,t,r){var i=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},e.prototype._allDistMargin=function(e,t,r,i){e.children.sort(i);for(var n=this.toBBox,a=o(e,0,t,n),l=o(e,r-t,r,n),u=h(a)+h(l),c=t;c<r-t;c++){var d=e.children[c];s(a,e.leaf?n(d):d),u+=h(a)}for(c=r-t-1;c>=t;c--){d=e.children[c];s(l,e.leaf?n(d):d),u+=h(l)}return u},e.prototype._adjustParentBBoxes=function(e,t,r){for(var i=r;i>=0;i--)s(t.data[i],e)},e.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(r=e.data[t-1].children).splice(r.indexOf(e.data[t]),1):this.clear():a(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=y;var b=new r,_=new r,x=new r,w=new r({deallocator:null});t.default=y}.apply(null,i))||(e.exports=n)},1914:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(67)],void 0===(n=function(e,t,r){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?r.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var r=0;r<e.length;++r)for(var i=e[r],n=0;n<i.length;++n){i[n][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var r=0;r<e.length;++r){var i=e[r].geometry;i&&i.hasZ&&(this._geometryIsPoint(i)?null!==i.z&&(i.z*=t):this._geometryIsPolyline(i)?this._vertexListsScaleZ(i.paths,t):this._geometryIsPolygon(i)&&this._vertexListsScaleZ(i.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,i))||(e.exports=n)},1916:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){if(!e||e.symbol)return null;var r=t.renderer;return e&&r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function i(e,t){if(e.symbol)return e.symbol;var i=r(e,t);return i&&i.getSymbol(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=r,t.getSymbol=i,t.getRenderingInfo=function(e,t){var n=r(e,t),a=i(e,t);if(!a)return null;var o={renderer:n,symbol:a};if(!(n&&"visualVariables"in n&&n.visualVariables))return o;for(var s=["proportional","proportional","proportional"],l=0,u=n.getVisualVariableValues(e,t);l<u.length;l++){var c=u[l],h=c.variable,d=c.value;if("color"===h.type)o.color=d.toRgba();else if("size"===h.type)if("outline"===h.target)o.outlineSize=d;else{var p=h.axis,f=h.useSymbolValue?"symbolValue":d;"width"===p?s[0]=f:"depth"===p?s[1]=f:"height"===p?s[2]=f:s[0]=s[1]="width-and-depth"===p?f:s[2]=f}else"opacity"===h.type?o.opacity=d:"rotation"===h.type&&"tilt"===h.axis?o.tilt=d:"rotation"===h.type&&"roll"===h.axis?o.roll=d:"rotation"===h.type&&(o.heading=d)}return(isFinite(s[0])||isFinite(s[1])||isFinite(s[2]))&&(o.size=s),o}}.apply(null,i))||(e.exports=n)},1917:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(50),r(4),r(58),r(13),r(7),r(14),r(1),r(31),r(525),r(52),r(1738),r(1918),r(1929),r(1930),r(1933),r(1935),r(1936),r(1566),r(1800)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w){var S=function(e){function t(t){var r=e.call(this)||this;return r._handles=new s,r.highlights=new y,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=!e.queryGraphicUIDsInExtent&&(e.scaleVisibilityEnabled||e.elevationAlignmentEnabled)?new _({spatialReference:e.owner.view.spatialReference}):null,r=e.frustumVisibilityEnabled?new v:null,i=e.scaleVisibilityEnabled?new b:null,n=e.elevationAlignmentEnabled?new g:null,a=new m({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,basemapTerrain:e.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),o=e.updateClippingExtent,s=e.queryGraphicUIDsInExtent,l=e.suspendResumeExtentMode,u=e.dataExtent;return{graphicsCore:a,frustumVisibility:r,scaleVisibility:i,elevationAlignment:n,spatialIndex:t,updateClippingExtent:o,suspendResumeExtentMode:l,dataExtent:u,queryGraphicUIDsInExtent:s||function(e,r,i){return t.queryGraphicUIDsInExtent(e,r,i)}}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,r){d.diff(t,r)&&e.graphicsCore.elevationInfoChange()})),this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,r){d.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))),this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.graphicsCore,this.elevationAlignment]},t.prototype.setup=function(){var e=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var t=this.owner.view.basemapTerrain,r=this.owner.view.elevationProvider;return this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,t),this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,this.graphicsCore,r),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex)),this._set("deconfliction",this.owner.view.deconflictor.addGraphicsOwner(this.graphicsCore)),this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,deconfliction:this.deconfliction,labeling:this.labeling,highlights:this.highlights}),this._handles.add([this.layer.watch("renderer",function(t){return e.graphicsCore.rendererChange(t)}),this.owner.watch("fullOpacity",function(){return e.graphicsCore.opacityChange()})]),this._handles.add(this.layer.on("graphic-update",function(t){return e.graphicsCore.graphicUpdateHandler(t)})),this.setupSuspendResumeExtent(),this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return e.needsIdleUpdate()},idleFrame:function(t){return e.idleUpdate(t)}})),this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return e._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():l.resolve()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null),this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null)),this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null)),this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null)),this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null)),this.highlights&&(this.highlights.destroy(),this._set("highlights",null)),this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,r){var i=this;if(e instanceof p){var a=this.highlights.acquireSet(t,r),o=a.set,s=a.handle;return this.owner.queryObjectIds(e).then(function(e){return i.highlights.setObjectIds(o,e)}),s}if("number"==typeof e)return this.highlight([e],t,r);if(e instanceof n)return this.highlight([e],t,r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof n){var l=e;if(!r||!l[0].attributes||null===w.attributeLookup(l[0].attributes,r)){var u=l.map(function(e){return e.uid}),c=this.highlights.acquireSet(t,null),h=c.set;s=c.handle;return this.highlights.setUids(h,u),s}e=l.map(function(e){return w.attributeLookup(e.attributes,r)})}if("number"==typeof e[0]){var d=e,f=this.highlights.acquireSet(t,r);h=f.set,s=f.handle;return this.highlights.setObjectIds(h,d),s}}return{remove:function(){}}},t.prototype.needsIdleUpdate=function(){for(var e=0,t=this.idleClients;e<t.length;e++){var r=t[e];if(r&&r.needsIdleUpdate())return!0}return!1},t.prototype.idleUpdate=function(e){for(var t=0,r=this.idleClients;t<r.length;t++){var i=r[t];if(i&&i.needsIdleUpdate()&&(i.idleUpdate(e),e.done()))return}},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(u.init(this,"suspendResumeExtentMode",function(t){switch(e._handles.remove(C),e.suspendResumeExtentMode){case"computed":e._handles.add(u.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),C);break;case"data":e._handles.add(u.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),C);break;default:o.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!h.canProject(e,r))return;e=h.project(e,r)}return x.enlargeExtent(e,t,f.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},i([c.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),i([c.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),i([c.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),i([c.property({constructOnly:!0})],t.prototype,"queryGraphicUIDsInExtent",void 0),i([c.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),i([c.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),i([c.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),i([c.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),i([c.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),i([c.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([c.property({readOnly:!0})],t.prototype,"labeling",void 0),i([c.property({readOnly:!0})],t.prototype,"highlights",void 0),i([c.property()],t.prototype,"suspendResumeExtentMode",void 0),i([c.property()],t.prototype,"dataExtent",void 0),i([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),i([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],t.prototype,"updating",null),i([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(c.declared(a)),C="suspendResumeExtentMode";return S}.apply(null,i))||(e.exports=n)},1918:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(83),r(114),r(30),r(538),r(103),r(4),r(73),r(58),r(8),r(13),r(262),r(9),r(139),r(84),r(261),r(7),r(14),r(1),r(38),r(1563),r(72),r(65),r(1593),r(525),r(1919),r(530),r(1920),r(1603),r(1739),r(1921),r(1922),r(1741),r(1566),r(1605),r(92),r(93),r(1928),r(1575),r(1613),r(1630)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m,g,v,y,b,_,x,w,S,C,T,E,P,O,R,A,M,I,D,F,V,L,U,B,N,j,G,z,H){var k=new o.Point,W=w.vec3f64.create(),q=S.create(),X=m.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),Y=function(e){function t(t){var r=e.call(this)||this;return r.propertiesPool=new j.PropertiesPool({computedExtent:o.Extent},r),r.computedExtent=null,r.symbolCreationContext=new D.Graphics3DSymbolCreationContext,r.graphics=new Map,r.stageLayer=null,r.stage=null,r.graphicsDrapedUids=new Set,r.graphicsBySymbol=new Map,r.symbolConversionCache=new Map,r.symbols=new Map,r.graphicsWithoutSymbol={},r.graphicsWaitingForSymbol=new Set,r.lastFastUpdate=null,r.handles=new p,r.viewSR=null,r.elevationAlignment=null,r.scaleVisibility=null,r.spatialIndex=null,r.deconfliction=null,r.labeling=null,r.highlights=null,r.viewElevationProvider=null,r.sharedSymbolResourcesOwnerHandle=null,r.whenGraphics3DGraphicRequests={},r.pendingUpdates=new Map,r.pendingAdds=0,r.pendingRemoves=0,r.pendingUpdatesPool=new y({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),r.symbolWarningLogged=!1,r.geometryWarningLogged=!1,r._whenSymbolRemoved=[],r.asyncUpdates=!1,r.elevationFeatureExpressionEnabled=!0,r.owner=null,r.layer=null,r.hasDraped=!1,r.graphicSymbolSupported=!0,r._usedMemory=0,r.numberOfGraphics=0,r._visible=void 0,r._startCreateGraphics=!1,r.maxPendingUpdates=0,r}var u;return r(t,e),u=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.maxSymbolComplexity,a=Math.max(t,Math.min(r,Math.ceil(i/Math.max(1,n?n.primitivesPerFeature:1)))),o=this._get("displayFeatureLimit");return o&&o.minimumTotalNumberOfFeatures===t&&o.maximumTotalNumberOfFeatures===r&&o.maximumTotalNumberOfPrimitives===i&&o.maximumSymbolComplexity===n&&o.maximumNumberOfFeatures===a?o:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:i,maximumSymbolComplexity:n,maximumNumberOfFeatures:a}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=0,r=this.getSymbolComplexities();t<r.length;t++){var i=r[t];e?0===e.primitivesPerCoordinate&&i.primitivesPerFeature>e.primitivesPerFeature?e=i:0!==e.primitivesPerCoordinate&&i.primitivesPerCoordinate>e.primitivesPerCoordinate&&(e=i):e=i}var n=this._get("maxSymbolComplexity");return!e||n&&n.primitivesPerFeature===e.primitivesPerFeature&&n.primitivesPerCoordinate===e.primitivesPerCoordinate?n:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),t.prototype.getSymbolComplexities=function(){return this.layer.renderer?this.getSymbolComplexitiesUsedOrRenderer(this.layer.renderer):this.getSymbolComplexitiesUsed()},t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var r=R.to3D(e,!0,!1,this.hasLabelingContext(e)),i=r.symbol||null;return i||r.error&&X.error(r.error.message),this.symbolConversionCache.set(e.id,i),i},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i],o=this.symbols.get(a.id);if(o)r.push(o.complexity);else{var s=this.getConvertedSymbol(a);s&&r.push(U.defaultSymbolComplexity(s))}}return r},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("spatialIndex",e.spatialIndex),this._set("deconfliction",e.deconfliction),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var r=this.owner.view;this.viewElevationProvider=new A.ViewElevationProvider(this.viewSR,r),this.initializeStage(r,this.layer.uid),this.symbolCreationContext.sharedResources=r.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=r.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.layer.renderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=r.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=r.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=r.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new z,this.symbolCreationContext.elevationProvider=r.elevationProvider;var i=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(i,this.viewSR,X),r.deconflictor.addGraphicsOwner(this),this.symbolCreationContext.screenSizePerspectiveEnabled=r.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var n="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(n,function(){var e=r.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(e){return t.slicePlaneEnabledChange(!!e)}),this.owner.watch("layer.featureReduction",function(){t.deconfliction.featureReductionChange()})]),this.handles.add(_.when(r.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference),t.handles.has("loaded-graphics")?t.recreateAllGraphics():t.handles.add(_.on(t.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){return t.recreateAllGraphics()}),"loaded-graphics")})),this.validateRenderer(this.layer.renderer),this.notifyChange("maxSymbolComplexity")},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(G.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new d("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear()},t.prototype.clear=function(){this.graphics.forEach(function(e){return e.destroy()}),this.spatialIndex&&this.spatialIndex.clear(),this.graphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new H(t,{isPickable:!this.owner.suspended},t),this.stage.add(G.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(r){r&&r.setDrawOrder(e,t)}),t.size>0&&this.stage.getDrapedTextureRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*J,r=!e&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics.get(e)},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this.owner.layer&&this.owner.layer.objectIdField;if(!e)return null;var t=new Map;return this.graphics.forEach(function(r){if(r){var i=r.graphic,n=i.attributes&&i.attributes[e];null!=n&&t.set(n,r)}}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){return this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.labelingInfoChange(e)},t.prototype.updateVisibilityInfo=function(){return this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,r=0;return f.everyMap(this.symbols,function(i,n){if(i){var a=i.getFastUpdateStatus();if(a.loading>0)return!1;e.graphicsBySymbol.has(n)&&(r+=a.fast,t+=a.slow)}})?r>=0&&0===t?"fast":t>=0&&0===r?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsIdleUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&g()-this.lastFastUpdate>500},t.prototype.idleUpdate=function(e){var t=this.needsIdleUpdate();this._applyPendingUpdates(e),!e.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsIdleUpdate()&&this.notifyChange("updating")},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics.get(e.uid);if(t)return b.resolve(t);var r=this.whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;var i=b.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=i,i.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return a(this,void 0,void 0,function(){var r,i,a,o,s,l,u,c,h,d;return n(this,function(n){switch(n.label){case 0:return r=this.owner.view.spatialReference,i=this.owner.view.renderSpatialReference,a=this.owner.view.basemapTerrain.spatialReference,o=function(e,t,n){return N.bufferToBuffer(e,i,t,e,r,t,n)},s=function(e,t,i){return N.bufferToBuffer(e,a,t,e,r,t,i)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t&&t.useViewElevation,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(o,s,l)];case 1:return(u=n.sent())?(c=u.boundingBox,u.requiresDrapedElevation&&(h=this.symbolCreationContext.elevationProvider)&&(S.center(c,W),k.x=W[0],k.y=W[1],k.z=void 0,k.spatialReference=r,d=h.getElevation(k)||0,c[2]=Math.min(c[2],d),c[5]=Math.max(c[5],d)),[2,{boundingBox:c,screenSpaceObjects:u.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var r=this;return _.whenOnce(this.owner,"loadedGraphics").then(function(){var t=r.owner.layer&&r.owner.layer.objectIdField,i=r.owner.loadedGraphics.find(function(r){return r===e||t&&r.attributes&&e.attributes&&r.attributes[t]===e.attributes[t]});if(i)return r.whenGraphics3DGraphic(i);throw new d("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return r.boundsForGraphics3DGraphic(e,t)})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=this.graphics.get(e.graphic.uid);if(t)switch(e.property){case"visible":this.graphicUpdateVisible(t,e);break;case"geometry":case"attributes":case"symbol":this.recreateGraphic(t);break;default:h.neverReached(e)}},t.prototype.graphicUpdateVisible=function(e,t){var r=e.setVisibilityFlag(0,t.newValue);r&&this.labeling&&(this.lastFastUpdate=g(),this.owner.view.labeler.setDirty()),r&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e.graphic];this.remove(t),this.add(t)},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=q,r=e.spatialReference;E.computeAABB(e,t);var i=this.viewSR,n=u.tmpVec;if(r.equals(i)||N.xyzToVector(t[0],t[1],0,r,n,i)&&(t[0]=n[0],t[1]=n[1],N.xyzToVector(t[3],t[4],0,r,n,i),t[3]=n[0],t[4]=n[1]),B.isFinite(t[0])&&B.isFinite(t[3])&&B.isFinite(t[1])&&B.isFinite(t[4])){var a=this.computedExtent,o=null,s=B.isFinite(t[2])&&B.isFinite(t[5]),l=s&&(!a||null==a.zmin||t[2]<a.zmin),c=s&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||l||c)&&((o=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),o.ymin=Math.min(t[1],a.ymin),o.xmax=Math.max(t[3],a.xmax),o.ymax=Math.max(t[4],a.ymax),o.spatialReference=i):((o=this.propertiesPool.get("computedExtent")).xmin=t[0],o.ymin=t[1],o.xmax=t[3],o.ymax=t[4],o.spatialReference=i),o&&(l&&(o.zmin=t[2]),c&&(o.zmax=t[5]),this._set("computedExtent",o))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(t,this.viewSR,X),this.labeling&&this.labeling.elevationInfoChange(),this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer),this.forEachGraphics3DSymbol(function(t,r,i){if(t.layerPropertyChanged("elevationInfo",r))for(var n in r)for(var a=r[n],o=a.graphic,s=a._labelGraphics,l=0;l<s.length;l++){var u=s[l];u.graphics3DSymbolLayer.updateGraphicElevationContext(o,u)}else e._recreateSymbol(i)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.labeling&&this.labeling.reset(),this.deconfliction&&this.deconfliction.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,r=[],i=[];this.graphicsBySymbol.get(e).forEach(function(e,n){var a=e.usedMemory;e.isDraped()&&t.graphicsDrapedUids.delete(n),t.labeling&&t.labeling.removeGraphic(e),t.deconfliction&&t.deconfliction.removeGraphic(e),t.spatialIndex&&r.push(e),i.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(n,a),t.updateLayerVisibility()}),r.length>0&&this.spatialIndex.removeMany(r),this.graphicsBySymbol.set(e,new Map);var n=this.symbols.get(e);n&&n.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(i)},t.prototype.add=function(e){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")):X.error("#add()","Cannot add graphics before terrain surface has been initialized")},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,Q.clear();for(var r=0,i=e;r<i.length;r++){var n=i[r];this._startAddGraphic(n,Q)}Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,a=this.pendingUpdates.get(n);if(a)a.add||this.pendingAdds++,a.add=i;else{var o=this.pendingUpdatesPool.pushNew();o.add=i,this.pendingAdds++,this.pendingUpdates.set(n,o)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._removeGraphic(i)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,a=this.pendingUpdates.get(n);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(n),this.pendingAdds--);else{var o=this.pendingUpdatesPool.pushNew();o.remove=i,this.pendingUpdates.set(n,o),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&X.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;if(!e.done()){this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var r=0;Q.clear(),f.everyMap(this.pendingUpdates,function(i,n){if(e.done())return!1;i.remove&&(t.pendingRemoves--,t._removeGraphic(i.remove)),i.add&&(t.pendingAdds--,t._startAddGraphic(i.add,Q)&&r++),t.pendingUpdates.delete(n),r>1e3&&(Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),r=0)}),Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()}},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var r=this._getRenderingInfo(e,X);if(!r)return!1;var i=r.symbol,n=this.getOrCreateGraphics3DSymbol(i,r.renderer);if(!n)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var a={graphic:e,renderingInfo:r,layer:this.layer},o=n.symbol.id,s=t.get(o);if(s)s.graphics.push(a);else{var l=K.acquire();l.clear(),l.push(a),t.set(o,{asyncSymbol:n,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,r=!1,i=function(t){t===e.asyncSymbol.symbol.id&&(r=!0)};this._whenSymbolRemoved.push(i),e.asyncSymbol.then(function(){c.removeUnordered(t._whenSymbolRemoved,i),Z.clear();for(var n=0;n<e.graphics.length;n++){var a=e.graphics.data[n],o=a.graphic;if(!r&&!e.asyncSymbol.destroyed){if(t.graphicsWaitingForSymbol.has(o.uid)){var s=t.createGraphics3DGraphic(e.asyncSymbol,a);t.spatialIndex&&s&&Z.push(s)}t._endGraphicUpdate(o)}--e.asyncSymbol.referenced}Z.length>0&&(t.spatialIndex.addMany(Z.data,Z.length),Z.clear()),e.graphics.clear(),K.release(e.graphics),t.labeling&&(t.lastFastUpdate=g(),t.owner.view.labeler.setDirty())},function(){if(c.removeUnordered(t._whenSymbolRemoved,i),!r&&!e.asyncSymbol.destroyed)for(var n=0;n<e.graphics.length;n++)t._endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),K.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,r=this.graphics.get(t);if(r){var i=r.usedMemory;r.isDraped()&&this.graphicsDrapedUids.delete(t),this.deconfliction&&this.deconfliction.removeGraphic(r),this.labeling&&this.labeling.removeGraphic(r),this.spatialIndex&&this.spatialIndex.remove(r);var n=r.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,i),r.destroy()}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e)&&(X.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){if(!e.geometry)return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&e.symbol)return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var r=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(e);return r&&r.symbol?r:(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)},t.prototype.createGraphics3DSymbol=function(e,t){var r=this;if(!this.hasValidSymbolCreationContext(e))return null;var i,n=this.getConvertedSymbol(e);if(!n)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=R.to3D(t.backgroundFillSymbol,!1,!0);a.symbol&&"web-style"!==a.symbol.type&&(i=a.symbol.symbolLayers)}var o=F.make(n,this.symbolCreationContext,i);return o.then(function(){return r.notifyChange("maxSymbolComplexity")}),o},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var r=this,i=this.symbols.get(e.id);return void 0===i&&(i=e instanceof l.WebStyleSymbol?new V(e,function(e){return r.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,i)),i&&++i.referenced,i},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var r=t.graphic;if(delete this.graphicsWithoutSymbol[r.uid],this.symbols.has(e.symbol.id)){if(!this.graphics.has(r.uid)){var i=e.createGraphics3DGraphic(t),n=e.symbol.id;this.addGraphics3DGraphic(i),this.graphicsBySymbol.has(n)||this.graphicsBySymbol.set(n,new Map),this.graphicsBySymbol.get(n).set(r.uid,i),i.initialize(this.stageLayer,this.stage),i.isDraped()&&(this.graphicsDrapedUids.add(r.uid),this._set("hasDraped",!0)),i.centroid=null,"point"!==r.geometry.type&&i instanceof I&&(i.centroid=L.computeCentroid(r.geometry,this.viewSR));var a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.deconfliction&&this.deconfliction.addGraphic(i),this.labeling&&this.labeling.addGraphic(i),a&&this.scaleVisibility.updateGraphicScaleVisibility(i);var o=!!r.visible&&!this.owner.suspended;i.setVisibilityFlag(0,o),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,i);var s=this.whenGraphics3DGraphicRequests[r.uid];return s&&(delete this.whenGraphics3DGraphicRequests[r.uid],s.resolve(i)),this.highlights&&this.highlights.graphicCreated(i),i}}else this.add([r])},t.prototype.rendererChange=function(e){var t=this.symbolCreationContext.renderer;if(e!==t){this.validateRenderer(e),this.symbolConversionCache.clear();var r=P.diff(t,e);this.updateUnchangedSymbolMappings(r,e,t),this.symbolCreationContext.renderer=e,r&&("complete"===r.type?this.recreateAllGraphics():"partial"===r.type&&(this.applyRendererDiff(r,e,t)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,r,i){var n=this;e=e||[];for(var a=[],o=this,s=0,l=t=t||[];s<l.length;s++){!function(t){var i=o.graphicsBySymbol.get(t.id);i&&i.forEach(function(o,s){var l=o.graphic,u=n.layer instanceof T?n.layer:null;if(t!==r.defaultSymbol||r.getSymbol(E.hydrateGraphic(l,u))!==r.defaultSymbol){var c=o.usedMemory;o.isDraped()&&n.graphicsDrapedUids.delete(s),e.length||r.defaultSymbol?a.push(l):n.graphicsWithoutSymbol[s]=l;var h=n.graphics.get(s);n.highlights&&n.highlights.graphicDeleted(h),n.labeling&&n.labeling.removeGraphic(h),o.destroy(),i.delete(s),n.removeGraphics3DGraphic(s,c),n.updateLayerVisibility()}});for(var s=0,l=o._whenSymbolRemoved;s<l.length;s++)(0,l[s])(t.id)}(l[s])}if(e.length||a.length){for(var u in this.graphicsWithoutSymbol)a.push(this.graphicsWithoutSymbol[u]);this.graphicsWithoutSymbol={},this.add(a)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,r){var i=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(i||n){var a=n?n.added.map(function(e){return e.symbol}):[],o=n?n.removed.map(function(e){return e.symbol}):[];if(n)for(var s=0;s<n.changed.length;s++)a.push(n.changed[s].newValue.symbol),o.push(n.changed[s].oldValue.symbol);return i?(r.defaultSymbol&&o.push(r.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):r.defaultSymbol&&a.length&&o.push(t.defaultSymbol),this.applySymbolSetDiff(a,o,t,r),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,r){if(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&(!e||"partial"===e.type)){var i=e&&e.diff,n=i&&i.defaultSymbol,a=i&&i.uniqueValueInfos,o=void 0;return o=a?a.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):r.uniqueValueInfos.map(function(e,r){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[r].symbol.id}}),!n&&r.defaultSymbol&&o.push({oldId:r.defaultSymbol.id,newId:t.defaultSymbol.id}),o}return[]},t.prototype.updateUnchangedSymbolMappings=function(e,t,r){for(var i=0,n=this.calculateUnchangedSymbolMapping(e,t,r);i<n.length;i++){var a=n[i],o=a.oldId,s=a.newId;if(o&&o!==s){var l=this.graphicsBySymbol.get(o);this.graphicsBySymbol.delete(o),void 0!==l&&this.graphicsBySymbol.set(s,l);var u=this.symbols.get(o);this.symbols.delete(o),void 0!==u&&(this.symbols.set(s,u),u.symbol.id=s)}}},t.prototype.applyRendererDiff=function(e,t,r){var i=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)||f.everyMap(this.graphicsBySymbol,function(r,n){var a=i.symbols.get(n);if(a&&!a.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.layerPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.layerPropertyChanged("slicePlaneEnabled",t)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())},t.prototype.setClippingExtent=function(e,t){var r=this.symbolCreationContext.clippingExtent,i=C.create();return N.extentToBoundingRect(e,i,t)?this.symbolCreationContext.clippingExtent=[i[0],i[1],-1/0,i[2],i[3],1/0]:this.symbolCreationContext.clippingExtent=null,!c.equals(this.symbolCreationContext.clippingExtent,r)},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var r=!1;this.owner.loadedGraphics.forEach(function(i){var n=t.getGraphics3DGraphicById(i.uid);n&&e(n,i)&&(r=!0)}),r&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(r,i){var n=t.symbols.get(i);n&&e(n,r,i)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.forEachGraphics3DGraphic(function(t,r){var i=t.setVisibilityFlag(0,r.visible),n=!1;return e.scaleVisibility&&(n=e.scaleVisibility.updateGraphicScaleVisibility(t)),i||n})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1)})},t.prototype.validateRenderer=function(e){var t=O.validateTo3D(e);if(t){var r="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";X.warn(r,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=g(),this.labeling.reset()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0)){var t=!1;this.symbols.forEach(function(r,i){if(r&&!(r.referenced>0)){var n=e.graphicsBySymbol.get(i);n&&0!==n.size||(e.graphicsBySymbol.delete(i),e.symbols.delete(i),r&&r.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:c.keysOfMap(this.graphics).sort(),symbols:c.keysOfMap(this.symbols).sort(),graphicsBySymbol:c.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:c.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:c.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"debug",{get:function(){return{symbols:this.symbols}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}},t.tmpVec=w.vec3f64.create(),i([x.property({readOnly:!0})],t.prototype,"computedExtent",void 0),i([x.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),i([x.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),i([x.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),i([x.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([x.property({readOnly:!0})],t.prototype,"labeling",void 0),i([x.property({readOnly:!0})],t.prototype,"highlights",void 0),i([x.property()],t.prototype,"asyncUpdates",void 0),i([x.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),i([x.property({constructOnly:!0})],t.prototype,"owner",void 0),i([x.property({constructOnly:!0})],t.prototype,"layer",void 0),i([x.property({constructOnly:!0})],t.prototype,"basemapTerrain",void 0),i([x.property({readOnly:!0})],t.prototype,"hasDraped",void 0),i([x.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),i([x.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),i([x.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],t.prototype,"updating",null),i([x.property({readOnly:!0})],t.prototype,"updatingRemaining",null),i([x.property({readOnly:!0})],t.prototype,"updatingTotal",null),i([x.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),i([x.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),u=i([x.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(x.declared(u)),Q=new Map,Z=new y,K=new v(y),J=10;return Y}.apply(null,i))||(e.exports=n)},1919:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8),r(530)],void 0===(n=function(e,t,r,i){function n(e,t){if(!t)return null;var i;if((i=Array.isArray(t)?t:[t]).length>0){var n=i.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});n.sort();var a=[];return n.forEach(function(e,t){0!==t&&e===n[t-1]||a.push(e)}),new r("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:i})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return n(e,i.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):new r("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,i))||(e.exports=n)},1920:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(83),r(114),r(10),r(30),r(7),r(47)],void 0===(n=function(e,t,r,i,n,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){this.spatialReference=e,this.view=t,this.point=new a.Point,this.point.spatialReference=e}return e.prototype.getElevation=function(e,t,r){return this.point.x=e,this.point.y=t,this.view.elevationProvider.getElevation(this.point,r)},e.prototype.queryElevation=function(e,t,n,a){return i(this,void 0,void 0,function(){return r(this,function(r){return this.point.x=e,this.point.y=t,[2,this.view.elevationProvider.queryElevation(this.point,n,a)]})})},e}();t.ViewElevationProvider=l;var u=function(){function e(e,t,r){this.spatialReference=e,this._getElevationQueryProvider=t,this._queries=[],this._isScheduled=!1,this._queryOptions=n({},r,{ignoreInvisibleLayers:!0})}return e.prototype.queryElevation=function(e,t,n){return void 0===n&&(n=0),i(this,void 0,void 0,function(){var i=this;return r(this,function(r){return[2,o.create(function(r,a){i._queries.push({x:e,y:t,minDemResolution:n,result:{resolve:r,reject:a}}),i._scheduleDoQuery()})]})})},e.prototype._scheduleDoQuery=function(){var e=this;this._isScheduled||(s.schedule(function(){return e._doQuery()}),this._isScheduled=!0)},e.prototype._doQuery=function(){return i(this,void 0,void 0,function(){var e,t,i,o,s,l,u,c,h;return r(this,function(r){switch(r.label){case 0:if(this._isScheduled=!1,e=this._queries,this._queries=[],t=e.map(function(e){return[e.x,e.y]}),i=e.reduce(function(e,t){return Math.min(e,t.minDemResolution)},1/0),o=new a.Multipoint({points:t,spatialReference:this.spatialReference}),!(s=this._getElevationQueryProvider()))return e.forEach(function(e,t){return e.result.reject()}),[2];u=n({},this._queryOptions,{minDemResolution:i}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.queryElevation(o,u)];case 2:return l=r.sent(),[3,4];case 3:return c=r.sent(),e.forEach(function(e){return e.result.reject(c)}),[2];case 4:return h=l.geometry.points,e.forEach(function(e,t){return e.result.resolve(h[t][2])}),[2]}})})},e}();t.ElevationQuery=u}.apply(null,i))||(e.exports=n)},1921:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.sharedResources=null,this.streamDataSupplier=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1}}();t.Graphics3DSymbolCreationContext=r}.apply(null,i))||(e.exports=n)},1922:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1923),r(1659)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,n){var a;switch(e.type){case"point-3d":a=r;break;default:a=i}return new a(e,t,n)}}.apply(null,i))||(e.exports=n)},1923:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(1924),r(1659)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r,n){var a=e.call(this,t,r,n)||this;return a.calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=i.make(a.symbol,r)),a}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createGraphics3DGraphic=function(t,r,i){var n=e.prototype.createGraphics3DGraphic.call(this,t,i);if(this.calloutSymbolLayer){var a=this.createCalloutGraphic(t);a&&n.addAuxiliaryGraphic(a)}return n},t.prototype.layerPropertyChanged=function(t,r){var i=this;if(!e.prototype.layerPropertyChanged.call(this,t,r))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.layerPropertyChanged(t,r,function(e){for(var t=0,r=e._auxiliaryGraphics;t<r.length;t++){var n=r[t];if(n.graphics3DSymbolLayer===i.calloutSymbolLayer)return n}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo;return e.renderingInfo={renderer:t.renderer,symbol:t.symbol,needsOffsetAdjustment:t.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null},this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(n)}.apply(null,i))||(e.exports=n)},1924:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(264),r(1925)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=r.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");t.make=function(e,t){if(!i.isCalloutSupport(e))return a.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+e.type+"' does not support callouts"),null;if(!e.callout)return null;var r=o[e.callout.type];return r?new r(e,t):(a.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)};var o={line:n}}.apply(null,i))||(e.exports=n)},1925:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(25),r(27),r(1599),r(1585),r(1574),r(1584),r(1566),r(1605),r(1575),r(1570),r(1576),r(1559),r(1926)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,m){var g,v,y=f.VertexAttrConstants,b=function(e){function t(t,r){var i=e.call(this,t,null,r,!0)||this;return i._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},i}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(h.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype._prepareResources=function(){var e=this._getStageIdHint();this._createMaterialsAndAddToStage(this._context.stage,e),this.resolve()},t.prototype.perInstanceMaterialParameters=function(e){var t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t},Object.defineProperty(t.prototype,"materialParameters",{get:function(){var e=this.symbolContainer,t=e.callout,r=i.toUnitRGBA(t.color);r[3]*=this._getLayerOpacity();var a=n.pt2px(t.size||0),o=null;if(e.verticalOffset){var s=e.verticalOffset,l=s.screenLength,u=s.minWorldLength,c=s.maxWorldLength;o={screenLength:n.pt2px(l),minWorldLength:u||0,maxWorldLength:null!=c?c:1/0}}var h=t.border&&t.border.color?i.toUnitRGBA(t.border.color):null,d="object"===e.symbolLayers.getItemAt(0).type,p="label-3d"===e.type,f=!d,m=d?0:void 0,g=p;return{color:r,size:a,verticalOffset:o,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:h,occlusionTest:f,shaderPolygonOffset:m,depthHUDAlignStart:g,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0}),t.prototype._createMaterialsAndAddToStage=function(e,t){this._material=new m(this.materialParameters,t+"_lineCallout_common"),e.add(h.ModelContentType.MATERIAL,this._material)},t.prototype._defaultElevationInfoNoZ=function(){return S},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic;null!=t.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=t.needsOffsetAdjustment);var i=this.getGraphicElevationContext(r,t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&!n.symbolLayers.some(function(e){return"object"===e.type||"text"===e.type});if("label-3d"!==n.type&&a)return null;var o=u.computeCentroid(r.geometry);if(null==o)return null;var s="graphic"+r.uid;return this._createAs3DShape(r,o,i,t,s,r.uid)},t.prototype.layerOpacityChanged=function(){return this._material.setParameterValues(this.materialParameters),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var i=this,n=this._elevationContext.mode;return(r===n||"on-the-ground"!==r&&"on-the-ground"!==n)&&(e.forEach(function(e){var r=t(e);r&&i.updateGraphicElevationContext(e.graphic,r)}),!0)},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.getGraphicElevationContext=function(t,r){void 0===r&&(r=0);var i=e.prototype.getGraphicElevationContext.call(this,t);return i.addOffsetRenderUnits(r),i},t.prototype.updateGraphicElevationContext=function(e,t){var r=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(r),t.needsElevationUpdates=s.needsElevationUpdates2D(r.mode)},t.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:c.emptySymbolComplexity.memory}},t.prototype.createVertexData=function(e){var t,r=e.translation,i=e.centerOffset;if(!r&&!i)return _;var n=r?{size:3,data:[r[0],r[1],r[2]]}:_[y.POSITION],a=i?{size:4,data:[i[0],i[1],i[2],i[3]]}:_[y.AUXPOS1];return(t={})[y.POSITION]=n,t[y.NORMAL]=_[y.NORMAL],t[y.AUXPOS1]=a,t},t.prototype.getOrCreateMaterial=function(e,t){var r,i=this.perInstanceMaterialParameters(e),n=m.uniqueMaterialIdentifier(i);return n===this._material.uniqueMaterialIdentifier?{material:this._material,isUnique:!1}:e.materialCollection?((r=e.materialCollection.getMaterial(n))||(r=new m(i,t+"_lineCallout_shared"),e.materialCollection.addMaterial(n,r)),{material:r,isUnique:!1}):{material:r=new m(i,t+"_lineCallout_unique"),isUnique:!0}},t.prototype._createAs3DShape=function(e,t,r,i,n,l){var u=new p(this.createVertexData(i),w,p.DefaultOffsets,"point"),c=[new d(u,n)],h=this.getOrCreateMaterial(i,n),f=s.createStageObjectForPoint(this._context,t,c,[h.material],null,null,r,n,this._context.layer.uid,l,!0);if(null===f)return null;var m=a.perObjectElevationAligner,g=new o(this,f.object,c,h.isUnique?[h.material]:null,null,m,r);return g.metadata={elevationOffset:i.elevationOffset||0},g.alignedTerrainElevation=f.terrainElevation,g.needsElevationUpdates=s.needsElevationUpdates2D(r.mode),s.extendPointGraphicElevationContext(g,t,this._context.elevationProvider),g},t}(l),_=((g={})[y.POSITION]={size:3,data:[0,0,0]},g[y.NORMAL]={size:3,data:[0,0,1]},g[y.AUXPOS1]={size:4,data:[0,0,0,1]},g),x=new Uint32Array([0]),w=((v={})[y.POSITION]=x,v[y.NORMAL]=x,v[y.AUXPOS1]=x,v),S={mode:"relative-to-ground",offset:0};return b}.apply(null,i))||(e.exports=n)},1926:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(38),r(1590),r(1604),r(1591),r(1559),r(1595),r(1568),r(1927)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){function h(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}var d=function(e){function t(r,i){var n=e.call(this,i)||this;return n.bufferWriter=new v,n.params=u.copyParameters(r,f),n._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(n.params),n}return r(t,e),Object.defineProperty(t.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getGLMaterials=function(){return{color:p,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.intersect=function(e,t,r,i,n,a,o,s){},t.prototype.getParameterValues=function(){return u.copyParameters(this.params)},t.prototype.setParameterValues=function(e){u.updateParameters(this.params,e)&&(this._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))},t.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t}(o),p=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.isRenderSlot=!0,n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.renderProgram=this.programRep.getProgram(c.program,{occlTest:!!e.occlusionTest,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!e.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.depthProgram=this.programRep.getProgram(c.program,{occlTest:!!e.occlusionTest,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!e.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled})},t.prototype.beginSlot=function(e){switch(e){case 21:return this.isRenderSlot=!0,!0;case 22:return this.isRenderSlot=!1,!0}return!1},Object.defineProperty(t.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(){return this.program},t.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]},t.prototype.getDrawMode=function(){return 4},t.prototype.bind=function(e,t){var r=t.cameraAboveGround?1:-1,i=this.program,n=this.params;e.bindProgram(i),i.setUniform1f("cameraGroundRelative",r),i.setUniform1f("polygonOffset",n.shaderPolygonOffset),i.setUniform4fv("viewport",t.viewport),i.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.setUniform1i("hudVisibilityTexture",0),e.bindTexture(t.hudVisibilityTexture,0),h(i,"color",n.color);var a=t.pixelRatio||1;i.setUniform1f("pixelRatio",a),i.setUniform2f("screenOffset",n.screenOffset[0]*a,n.screenOffset[1]*a),this.bindBorder(e,t),u.bindVerticalOffset(n.verticalOffset,t,i),this.bindSizing(e,t),u.bindScreenSizePerspective(n.screenSizePerspective,t,i),this.isRenderSlot?this.bindRender(e,t):this.bindHUDDepth(e,t)},t.prototype.bindRender=function(e,t){e.setBlendFunctionSeparate(1,771,770,771),e.setBlendingEnabled(!0),e.setDepthWriteEnabled(!1)},t.prototype.bindHUDDepth=function(e,t){e.setColorMask(!1,!1,!1,!1),e.setDepthWriteEnabled(!0),e.setBlendingEnabled(!1),e.setDepthTestEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params;u.bindView(t.origin,t.view,r),u.bindCamPos(t.origin,t.viewInvTransp,r),i.slicePlaneEnabled&&u.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e,t){this.isRenderSlot?this.releaseRender(e,t):this.releaseHUDDepth(e,t)},t.prototype.releaseRender=function(e,t){e.setBlendingEnabled(!1),e.setBlendFunction(770,771),e.setDepthWriteEnabled(!0)},t.prototype.releaseHUDDepth=function(e,t){e.setColorMask(!0,!0,!0,!0)},t.prototype.bindSizing=function(e,t){var r=this.program,i=this.params;r.setUniform2f("pixelToNDC",2/t.viewport[2],2/t.viewport[3]);var n=t.pixelRatio||1;r.setUniform1f("lineSize",Math.ceil(i.size)*n)},t.prototype.bindBorder=function(e,t){var r=this.program,i=this.params,n=t.pixelRatio||1;null!==i.borderColor?(h(r,"borderColor",i.borderColor),r.setUniform1f("borderSize",n)):(r.setUniform4f("borderColor",0,0,0,0),r.setUniform1f("borderSize",0))},t}(a),f={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},m=n.newLayout().vec3f(s.VertexAttrConstants.POSITION).vec3f(s.VertexAttrConstants.NORMAL).vec2f(s.VertexAttrConstants.UV0).vec4f(s.VertexAttrConstants.AUXPOS1),g=[i.vec2f32.fromValues(0,0),i.vec2f32.fromValues(1,0),i.vec2f32.fromValues(0,1),i.vec2f32.fromValues(1,0),i.vec2f32.fromValues(1,1),i.vec2f32.fromValues(0,1)],v=function(){function e(){this.vertexBufferLayout=m}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[s.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){l.writePosition(t.indices[s.VertexAttrConstants.POSITION],t.vertexAttr[s.VertexAttrConstants.POSITION].data,e.transformation,i.position,n,6),l.writeNormal(t.indices[s.VertexAttrConstants.NORMAL],t.vertexAttr[s.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,i.normal,n,6),l.writeBufferVec4(t.indices[s.VertexAttrConstants.AUXPOS1],t.vertexAttr[s.VertexAttrConstants.AUXPOS1].data,i.auxpos1,n,6);for(var a=0;a<g.length;++a)i.uv0.setVec(n+a,g[a])},e}();return d}.apply(null,i))||(e.exports=n)},1927:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1561),r(1565),r(1573)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({OCCL_TEST:e.occlTest,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,DEPTH_HUD:e.depthHud,DEPTH_HUD_ALIGN_START:e.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})};t.program={name:"line-callout",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},1928:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(84),r(547)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var n=this;for(var a in this.owner=t,this.properties={},this.afterDispatchHandle=null,e){var o=e[a],s=new r(o,null,null,2,2);this.properties[a]={pool:s,acquired:[]}}this.afterDispatchHandle=i.afterDispatch(function(){return n.release()})}return e.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.owner=null},e.prototype.get=function(e){var t=this.owner._get(e),r=this.properties[e],i=r.pool.acquire();for(r.acquired.push(i);i===t;)r.acquired.push(i),i=r.pool.acquire();return i},e.prototype.release=function(){for(var e in this.properties){for(var t=this.properties[e],r=0,n=0,a=t.acquired;n<a.length;n++){var o=a[n];i.isValueInUse(o)?t.acquired[r++]=o:t.pool.release(o)}t.acquired.length=r}},e}();t.PropertiesPool=n,t.default=n}.apply(null,i))||(e.exports=n)},1929:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(261),r(1),r(72)],void 0===(n=function(e,t,r,i,n,a,o,s){var l=function(){function e(){this.extents=new a({allocator:function(e){return e||s.create()}}),this.tempExtent=s.create()}return Object.defineProperty(e.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){var e=0;return this.extents.forEach(function(t){return e+=s.area(t)}),e},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),s.set(this.extents.pushNew(),e))},e.prototype.pop=function(){return this.extents.pop()},e.prototype.forEach=function(e){this.extents.forEach(function(t){return e(t)})},e.prototype.mergeAll=function(){for(;this.extents.length>1;){var e=this.extents.length-1;s.expand(this.extents.data[e-1],this.extents.data[e]),this.extents.pop()}},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,r=!1;!r;){r=!0;for(var i=0;i<e.length;++i)if(function(r){for(var i=e.data[r],n=s.area(i),a=!1,o=e.length-1;o>r;--o){var l=e.data[o],u=s.area(l);s.expand(i,l,t);var c=n+u;(s.area(t)-c)/c<.05&&(s.set(i,t),n=s.area(i),e.swapElements(o,e.length-1),e.pop(),a=!0)}return a}(i)){r=!1;break}}},e.prototype.toArray=function(){return this.extents.toArray()},e.prototype.contains=function(e){return this.extents.some(function(t){return s.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)s.contains(e,this.extents.data[t])&&(this.extents.swapElements(t,this.extents.length-1),this.extents.pop())},e}();return function(e){function t(){var t=e.call(this)||this;return t.dirtyExtents=new l,t.globalDirty=!1,t.dirtyGraphicsQueue=new a({deallocator:null}),t.elevationUpdateEventHandle=null,t.eventHandles=[],t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.graphicsCore=r,this.elevationProvider=i,this.queryGraphicUIDsInExtent=t,this.elevationUpdateEventHandle=i.on("elevation-change",function(e){return n.elevationUpdateHandler(e)}),this.eventHandles.push(this.layerView.watch("suspended",function(){return n.suspendedChange()}))},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null),this.eventHandles.forEach(function(e){return e.remove()}),this.eventHandles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()},t.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()},t.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()},t.prototype.idleUpdate=function(e){var t=this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var r=this.layerView.view,i=this.graphicsCore.stageLayer.id,n=this.graphicsCore.labelsEnabled?r.labeler.labelStageLayerId:null,a=!1;this.hasPendingOperations()&&!e.done();){for(;this.dirtyGraphicsQueue.length>0&&!e.done();){for(var o=Math.min(this.dirtyGraphicsQueue.length,100),s=0;s<o;s++){var l=this.dirtyGraphicsQueue.pop(),u=this.graphicsCore.getGraphics3DGraphicById(l);u&&u.alignWithElevation(this.elevationProvider,r.renderCoordsHelper)}r._stage.processDirtyLayer(i),null!=n&&r._stage.processDirtyLayer(n)}for(;this.dirtyExtents.count>0&&this.dirtyGraphicsQueue.length<100&&!e.done();){a||(this.dirtyExtents.mergeTight(),a=!0);var c=this.dirtyExtents.pop();this.queryGraphicUIDsInExtent(c,this.spatialReference,function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsQueue.push(e)})}}r.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,r){return e.dirtyGraphicsQueue.push(r)}),this.notifyChange("updating")},t.prototype.hasPendingOperations=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.count>0||this.globalDirty},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},i([o.property({readOnly:!0})],t.prototype,"updating",null),i([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1930:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(13),r(14),r(1),r(518),r(1931)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){var c=-.3*l.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!0,t._frustumVisibilityDirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new a,t.layerView=null,t}return r(t,e),Object.defineProperty(t.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(e){e!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain;this.handles.add([r.on("resize",function(){return t.viewChange()}),r.state.watch("camera",function(){return t.viewChange()},!0),i.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(o.init(i,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!i.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.frustumVisibilityDirty=!0},t.prototype.viewChange=function(){this.frustumVisibilityDirty=!0},t.prototype.elevationBoundsChange=function(){this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.idleUpdate=function(e){e.done()||this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1)},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=c;else{var r=t.basemapTerrain.getElevationBounds(),i=r[0],n=r[1];e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},i([s.property({readOnly:!0})],t.prototype,"suspended",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1931:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(58),r(38),r(1563),r(72),r(518),r(1571),r(1932),r(92),r(93)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){Object.defineProperty(t,"__esModule",{value:!0});var h=.5*Math.PI,d=h/Math.PI*180,p=h*o.earthRadius,f=.9*o.earthRadius,m=function(){function e(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:i.vec3f64.create(),direction:i.vec3f64.create()};for(var t=0;t<4;t++)this.extent[t]={origin:i.vec3f64.create(),direction:i.vec3f64.create(),cap:{next:null,direction:i.vec3f64.create()}},this.planes[t]=s.plane.create();this.planes[4]=s.plane.create(),this.planes[5]=s.plane.create(),this.planesWithoutFar=this.planes.slice(0,5)}return e.prototype.update=function(e,t,r,n){void 0===n&&(n=!0);var a=this.extent;this.toRenderBoundingExtent(e,t,r),i.vec3.add(this.center.origin,a[0].origin,a[2].origin),i.vec3.scale(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),n||i.vec3.scale(this.center.direction,this.center.direction,-1);for(var o=0;o<4;o++){var l=a[o];this.renderCoordsHelper.worldUpAtPosition(l.origin,l.direction);var c=a[3===o?0:o+1];l.cap.next=c.origin,u.directionFromTo(l.cap.direction,l.origin,c.origin),s.plane.fromVectorsAndPoint(l.direction,l.cap.direction,l.origin,this.planes[o]),n||i.vec3.scale(l.direction,l.direction,-1)}s.plane.fromVectorsAndPoint(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[4]),n?s.plane.negate(this.planes[4],this.planes[5]):(s.plane.copy(this.planes[4],this.planes[5]),s.plane.negate(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t},e.prototype.isVisibleInFrustum=function(e,t){if(void 0===t&&(t=!1),"global"===this.renderCoordsHelper.type){var r=this.maxSpanSpatialReference.isWGS84?d:p;if(this.maxSpan>r)return!0;if(e.altitude>=f)return this.isVisibleInFrustumGlobal(e)}for(var i=0;i<this.extent.length;i++){var n=this.extent[i];if(!t&&e.intersectsRay(s.ray.wrap(n.origin,n.direction)))return!0;if(e.intersectsLineSegment(s.lineSegment.fromPoints(n.origin,n.cap.next,x),n.cap.direction))return!0}var a=t?this.planes:this.planesWithoutFar;for(i=0;i<e.lines.length;i++){var o=e.lines[i];if(l.frustumLineSegment(a,o.origin,o.endpoint,o.direction))return!0}return!1},e.prototype.toRenderBoundingExtentGlobal=function(e,t,r){a.center(e,v),v[2]=r,c.computeLinearTransformation(t,v,y,this.renderCoordsHelper.spatialReference),i.mat4.invert(b,y),n.empty(_);for(var o=0,s=g;o<s.length;o++)for(var l=s[o],h=l.x0,d=l.x1,p=l.y0,f=l.y1,m=0;m<5;m++){var x=m/4;v[0]=u.lerp(e[h],e[d],x),v[1]=u.lerp(e[p],e[f],x),v[2]=r,c.vectorToVector(v,t,v,this.renderCoordsHelper.spatialReference),i.vec3.transformMat4(v,v,b),n.expandPointInPlace(_,v)}i.vec3.set(this.extent[0].origin,_[0],_[1],_[2]),i.vec3.set(this.extent[1].origin,_[3],_[1],_[2]),i.vec3.set(this.extent[2].origin,_[3],_[4],_[2]),i.vec3.set(this.extent[3].origin,_[0],_[4],_[2]);for(m=0;m<4;++m)i.vec3.transformMat4(this.extent[m].origin,this.extent[m].origin,y)},e.prototype.toRenderBoundingExtentLocal=function(e,t,r){i.vec3.set(this.extent[0].origin,e[0],e[1],r),i.vec3.set(this.extent[1].origin,e[2],e[1],r),i.vec3.set(this.extent[2].origin,e[2],e[3],r),i.vec3.set(this.extent[3].origin,e[0],e[3],r)},e.prototype.toRenderBoundingExtent=function(e,t,i){switch(this.renderCoordsHelper.type){case"global":this.toRenderBoundingExtentGlobal(e,t,i);break;case"local":this.toRenderBoundingExtentLocal(e,t,i);break;default:r.neverReached(this.renderCoordsHelper.type)}},e.prototype.isVisibleInFrustumGlobal=function(e){if(i.vec3.dot(this.center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this.extent[t];if(i.vec3.dot(r.direction,e.direction)<0)return!0}return!1},e}();t.FrustumExtentIntersection=m;var g=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v=i.vec3f64.create(),y=i.mat4f64.create(),b=i.mat4f64.create(),_=n.create(),x=s.lineSegment.create();t.default=m}.apply(null,i))||(e.exports=n)},1932:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(38)],void 0===(n=function(e,t,r){function i(e,t,i,n){var a=s;return e?(i&&n&&(a.len=r.vec3.distance(t,i)),r.vec3.copy(a.dir,e)):n?(a.len=r.vec3.distance(t,i),r.vec3.subtract(a.dir,i,t),r.vec3.scale(a.dir,a.dir,1/a.len)):(r.vec3.subtract(a.dir,i,t),r.vec3.normalize(a.dir,a.dir)),a}function n(e,t){return-r.vec3.dot(t,e)-e[3]}function a(e,t,i){var a=r.vec3.dot(e,i.dir),o=n(e,t);if(o<0&&a>=0)return!1;if(a>-1e-6&&a<1e-6)return o>0;if((o<0||a<0)&&!(o<0&&a<0))return!0;var s=o/a;return a>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function o(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(var n=0;n<e.length;n++)if(!a(e[n],t,i))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var i=t[0],n=t[1],a=t[2];return!(e[0][0]*i+e[0][1]*n+e[0][2]*a+e[0][3]>r||e[1][0]*i+e[1][1]*n+e[1][2]*a+e[1][3]>r||e[2][0]*i+e[2][1]*n+e[2][2]*a+e[2][3]>r||e[3][0]*i+e[3][1]*n+e[3][2]*a+e[3][3]>r||e[4][0]*i+e[4][1]*n+e[4][2]*a+e[4][3]>r||e[5][0]*i+e[5][1]*n+e[5][2]*a+e[5][3]>r)},t.frustumRay=function(e,t,r,n){return o(e,t,null,i(n,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(n(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,n){return o(e,t,r,i(n,t,r,!0))},t.closestPointOnRay=function(e,t,i,n){var a=r.vec3.dot(t,r.vec3.subtract(n,i,e));return r.vec3.add(n,e,r.vec3.scale(n,t,a)),n};var s={dir:r.vec3f64.create(),len:0,clip:r.vec2f64.create()}}.apply(null,i))||(e.exports=n)},1933:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1934)],void 0===(n=function(e,t,r){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var i=this,n=new r(e,t);return this.highlights.push(n),{set:n,handle:{remove:function(){return i.releaseSet(n)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var r=this.graphicsCore.graphics3DGraphics,i=0,n=t;i<n.length;i++){var a=n[i];e.ids.add(a);var o=r.get(a);o&&o.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){var r=this.graphicsCore.graphics3DGraphics;t.forEach(function(t){return e.ids.add(t)}),r.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)})},e.prototype.graphicCreated=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.graphicDeleted=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,i))||(e.exports=n)},1934:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1799)],void 0===(n=function(e,t,r){return function(){function e(e,t){this.highlightSet=new r,this.ids=new Set,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,i))||(e.exports=n)},1935:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(1)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return r(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i,n){this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=r,this.graphicsCore=i,this.basemapTerrain=n,this.updateScaleRangeActive()},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.idleUpdate=function(e){this.layerView.view.basemapTerrain&&(e.done()||this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1))},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,r=!1;t.labelingInfo&&(r=r||t.labelingInfo.some(function(e){return e&&o(e.minScale,e.maxScale)})),r=r||o(t.minScale,t.maxScale);var i=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!r&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),i},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtScale=function(e,t,r){return null==e||e>r&&(!t||e<t)},t.prototype.visibleAtLayerScale=function(e){return this.visibleAtScale(e,this.layer.minScale,this.layer.maxScale)},t.prototype.visibleAtLabelScale=function(e,t){return this.visibleAtScale(e,t.minScale,t.maxScale)},t.prototype.graphicScale=function(e){var t;return e.centroid?t=e.centroid:"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateGraphicScaleVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),r=this.updateLabelScaleVisibility(e,t);return r&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),r},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var r=e._labelGraphics[0]._labelClass;if(r&&null!=r.minScale&&null!=r.maxScale){var i=this.visibleAtLabelScale(t,r);if(e.setVisibilityFlag(1,i,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var r=e.extent,i=e.scale,n=this.visibleAtLayerScale(i),a=!1;this.queryGraphicUIDsInExtent(r,e.spatialReference,function(e){var o=t.graphicsCore.getGraphics3DGraphicById(e);if(o){var s=o.centroid;if(s&&(r[0]>s.x||r[1]>s.y||r[2]<s.x||r[3]<s.y))return;var l=!1;o.setVisibilityFlag(1,n)&&(l=!0),t.updateLabelScaleVisibility(o,i)&&(l=!0),l&&(a=!0)}}),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(1,void 0)})),this.layerScaleRangeVisibilityDirty=!0},i([a.property({readOnly:!0})],t.prototype,"suspended",void 0),i([a.property({readOnly:!0})],t.prototype,"updating",null),i([a.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(a.declared(n))}.apply(null,i))||(e.exports=n)},1936:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(4),r(19),r(261),r(1),r(1890)],void 0===(n=function(e,t,r,i,n,a,o,s,l){var u=function(e){function t(t){var r=e.call(this)||this;return r.index=new l.default(9,a("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),r.spatialReference=null,r}return r(t,e),t.prototype.destroy=function(){this.index.clear(),this.index=null},t.prototype.queryGraphicUIDsInExtent=function(e,t,r){t.equals(this.spatialReference)&&(h.minX=e[0],h.minY=e[1],h.maxX=e[2],h.maxY=e[3],this.index.search(h,function(e){r(e.graphic.uid)}))},t.prototype.add=function(e){!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(this.index.insert(e),e.addedToSpatialIndex=!0)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length),c.clear();for(var r=0;r<t;r++){var i=e[r];!i.addedToSpatialIndex&&i.computeExtent(this.spatialReference)&&(c.push(i),i.addedToSpatialIndex=!0)}this.index.load(c.data,c.length)},t.prototype.remove=function(e){e.addedToSpatialIndex&&(e.addedToSpatialIndex=!1,this.index.remove(e))},t.prototype.removeMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.remove(i)}},t.prototype.clear=function(){this.index.clear()},i([s.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),i([s.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],t)}(s.declared(n)),c=new o,h={minX:0,minY:0,maxX:0,maxY:0};return u}.apply(null,i))||(e.exports=n)},2008:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(8),r(7),r(1593),r(119)],void 0===(n=function(e,t,r,i,n,a){return function(){function e(e,t,r){this._layer=e,this._support=t,this._options=r}return e.prototype.queryExtent=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0,i=t._support.createExtentBuilder();return t._forAllQueried(e,function(e){r++,i.add(e)}),{count:r,extent:0===r?null:i.getExtent()}})},e.prototype.queryFeatureCount=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0;return t._forAllQueried(e,function(){return r++}),r})},e.prototype.queryFeatures=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var n=[],a=e&&e.outFields,o=[];return t._forAllQueried(e,function(e){return o.push(t._support.createGraphic(e))},function(e){a&&(n.push(t._support.requestFields(e,o,a)),o=[])})>0&&!e.num?i.reject(new r("Unsupported Query","Large feature query, use Query.num and Query.start to batch")):(a||n.push(i.resolve(o)),i.all(n))}).then(function(e){for(var r=[],i=0;i<e.length;++i)for(var o=e[i],s=0;s<o.length;++s)r.push(n.hydrateGraphic(o[s],t._layer));var l=new a;return l.features=r,l})},e.prototype.queryObjectIds=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=[];return t._forAllQueried(e,function(e){return r.push(e.id)}),r})},e.defaultExtentBuilder=function(e){var t=null;return{add:function(r){var i=e(r);i&&(t=null!=t?t.union(i):i.clone())},getExtent:function(){return t}}},e.prototype._forAllQueried=function(e,t,r){var i=[];if(e&&e.objectIds){var n=e.objectIds;i.push(function(e){return n.indexOf(e.id)>=0})}var a=e&&e.start||0,o=e&&e.num||1e4;return i.push(function(){return o<=0?(--o,!1):a>0?(--a,!1):(--o,!0)}),this._support.forAll(function(e){for(var r=0,n=i;r<n.length;r++)if(!(0,n[r])(e))return;t(e)},r),Math.max(0,-o)},e.prototype._rejectUnsupported=function(e){if(null==e)return i.resolve();var t=function(e){return i.reject(new r("Unsupported Query","Unsupported property '"+e+"'"))};return null!=e.distance?t("distance"):null!=e.geometryPrecision?t("geometryPrecision"):e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length?t("groupByFieldsForStatistics"):null!=e.maxAllowableOffset?t("maxAllowableOffset"):e.multipatchOption?t("multipatchOption"):e.orderByFields&&e.orderByFields.length?t("orderByFields"):e.outSpatialReference?t("outSpatialReference"):e.outStatistics&&e.outStatistics.length?t("outStatistics"):e.pixelSize?t("pixelSize"):e.quantizationParameters?t("quantizationParameters"):e.relationParameter?t("relationParameter"):e.returnDistinctValues?t("returnDistinctValues"):e.text?t("text"):e.timeExtent?t("timeExtent"):e.where?t("where"):e.geometry?t("geometry"):!this._options.enableOutFields&&e.outFields&&e.outFields.length?t("outFields"):!this._options.enableObjectId&&e.objectIds&&e.objectIds.length?t("objectIds"):i.resolve()},e}()}.apply(null,i))||(e.exports=n)},2009:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(0),r(8),r(7),r(1),r(1832),r(1643),r(1835),r(1833)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validateFetchPopupFeatures=function(){var e=this.layer,t=e.popupEnabled,r=e.popupTemplate;return t?r?void 0:new n("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:e}):new n("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:e})},t.prototype.fetchPopupFeatures=function(e,t){var r=this._validateFetchPopupFeatures();if(r)return a.reject(r);if(e&&this.hasDraped&&this.loadedGraphics&&(t=u.queryDrapedGraphics({view:this.view,loadedGraphics:this.loadedGraphics,layer:this.layer,popupTemplate:this.layer.popupTemplate,area:e,clientGraphics:t})),!t||0===t.length)return a.resolve([]);for(var i=[],n=[],o=c.getRequiredFields(this.layer),l=0,h=t;l<h.length;l++){var d=h[l];s.hasRequiredFields(d,o)?i.push(d):n.push(d)}return 0===n.length?a.resolve(i):this.whenGraphicAttributes(n,o).catch(function(){return n}).then(function(e){return i.concat(e)})},i([o.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(o.declared(l));t.PopupSceneLayerView=h,t.default=h}.apply(null,i))||(e.exports=n)},2451:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(261),r(1656)],void 0===(n=function(e,t,r,i,n){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.array=new i,t}return r(t,e),t.prototype.clear=function(){this.array.length>0&&this.emit("change",{added:[],removed:this.toArray()}),this.array.clear()},Object.defineProperty(t.prototype,"length",{get:function(){return this.array.length},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(e){return this.array.data[e]},t.prototype.push=function(e){var t=this.array.push(e);return this.emit("change",{added:[e],removed:[]}),t},t.prototype.addMany=function(e){var t=this.array.pushArray(e);return this.emit("change",{added:e,removed:[]}),t},t.prototype.pushNew=function(){var e=this.array.pushNew();return this.emit("change",{added:[e],removed:[]}),e},t.prototype.pop=function(){var e=this.array.pop();return void 0!==e&&this.emit("change",{added:[],removed:[e]}),e},t.prototype.removeMany=function(e){var t=this.array.removeMany(e);return t.length>0&&this.emit("change",{added:[],removed:t}),t},t.prototype.removeUnordered=function(e){var t=this.array.removeUnordered(e);return void 0!==t&&this.emit("change",{added:[],removed:[t]}),t},t.prototype.removeUnorderedMany=function(e){var t=this.array.removeUnorderedMany(e);return t.length>0&&this.emit("change",{added:[],removed:t}),t},t.prototype.toArray=function(){return this.array.toArray()},t.prototype.some=function(e,t){return this.array.some(e,t)},t.prototype.find=function(e,t){return this.array.find(e,t)},t.prototype.filter=function(e,r,i){return i=i||new t,this.array.filter(e,r,i.array),i},t.prototype.forEach=function(e,t){this.array.forEach(e,t)},t.prototype.map=function(e,t){return this.array.map(e,t)},t}(n.Evented)}.apply(null,i))||(e.exports=n)}}]);