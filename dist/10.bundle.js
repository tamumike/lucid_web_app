(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/sql/WhereClause":1752,"esri/core/sql/AggregateFunctions":1753,"esri/core/sql/StandardizedFunctions":1754,"esri/layers/graphics/data/FeatureStore":1861,"esri/layers/graphics/data/attributeSupport":1862,"esri/layers/graphics/data/QueryEngine":1884,"esri/layers/graphics/data/utils":1909,"esri/layers/graphics/data/QueryEngineResult":1990,"esri/layers/graphics/data/AttributesBuilder":1991,"esri/layers/graphics/data/spatialQuerySupport":1992})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1752:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(190),r(1628),r(269),r(1753),r(1754),r(1746)],void 0===(a=function(e,t,r,n,a,i,s,u){function o(e){return a(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function l(e){return a(e,["YYYY-M-D"]).toDate()}function c(e){return!0===e}function h(e){return Array.isArray(e)?e:[e]}function f(e){return null!==e?!0!==e:null}function p(e,t){if(null==e)return null;for(var r=!1,n=0,a=t;n<a.length;n++){var i=a[n];if(null==i)r=null;else if(e===i){r=!0;break}}return r}function d(e,t,r){if(null==e)return null;for(var n=t,a=r,i="",s="-[]/{}()*+?.\\^$|",u=0,o=0;o<n.length;o++){var l=n.charAt(o);switch(u){case 0:l===a?u=1:s.indexOf(l)>=0?i+="\\"+l:i+="%"===l?".*":"_"===l?".":l;break;case 1:s.indexOf(l)>=0?i+="\\"+l:i+=l,u=0}}return new RegExp("^"+i+"$").test(e)}function m(e){return e instanceof Date?e.valueOf():e}function y(e){for(var t=[],r={},n=0,a=e;n<a.length;n++){var i=a[n],s=i.toLowerCase();void 0===r[s]&&(t.push(i),r[s]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null,this._hasStandardizedFunctions=null,this._hasAggregateFunctions=null}return e.create=function(t){var r=new e;r.parseTree=u.WhereGrammar.parse(t);var n=!0,a=!0;return r.visitAll(r.parseTree,function(e){if("function"===e.type){var t=e.name,r=e.args.value.length;n&&(n=s.isStandardized(t,r)),a&&(a=i.isAggregate(t,r))}}),r._hasStandardizedFunctions=n,r._hasAggregateFunctions=a,r},e.prototype.isStandardized=function(){return this._hasStandardizedFunctions},e.prototype.isAggregate=function(){return this._hasAggregateFunctions},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testSet=function(e){var t=this,r=new n.default;this.visitAll(this.parseTree,function(e){"column_ref"!==e.type||r.has(e.column)||r.set(e.column,e)});for(var a={},i=0,s=e;i<s.length;i++){!function(e){r.forEach(function(r,n){var i=t.featureValue(e,n,r);a[n]?a[n].push(i):a[n]=[i]})}(s[i])}return!!this.evaluateNode(this.parseTree,{attributes:a})},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),y(e)},e.prototype.getExpressions=function(){var e=new n.default;return this.visitAll(this.parseTree,function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var a=n.column,i=r+"-"+a;e.has(i)||e.set(i,{aggregateType:r,field:a})}}}),r.from(e.values())},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),y(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),y(e)},e.prototype.featureValue=function(e,t,r){var n=function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e,a=n[t];if(void 0!==a)return a;for(var i in n)if(t.toLowerCase()===i.toLowerCase())return r.column=i,n[i];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var a=n[r];this.visitAll(a,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var i=0,s=e.value;i<s.length;i++){a=s[i];this.visitAll(a,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=m(this.evaluateNode(e.operand,t)),n=0;n<e.clauses.length;n++)if(r===m(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(n=0;n<e.clauses.length;n++)if(c(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var a=[],u=0,y=e.value;u<y.length;u++){var v=y[u];a.push(this.evaluateNode(v,t))}return a;case"unary_expr":return f(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return function(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return function(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var g=h(this.evaluateNode(e.right,t));return p(this.evaluateNode(e.left,t),g);case"NOT IN":g=h(this.evaluateNode(e.right,t));return f(p(this.evaluateNode(e.left,t),g));case"BETWEEN":var x=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==x||null==_[0]||null==_[1]?null:x>=_[0]&&x<=_[1];case"NOTBETWEEN":x=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==x||null==_[0]||null==_[1]?null:x<_[0]||x>_[1];case"LIKE":return d(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return f(d(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return function(e,t,r){if(null==t||null==r)return null;var n=m(t),a=m(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return l(e.value);case"timestamp":return o(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((v=new Date).setHours(0,0,0,0),v):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var b=this.evaluateNode(e.args,t);return this.isAggregate()?i.aggregateFunction(e.name,b):s.evaluateFunction(e.name,b)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,n))||(e.exports=a)},1753:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function n(e){for(var t=r(e),n=e.length,a=0,i=0,s=e;i<s.length;i++){var u=s[i];a+=Math.pow(u-t,2)}return n>1?a/(n-1):0}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var r=a[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isAggregate=function(e,t){var r=a[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var a={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:r(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(n(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}}}}.apply(null,n))||(e.exports=a)},1754:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(187)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",a=t?e[2]:e[1];if(null==n||null==a)return null;var i="("+r.escapeString(n)+")";switch(e[0]){case"BOTH":return a.replace(new RegExp("^"+i+"*|"+i+"*$","g"),"");case"LEADING":return a.replace(new RegExp("^"+i+"*","g"),"");case"TRAILING":return a.replace(new RegExp(i+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=a)},1861:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1628),r(8),r(19),r(9),r(1749),r(72),r(521)],void 0===(a=function(e,t,r,n,a,i,s,u,o){Object.defineProperty(t,"__esModule",{value:!0});var l=[],c=i.getLogger("esri.layers.graphics.data.FeatureStore"),h={minX:0,minY:0,maxX:0,maxY:0},f=function(){function e(e){this._featuresById=new r.default,this._boundsByFeature=new r.default,this._featuresByBounds=new r.default,this._index=s(9,a("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._geometryInfo=e}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=u.create(u.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.setEngine=function(e){this._engine=e},e.prototype.add=function(e){this._add(e,l),this._index.load(l),this._clearCache(),l.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._add(n,l)}this._index.load(l),this._clearCache(),l.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._clearCache()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],a=this._featuresById.get(n);if(a){var i=this._boundsByFeature.get(a);i&&(this._index.remove(i),this._featuresByBounds.delete(i)),this._boundsByFeature.delete(a)}this._featuresById.delete(n)}this._clearCache()},e.prototype.forEachBounds=function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r],i=this._boundsByFeature.get(a);i&&t(i,a)}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.hasFeature=function(e){return this._featuresById.has(e)},e.prototype.forEachFeature=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachFeatureInBounds=function(e,t){for(var r=0,n=function(e,t){return h.minX=t[0],h.minY=t[1],h.maxX=t[2],h.maxY=t[3],e.search(h)}(this._index,e);r<n.length;r++){var a=n[r];t(this._featuresByBounds.get(a))}},e.prototype.transferIds=function(e,t){for(var r=[],n=0,a=t;n<a.length;n++){var i=a[n],s=this._featuresById.get(i);s&&(this._remove(s),r.push(s))}e.addMany(r),this._clearCache()},e.prototype.transferIdRange=function(e,t,r){for(var n=[],a=t;a<r;a++){var i=this._featuresById.get(a);i&&(this._remove(i),n.push(i))}e.addMany(n),this._clearCache()},e.prototype.transferIf=function(e,t){var r=this,n=[];this._featuresById.forEach(function(e,a){t(e)&&(r._remove(e),n.push(e))}),e.addMany(n),this._clearCache()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,n){t._remove(e),r.push(e)}),e.addMany(r),this._clearCache()},e.prototype._clearCache=function(){this._engine&&this._engine.clearCache()},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void c.error(new n("featurestore:invalid-feature","feature id is missing",{feature:e}));var a,i=this._featuresById.get(r);if(i&&(a=this._boundsByFeature.get(i))&&(this._index.remove(a),this._boundsByFeature.delete(i),this._featuresByBounds.delete(a)),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);a=o.getBoundsOptimizedGeometry(a||u.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,a),this._featuresByBounds.set(a,e),this._featuresById.set(r,e),t.push(a)}},e.prototype._remove=function(e){var t;e&&((t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=f}.apply(null,n))||(e.exports=a)},1862:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(514),r(8),r(549),r(1752)],void 0===(a=function(e,t,r,n,a,i){function s(e){if(!e)return null;var r=t.invalidClauseCache.get(e);if(void 0!==r)return r;var n,a=t.whereClausesCache.get(e);return void 0!==a?a:(n=i.create(e),t.whereClausesCache.put(e,n),n)}function u(e,t,r,a){void 0===a&&(a=!0);for(var i=[],c=0,h=t;c<h.length;c++){var f=h[c];if("*"!==f&&!e.has(f))if(a){var p=o(f);try{var d=s(p);if(!d.isStandardized())throw new n(l,"expression is not standard",{clause:d});u(e,d.getFields(),"expression contains missing fields")}catch(e){var m=e&&e.details;if(m&&m.clause)throw e;m&&m.missingFields?Array.prototype.push.apply(i,m.missingFields):i.push(f)}}else i.push(f)}if(i.length)throw new n(l,r,{missingFields:i})}function o(e){return e.split(c)[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.invalidClauseCache=new a(500),t.whereClausesCache=new a(50);var l="feature-store:unsupported-query",c=" as ",h=new r.default(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);t.validateWhere=function(e,r){if(!r)return!0;var a;try{a=i.create(r),t.whereClausesCache.put(r,a)}catch(e){throw t.invalidClauseCache.put(r,null),new n(l,"invalid SQL expression",{where:r})}if(!a.isStandardized())throw new n(l,"where clause is not standard",{where:r});return u(e,a.getFields(),"where clause contains missing fields"),!0},t.validateHaving=function(e,r,a){if(!r)return!0;var s;try{s=i.create(r),t.whereClausesCache.put(r,s)}catch(e){throw t.invalidClauseCache.put(r,null),new n(l,"invalid SQL expression",{having:r})}if(!s.isAggregate())throw new n(l,"having does not contain a valid aggregate function",{having:r});var o=s.getFields();if(u(e,o,"having contains missing fields"),!s.getExpressions().every(function(t){var r=t.aggregateType,n=t.field,i=e.has(n)&&e.get(n).name;return a.some(function(t){var n=t.onStatisticField,a=t.statisticType,s=n.toLowerCase().trim();return(e.has(s)&&e.get(s).name)===i&&a.toLowerCase().trim()===r})}))throw new n(l,"expressions in having should also exist in outStatistics",{having:r});return!0},t.getWhereClause=s,t.validateFields=u,t.getExpressionFromFieldName=o,t.getAliasFromFieldName=function(e){return e.split(c)[1]},t.hasInvalidFieldType=function(e,t){var r=!1;if(-1!==s(e).getFields().indexOf(e)){var n=t.get(e);r=!h.has(n.type)}return r}}.apply(null,n))||(e.exports=a)},1884:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(10),r(1628),r(514),r(30),r(8),r(9),r(270),r(7),r(1894),r(72),r(142),r(67),r(66),r(1862),r(1747),r(556),r(1990),r(1992),r(1909),r(52)],void 0===(a=function(e,t,r,n,a,i,s,u,o,l,c,h,f,p,d,m,y,v,g,x,_,b){function I(e){return e?JSON.parse(JSON.stringify(e,["latestWkid","wkid","wkt"])):e}function F(e,t,r,n,a,i,s,u){s&&!i?n.forEachFeatureInBounds(a,function(t){var n=_.getCentroid(r,t,u),a=t.attributes;n&&e.push(new S(a,null,n))}):i&&!s?n.forEachFeatureInBounds(a,function(n){var a=n.attributes,i=_.getGeometry(r,n,0,u);i&&(t.add(n.objectId),e.push(new S(a,i)))}):n.forEachFeatureInBounds(a,function(n){var a=n.attributes,i=_.getGeometry(r,n,0,u),s=_.getCentroid(r,n,u);i&&s&&(t.add(n.objectId),e.push(new S(a,i,s)))})}Object.defineProperty(t,"__esModule",{value:!0});var w=u.getLogger("esri.layers.graphics.data.QueryEngine"),S=function(){return function(e,t,r){this.attributes=e,this.geometry=t,this.centroid=r}}(),P={},M=new a.default,N=new o.Storage(2e6),C=0,T=function(){function e(e){var t=this;this.capabilities={query:v.queryCapabilities},this.fieldsMap=new n.default,this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.cacheSpatialQueries=e.cacheSpatialQueries||!1,this.gdbVersion=e.gdbVersion,this.historicMoment=e.historicMoment,this.spatialIndex=e.spatialIndex,this.spatialIndex.setEngine(this),this.timeInfo=e.timeInfo,this.cacheSpatialQueries&&(this._geometryQueryCache=new o(C+++"$$",N)),e.fields.forEach(function(e){t.fieldsMap.set(e.name.trim(),e),t.fieldsMap.set(e.name.trim().toLowerCase(),e)})}return e.prototype.destroy=function(){this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this.fieldsMap.clear()},Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.spatialIndex.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:I(this.spatialReference)}:null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null},e.prototype.executeQuery=function(e){var t=this;void 0===e&&(e=new b);var r=e.clone();return this._normalizeQuery(r).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return e.executeAttributesQuery(r)}).catch(function(e){if(e===P)return new g.default([],t);throw e}).then(function(e){return e.createQueryResponse(r)})},e.prototype.executeQueryForCount=function(e){var t=this;void 0===e&&(e=new b);var r=e.clone();return r.returnGeometry=!1,r.returnCentroid=!1,r.outSpatialReference=null,this._normalizeQuery(r).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return e.size}).catch(function(e){if(e===P)return 0;throw e})},e.prototype.executeQueryForExtent=function(e){var t=this;void 0===e&&(e=new b);var r=e.clone(),n=r.outSpatialReference;return this._normalizeQuery(r).then(function(e){return t._checkQuerySupport(e)}).then(function(){return r.returnGeometry=!0,r.returnCentroid=!1,r.outSpatialReference=null,r}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){var r=e.size;if(!r)return{count:r,extent:null};var a={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:I(t.spatialReference)};t.spatialIndex.forEachBounds(e.items,function(e){a.xmin=Math.min(e[0],a.xmin),a.ymin=Math.min(e[1],a.ymin),a.xmax=Math.max(e[2],a.xmax),a.ymax=Math.max(e[3],a.ymax)});var i=y.project(a,e.spatialReference,n);if(i.spatialReference=I(n&&n.toJSON()||t.spatialReference),i.xmax-i.xmin==0){var s=p.getMetersPerUnitForSR(i.spatialReference);i.xmin-=s,i.xmax+=s}if(i.ymax-i.ymin==0){s=p.getMetersPerUnitForSR(i.spatialReference);i.ymin-=s,i.ymax+=s}return{count:r,extent:i}}).catch(function(e){if(e===P)return{count:0,extent:null};throw e})},e.prototype.executeQueryForIds=function(e){var t=this;void 0===e&&(e=new b);var r=e.clone();return r.returnGeometry=!1,r.returnCentroid=!1,r.outSpatialReference=null,this._normalizeQuery(r).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){for(var t=e.items,r=[],n=0;n<t.length;n++)r[n]=t[n].objectId;return r}).catch(function(e){if(e===P)return[];throw e})},e.prototype.executeTileQuery=function(e,t){var r=this,n=t.returnGeometry,i=t.returnCentroid,s=t.pixelBuffer,u=new a.default,o=[],l=s*e.resolution,c=h.pad(e.bounds,l,h.create());if(F(o,u,this,this.spatialIndex,c,n,i,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),"esriGeometryPoint"===this.geometryType||i){var f=d.getInfo(this.spatialReference);if(f){var p=f.valid,m=p[0],y=p[1];if(c[0]<m){var v=h.fromValues(y-l,c[1],y,c[3]);F(o,u,this,this.spatialIndex,v,n,i,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[y,e.bounds[3]]})}if(c[2]>y){var g=h.fromValues(m,c[1],m+l,c[3]);F(o,u,this,this.spatialIndex,g,n,i,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[m-y+e.bounds[0],e.bounds[3]]})}}}return o.sort(function(e,t){return e.attributes[r.objectIdField]-t.attributes[r.objectIdField]}),{features:o,objectIds:u}},e.prototype.executeTileQueryForIds=function(e,t){var r=t.pixelBuffer*e.resolution,n=h.pad(e.bounds,r,h.create()),a=[];return this.spatialIndex.forEachFeatureInBounds(n,function(e){return a.push(e.objectId)}),a},e.prototype.executeQueryForLatestObservations=function(e){var t=this;return this.timeInfo?this.executeQuery(e).then(function(e){return t._filterLatest(e,t.timeInfo)}):void w.error(new s("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))},e.prototype._filterLatest=function(e,t){for(var a=t.trackIdField,i=t.startTimeField,s=t.endTimeField||i,u=new n.default,o=[],l=0,c=e.features;l<c.length;l++){var h=c[l],f=h.attributes[a],p=h.attributes[s];(!u.has(f)||u.get(f).attributes[s]<p)&&u.set(f,h)}return u.forEach(function(e){return o.push(e)}),r({},e,{features:o})},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.spatialIndex.forEachFeature(function(t){return e.push(t)}),this._allItems=new g.default(e,this)}return this._allItems},e.prototype._normalizeQuery=function(e){var t=this,r=this.definitionExpression,n=e.where,a=e.geometry,i=e.outFields,s=e.orderByFields,u=e.groupByFieldsForStatistics,o=e.outStatistics;if(e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||r&&r===n)&&(e.where=null),i)for(var c=0;c<i.length;c++)i[c]=i[c].trim();if(s)for(c=0;c<s.length;c++)s[c]=s[c].trim();if(u)for(c=0;c<u.length;c++)u[c]=u[c].trim();if(o)for(c=0;c<o.length;c++)o[c].onStatisticField&&(o[c].onStatisticField=o[c].onStatisticField.trim());return a?(e.outSpatialReference||(e.outSpatialReference=a.spatialReference),this._getInputGeometry(e).then(function(t){return e.geometry=t}).then(function(e){return y.checkProjectionSupport(e.spatialReference,t.spatialReference)}).then(function(){return f.normalizeCentralMeridian(e.geometry)}).then(function(e){return y.project(e[0].toJSON(),e[0].spatialReference,t.spatialReference)}).then(function(r){if(!r)throw P;return r.spatialReference=t.spatialReference,e.read({geometry:r})})):l.resolve(e)},e.prototype._executeGeometryQuery=function(e){var t=this,r=e.geometry,n=e.outSpatialReference,a=e.spatialRelationship,i=d.isValid(n)&&!d.equals(this.spatialReference,n),s=i?JSON.stringify({geometry:r,spatialRelationship:a,outSpatialReference:n}):JSON.stringify({geometry:r,spatialRelationship:a});if(this.cacheSpatialQueries){var u=this._geometryQueryCache.get(s);if(void 0!==u)return l.resolve(u)}var o=null;if(r){var c=this._searchSpatialIndex(this._getQueryBBoxes(r));if(!c.length){var h=new g.default([],this);return this.cacheSpatialQueries&&this._geometryQueryCache.put(s,h,h.size||1),l.resolve(h)}o="envelope-intersects"===e.spatialRelationship||"esriGeometryPoint"===this.geometryType&&x.canQueryWithRBush(r)?l.resolve(new g.default(c,this)):x.getSpatialQueryOperator(a,r,this.geometryType).then(function(e){if(e){var r=c.filter(function(r){return e(_.getGeometry(t,r))});return new g.default(r,t)}})}else o=l.resolve(this._getAll());return o.then(function(r){return i&&(e.returnGeometry||e.returnCentroid)?r.project(n).then(function(e){return t.cacheSpatialQueries&&t._geometryQueryCache.put(s,e,e.size||1),e}):(t.cacheSpatialQueries&&t._geometryQueryCache.put(s,r,r.size||1),r)})},e.prototype._getInputGeometry=function(e){var t=e.geometry,r=e.distance,n=e.units;if(null==r)return l.resolve(t);var a=t.spatialReference,s=n||p.getUnitString(a);return(a&&(a.isGeographic||a.isWebMercator)?l.resolve(t):y.checkProjectionSupport(a,i.SpatialReference.WGS84).then(function(){return c.project(t,i.SpatialReference.WGS84)})).then(function(e){return x.getGeodesicBufferOperator().then(function(t){return t(e,r,s)})})},e.prototype._getQueryBBoxes=function(e){if("point"===e.type)return[h.fromValues(e.x,e.y,e.x,e.y)];var t=x.canQueryWithRBush(e)?e:e.extent;switch(t.type){case"extent":return[h.fromExtent(t)];case"polygon":return t.rings.map(function(e){return h.fromValues(e[0][0],e[0][1],e[2][0],e[2][1])})}},e.prototype._searchSpatialIndex=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var a=n[r];this.spatialIndex.forEachFeatureInBounds(a,function(e){M.has(e)||(t.push(e),M.add(e))})}return M.clear(),t},e.prototype._checkQuerySupport=function(e){return e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParameter||e.text||e.timeExtent?l.reject(new s("feature-store:unsupported-query","Unsupported query options",{query:e})):l.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),x.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),y.checkProjectionSupport(this.spatialReference,e.outSpatialReference)]).then(function(){return e})},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues;if(r&&r.length>0){var a=r.map(function(e){return e.indexOf(" ASC")>-1?e.split(" ASC")[0]:e.indexOf(" DESC")>-1?e.split(" DESC")[0]:e});m.validateFields(this.fieldsMap,a,"orderByFields contains missing fields")}if(t&&t.length>0)m.validateFields(this.fieldsMap,t,"outFields contains missing fields");else if(n)throw new s("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});m.validateWhere(this.fieldsMap,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,a=r&&r.length,i=t&&t.length;if(n){if(!a||!i)return l.reject(new s("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e}));m.validateHaving(this.fieldsMap,n,t)}if(i){if(t.some(function(e){return"exceedslimit"===e.statisticType}))return;var u=t.map(function(e){return e.onStatisticField});m.validateFields(this.fieldsMap,u,"onStatisticFields contains missing fields"),a&&m.validateFields(this.fieldsMap,r,"groupByFieldsForStatistics contains missing fields");for(var o=0,c=t;o<c.length;o++){var h=c[o],f=h.onStatisticField,p=h.statisticType;if("exceedslimit"===p)return l.reject(new s("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:h,query:e}));if((!a||"count"!==p)&&f&&m.hasInvalidFieldType(f,this.fieldsMap))return l.reject(new s("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e}))}}},e}();t.default=T}.apply(null,n))||(e.exports=a)},1909:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(521),r(274)],void 0===(a=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var a=new n.default,i=new n.default,s={esriGeometryPoint:r.convertToPoint,esriGeometryPolyline:r.convertToPolyline,esriGeometryPolygon:r.convertToPolygon,esriGeometryMultipoint:r.convertToMultipoint};t.getCentroid=function(e,t,a){if("esriGeometryPolygon"!==e.geometryType)return null;if(!t.centroid&&!t.geometry)return null;if(t.centroid||(t.centroid=r.getCentroidOptimizedGeometry(new n.default,t.geometry,e.hasZ,e.hasM)),a){var s=r.quantizeOptimizedGeometry(i,t.centroid,e.hasZ,e.hasM,"esriGeometryPoint",a);return r.convertToPoint(s,e.hasZ,e.hasM)}return r.convertToPoint(t.centroid,e.hasZ,e.hasM)},t.getGeometry=function(e,t,n,u){if(!t.geometry)return null;if(n){var o=r.generalizeOptimizedGeometry(a,t.geometry,e.hasZ,e.hasM,e.geometryType,n);return u?(o=r.quantizeOptimizedGeometry(i,o,e.hasZ,e.hasM,e.geometryType,u),s[e.geometryType](o,e.hasZ,e.hasM)):s[e.geometryType](o,e.hasZ,e.hasM)}if(u)return o=r.quantizeOptimizedGeometry(i,t.geometry,e.hasZ,e.hasM,e.geometryType,u),s[e.geometryType](o,e.hasZ,e.hasM);return s[e.geometryType](t.geometry,e.hasZ,e.hasM)}}.apply(null,n))||(e.exports=a)},1990:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(514),r(7),r(1620),r(66),r(521),r(1991),r(1862),r(1747),r(1909)],void 0===(a=function(e,t,r,n,a,i,s,u,o,l,c){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e,t){this.items=e,this.definitionExpression=t.definitionExpression,this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.fieldsMap=t.fieldsMap}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){return e.outStatistics?e.outStatistics.some(function(e){return"exceedslimit"===e.statisticType})?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e)},e.prototype.executeAttributesQuery=function(e){var t=o.getWhereClause(e.where);if(!t)return n.resolve(this);if(t.isStandardized()){for(var r=0,a=[],i=0,s=this.items;i<s.length;i++){var u=s[i];t.testFeature(u.attributes)&&(a[r++]=u)}var l=this._createNew(a);return l.definitionExpression=e.where,n.resolve(l)}return n.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(e){if(!e.objectIds||!e.objectIds.length)return n.resolve(this);var t=new r.default(e.objectIds);return n.resolve(this._createNew(this.items.filter(function(e){return t.has(e.objectId)})))},e.prototype.project=function(t){var r=this;return!t||i.equals(this.spatialReference,t)?n.resolve(this):l.projectMany(this.items.map(function(e){return c.getGeometry(r,e)}),this.spatialReference,t).then(function(n){for(var a=[],i=0;i<r.items.length;i++)a[i]={attributes:r.items[i].attributes,geometry:n[i]};var u=[];return s.convertFromFeatures(u,a,r.geometryType,r.hasZ,r.hasM,r.objectIdField),new e(u,{definitionExpression:r.definitionExpression,geometryType:r.geometryType,hasM:r.hasM,hasZ:r.hasZ,objectIdField:r.objectIdField,spatialReference:t,fieldsMap:r.fieldsMap})})},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,n=this,i=n.geometryType,s=n.hasM,u=n.hasZ,o=n.objectIdField,l=n.spatialReference,c=e.outFields,h=e.outSpatialReference,f=e.quantizationParameters,p=!1;if(null!=e.num&&null!=e.start){var d=e.start+e.num;p=r.length>d,r=r.slice(e.start,Math.min(r.length,d))}return{exceededTransferLimit:p,features:this._createFeatures(e,r),fields:c&&c.map(function(e){return t.fieldsMap.get(e)}),geometryType:i,hasM:s,hasZ:u,objectIdFieldName:o,spatialReference:function(e){return e?JSON.parse(JSON.stringify(e,["latestWkid","wkid","wkt"])):e}(h?h.toJSON():l),transform:f&&a.toTransform(f)}},e.prototype._createFeatures=function(e,t){var r=new u.default(e,this.fieldsMap),n=e.quantizationParameters,i=e.returnGeometry,s=e.returnCentroid,o=e.maxAllowableOffset,l=e.orderByFields,h=[],f=0;if(t.length&&l&&l.length){var p=l[0].split(" "),d=p[0],m="DESC"===p[1];t.sort(function(e,t){var n=r.getFieldValue(e,d),a=r.getFieldValue(t,d);if("number"==typeof n&&"number"==typeof a)return m?a-n:n-a;if("string"==typeof n&&"string"==typeof a){var i=n.toUpperCase(),s=a.toUpperCase();return(m?i>s:i<s)?-1:(m?i<s:i>s)?1:0}})}if(i||s){var y=a.toTransform(n);if(i&&!s)for(var v=0,g=t;v<g.length;v++){var x=g[v];h[f++]={attributes:r.getAttributes(x),geometry:c.getGeometry(this,x,o,y)}}else if(!i&&s)for(var _=0,b=t;_<b.length;_++){x=b[_];h[f++]={attributes:r.getAttributes(x),centroid:c.getCentroid(this,x,y)}}else for(var I=0,F=t;I<F.length;I++){x=F[I];h[f++]={attributes:r.getAttributes(x),centroid:c.getCentroid(this,x,y),geometry:c.getGeometry(this,x,o,y)}}}else for(var w=0,S=t;w<S.length;w++){x=S[w];var P=r.getAttributes(x);P&&(h[f++]={attributes:P})}return h},e.prototype._createNew=function(t){return new e(t,this)},e.prototype._createExceedsLimitQueryResponse=function(e){var t=!1,r=null;e.outStatistics.some(function(e){return r=e,"exceedslimit"===e.statisticType});var n=null!=r.maxPointCount?r.maxPointCount:Number.POSITIVE_INFINITY,a=null!=r.maxRecordCount?r.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=r.maxVertexCount?r.maxVertexCount:Number.POSITIVE_INFINITY;if("esriGeometryPoint"===this.geometryType)t=this.items.length>n;else if(this.items.length>a)t=!0;else{var s=this.hasZ?this.hasM?4:3:this.hasM?3:2;t=this.items.reduce(function(e,t){return e+(t.geometry&&t.geometry.coords.length||0)},0)/s>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new u.default(e,this.fieldsMap),r=e.outStatistics,n=[],a=[],i=e.groupByFieldsForStatistics,s=e.having,o=i&&i.length,l=o&&i[0],c={},h={},f={},p={attributes:{}},d=0,m=r;d<m.length;d++){var y=m[d],v=y.onStatisticField,g=y.outStatisticFieldName,x=y.statisticType,_="1"===v;if(o&&(v===l||_)&&"count"===x){c[v]||(c[v]=this._calculateUniqueValues(t,_?l:v));var b=c[v];for(var I in b){var F=b[I],w=F.count,S=F.data,P=F.items,M=h[S]||{attributes:{}};s&&!t.validateItems(P,s)||(M.attributes[g]=w,M.attributes[_?"EXPR_1":v]=S,h[S]=M)}a.push({name:g,alias:g,type:"esriFieldTypeString"})}else{if(o){var N=this._calculateUniqueValues(t,l);for(var I in N){var C=N[I];S=C.data,P=C.items;if(!s||t.validateItems(P,s)){M=h[S]||{attributes:{}};var T=this._calculateStatistics(P,t,v),E="var"===x?"variance":x;M.attributes[g]=T[E],M.attributes[l]=S,h[S]=M}}}else{f[v]||(f[v]=this._calculateStatistics(this.items,t,v));T=f[v],E="var"===x?"variance":x;p.attributes[g]=T[E]}a.push({name:g,alias:g,type:"esriFieldTypeDouble"})}}if(o)for(var R in h)n.push(h[R]);else n.push(p);return{fields:a,features:n}},e.prototype._calculateStatistics=function(e,t,r){for(var n=e.length,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=null,u=null,o=null,l=null,c=[],h=0;h<n;h++){var f=e[h],p=c[h]=t.getFieldValue(f,r);isNaN(p)||(s+=p,a=Math.min(a,p),i=Math.max(i,p))}if(n){u=s/n;for(var d=0,m=0,y=c;m<y.length;m++){p=y[m];d+=Math.pow(p-u,2)}l=n>1?d/(n-1):0,o=Math.sqrt(l)}else a=null,i=null;return{avg:u,count:n,max:i,min:a,stddev:o,sum:s,variance:l}},e.prototype._calculateUniqueValues=function(e,t){for(var r={},n=0,a=this.items;n<a.length;n++){var i=a[n],s=e.getFieldValue(i,t);(null==s||"string"==typeof s&&""===s.trim())&&(s=null),null==r[s]?r[s]={count:1,data:s,items:[i]}:(r[s].count++,r[s].items.push(i))}return r},e}();t.default=h}.apply(null,n))||(e.exports=a)},1991:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1628),r(1862)],void 0===(a=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this._fieldDataCache=new r.default,this._returnDistinctMap=new r.default,this.returnDistinctValues=e.returnDistinctValues,this.fieldsMap=t;var a=e.outFields;if(a&&-1===a.indexOf("*")){this.outFields=a;for(var i=0,s=0,u=a;s<u.length;s++){var o=u[s],l=n.getExpressionFromFieldName(o),c=this.fieldsMap.has(l),h=c?null:n.getWhereClause(l),f=c?this.fieldsMap.get(o).name:n.getAliasFromFieldName(o)||"FIELD_EXP_"+i++;this._fieldDataCache.set(o,{alias:f,clause:h})}}}return e.prototype.getAttributes=function(e){var t=e.attributes;return t=this._processAttributesForOutFields(t),this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t){var r=e.attributes,a=this.fieldsMap.has(t),i=a?this.fieldsMap.get(t).name:t,s=null;return this._fieldDataCache.has(i)?s=this._fieldDataCache.get(i).clause:a||(s=n.getWhereClause(t),this._fieldDataCache.set(i,{alias:i,clause:s})),a?r[i]:s.calculateValue(r)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t)}),this._fieldDataCache.get(t).clause.testFeature(e.attributes)},e.prototype.validateItems=function(e,t){var r=this;this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t)});var a=e.map(function(e){return r.getAttributes(e)});return this._fieldDataCache.get(t).clause.testSet(a)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!e||!t||!t.length)return e;for(var r={},n=0,a=t;n<a.length;n++){var i=a[n],s=this._fieldDataCache.get(i),u=s.alias,o=s.clause;r[u]=o?o.calculateValue(e):e[u]}return r},e.prototype._processAttributesForDistinctValues=function(e){if(!e||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var n=0,a=t;n<a.length;n++){var i=a[n],s=this._fieldDataCache.get(i).alias;r.push(e[s])}else for(var s in e)r.push(e[s]);var u=(t||["*"]).join(",")+"="+r.join(","),o=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++o),o>1?null:e},e}();t.default=a}.apply(null,n))||(e.exports=a)},1992:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(8),r(7),r(99),r(284),r(66),r(1747)],void 0===(a=function(e,t,n,a,i,s,u,o){function l(){return a.create(function(e){return Promise.resolve().then(function(){var t=[r(279)];e.apply(null,t)}.bind(this)).catch(r.oe)})}Object.defineProperty(t,"__esModule",{value:!0});var c="feature-store:unsupported-query",h={spatialRelationship:{intersects:!0,contains:!0,within:!0,crosses:!0,touches:!0,overlaps:!0,"envelope-intersects":!0},queryGeometry:{point:!0,multipoint:!0,polyline:!0,polygon:!0,extent:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0}};t.importGeometryEngine=l,t.getGeodesicBufferOperator=function(){return l().then(function(e){return e.geodesicBuffer})},t.getSpatialQueryOperator=function(e,t,r){if("intersects"===e){if("polygon"===t.type&&"esriGeometryPoint"===r)return a.resolve(i.polygonContainsPoint.bind(null,t.toJSON()));if("extent"===t.type)return a.resolve(s.getExtentIntersector(r).bind(null,t))}return l().then(function(r){return r[e].bind(null,t.toJSON())})},t.checkSpatialQuerySupport=function(e,t,r){var i=e.spatialRelationship,s=e.geometry;return s?function(e){return!0===h.spatialRelationship[e]}(i)?u.isValid(s.spatialReference)&&u.isValid(r)?function(e){return!0===h.queryGeometry[e]}(s.type)?function(e){return!0===h.layerGeometry[e]}(t)?o.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSpatialReference):a.reject(new n(c,"Unsupported layer geometry type",{query:e})):a.reject(new n(c,"Unsupported query geometry type",{query:e})):a.resolve():a.reject(new n(c,"Unsupported query spatial relationship",{query:e})):null},t.canQueryWithRBush=function(e){switch(e.type){case"extent":return!0;case"polygon":return e.rings.every(function(e){return 5===e.length&&e[0][0]===e[1][0]&&e[0][0]===e[4][0]&&e[2][0]===e[3][0]&&e[0][1]===e[3][1]&&e[0][1]===e[4][1]&&e[1][1]===e[2][1]});default:return!1}}}.apply(null,n))||(e.exports=a)}}]);