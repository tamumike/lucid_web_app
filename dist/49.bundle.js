(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/webgl-engine/lib/RenderSlot":1491,"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":1492,"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":1494,"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":1498,"esri/views/3d/webgl-engine/lib/ShaderVariations":1499,"esri/views/3d/layers/graphics/graphicUtils":1501,"esri/views/3d/webgl-engine/lib/Material":1502,"esri/views/3d/webgl-engine/lib/glUtil3D":1503,"esri/views/3d/webgl-engine/lib/IdGen":1504,"esri/views/3d/webgl-engine/lib/GLMaterial":1505,"esri/views/3d/webgl-engine/lib/ModelContentType":1506,"esri/views/3d/webgl-engine/lib/RenderPass":1507,"esri/views/layers/LayerView":1509,"esri/views/3d/webgl-engine/Stage":1511,"esri/views/3d/support/debugFlags":1512,"esri/views/3d/webgl-engine/lighting/Lightsources":1514,"esri/views/3d/webgl-engine/materials/DefaultMaterial":1515,"esri/views/3d/webgl-engine/lib/Camera":1517,"esri/views/3d/webgl-engine/lib/Geometry":1518,"esri/core/PooledArray":1519,"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":1520,"esri/views/3d/webgl-engine/lib/Object3D":1521,"esri/views/3d/support/imageUtils":1522,"esri/views/3d/webgl-engine/lib/depthRange":1523,"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":1525,"esri/views/3d/webgl-engine/materials/HUDMaterial":1526,"esri/views/3d/webgl-engine/lib/GeometryData":1527,"esri/core/iteratorUtils":1529,"esri/views/3d/webgl-engine/lib/HighlightUtils":1530,"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":1531,"esri/views/3d/webgl-engine/lib/RenderGeometry":1532,"esri/views/3d/layers/LayerView3D":1534,"esri/views/3d/layers/graphics/ElevationAligners":1536,"esri/views/3d/webgl-engine/lib/PerformanceTimer":1537,"esri/views/3d/webgl-engine/parts/Model":1538,"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":1539,"esri/views/3d/webgl-engine/lib/Renderer":1540,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":1541,"esri/views/3d/webgl-engine/lib/localOriginHelper":1542,"esri/views/3d/webgl-engine/lib/GLMaterialTexture":1543,"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":1544,"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":1545,"esri/views/3d/webgl-engine/lib/HighlightHelper":1546,"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":1547,"esri/views/3d/webgl-engine/lib/SSAOHelper":1548,"esri/views/3d/webgl-engine/lib/Texture":1549,"esri/views/3d/layers/graphics/featureExpressionInfoUtils":1550,"esri/views/3d/webgl-engine/lib/Selector":1553,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":1554,"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":1555,"esri/views/3d/webgl-engine/materials/ColorMaterial":1556,"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":1557,"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":1558,"esri/views/3d/support/intersectionUtils":1559,"esri/views/3d/webgl-engine/lib/GeometryUtil":1560,"esri/views/3d/webgl-engine/lib/Performance":1563,"esri/core/HeapSort":1565,"esri/symbols/support/unitConversionUtils":1566,"esri/views/3d/webgl-engine/lib/GeometryRecord":1567,"esri/views/3d/webgl-engine/lib/ModelDirtySet":1568,"esri/views/3d/webgl-engine/parts/View":1569,"dojo/text!esri/views/3d/webgl-engine/materials/internal/occluded.xml":1570,"esri/views/3d/webgl-engine/lib/DrapedRenderer":1571,"esri/views/3d/webgl-engine/lib/RenderContext":1572,"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":1573,"esri/views/3d/webgl-engine/lib/Float32ArrayList":1574,"esri/views/3d/webgl-engine/lib/FxaaRenderPass":1575,"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":1576,"esri/views/3d/webgl-engine/lib/InstanceBufferData":1577,"esri/views/3d/webgl-engine/lib/IntervalUtilities":1578,"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":1579,"esri/views/3d/webgl-engine/lib/NormalTextureHelper":1580,"esri/views/3d/webgl-engine/lib/SmaaRenderPass":1581,"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":1582,"esri/views/3d/support/buffer/bufferViewUtil":1583,"esri/views/3d/webgl-engine/lib/LocalOriginManager":1584,"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":1585,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":1586,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":1587,"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":1588,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":1589,"dojo/text!esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRendererUtils.xml":1590,"dojo/text!esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer.xml":1591,"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":1592,"esri/views/3d/webgl-engine/lib/edgeRendering/util":1593,"esri/views/3d/webgl-engine/lighting/SceneLighting":1594,"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":1595,"esri/views/3d/webgl-engine/lib/LongVectorMath":1596,"dojo/text!esri/views/3d/webgl-engine/materials/HUDMaterial.xml":1597,"esri/views/webgl/Profiling":1598,"dojo/text!esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":1599,"esri/views/3d/webgl-engine/lib/GLMaterialRep":1600,"esri/views/3d/webgl-engine/lib/GLTextureRep":1601,"dojo/text!esri/views/3d/webgl-engine/materials/internal/highlight.xml":1602,"dojo/text!esri/views/3d/webgl-engine/materials/internal/offscreen.xml":1603,"esri/views/3d/webgl-engine/lib/RenderTargetHelper":1604,"esri/views/3d/webgl-engine/lib/ProgramRepository":1605,"esri/views/3d/webgl-engine/lib/ShaderSnippets":1606,"dojo/text!esri/views/3d/webgl-engine/materials/internal/ssao.xml":1607,"esri/views/3d/webgl-engine/lib/tracer":1608,"esri/views/3d/webgl-engine/lib/webgl-debug":1609,"esri/views/3d/webgl-engine/materials/repository":1610,"dojo/text!esri/views/3d/webgl-engine/materials/internal/hud.xml":1611,"dojo/text!esri/views/3d/webgl-engine/materials/internal/util.xml":1612,"esri/views/3d/webgl-engine/materials/CheckerBoardMaterial":1613,"dojo/text!esri/views/3d/webgl-engine/materials/CheckerBoardMaterial.xml":1614,"dojo/text!esri/views/3d/webgl-engine/materials/ColorMaterial.xml":1615,"dojo/text!esri/views/3d/webgl-engine/materials/DefaultMaterial.xml":1616,"dojo/text!esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":1617,"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":1618,"dojo/text!esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":1619,"dojo/text!esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":1620,"esri/views/3d/webgl-engine/materials/internal/BlendLayers":1621,"dojo/text!esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":1622,"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":1623,"dojo/text!esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":1624,"esri/views/3d/webgl-engine/parts/Viewport":1625,"esri/views/3d/webgl-engine/parts/Visualizer":1626,"esri/core/TimeProfiler":1627,"esri/views/3d/webgl-engine/lib/depthRangeUtils":1628,"esri/views/3d/webgl-engine/lib/ShadowMap":1629,"esri/views/3d/webgl-engine/lib/DDSUtil":1630,"esri/views/3d/layers/support/symbolColorUtils":1643,"esri/views/3d/layers/support/edgeUtils":1644,"esri/views/3d/webgl-engine/lib/Octree":1645,"esri/views/3d/layers/support/FastSymbolUpdates":1650,"esri/renderers/support/renderingInfoUtils":1651,"esri/views/3d/support/PromiseLightweight":1652,"esri/views/3d/support/Evented":1653,"esri/views/3d/webgl-engine/lib/BoundingInfo":1670,"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":1671,"esri/views/3d/webgl-engine/lib/Layer":1672,"esri/views/3d/webgl-engine/lib/HighlightSet":1673,"esri/views/3d/layers/support/attributeUtils":1674,"esri/views/3d/layers/graphics/ElevationContext":1683,"esri/views/3d/layers/support/projectExtentUtils":1688,"esri/views/3d/layers/graphics/constants":1696,"esri/views/3d/layers/graphics/Graphics3DGraphic":1697,"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":1698,"esri/views/3d/layers/graphics/Graphics3DSymbol":1699,"esri/views/3d/webgl-engine/materials/NativeLineMaterial":1700,"esri/views/3d/layers/graphics/lineUtils":1701,"esri/views/3d/layers/graphics/objectResourceUtils":1702,"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":1703,"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":1704,"esri/core/libs/quickselect/quickselect":1710,"esri/core/asyncUtils":1729,"esri/core/libs/rbush/PooledRBush":1730,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1746,"esri/views/3d/layers/graphics/Graphics3DCore":1747,"esri/renderers/support/rendererConversion":1748,"esri/views/3d/layers/graphics/ElevationQuery":1749,"esri/views/3d/layers/graphics/Graphics3DOwner":1750,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1751,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1752,"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":1753,"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":1754,"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":1755,"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":1756,"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":1757,"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":1758,"esri/symbols/support/symbolUtils":1759,"esri/views/3d/layers/graphics/SignedDistanceFunctions":1760,"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":1761,"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":1762,"esri/core/Version":1763,"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayerLod":1764,"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":1765,"esri/views/3d/layers/graphics/lodResourceUtils":1766,"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":1767,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":1768,"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":1769,"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":1770,"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":1771,"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":1772,"esri/views/3d/webgl-engine/lib/lodRendering/utils":1773,"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":1774,"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":1775,"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":1776,"esri/views/3d/webgl-engine/lib/TextTexture":1777,"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":1778,"esri/views/3d/support/PropertiesPool":1779,"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":1780,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1781,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1782,"esri/views/3d/support/FrustumExtentIntersection":1783,"esri/views/3d/layers/graphics/Graphics3DHighlights":1784,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1785,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1786,"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":1787,"esri/views/3d/layers/FeatureLikeLayerView3D":1842,"esri/views/3d/layers/graphics/stats":1843,"esri/views/layers/StreamLayerView":1878,"esri/views/3d/layers/StreamLayerView3D":2310})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{1491:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){var n;return function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL",e[e.STENCIL_MATERIAL=2]="STENCIL_MATERIAL",e[e.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL",e[e.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL",e[e.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL",e[e.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT",e[e.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE",e[e.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT",e[e.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL",e[e.HUDMATERIAL1=14]="HUDMATERIAL1",e[e.HUDMATERIAL2=15]="HUDMATERIAL2",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.MAX_SLOTS=18]="MAX_SLOTS"}(n||(n={})),n}.apply(null,r))||(e.exports=i)},1492:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,r))||(e.exports=i)},1494:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(473),n(1500),n(1555),n(1488),n(1544),n(1487),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l){function c(e,t,n,r,i,a){if(void 0===i||3!==a)for(var o=0;o<a;++o)n[r+o]=e[t+o];else!function(e,t,n,r,i){var a=e[t],o=e[t+1],s=e[t+2];n[r]=i[0]*a+i[4]*o+i[8]*s+i[12],n[r+1]=i[1]*a+i[5]*o+i[9]*s+i[13],n[r+2]=i[2]*a+i[6]*o+i[10]*s+i[14]}(e,t,n,r,i);return a}function d(e,t,n,r,i,a){for(var o=e.length,s=0;s<o;++s){var l=3*e[s],c=t[l],d=t[l+1],u=t[l+2];r[i]=n[0]*c+n[4]*d+n[8]*u+n[12],r[i+1]=n[1]*c+n[5]*d+n[9]*u+n[13],r[i+2]=n[2]*c+n[6]*d+n[10]*u+n[14],i+=a}}function u(e,t,n,r,i,a){for(var o=e.length,s=0;s<o;++s){for(var l=n*e[s],c=0;c<n;++c)r[i+c]=t[l+c];i+=a}}function p(e,t,n,r,i,a){var o=new Uint8Array(r);i*=4,a*=4;var s=e.length;if(4===n)for(var l=0;l<s;++l){var c=4*e[l];o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],o[i+3]=t[c+3],i+=a}else if(3===n)for(l=0;l<s;++l){c=3*e[l];o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],o[i+3]=255,i+=a}}function h(e,t,n,r,i,a,o){var s=new Uint8Array(i);a*=4,o*=4;var l=e.length;if(4===r)for(var c=0;c<l;++c){var d=4*e[c];s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=t[d+3]*n[3],a+=o}else if(3===r){var u=255*n[3];for(c=0;c<l;++c){d=3*e[c];s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=u,a+=o}}}function f(e,t,n,r,i,a){var o=new Uint16Array(r);i*=2,a*=2;for(var s=e.length,l=0;l<s;++l){for(var c=n*e[l],d=0;d<n;++d)o[i+d]=t[c+d];i+=a}}function v(e,t,r,i,a){var o=b(t,r,O);if(n.setMin(A,e.getBBMin()),n.setMax(A,e.getBBMax()),_(A,t,o,i)){var s=e.getPrimitiveIndices(),l=e.getIndices(),c=e.getPosition(),d=s?s.length:l.length/3;if(d>L){var u=e.getChildren();if(void 0!==u){for(var p=0;p<8;++p)void 0!==u[p]&&v(u[p],t,r,i,a);return}}m(t,r,0,d,l,c,s,a)}}function g(e,t,i,a,o,s){var l=b(i,a,O),c=e.getBoundingInfo();if(n.setMin(A,c.getBBMin()),n.setMax(A,c.getBBMax()),_(A,i,l,o))for(var d=e.data,u=e.getComponentCount(),p=d.getIndices(C.POSITION),h=d.getAttribute(C.POSITION),f=d.componentOffsets,v=0;v<u;v++)if(!t||r.getVisibility(t,v)){if(_(e.getComponentAABB(v,A),i,l,o))m(i,a,f[v]/3,f[v+1]/3,p,h,void 0,s)}}function m(e,t,n,r,i,a,o,s){for(var l=a.data,c=a.offsetIdx,d=a.strideIdx,u=e[0],p=e[1],h=e[2],f=t[0]-u,v=t[1]-p,g=t[2]-h,m=n;m<r;m++){var b=o?o[m]:m,_=c+d*i[3*b],x=c+d*i[3*b+1],S=c+d*i[3*b+2],w=l[_],A=l[_+1],C=l[_+2],O=l[x]-w,P=l[x+1]-A,T=l[x+2]-C,D=l[S]-w,I=l[S+1]-A,M=l[S+2]-C,L=v*M-I*g,V=g*D-M*f,F=f*I-D*v,z=O*L+P*V+T*F,U=u-w,N=p-A,B=h-C,j=N*T-P*B,G=B*O-T*U,H=U*P-O*N;if(z>R){if((k=U*L+N*V+B*F)<0||k>z)continue;if((W=f*j+v*G+g*H)<0||k+W>z)continue}else{if(!(z<-R))continue;var k,W;if((k=U*L+N*V+B*F)>0||k<z)continue;if((W=f*j+v*G+g*H)>0||k+W<z)continue}var q=(D*j+I*G+M*H)/z;q>=0&&s(q,y(O,P,T,D,I,M,E),b)}}function y(e,t,n,r,i,o,s){return a.vec3d.set3(e,t,n,P),a.vec3d.set3(r,i,o,T),a.vec3d.normalize(a.vec3d.cross(P,T,s))}function b(e,t,n){return a.vec3d.set3(1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]),n)}function _(e,t,n,r){var i=(e[0]-r-t[0])*n[0],a=(e[3]+r-t[0])*n[0],o=Math.min(i,a),s=Math.max(i,a),l=(e[1]-r-t[1])*n[1],c=(e[4]+r-t[1])*n[1];if((o=Math.max(o,Math.min(l,c)))>(s=Math.min(s,Math.max(l,c))))return!1;var d=(e[2]-r-t[2])*n[2],u=(e[5]+r-t[2])*n[2];return(o=Math.max(o,Math.min(d,u)))<=(s=Math.min(s,Math.max(d,u)))}function x(e,t,n,r,i){return o.scale(e,r,n,i)}function S(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var w=a.mat4d.create(),A=n.create(),C=s.VertexAttrConstants;t.IDENTITY=a.mat4d.identity(),t.fill=c,t.fillColor=function(e,t,n,r,i){for(var a=0;a<i;++a)n[r+a]=e[t+a];return i},t.fillInterleaved=function(e,t,n,r,i,a,o,s){for(var c=l.getStride(i)/4,v=0;v<i.length;v++){var g=i[v],m=o+g.offset/4,y=g.name,b=e.vertexAttr[y];if(null!=b&&(null==s||null!=s[y]))switch(y){case"uv0":u(e.indices[y],b.data,b.size,a,m,c);break;case"region":f(e.indices[y],b.data,b.size,a.buffer,m,c);break;case"color":r&&r.color?h(e.indices[y],b.data,r.color,b.size,a.buffer,m,c):p(e.indices[y],b.data,b.size,a.buffer,m,c);break;case"symbolColor":p(e.indices[y],b.data,b.size,a.buffer,m,c);break;default:var _=y===C.POSITION?t:y===C.NORMAL?n:void 0;void 0!==_&&3===b.size?d(e.indices[y],b.data,_,a,m,c):u(e.indices[y],b.data,b.size,a,m,c)}}},t.triangleVertexArrayToWireframeLines=function(e,t,n,r){for(var i=Math.floor(n/3)-1;i>=0;i--){var a=t+3*i*r,o=t+3*i*2*r+5*r;c(e,a,e,o,null,r),c(e,a+r,e,o-=r,null,r),c(e,a+r,e,o-=r,null,r),c(e,a+2*r,e,o-=r,null,r),c(e,a+2*r,e,o-=r,null,r),c(e,a,e,o-=r,null,r)}},t.intersectTriangleGeometry=function(e,t,n,i,a,o,l){s.assert("triangle"===e.data.primitiveType);var c=t&&t.componentVisibilities,d=i.tolerance;e.getComponentCount()>1?g(e,c,a,o,d,l):c&&!r.getVisibility(c,0)||v(e.getBoundingInfo(),a,o,d,l)};var O=a.vec3d.create(),R=Math.pow(2,-52),E=a.vec3d.create();t.intersectTriangles=m;var P=a.vec3d.create(),T=a.vec3d.create();t.computeNormal=y,t.intersectAabbInvDir=_,t.transformToWorld=function(e,t,n){return a.vec4d.set4(e[0]-t[0],e[1]-t[1],e[2]-t[2],1,n)},t.transformToView=function(e,t,n,r){return a.mat4d.translate(n,t,w),n=w,a.mat4d.multiplyVec4(n,e,r)},t.transformToProjection=function(e,t,n,r){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3],a.mat4d.multiplyVec4(t,r)},t.transformToNDC=function(e,t){return a.vec4d.scale(e,1/Math.abs(e[3]),t)},t.applyScreenSizePerspectiveScale=x,t.verticalOffsetAtDistance=function(e,t,n,r,i){var a=n.screenLength||0;i&&(a=x(a,0,t,r,i));var o=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return s.clamp(o*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)},t.aquireIfNotUndefined=function(e,t,n){if(void 0!==e)return t.aquire(e,n)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)};var D=a.mat4.create();t.bindView=function(e,t,n){a.mat4d.translate(t,e,D),n.setUniform3fv("localOrigin",e),n.setUniformMatrix4fv("view",D)},t.bindCamPos=function(e,t,n){n.setUniform3f("camPos",t[3]-e[0],t[7]-e[1],t[11]-e[2])};var I=a.vec3d.create(),M=a.vec3d.create();t.bindViewOriginDouble=function(e,t){i.encodeDoubleArraySplit(e,I,M,3),t.setUniform3fv("viewOriginHi",I),t.setUniform3fv("viewOriginLo",M)},t.bindVerticalOffset=function(e,t,n){if(e){var r=function(e,t,n,r){return void 0===r&&(r=V),r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*n),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}(e,t.fovY,t.viewport[3]);n.setUniform4f("verticalOffset",r.screenLength,r.perDistance,r.minWorldLength,r.maxWorldLength)}},t.bindScreenSizePerspective=function(e,t,n){if(void 0===n&&(n="screenSizePerspectiveAlignment"),e){var r=e.parameters,i=e.paddingPixelsOverride;t.setUniform4f(n,r.divisor,r.offset,r.minPixelSize,i)}},t.copyParameters=function e(t,n){var r=n?e(n):{};for(var i in t){var a=t[i];a&&a.forEach&&(a=S(a)),null==a&&i in r||(r[i]=a)}return r},t.updateParameters=function(e,t){var n=!1;for(var r in t){var i=t[r];void 0!==i&&(n=!0,Array.isArray(i)?e[r]=i.slice():e[r]=i)}return n},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var L=1e3,V={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,r))||(e.exports=i)},1498:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,r))||(e.exports=i)},1499:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(5),n(1492),n(1487),n(1493)],void 0===(i=function(e,t,n,r,i,a,o){return function(){function e(e,t,n,r,i,o){this.variables=[],this.sealed=!1,this.programCache={},a.assert(2===t.length,"you must specify shader snippet prefixes for vertex and fragment shaders"),this.programNamePrefix=e,this.shaderSnippetPrefixes=t,this.baseDefines=n,this.programRep=r,this.snippets=i,this.rctx=o,this.baseDefines=n?n.slice():[]}return e.prototype.addDefine=function(e,t,n,r){a.assert(!this.sealed,"you cannot add another variable after the first program has been generated"),a.assert(!!e,"you must specify a program name suffix"),this.variables.push({programNameSuffixes:["",e],shaderNameSuffixes:r||e,defineStr:t,affectsShaderTypes:n||[!0,!0]})},e.prototype.addBinaryShaderSnippetSuffix=function(e,t,n){a.assert(!this.sealed,"you cannot add another variable after the first program has been generated"),a.assert(!!e,"you must specify a program name suffix"),this.variables.push({programNameSuffixes:["",e],shaderSnippetSuffixes:["",t],affectsShaderTypes:n||[!0,!0]})},e.prototype.addNaryShaderSnippetSuffix=function(e,t){a.assert(!this.sealed,"you cannot add another variable after the first program has been generated");var n=e.map(function(e){return a.assert(null!=e.value,"value must always be specified"),e.value});this.variables.push({values:n,programNameSuffixes:e.map(function(e,t){return null!=e.programNameSuffix?e.programNameSuffix:n[t]}),shaderSnippetSuffixes:e.map(function(e,t){return null!=e.shaderSnippetSuffix?e.shaderSnippetSuffix:n[t]}),affectsShaderTypes:t||[!0,!0]})},e.prototype.getShaderVariation=function(e){a.assert(e.length===this.variables.length,"you must specify a value for each variable");for(var t=this.programNamePrefix,n=r.clone(this.shaderSnippetPrefixes),i=r.clone(this.shaderSnippetPrefixes),o=r.clone(this.baseDefines),s=0;s<this.variables.length;s++){var l=this.variables[s],c=e[s],d=void 0;l.values?(d=l.values.indexOf(c.toString()),a.assert(d>=0,"invalid value "+c+" for variable "+s)):d=c?1:0,t+=l.programNameSuffixes[d];for(var u=0;u<2;u++)l.affectsShaderTypes[u]&&(l.shaderSnippetSuffixes&&(n[u]+=l.shaderSnippetSuffixes[d],i[u]+=l.shaderSnippetSuffixes[d]),l.defineStr&&d&&(o.push(l.defineStr),i[u]+=l.shaderNameSuffixes))}return{programName:t,shaderSnippetNames:n,shaderNames:i,defines:o}},e.prototype.getProgram=function(e,t,n,r){void 0===t&&(t=this.snippets),void 0===n&&(n=this.rctx),void 0===r&&(r=i.Default3D),this.sealed=!0;var s=e.reduce(function(e,t){return e+t.toString()},"");if(this.programCache[s])return this.programCache[s];var l=this.getShaderVariation(e),c=this.programRep.get(l.programName);if(c)return c;var d=l.shaderSnippetNames[0],u=t[d];a.assert(null!=u,"shader snippet '"+d+"' does not exist");var p=l.shaderSnippetNames[1],h=t[p];return a.assert(null!=h,"shader snippet '"+p+"' does not exist"),c=new o(n,u,h,r,l.defines),this.programCache[s]=c,this.programRep.add(l.programName,c),c},e}()}.apply(null,r))||(e.exports=i)},1501:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(27),n(473),n(56),n(477),n(186),n(30),n(252),n(49),n(80)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){function u(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=o.getPointOnPath(t,o.getPathLength(t)/2);return l.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference)}Object.defineProperty(t,"__esModule",{value:!0});var p=[1,1,1];t.computeCentroid=function(e){if("point"===e.type)return e;if(l.isHydratedGeometry(e))switch(e.type){case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return u(e);case"mesh":return e.extent.center}else switch(e.type){case"extent":return function(e){var t=d.isFinite(e.zmin);return l.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e);case"polygon":return function(e){var t=a.ringsCentroid(e.rings,l.hasZ(e));return l.makeDehydratedPoint(t[0],t[1],t[2],e.spatialReference)}(e);case"polyline":return u(e)}},t.convertPointSR=function(e,t){var r=e.spatialReference;r.isWebMercator&&t.isWGS84?(s.xyToLngLat(e.x,e.y,h),e.x=h[0],e.y=h[1],e.spatialReference=n.SpatialReference.WGS84):t.isWebMercator&&r.isWGS84&&(s.lngLatToXY(e.x,e.y,h),e.x=h[0],e.y=h[1],e.spatialReference=n.SpatialReference.WebMercator)},t.enlargeExtent=function(e,t,n){if(e){t||(t=i.create());var r=e,a=.5*r.width*(n-1),o=.5*r.height*(n-1);return r.width<1e-7*r.height?a+=o/20:r.height<1e-7*r.width&&(o+=a/20),c.vec4d.set4(r.xmin-a,r.ymin-o,r.xmax+a,r.ymax+o,t),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].data.vertexAttributes.auxpos1;r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(n))}},t.mixinColorAndOpacity=function(e,t){var n=[1,1,1,1];return null!=e&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),null!==t&&void 0!==t?n[3]=t:null!=e&&e.length>3&&(n[3]=e[3]),n},t.overrideColor=function(e,t,n,r,i,a){void 0===a&&(a=[0,0,0,0]);for(var o=0;o<3;++o)e&&null!=e[o]?a[o]=e[o]:n&&null!=n[o]?a[o]=n[o]:a[o]=i[o];return a[3]=null!=t?t:null!=r?r:i[3],a},t.computeObjectScale=function(e,t,n,r){void 0===e&&(e=p),void 0===r&&(r=1);var i=new Array(3);if(null==t||null==n)i[0]=1,i[1]=1,i[2]=1;else{for(var a=void 0,o=0,s=2;s>=0;s--){var l=e[s],c=void 0,d=null!=l,u=0===s&&!a&&!d,h=n[s];"symbolValue"===l||u?c=0!==h?t[s]/h:1:d&&"proportional"!==l&&isFinite(l)&&(c=0!==h?l/h:1),null!=c&&(i[s]=c,a=c,o=Math.max(o,Math.abs(c)))}for(s=2;s>=0;s--)null==i[s]?i[s]=a:0===i[s]&&(i[s]=.001*o)}for(s=2;s>=0;s--)i[s]/=r;return i},t.computeSizeWithResourceSize=function(e,t){var n=t.isPrimitive,r=t.width,i=t.depth,a=t.height,o=n?10:1;if(null==r&&null==a&&null==i)return[o*e[0],o*e[1],o*e[2]];for(var s,l=[r,i,a],c=0;c<3;c++){var d=l[c];if(null!=d){s=d/e[c];break}}for(c=0;c<3;c++)null==l[c]&&(l[c]=e[c]*s);return l},t.validateSymbolLayerSize=function(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),function e(t){if(Array.isArray(t)){for(var n=0,r=t;n<r.length;n++)if(!e(r[n]))return!1;return!0}return null==t||t>=0}(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,n,r){void 0===r&&(r=c.mat4d.identity());var i=e||0,a=t||0,o=n||0;return 0!==i&&c.mat4d.rotateZ(r,-i/180*Math.PI,r),0!==a&&c.mat4d.rotateX(r,a/180*Math.PI,r),0!==o&&c.mat4d.rotateY(r,o/180*Math.PI,r),r},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:r.isPoint(e)?t.minDemResolutionForPoints:.01*r.maximumDimension(e)};var h=[0,0]}.apply(null,r))||(e.exports=i)},1502:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1504),n(1506)],void 0===(i=function(e,t,n,r){return function(){function e(t){this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.supportsEdges=!1,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(r.MATERIAL,this,e)},e._idGen=new n,e}()}.apply(null,r))||(e.exports=i)},1503:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1492),n(1498),n(1497),n(1490),n(1496)],void 0===(i=function(e,t,n,r,i,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=r.Pos2);var a=t===r.Pos3Tex?new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]):new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new o(e,n.Default3D,{geometry:t},{geometry:i.createVertex(e,35044,a)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,n){void 0===n&&(n=s);for(var r=new Uint8Array(n*n*4),i=0;i<r.length;i+=4)r[i+0]=255*t[0],r[i+1]=255*t[1],r[i+2]=255*t[2],r[i+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:n,height:n},r)}}.apply(null,r))||(e.exports=i)},1504:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,r))||(e.exports=i)},1505:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,r))||(e.exports=i)},1506:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,r))||(e.exports=i)},1507:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){var n;return function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_DEPTH=1]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=2]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP",e[e.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT",e[e.MAX_PASS=5]="MAX_PASS"}(n||(n={})),n}.apply(null,r))||(e.exports=i)},1509:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(29),n(15),n(141),n(9),n(119),n(7),n(1)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handles=new o,t.layer=null,t.parent=null,t.view=null,t}return n(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var n=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+n+"')",t),d.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},r([u.property()],t.prototype,"layer",void 0),r([u.property()],t.prototype,"parent",void 0),r([u.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),r([u.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),r([u.property()],t.prototype,"view",void 0),r([u.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r([u.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r([u.subclass("esri.views.layers.LayerView")],t)}(u.declared(i,a,s,c))}.apply(null,r))||(e.exports=i)},1511:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1488),n(1506),n(1553),n(1487),n(1514),n(1538),n(1569)],void 0===(i=function(e,t,n,r,i,a,o,s,l){var c=n.vec2d,d=n.vec2,u=n.vec3d,p=function(){function e(e,t,n){this._intersectTolerance=i.DEFAULT_TOLERANCE,this._viewContent=[],this._externalIntersectionHandlers=[],this.container=t,this.viewingMode=e,this.model=new s,this.view=new l(t,this,this.model.getDirtySet(),n),this._validateHUDSelector=new i(this.viewingMode),this._validateHUDSelector.enableHUDSelection=!1,this.view.setLighting({lights:[new o.MainLight(u.createFrom(.7,.7,.7)),new o.AmbientLight(u.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.beginMod=function(){e.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()},e.prototype.endMod=function(t){void 0===t&&(t=!1),e.DebugSettings.fineGrainedContentValidation&&!t&&this.model.validateContent()},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var n=this.model.remove(e,t);return"function"==typeof n.removeParentStage&&n.removeParentStage(this),n},e.prototype.notifyDirty=function(e,t,n,r){this.model.notifyDirty(e,t,n,r)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),n=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||n){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var r=t.commitLayers(this._viewContent);(r[0].length+r[1].length+r[2].length>0||n)&&this.view.modify(r[0],r[1],r[2],n),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+r[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+r[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),n=t.getDirtyMaterials(),r=t.commitLayers([e]);(r[0].length+r[1].length+r[2].length>0||n)&&this.view.modify(r[0],r[1],r[2],n),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.addTextureListener=function(e){this.view.addTextureListener(e)},e.prototype.removeTextureListener=function(e){this.view.removeTextureListener(e)},e.prototype.getContainer=function(){return this.container},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(r.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.setViewContent=function(e){var t=a.array2object(this._viewContent),n=a.array2object(e),r=a.subtractObjects(n,t),i=a.subtractObjects(t,n);this.processDirty();var o=this.model.getDirtySet(),s=o.getResidentRenderGeometriesFilteredByLayers(a.object2array(r)),l=o.getResidentRenderGeometriesFilteredByLayers(a.object2array(i));this.view.modify(s,l,[]),this._viewContent=e.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],n=0;n<e.length;n++)-1===this._viewContent.indexOf(e[n])&&t.push(e[n]);if(e.length>0){this.processDirty();var r=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(r,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),n=this._viewContent,r=[],i=0;i<e.length;i++){var a=n.indexOf(e[i]);a>-1&&(n[a]=n[n.length-1],n.pop(),r.push(e[i]))}var o=t.getResidentRenderGeometriesFilteredByLayers(r);this.view.modify([],o,[])},e.prototype.getLocalOrigin=function(e,t,n){return this.model.getOrigin(e,t,n)},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.requestScreenCapture=function(e,t){this.view.requestScreenCapture(e,t)},e.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()},e.prototype.getTextureLoaded=function(e){return this.view.getTextureLoaded(e)},e.prototype.addExternalRenderer=function(e,t){return"function"==typeof t.intersect&&this._externalIntersectionHandlers.push(t),this.view.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){var t=this._externalIntersectionHandlers.indexOf(e);return t>-1&&this._externalIntersectionHandlers.splice(t,1),this.view.removeExternalRenderer(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),n="";if(e){for(var r in n+="<table>",t)n+="<tr><td>"+r+'</td><td style="text-align: right">'+Math.round(t[r])+"</td></tr>";n+="</table>"}else for(var r in t)n+=r+": "+t[r]+"\n";return n},e.prototype.pick=function(e,t,n,r){var i=u.create(),a=u.create();return this.view.getPickRay(e,i,a),this.pickRay(i,a,e,e,t,n,r)},e.prototype.pickRayWithBeginPoint=function(e,t,n,r,i){this.view.pickRayWithBeginPoint(e,t,n,r,i)},e.prototype.pickRay=function(e,t,n,r,a,o,l){var c,d=this.view.getCamera();if(n||(n=h,d.projectPoint(t,n)),a){c=new Array(a.length);for(var p=0;p<c.length;p++)c[p]=this.model.get(s.ContentType.LAYER,a[p])}else{c=[];var g=this.getViewContent(),m=this.model.getAll(s.ContentType.LAYER);for(p=0;p<g.length;p++){var y=m[g[p]];y&&y.isPickable&&c.push(y)}}l?l.init(c,e,t,n,d,this._intersectTolerance,o):l=new i(this.viewingMode,c,e,t,n,d,this._intersectTolerance,o);for(p=0;p<this._externalIntersectionHandlers.length;p++)this._externalIntersectionHandlers[p].intersect(l,e,t,n);if(l.getHudResults().length){var b=l.getHudResults();b.sort(function(e,t){return t.dist-e.dist});var _=b[b.length-1],x=f;d.projectPoint(_.center,x),x[0]=Math.round(x[0]),x[1]=Math.round(x[1]);var S=v;this.view.getPickRay(x,e,S);var w=u.dist(_.center,e)/u.dist(e,S)*.99;this._validateHUDSelector.init(c,e,S,x,d,this._intersectTolerance,o);for(p=0;p<this._externalIntersectionHandlers.length;p++)this._externalIntersectionHandlers[p].intersect(this._validateHUDSelector,e,S,x);var A=this._validateHUDSelector.getMinResult();(null==A.dist||w<=A.dist)&&l.getMinResult().copyFrom(_)}return l},e.prototype.getIntersectTolerance=function(){return this._intersectTolerance},e.prototype.setIntersectTolerance=function(e){void 0===e&&(e=1e-5),this._intersectTolerance=e},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=r,e}(),h=c.create(),f=d.create(),v=u.create();return p}.apply(null,r))||(e.exports=i)},1512:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(0),n(4),n(1)],void 0===(i=function(e,t,n,r,i,a){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t}return n(t,e),r([a.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),r([a.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),r([a.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),r([a.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),r([a.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),r([a.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),r([a.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),r([a.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),r([a.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),r([a.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),r([a.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),r([a.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),r([a.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r([a.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),r([a.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),r([a.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),r([a.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),r([a.subclass()],t)}(a.declared(i)))}.apply(null,r))||(e.exports=i)},1514:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(49)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n.vec3d,i=function(){return function(e,t,n){void 0===e&&(e=r.create()),void 0===t&&(t=r.createFrom(.57735,.57735,.57735)),void 0===n&&(n=!0),this.intensity=e,this.direction=t,this.castShadows=n}}();t.MainLight=i;var a=function(){return function(e,t){void 0===e&&(e=r.create()),void 0===t&&(t=r.createFrom(.57735,.57735,.57735)),this.intensity=r.create(),this.direction=r.create(),this.intensity=e,this.direction=t}}();t.FillLight=a;var o=function(){return function(e){void 0===e&&(e=r.create()),this.intensity=e}}();t.AmbientLight=o;var s=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=s}.apply(null,r))||(e.exports=i)},1515:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(11),n(1616),n(1501),n(1668),n(1667),n(1492),n(1488),n(1543),n(1502),n(1491),n(1499),n(1487),n(1494),n(1493),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m){function y(e){return e.cullFace?"none"!==e.cullFace:!e.transparent}function b(e,t){var n=e.gl;y(t)?(e.setFaceCullingEnabled(!0),"front"===t.cullFace&&e.setCullFace(n.FRONT)):e.setFaceCullingEnabled(!1)}function _(e,t){var n=e.gl;y(t)?(e.setFaceCullingEnabled(!1),"front"===t.cullFace&&e.setCullFace(n.BACK)):e.setFaceCullingEnabled(!0)}function x(e,t){return e?p.TRANSPARENT_MATERIAL:t?p.STENCIL_MATERIAL:p.OPAQUE_MATERIAL}function S(e,t){var n=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):n&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),n&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),a.computeObjectRotation(t.vvSymbolRotation[2],t.vvSymbolRotation[0],t.vvSymbolRotation[1],E.identity(W)),e.setUniformMatrix3fv("vvSymbolRotation",E.toMat3(W,k))),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function w(e,t){e.vvSizeEnabled=t.vvSizeEnabled,e.vvSizeMinSize=t.vvSizeMinSize,e.vvSizeMaxSize=t.vvSizeMaxSize,e.vvSizeOffset=t.vvSizeOffset,e.vvSizeFactor=t.vvSizeFactor,e.vvSizeValue=t.vvSizeValue,e.vvSymbolAnchor=t.vvSymbolAnchor,e.vvSymbolRotation=t.vvSymbolRotation}var A,C=c.vec3d,O=c.vec4d,R=c.mat3d,E=c.mat4d,P=f.assert,T=1,D=function(e){function t(n,r){var i=e.call(this,r)||this;return i.supportsEdges=!0,i.params=v.copyParameters(n,z),i.instanced=!!n.instanced,i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.instanceBufferLayout=i.instanced?t.getInstanceBufferLayout(i.params):null,i}return n(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var n=A&&t.instanced,r=t.vertexColors,i=t.symbolColors,a=!!n&&n.indexOf("color")>-1,o=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(a||o||i)?!!s||l:r?s?c:l:a||o||i?!!s||l:s?c:l},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=this.params;return{textureId:e.textureId,ambient:e.ambient,diffuse:e.diffuse,specular:e.specular,externalColor:e.externalColor,colorMixMode:e.colorMixMode,opacity:e.opacity,layerOpacity:e.layerOpacity,transparent:e.transparent,polygonOffset:e.polygonOffset,atlasRegions:e.atlasRegions,flipV:e.flipV,doubleSided:e.doubleSided,doubleSidedType:e.doubleSidedType,cullFace:e.cullFace,writeStencil:e.writeStencil,receiveSSAO:e.receiveSSAO,castShadows:e.castShadows,verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,vvSizeEnabled:e.vvSizeEnabled,vvSizeMinSize:e.vvSizeMinSize,vvSizeMaxSize:e.vvSizeMaxSize,vvSizeOffset:e.vvSizeOffset,vvSizeFactor:e.vvSizeFactor,vvSizeValue:e.vvSizeValue,vvColorEnabled:e.vvColorEnabled,vvColorValues:e.vvColorValues,vvColorColors:e.vvColorColors,instancedDoublePrecision:e.instancedDoublePrecision,compressedNormals:e.compressedNormals,groundNormalShading:e.groundNormalShading,vvSymbolAnchor:e.vvSymbolAnchor,vvSymbolRotation:e.vvSymbolRotation}},t.prototype.setParameterValues=function(e){var t=this.params;for(var n in e)"textureId"===n&&P(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===n&&P(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[n]=e[n];this.notifyDirty("matChanged")},t.prototype.getOutputAmount=function(e){return e*(m.getStride(this.vertexBufferLayout)/4)},t.prototype.getVertexBufferLayout=function(){return this.vertexBufferLayout},t.prototype.getInstanceBufferLayout=function(){return this.instanceBufferLayout},t.prototype.fillInterleaved=function(e,t,n,r,i,a,o){v.fillInterleaved(e,t,n,r,this.vertexBufferLayout,i,a,o)},t.prototype.intersect=function(e,t,n,r,i,a,o,s){if(null!==this.params.verticalOffset){var l=r.camera;C.set3(n[12],n[13],n[14],Z);var c=C.subtract(Z,l.eye,K),d=C.length(c),u=C.scale(c,1/d),p=null,h=null;switch(r.viewingMode){case"global":h=C.normalize(Z,Y);break;case"local":h=C.set(X,Y)}this.params.screenSizePerspective&&(p=C.dot(h,u));var f=v.verticalOffsetAtDistance(l,d,this.params.verticalOffset,p,this.params.screenSizePerspective);C.scale(h,f),R.multiplyVec3(r.transformInverseRotation,h,Q),i=C.subtract(i,Q,q),a=C.subtract(a,Q,$)}v.intersectTriangleGeometry(e,t,n,r,i,a,o)},t.prototype.getGLMaterials=function(){return{color:I,depthShadowMap:this.params.castShadows?L:null,normal:V,depth:M,highlight:F}},t.prototype.getAllTextureIds=function(){var e=this.params,t=[];return e.textureId&&t.push(e.textureId),t},t.loadShaders=function(e,t,n){e._parse(i),A=null!==n.capabilities.instancing;var r=new h("phong",["vsPhong","fsPhong"],null,t,e,n);r.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),r.addDefine("Color","VERTEXCOLORS"),r.addDefine("symbolColor","SYMBOLVERTEXCOLORS"),r.addDefine("FlipV","FLIPV"),r.addDefine("DoubleSided","DOUBLESIDED"),r.addDefine("WindingOrderDoubleSided","WINDINGORDERDOUBLESIDED"),r.addDefine("Instanced","INSTANCED"),r.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),r.addDefine("InstColor","INSTANCEDCOLOR"),r.addDefine("ReceiveShadows","RECEIVE_SHADOWS"),r.addDefine("ReceiveSSAO","RECEIVE_SSAO"),r.addDefine("vvSize","VV_SIZE"),r.addDefine("vvColor","VV_COLOR"),r.addDefine("VerticalOffset","VERTICAL_OFFSET"),r.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),r.addDefine("groundNormalShading","GROUND_NORMAL_SHADING"),r.addDefine("compressedNormals","COMPRESSED_NORMALS"),r.addDefine("componentColor","COMPONENTCOLORS"),r.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),r.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(N,r);var a=new h("depth",["vsDepth","fsDepth"],null,t,e,n);a.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),a.addDefine("FlipV","FLIPV"),a.addDefine("Instanced","INSTANCED"),a.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),a.addDefine("ShadowMap","BIAS_SHADOWMAP"),a.addDefine("vvSize","VV_SIZE"),a.addDefine("VerticalOffset","VERTICAL_OFFSET"),a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),a.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),a.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(B,a);var o=new h("normal",["vsNormal","fsNormal"],null,t,e,n);o.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),o.addDefine("FlipV","FLIPV"),o.addDefine("Instanced","INSTANCED"),o.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),o.addDefine("vvSize","VV_SIZE"),o.addDefine("VerticalOffset","VERTICAL_OFFSET"),o.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),o.addDefine("compressedNormals","COMPRESSED_NORMALS"),o.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),o.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(j,o);var s=new h("highlight",["vsHighlight","fsHighlight"],null,t,e,n);s.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),s.addDefine("FlipV","FLIPV"),s.addDefine("Instanced","INSTANCED"),s.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),s.addDefine("vvSize","VV_SIZE"),s.addDefine("VerticalOffset","VERTICAL_OFFSET"),s.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),s.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),s.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(G,s);var c=new g(n,e.vsDepth,e.fsDepth,l.Default3D,["BIAS_SHADOWMAP 1"]),d=new g(n,e.vsDepthTextured,e.fsDepthTextured,l.Default3D,["BIAS_SHADOWMAP 1"]),u=new g(n,e.vsDepth,e.fsDepth,l.Default3D),p=new g(n,e.vsDepthTextured,e.fsDepthTextured,l.Default3D),f=new g(n,e.vsNormal,e.fsNormal,l.Default3D),v=new g(n,e.vsNormalTextured,e.fsNormalTextured,l.Default3D),m=new g(n,e.vsHighlight,e.fsHighlight,l.Default3D),y=new g(n,e.vsHighlightTextured,e.fsHighlightTextured,l.Default3D);t.add("depthShadowMap",c),t.add("depthTexturedShadowMap",d),t.add("depth",u),t.add("depthTextured",p),t.add("normal",f),t.add("normalTextured",v),t.add("highlight",m),t.add("highlightTextured",y)},t.getVertexBufferLayout=function(e){var t=s.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region"))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),o.glLayout(t)},t.getInstanceBufferLayout=function(e){var t=s.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),o.glLayout(t,{divisor:1})},t}(u),I=function(e){function t(t,n,r){var i=e.call(this,t,n,r,t.getParams().textureId)||this;i.programs=[[null,null],[null,null]],i.params=v.copyParameters(t.getParams()),i.slot=x(i.params.transparent,i.params.writeStencil);var a=i.params;i.texturing=a.textureId?a.atlasRegions?"AtlasTextured":"Textured":"none";var o=A&&a.instanced;return i.instanced=!!o,i.instancedColor=!!o&&o.indexOf("color")>-1,i.pseudoInstancedColor=!A&&a.instanced&&a.instanced.indexOf("color")>-1,i._loadPrograms(),i}return n(t,e),t.prototype._loadPrograms=function(){this.programs[0][0]=this._loadProgram(!1,!1),this.programs[1][0]=this._loadProgram(!0,!1),this.params.receiveSSAO?(this.programs[0][1]=this._loadProgram(!1,!0),this.programs[1][1]=this._loadProgram(!0,!0),this.allPrograms=this.programs[0].concat(this.programs[1])):(this.programs[0][1]=this.programs[0][0],this.programs[1][1]=this.programs[1][0],this.allPrograms=[this.programs[0][0],this.programs[1][0]])},t.prototype._loadProgram=function(e,t){var n=this.params;return this.programRep.getShaderVariationsProgram(N,[this.texturing,n.vertexColors,n.symbolColors,n.flipV,n.doubleSided&&"normal"===n.doubleSidedType,n.doubleSided&&"winding-order"===n.doubleSidedType,!!this.instanced,n.instancedDoublePrecision,this.instancedColor,e,t,n.vvSizeEnabled,n.vvColorEnabled,null!==n.verticalOffset,null!==n.screenSizePerspective,n.groundNormalShading,n.compressedNormals,null!=n.componentColorBuffer,n.transparent,U])},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.programs[0][0]},t.prototype.getPrograms=function(){return this.allPrograms},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.ambient=e.ambient,t.diffuse=e.diffuse,t.specular=e.specular,t.externalColor=e.externalColor,t.colorMixMode=e.colorMixMode,t.opacity=e.opacity,t.layerOpacity=e.layerOpacity,t.polygonOffset=e.polygonOffset,t.flipV=e.flipV,t.doubleSided=e.doubleSided,t.doubleSidedType=e.doubleSidedType,t.cullFace=e.cullFace,t.receiveSSAO=e.receiveSSAO,t.castShadows=e.castShadows,t.verticalOffset=e.verticalOffset,t.screenSizePerspective=e.screenSizePerspective,w(t,e),t.vvColorEnabled=e.vvColorEnabled,t.vvColorValues=e.vvColorValues,t.vvColorColors=e.vvColorColors,t.transparent!==e.transparent&&(this.slot=x(e.transparent,e.writeStencil),t.transparent=e.transparent),t.instancedDoublePrecision=e.instancedDoublePrecision,t.compressedNormals=e.compressedNormals,t.groundNormalShading=e.groundNormalShading,this.updateTexture(e.textureId),e.atlasRegions&&(t.atlasRegions=e.atlasRegions),t.blendModeOneOne=e.blendModeOneOne,t.inverseWindingOrder=e.inverseWindingOrder,this._loadPrograms()},t.prototype.bind=function(e,t){var n=e.gl,r=this.params,i=this.program=this.programs[t.shadowMappingEnabled?1:0][t.ssaoEnabled?1:0];e.bindProgram(i),i.setUniform3fv("ambient",r.ambient),i.setUniform3fv("diffuse",r.diffuse),i.setUniform3fv("specular",r.specular),i.setUniform4fv("externalColor",r.externalColor),i.setUniform1i("colorMixMode",v.colorMixModes[r.colorMixMode]),i.setUniform1f("opacity",r.opacity),i.setUniform1f("layerOpacity",r.layerOpacity),v.bindVerticalOffset(r.verticalOffset,t,i),v.bindScreenSizePerspective(r.screenSizePerspective,i),S(i,r),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),r.inverseWindingOrder&&e.setFrontFace(n.CW),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(n.ONE,n.ONE),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):e.setBlendingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),b(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:T}))},t.prototype.release=function(e,t){var n=e.gl;e.setPolygonOffsetFillEnabled(!1),_(e,this.params),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),e.setDepthWriteEnabled(!0),e.setFrontFace(n.CCW)},t.prototype.bindView=function(e,t){var n=this.program=this.programs[t.shadowMappingEnabled?1:0][t.ssaoEnabled?1:0],r=this.params,i=r.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;v.bindView(i,t.view,n),v.bindCamPos(i,t.viewInvTransp,n),r.instancedDoublePrecision&&v.bindViewOriginDouble(i,n),t.shadowMappingEnabled&&t.shadowMap.bindView(n,i)},t.prototype.bindInstance=function(e,t){var n=this.program;if(n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal),t.instanceParameters&&this.pseudoInstancedColor){var r=t.instanceParameters.color;r&&(O.multiply(r,this.params.externalColor,H),n.setUniform4fv("externalColor",H))}},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),M=function(e){function t(t,n,r,i){void 0===i&&(i=!1);var a=e.call(this,t,n,r,t.getParams().textureId)||this;return a.params=v.copyParameters(t.getParams()),a.instanced=A&&!!a.params.instanced,a.texturing=m.hasAttribute(t.getVertexBufferLayout(),"uv0")?(a.params.atlasRegions,"Textured"):"none",a.program=n.getShaderVariationsProgram(B,[a.texturing,a.params.flipV,a.instanced,a.params.instancedDoublePrecision,i,a.params.vvSizeEnabled,null!==a.params.verticalOffset,null!==a.params.screenSizePerspective,a.params.transparent,U]),a.slot=x(a.params.transparent,a.params.writeStencil),a}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,w(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var n=e.gl,r=this.program,i=this.params;e.bindProgram(r),r.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(n.CW),v.bindVerticalOffset(i.verticalOffset,t,r),v.bindScreenSizePerspective(i.screenSizePerspective,r),S(r,i),this.bindTexture(e,r),b(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,n=this.params;_(e,n),n.inverseWindingOrder&&e.setFrontFace(t.CCW)},t.prototype.bindView=function(e,t){var n=this.program,r=this.params,i=r.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;v.bindView(i,t.view,n),r.screenSizePerspective&&v.bindCamPos(i,t.viewInvTransp,n),r.instancedDoublePrecision&&v.bindViewOriginDouble(i,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),L=function(e){function t(t,n,r){return e.call(this,t,n,r,!0)||this}return n(t,e),t}(M),V=function(e){function t(t,n,r,i){void 0===i&&(i=!1);var a=e.call(this,t,n,r,t.getParams().textureId)||this;return a.params=v.copyParameters(t.getParams()),a.instanced=A&&!!a.params.instanced,a.texturing=m.hasAttribute(t.getVertexBufferLayout(),"uv0")?(a.params.atlasRegions,"Textured"):"none",a.program=n.getShaderVariationsProgram(j,[a.texturing,a.params.flipV,a.instanced,a.params.instancedDoublePrecision,a.params.vvSizeEnabled,null!==a.params.verticalOffset,null!==a.params.screenSizePerspective,a.params.compressedNormals,a.params.transparent,U]),a.slot=x(a.params.transparent,a.params.writeStencil),a}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,w(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var n=e.gl,r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),v.bindVerticalOffset(i.verticalOffset,t,r),v.bindScreenSizePerspective(i.screenSizePerspective,r),S(r,i),b(e,i),i.inverseWindingOrder&&e.setFrontFace(n.CW),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,n=this.params;_(e,n),n.inverseWindingOrder&&e.setFrontFace(t.CCW)},t.prototype.bindView=function(e,t){var n=this.program,r=this.params,i=r.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;v.bindView(i,t.view,n),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),r.screenSizePerspective&&v.bindCamPos(i,t.viewInvTransp,n),r.instancedDoublePrecision&&v.bindViewOriginDouble(i,n)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),F=function(e){function t(t,n,r,i){void 0===i&&(i=!1);var a=e.call(this,t,n,r,t.getParams().textureId)||this;return a.params=v.copyParameters(t.getParams()),a.instanced=A&&!!a.params.instanced,a.texturing=m.hasAttribute(t.getVertexBufferLayout(),"uv0")?(a.params.atlasRegions,"Textured"):"none",a.program=n.getShaderVariationsProgram(G,[a.texturing,a.params.flipV,a.instanced,a.params.instancedDoublePrecision,a.params.vvSizeEnabled,null!==a.params.verticalOffset,null!==a.params.screenSizePerspective,a.params.transparent,U]),a.slot=x(a.params.transparent,a.params.writeStencil),a}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,w(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var n=e.gl,r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),v.bindVerticalOffset(i.verticalOffset,t,r),v.bindScreenSizePerspective(i.screenSizePerspective,r),S(r,i),b(e,i),i.inverseWindingOrder&&e.setFrontFace(n.CW),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,n=this.params;_(e,n),n.inverseWindingOrder&&e.setFrontFace(t.CW)},t.prototype.bindView=function(e,t){var n=this.program,r=this.params,i=r.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;v.bindView(i,t.view,n),r.screenSizePerspective&&v.bindCamPos(i,t.viewInvTransp,n),r.instancedDoublePrecision&&v.bindViewOriginDouble(i,n)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),z={textureId:void 0,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},U=!!r("enable-feature:skallweit/lod-rendering"),N="material",B="material-depth",j="material-normal",G="material-highlight",H=O.create(),k=R.create(),W=E.create(),q=C.create(),$=C.create(),X=C.createFrom(0,0,1),Y=C.create(),Q=C.create(),Z=C.create(),K=C.create();return D}.apply(null,r))||(e.exports=i)},1517:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1510),n(1488),n(1487)],void 0===(i=function(e,t,n,r,i){function a(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function o(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var l=function(){function e(e,t,i){this._viewUp=r.vec3d.create(),this._viewForward=r.vec3d.create(),this._viewRight=r.vec3d.create(),this._viewport=r.vec4d.create(),this._padding=r.vec4d.create(),this._fov=55/180*Math.PI,this._near=0,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4d.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4d.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4d.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4d.create(),this._frustumPlanesDirty=!0,this._frustumPlanes=[n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create()],this._fullViewport=null,this.relativeElevation=0,this._eye=r.vec3d.create(e),this._center=r.vec3d.create(t),this._up=void 0!==i?r.vec3d.create(i):r.vec3d.create([0,0,1]),this._padding=r.vec4d.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){r.mat4d.set(e,this._viewMatrix),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=r.vec4d.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),r.vec4d.set(e,this._padding),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),i=n*this.aspect;r.mat4d.frustum(-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far,this._projectionMatrix),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){r.mat4d.set(e,this._projectionMatrix),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return i.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=i.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return i.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=i.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return r.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4d.create()),r.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),r.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return r.vec3d.set(e._eye,this._eye),r.vec3d.set(e._center,this._center),r.vec3d.set(e._up,this._up),r.vec4d.set(e._viewport,this._viewport),r.vec4d.set(e._padding,this._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(r.mat4d.set(e._viewMatrix,this._viewMatrix),r.vec3d.set(e._viewRight,this._viewRight),r.vec3d.set(e._viewUp,this._viewUp),r.vec3d.set(e._viewForward,this._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(r.mat4d.set(e._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumPlanesDirty?this._frustumPlanesDirty=!0:(e.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?r.mat4d.set(e._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4d.create(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?r.vec4d.set(e._fullViewport,this._fullViewport):this._fullViewport=r.vec4d.create(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return o(this._eye,e._eye)&&o(this._center,e._center)&&o(this._up,e._up)&&s(this._viewport,e._viewport)&&s(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,n){void 0===n&&(n=!1);var i,o=r.vec3d.dist(this._eye,this._center)*(t||5e-4),s=o*o;return n?(r.vec3d.direction(e._center,e._eye,u),r.vec3d.direction(this._center,this._eye,p),i=1e-10):(r.vec3d.set(e._center,u),r.vec3d.set(this._center,p),i=s),r.vec3d.dist2(e._eye,this._eye)<s&&r.vec3d.dist2(u,p)<i&&Math.abs(e._fov-this._fov)<.001&&a(e._padding,this._padding)<.5&&a(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(r.vec3d.dist(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.copyFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=r.vec4d.create()}var n=this.frustumPlanes;for(t=0;t<6;t++)r.vec4d.set(n[t],e[t]);return e},e.prototype.computeFrustumPoints=function(e){if(!e){e=new Array(8);for(var t=0;t<8;++t)e[t]=r.vec3d.create()}return i.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,e),e},e.prototype.setGLViewport=function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])},e.prototype.applyProjection=function(e,t,n){void 0===n&&(n=!1),e!==c&&r.vec3d.set(e,c),c[3]=1,n&&(t[2]=-c[2]),r.mat4d.multiplyVec4(this.projectionMatrix,c),r.vec3d.scale(c,1/Math.abs(c[3]));var a=this.fullViewport;return t[0]=i.lerp(0,a[0]+a[2],.5+.5*c[0]),t[1]=i.lerp(0,a[1]+a[3],.5+.5*c[1]),n||(t[2]=.5*(c[2]+1)),t},e.prototype.projectPoint=function(e,t){c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,r.mat4d.multiplyVec4(this.viewProjectionMatrix,c),r.vec3d.scale(c,1/Math.abs(c[3]));var n=this.fullViewport;return t[0]=i.lerp(0,n[0]+n[2],.5+.5*c[0]),t[1]=i.lerp(0,n[1]+n[3],.5+.5*c[1]),t[2]=.5*(c[2]+1),t},e.prototype.unprojectPoint=function(e,t,n){if(void 0===n&&(n=!1),n)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;if(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,d),!r.mat4d.inverse(d))return null;var i=this.fullViewport;return c[0]=2*(e[0]-i[0])/i[2]-1,c[1]=2*(e[1]-i[1])/i[3]-1,c[2]=2*e[2]-1,c[3]=1,r.mat4d.multiplyVec4(d,c),0===c[3]?null:(t[0]=c[0]/c[3],t[1]=c[1]/c[3],t[2]=c[2]/c[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){r.vec3d.subtract(this.center,this.eye,u);var e=r.vec3d.length(this.center);e<1?(r.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(r.vec3d.dot(u,this.center))>.9999*r.vec3d.length(u)*e||(r.vec3d.cross(u,this.center,this.up),r.vec3d.cross(this.up,u,this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){r.vec3d.direction(this.center,this.eye,u),Math.abs(u[2])<=.9999&&(r.vec3d.scale(u,u[2]),r.vec3d.set3(-u[0],-u[1],1-u[2],this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){o(e,t)||(r.vec3d.set(e,t),this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0)},e.prototype._computeFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=n.plane.create()}return i.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,e),e},e.prototype._ensureViewClean=function(){this._viewDirty&&(r.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),r.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),r.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),r.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),c=r.vec4d.create(),d=r.mat4d.create(),u=r.vec3d.create(),p=r.vec3d.create();return l}.apply(null,r))||(e.exports=i)},1518:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1670),n(1500),n(1649),n(1504),n(1487),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s){return function(){function e(t,n,r){this.singleUse=!1,this.componentAABB=null,this.id=e.__idGen.gen(n),this.data=t,this._boundingInfo=r}return e.prototype.getData=function(){return this.data},e.prototype.getComponentCount=function(){return r.componentCount(this.data.componentOffsets)},e.prototype.getComponentAABB=function(e,t){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var n=0;n<6;n++)t[n]=this.componentAABB[6*e+n];return t},e.prototype._computeComponentAABB=function(){for(var e=this.getComponentCount(),t=new Float32Array(6*e),n=0;n<e;n++)this._calculateAABB(n,t,6*n);return t},e.prototype._calculateAABB=function(e,t,n){void 0===n&&(n=0);for(var r=this.data.getIndices(s.VertexAttrConstants.POSITION),i=this.data.getAttribute(s.VertexAttrConstants.POSITION),a=this.data.componentOffsets,o=a.length?a[e]:0,l=a.length?a[e+1]:r.length,c=1/0,d=1/0,u=1/0,p=-1/0,h=-1/0,f=-1/0,v=i.offsetIdx,g=i.strideIdx,m=o;m<l;m++){var y=v+g*r[m],b=i.data[y],_=i.data[y+1],x=i.data[y+2];c=Math.min(c,b),d=Math.min(d,_),u=Math.min(u,x),p=Math.max(p,b),h=Math.max(h,_),f=Math.max(f,x)}return t?(t[n]=c,t[n+1]=d,t[n+2]=u,t[n+3]=p,t[n+4]=h,t[n+5]=f):t=[c,d,u,p,h,f],t},e.prototype.calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),r="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(r);for(var a=0;a<r;++a)e[a]=a}var l=e.length;o.assert(l%r==0);var c=i.generateDefaultIndexArray(l/r);return new n(c,r,e,t)},e.prototype.getBoundingInfo=function(){return null==this._boundingInfo&&(this._boundingInfo=this.calculateBoundingInfo()),this._boundingInfo},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.__idGen=new a,e}()}.apply(null,r))||(e.exports=i)},1519:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(251),n(1565)],void 0===(i=function(e,t,n,r){var i=2;return function(){function e(e){var t=this;if(this.data=[],this._length=0,this._allocator=null,this._deallocator=null,this._shrink=function(){},this._hint=new n.RemoveHint,e){if(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator){if(this._allocator=e.allocator,e.deallocator&&(this._deallocator=e.deallocator),e.initialSize)for(var r=0;r<e.initialSize;++r)this.data[r]=this._allocator(r)}else this._deallocator=function(e,n){return t.data[n]=void 0};e.shrink&&(this._shrink=function(){t.data.length>i*t.length&&(t.data.length=t.length)})}}return e.prototype.toArray=function(){return this.data.slice(0,this.length)},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length));if(this._deallocator)for(var t=e;t<this._length;++t)this._deallocator(this.data[t],t);this._length=e,this._shrink()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.length=0},e.prototype.equal=function(e){return n.equals(this.data,e.data)},e.prototype.push=function(e){return this.data.length===this.length&&this._grow((this.length+1)*i),this.data[this.length++]=e,e},e.prototype.pushArray=function(e){var t=this.length+e.length;t>=this.data.length&&this._grow(Math.max(this.length*i,t));for(var n=0;n<e.length;n++)this.data[this._length++]=e[n];return this.back()},e.prototype.pushNew=function(){return this.data.length===this.length&&this._grow((this.length+1)*i),++this._length,this.back()},e.prototype.pushAny=function(e){return void 0===e?this.pushNew():Array.isArray(e)?this.pushArray(e):this.push(e)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}},e.prototype.removeMany=function(e){var t=this,n=[];return this.data=this.data.filter(function(r,i){return!(i>=t.length)&&(e.indexOf(r)<0||(n.push(r),!1))}),this._length=this.data.length,n},e.prototype.removeUnordered=function(e){var t=n.removeUnordered(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),t},e.prototype.removeUnorderedMany=function(e){var t=n.removeUnorderedMany(this.data,e,this.length,this._hint);return this.length=this.length-t.length,t},e.prototype.front=function(){if(0!==this.length)return this.data[0]},e.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},e.prototype.swapElements=function(e,t){var n;e>=this.length||t>=this.length||(n=[this.data[t],this.data[e]],this.data[e]=n[0],this.data[t]=n[1])},e.prototype.sort=function(e){r.sort(this.data,0,this.length,e)},e.prototype.some=function(e,t){for(var n=0;n<this.length;++n)if(e.call(t,this.data[n],n,this.data))return!0;return!1},e.prototype.find=function(e,t){for(var n=0;n<this.length;++n){var r=this.data[n];if(e.call(t,r,n,this.data))return r}},e.prototype.filter=function(t,n,r){r=r||new e;for(var i=0;i<this.length;++i)t.call(n,this.data[i],i,this.data)&&r.push(this.data[i]);return r},e.prototype.forEach=function(e,t){for(var n=0;n<this.length;++n)e.call(t,this.data[n],n,this.data)},e.prototype.map=function(e,t){for(var n=new Array(this.length),r=0;r<this.length;++r)n[r]=e.call(t,this.data[r],r,this.data);return n},e.prototype._grow=function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length))},e}()}.apply(null,r))||(e.exports=i)},1520:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(186),n(499),n(252),n(256),n(1501),n(49),n(98),n(1521)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c){function d(e,t,n,r,i){var a=t.z||0,o=n.featureExpressionInfoContext;switch(n.mode){case"on-the-ground":var s=e.getElevation(t,"ground")||0;return i&&(i.verticalDistanceToGround=0,i.terrainElevation=s),s;case"relative-to-ground":var l=e.getElevation(t,"ground")||0;s=n.calculateOffsetRenderUnits(r);return null==o&&(s+=a),i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"relative-to-scene":l=e.getElevation(t,"scene")||0,s=n.calculateOffsetRenderUnits(r);return i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"absolute-height":s=n.calculateOffsetRenderUnits(r);if(null==o&&(s+=a),i){l=e.getElevation(t,"ground")||0;i.verticalDistanceToGround=s-l,i.terrainElevation=l}return s;default:n.mode}return 0}function u(e,t,n,r,i,a){var s,c=0;if(e.metadata.usesVerticalDistanceToGround)c=d(i,t,n,a,S),o.updateVertexAttributeAuxpos1w(e,S.verticalDistanceToGround),s=S.terrainElevation;else{var u="absolute-height"!==n.mode;c=d(i,t,n,a,u?S:null),u&&(s=S.terrainElevation)}var p=e.getObjectTransformation();return b[0]=t.x,b[1]=t.y,b[2]=c,l.computeLinearTransformation(t.spatialReference,b,p,r)?e.setObjectTransformation(p):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:s}}function p(e,t){var n=r.pathsToTriangulationInfo(e,t);return{vertexData:n.position,polygons:n.polygons,outlines:n.outlines}}function h(e,t,n,r,i){t*=3,r*=3;for(var a=0;a<i;++a)n[r++]=e[t++],n[r++]=e[t++],n[r++]=e[t++]}function f(e,t,n,r,i,a,o){return l.bufferToBuffer(e,n,t,r,a,i,o)}function v(e,t,n){l.pointToVector(e,t,n)}function g(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function m(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var y=s.mat4d,b=s.vec3d.create(),_=y.identity(),x=i.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,n,r,i,a,o,s,l,d,p){var h=t?t.length:0,f=this._context.clippingExtent;if(v(e,b,this._context.elevationProvider.spatialReference),f&&!g(b,f))return null;v(e,b,this._context.renderSpatialReference);for(var m=this._context.localOriginFactory.getOrigin(b),y=new c({castShadow:!1,metadata:{layerUid:s,graphicUid:l,usesVerticalDistanceToGround:!!d},idHint:o}),x=0;x<h;x++){var S=r?r[x]:_;y.addGeometry(t[x],n[x],S,i,m,p)}return{object:y,terrainElevation:u(y,e,a,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,n){var r=e.elevationContext,a=n.spatialReference;v(t,b,a),r.centerPointInElevationSR=i.makeDehydratedPoint(b[0],b[1],i.hasZ(t)?b[2]:0,a)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return o.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=n.getPointOnPath(t,n.getPathLength(t)/2);return i.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=d,t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=p,t.copyVertices=h,t.chooseOrigin=function(e,t,n,r){var i=Math.floor(t+(n-1)/2);r[0]=e[3*i+0],r[1]=e[3*i+1],r[2]=e[3*i+2]},t.subtractCoordinates=function(e,t,n,r){t*=3;for(var i=0;i<n;++i)e[t++]-=r[0],e[t++]-=r[1],e[t++]-=r[2]},t.setZ=function(e,t,n,r){t*=3;for(var i=0;i<n;++i)e[t+2]=r,t+=3},t.offsetZ=function(e,t,n,r){t*=3;for(var i=0;i<n;++i)e[t+2]+=r,t+=3},t.scaleZ=function(e,t,n,r){t*=3;for(var i=0;i<n;++i)e[t+2]*=r,t+=3},t.flatArrayToArrayOfArrays=function(e,t,n){var r=[];t*=3;for(var i=0;i<n;++i)r.push([e[t++],e[t++],e[t++]]);return r},t.reproject=f,t.reprojectPoint=v,t.getGeometryVertexData3D=function(e,t,n,r,i,a,o){var s=i.spatialReference,l=p(e,t),c=l.vertexData,d=c.length/3,u=new Float64Array(c.length),v=!0;n.equals(s)?h(c,0,u,0,c.length):v=f(c,0,n,u,0,s,d);var g=function(e,t,n,r,i,a,o,s){var l=s.mode,c=0,d=0,u=0,p=s.calculateOffsetRenderUnits(o),h=s.featureExpressionInfoContext;x.spatialReference=e.spatialReference,n*=3,i*=3;for(var f=0;f<a;++f)x.x=t[n+0],x.y=t[n+1],x.z=t[n+2],"on-the-ground"===l?(d=c=e.getElevation(x)||0,u+=c):"relative-to-ground"===l?(d=(c=e.getElevation(x)||0)+p,null==h&&(d+=x.z),u+=c):"relative-to-scene"===l?(d=(c=e.getElevation(x,"scene")||0)+p,u+=c):"absolute-height"===l&&(d=p,null==h&&(d+=x.z)),r[i+0]=t[n+0],r[i+1]=t[n+1],r[i+2]=d,n+=3,i+=3;return{terrainElevation:u/=a}}(i,u,0,c,0,d,a,o);return s.equals(r)||f(c,0,s,c,0,r,d),{geometryData:l,vertexData:c,eleVertexData:u,terrainElevation:g.terrainElevation,projectionSuccess:v}},t.getGeometryVertexDataDraped=function(e,t,n){var r=p(e,!1),i=r.vertexData,a=i.length/3,o=!0;return t.equals(n)||(o=l.bufferToBuffer(i,t,0,i,n,0,a)),{geometryData:r,vertexData:i,projectionSuccess:o}},t.computeBoundingBox=function(e,t,n,r){r[0]=Number.MAX_VALUE,r[1]=Number.MAX_VALUE,r[2]=Number.MAX_VALUE,r[3]=-Number.MAX_VALUE,r[4]=-Number.MAX_VALUE,r[5]=-Number.MAX_VALUE,t*=3;for(var i=0;i<n;++i){var a=e[t++],o=e[t++],s=e[t++];a<r[0]&&(r[0]=a),o<r[1]&&(r[1]=o),s<r[2]&&(r[2]=s),a>r[3]&&(r[3]=a),o>r[4]&&(r[4]=o),s>r[5]&&(r[5]=s)}return r},t.pointInBox2D=g,t.boxesIntersect2D=m,t.boundingBoxClipped=function(e,t){return!!t&&!m(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.needsOffsetAdjustment=function(e,t,n,r){if(!1===t.needsOffsetAdjustment||!1===t.supportsOffsetAdjustment)return!1;if("on-the-ground"===e.mode)return!1;if(0===e.meterUnitOffset){if(!0===t.needsOffsetAdjustment)return!0;if(a.isCalloutSupport(r)&&r.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===e.mode&&(!i.hasZ(n)||e.featureExpressionInfoContext))return!0;if("relative-to-scene"===e.mode)return!0}return!1};var S={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,r))||(e.exports=i)},1521:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1500),n(1567),n(1488),n(1530),n(1504),n(1506),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s,l){var c=l.assert,d=i.mat4d,u=i.vec3d,p=d.identity(),h=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new f,this._bvWorldSpace=new f,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=d.identity(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations)}return e.prototype._initializeGeometryRecords=function(e,t,n){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);c(t.length===e.length,"Object3D: materials don't match geometries"),c(n.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var i=0;i<e.length;i++){c(Array.isArray(t[i]),"Object3D: materials parameter must be array of array");this.geometryRecords[i]=new r(e[i],t[i].slice(),d.create(n[i]),{})}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){c(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getParentLayer=function(){return this.parentLayer},e.prototype.addParentLayer=function(e){this.parentLayer=e},e.prototype.removeParentLayer=function(e){this.parentLayer=null},e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return c(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],n=0;n<this.geometries.length;n++)this.geometries[n]===e&&t.push(this.geometryRecords[n]);return t},e.prototype.getGeometryRecord=function(e){return c(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,n,i,a,o){void 0===n&&(n=p),c(Array.isArray(t),"Object3D.addGeometry: materials must be array"),this.geometries.push(e);var s=new r(e,t.slice(),d.create(n),i||{},a,o);return this.geometryRecords.push(s),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),s},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.getData().componentOffsets;if(!n.isAllHidden(i,a)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=r.geometry.getData().componentOffsets;if(!n.isAllVisible(i,a))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t].getData();if(e=n.hasComponents(r.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var i=e.geometry,a=e.instanceParameters.componentVisibilities,o=i.getData().componentOffsets,s=n.updateVisibility(a,o,t,r);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return n.getVisibility(r,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.hideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,a=n.unhideAllComponents(i);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,r,i){var a=e.instanceParameters.componentHighlights,o=n.addHighlight(a,t,r,i);e.instanceParameters.componentHighlights=o},e.prototype.setComponentHighlight=function(e,t,n){var r=a.generateHighlightId();return this._setComponentHighlight(e,t,n,r),this._notifyDirty("componentHighlightChanged"),r},e.prototype.highlightAllComponents=function(e){for(var t=a.generateHighlightId(),n=0,r=this.geometryRecords;n<r.length;n++){var i=r[n];this._setComponentHighlight(i,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var i=r[t].instanceParameters,a=i.componentHighlights,o=n.removeHighlight(a,e);i.componentHighlights=o}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.getData().componentOffsets;return n.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){c(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var n=this.geometryRecords[e],i=new r(n.geometry,n.materials,d.create(t),n.instanceParameters);this.geometryRecords[e]=i,this._notifyDirty("objGeometryReplaced",[n,i]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return d.create(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){d.set(e,this.objectTransformation),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||d.create(),d.multiply(this.objectTransformation,e.getStaticTransformation(),t),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||d.create(),d.multiply(this.objectTransformation,e.getShaderTransformation(),t),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],n=this.geometryRecords[e],r=t.getBoundingInfo();this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}u.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center),u.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);var i=u.create(),a=u.create(),o=d.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var s=this.geometryRecords[e].getShaderTransformation(),l=d.maxScale(s);r=t.getBoundingInfo();d.multiplyVec3(s,r.getCenter(),i);var c=u.dist(i,this._bvObjectSpace.center),p=r.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,c+p),d.multiplyVec3(this.objectTransformation,i,a);var h=u.dist(a,this._bvWorldSpace.center),f=p*o;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+f)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,n){var r=e.getBBMin(),i=e.getBBMax(),a=u.create(r),o=u.create(i);d.multiplyVec3(n,a),d.multiplyVec3(n,o);for(var s=0;s<3;++s)t.bbMin[s]=Math.min(t.bbMin[s],a[s],o[s]),t.bbMax[s]=Math.max(t.bbMax[s],a[s],o[s]);for(s=0;s<3;++s){u.set(r,a),u.set(i,o),a[s]=i[s],o[s]=r[s],d.multiplyVec3(n,a),d.multiplyVec3(n,o);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],a[l],o[l]),t.bbMax[l]=Math.max(t.bbMax[l],a[l],o[l])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,n,r){if(this._parentLayer){n=n||s.OBJECT;var i=r||this;this._parentLayer.notifyDirty(e,t,n,i)}},e._idGen=new o,e}(),f=function(){function e(){this.bbMin=u.create(),this.bbMax=u.create(),this.center=u.create(),this.bsRadius=0}return e.prototype.init=function(){u.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin),u.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax),u.set3(0,0,0,this.center),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return h}.apply(null,r))||(e.exports=i)},1522:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(21)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([r],{type:n})},t.requestImage=function(e){return n(e,{responseType:"image",allowImageDataAccess:!0}).then(function(e){return e.data})}}.apply(null,r))||(e.exports=i)},1523:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){function n(e,t){return{near:e,far:t}}function r(e,t,n){return e.near=t,e.far=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.empty=function(e){return e?r(e,1/0,-1/0):n(1/0,-1/0)},t.set=r,t.union=function(e,t,n){return void 0===n&&(n=e),n.near=Math.min(e.near,t.near),n.far=Math.max(e.far,t.far),n}}.apply(null,r))||(e.exports=i)},1525:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(25),n(9),n(58),n(252),n(1696),n(1683),n(1550),n(1520),n(1501),n(80),n(1652)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h){function f(e,t){var n=null!=e?t.attributes[e]:0;return null!=n&&isFinite(n)?n:0}var v=new l,g=i.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),m={mode:"on-the-ground",offset:0,unit:"meters"},y={mode:"absolute-height",offset:0,unit:"meters"};return function(e){function t(t,n,r,i){var a=e.call(this)||this;return a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},a.symbolContainer=t,a.symbol=n,a._context=r,a._symbolLayerOrder=r.layerOrder,a._symbolLayerOrderDelta=r.layerOrderDelta,a._elevationContext=new l,a._material=null,a._geometryCreationWarningHandle=null,a._updateDrivenProperties(i),a._updateElevationContext(),a._prepareResources(),a}return n(t,e),t.prototype._logWarning=function(e){g.warn(e)},t.prototype._logGeometryCreationWarnings=function(e,t,n,r){var i=this;if(null==this._geometryCreationWarningHandle){var o=e.projectionSuccess,s=e.geometryData&&e.geometryData.polygons,l=r+" geometry failed to be created",c=null;o?!t.length||1===t.length&&!t[0].length?c=l+" (no "+n+" were defined)":Array.isArray(t)&&Array.isArray(t[0])?t.some(function(e){return 1===e.length})?c=l+" ("+n+" should contain at least 2 vertices)":s&&0===s.length&&"rings"===n&&(c=l+" (filled "+n+" should use clockwise winding - try reversing the order of vertices)"):c=l+" ("+n+" should be defined as a 2D array)":c=l+" (failed to project geometry to view spatial reference)",c&&(this._geometryCreationWarningHandle=a.schedule(function(){return i._onNextTick()}),this._logWarning(c))}},t.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null},t.prototype._validateGeometry=function(e){if("point"===e.type){var t=e;if(!p.isFinite(t.x)||!p.isFinite(t.y))return this._logWarning("point coordinate is not a valid number, graphic skipped"),!1}return!0},t.prototype._prepareResources=function(e){throw new Error("This is an abstract base class")},t.prototype._defaultElevationInfoNoZ=function(){return m},t.prototype._defaultElevationInfoZ=function(){return y},t.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var e=this._context.layer.elevationInfo;e&&this._elevationContext.mixinApi(e);var t=this.symbol&&this.symbol.elevationInfo;t&&this._elevationContext.mixinApi(t),this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext},t.prototype.getGraphicElevationContext=function(e){var t=o.hasZ(e.geometry)?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();v.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:t.unit),v.mode=this._elevationContext.mode||t.mode,v.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:t.offset),v.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext,v.hasOffsetAdjustment=!1,this._elevationOptions.supportsOnTheGround||"on-the-ground"!==v.mode||(v.mode="relative-to-ground",v.setOffsetMeters(0),v.featureExpressionInfoContext=c.zeroContext);var n=c.createFeature(e,this._context.layer);return c.setContextFeature(v.featureExpressionInfoContext,n),d.needsOffsetAdjustment(v,this._elevationOptions,e.geometry,this.symbolContainer)&&(v.setOffsetRenderUnits(s.defaultIconElevationOffset),v.hasOffsetAdjustment=!0),v},t.prototype._getDrapedZ=function(){return-2},t.prototype._updateDrivenProperties=function(e){var t={color:!1,opacity:!1,size:!1};if(!e){var n=this._context.renderer;n&&(t.color=!!n.colorInfo,t.size=!!n.sizeInfo,n.visualVariables&&n.visualVariables.forEach(function(e){switch(e.type){case"color":if(t.color=!0,e.colors)for(var n=0;n<e.colors.length;n++){(r=e.colors[n])&&(Array.isArray(r)&&r.length>3&&255!==r[3]||void 0!==r.a&&255!==r.a)&&(t.opacity=!0)}if(e.stops)for(n=0;n<e.stops.length;n++){var r;(r=e.stops[n].color)&&(Array.isArray(r)&&r.length>3&&255!==r[3]||void 0!==r.a&&255!==r.a)&&(t.opacity=!0)}break;case"opacity":t.opacity=!0;break;case"size":t.size=!0}}))}this._drivenProperties=t},t.prototype._isPropertyDriven=function(e){return this._drivenProperties[e]},t.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var e=this._context.layer.opacity;return null==e?1:e},t.prototype._getMaterialOpacity=function(){var e=1;e*=this._getLayerOpacity();var t=this.symbol&&this.symbol.material;return t&&!this._isPropertyDriven("opacity")&&t.color&&(e*=t.color.a),e},t.prototype._getMaterialOpacityAndColor=function(){var e=this.symbol&&this.symbol.material,t=this._getMaterialOpacity(),n=!this._isPropertyDriven("color")&&e&&e.color?r.toUnitRGB(e.color):null;return u.mixinColorAndOpacity(n,t)},t.prototype._getVertexOpacityAndColor=function(e,t,n){var r=this._isPropertyDriven("color")?e.color:null,i=this._isPropertyDriven("opacity")?e.opacity:null,a=u.mixinColorAndOpacity(r,i);return n&&(a[0]*=n,a[1]*=n,a[2]*=n,a[3]*=n),t?new t(a):a},t.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"},t.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled},t.prototype.updateSymbolLayerOrder=function(e,t){this._symbolLayerOrder=e,this._symbolLayerOrderDelta=t},t.prototype.setDrawOrder=function(e,t,n){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e,n.add(this._material.id))},t.prototype.createGraphics3DGraphic=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];throw new Error("This is an abstract base class")},t.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)},t.prototype.layerPropertyChanged=function(e,t,n){return!1},t.prototype.applyRendererDiff=function(e,t,n,r){return!1},t.prototype.getFastUpdateAttrValues=function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables;return[t.size?f(t.size.field,e):0,t.color?f(t.color.field,e):0,0,0]},t}(h.Promise)}.apply(null,r))||(e.exports=i)},1526:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1597),n(56),n(1500),n(1488),n(1543),n(1502),n(1507),n(1491),n(1544),n(1499),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v){function g(e,t){return void 0===t&&(t=P),e.textureIsSignedDistanceField?function(e,t,n){n[0]=e[0]*(t[2]-t[0])+t[0],n[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):m.set(e.anchorPos,t),t}var m=o.vec2d,y=o.vec3d,b=o.mat3d,_=o.mat4d,x={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},S=[{name:"position",count:3,type:5126,offset:0,stride:76,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],w={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:x.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},A=function(e){function t(t,n){var r=e.call(this,n)||this;return r._textureDirty=!1,r.params=f.copyParameters(t,w),"string"==typeof r.params.anchorPos&&(r.params.anchorPos=x[r.params.anchorPos]),r}return n(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{color:e.color,texCoordScale:e.texCoordScale,polygonOffset:e.polygonOffset,anchorPos:e.anchorPos,screenOffset:e.screenOffset,verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,screenSizePerspectiveAlignment:e.screenSizePerspectiveAlignment,shaderPolygonOffset:e.shaderPolygonOffset,textureIsSignedDistanceField:e.textureIsSignedDistanceField,outlineColor:e.outlineColor,outlineSize:e.outlineSize,distanceFieldBoundingBox:e.distanceFieldBoundingBox,vvSizeEnabled:e.vvSizeEnabled,vvSizeMinSize:e.vvSizeMinSize,vvSizeMaxSize:e.vvSizeMaxSize,vvSizeOffset:e.vvSizeOffset,vvSizeFactor:e.vvSizeFactor,vvColorEnabled:e.vvColorEnabled,vvColorValues:e.vvColorValues,vvColorColors:e.vvColorColors,textureId:e.textureId,occlusionTest:e.occlusionTest,binaryHighlightOcclusion:e.binaryHighlightOcclusion,centerOffsetUnits:e.centerOffsetUnits,debugDrawBorder:e.debugDrawBorder,drawInSecondSlot:e.drawInSecondSlot}},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&h.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 19*e*6},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return S},t.prototype.fillInterleaved=function(e,t,n,r,i,a){for(var o=4*a,s=e.indices[h.VertexAttrConstants.POSITION],l=e.vertexAttr[h.VertexAttrConstants.POSITION].data,c=a+v.findAttribute(S,h.VertexAttrConstants.POSITION).offset/4,d=0;d<s.length;++d){var u=3*s[d];f.fill(l,u,i,c,t,3),c+=19,f.fill(l,u,i,c,t,3),c+=19,f.fill(l,u,i,c,t,3),c+=19,f.fill(l,u,i,c,t,3),c+=19,f.fill(l,u,i,c,t,3),c+=19,f.fill(l,u,i,c,t,3),c+=19}var p=e.indices[h.VertexAttrConstants.NORMAL],g=e.vertexAttr[h.VertexAttrConstants.NORMAL].data,m=a+v.findAttribute(S,h.VertexAttrConstants.NORMAL).offset/4;for(d=0;d<p.length;++d){u=3*p[d];f.fill(g,u,i,m,n,3),m+=19,f.fill(g,u,i,m,n,3),m+=19,f.fill(g,u,i,m,n,3),m+=19,f.fill(g,u,i,m,n,3),m+=19,f.fill(g,u,i,m,n,3),m+=19,f.fill(g,u,i,m,n,3),m+=19}var y,b,_,x,w=e.vertexAttr[h.VertexAttrConstants.UV0].data;null==w||w.length<=3?(y=0,b=0,_=this.params.texCoordScale[0],x=this.params.texCoordScale[1]):(y=e.vertexAttr[h.VertexAttrConstants.UV0].data[0],b=e.vertexAttr[h.VertexAttrConstants.UV0].data[1],_=e.vertexAttr[h.VertexAttrConstants.UV0].data[2],x=e.vertexAttr[h.VertexAttrConstants.UV0].data[3]),_=Math.min(1.99999,_+1),x=Math.min(1.99999,x+1);var A=a+v.findAttribute(S,h.VertexAttrConstants.UV0).offset/4;for(d=0;d<s.length;++d)i[A]=y,i[A+1]=b,i[A+=19]=_,i[A+1]=b,i[A+=19]=_,i[A+1]=x,i[A+=19]=_,i[A+1]=x,i[A+=19]=y,i[A+1]=x,i[A+=19]=y,i[A+1]=b,A+=19;var C=e.indices[h.VertexAttrConstants.COLOR],O=e.vertexAttr[h.VertexAttrConstants.COLOR].data,R=o+v.findAttribute(S,h.VertexAttrConstants.COLOR).offset,E=new Uint8Array(i.buffer);for(d=0;d<C.length;++d){u=4*C[d];f.fillColor(O,u,E,R,4),R+=76,f.fillColor(O,u,E,R,4),R+=76,f.fillColor(O,u,E,R,4),R+=76,f.fillColor(O,u,E,R,4),R+=76,f.fillColor(O,u,E,R,4),R+=76,f.fillColor(O,u,E,R,4),R+=76}var P=e.indices[h.VertexAttrConstants.SIZE],T=e.vertexAttr[h.VertexAttrConstants.SIZE].data,D=a+v.findAttribute(S,h.VertexAttrConstants.SIZE).offset/4;for(d=0;d<P.length;++d){var I=T[2*P[d]],M=T[2*P[d]+1];i[D]=I,i[D+1]=M,i[D+=19]=I,i[D+1]=M,i[D+=19]=I,i[D+1]=M,i[D+=19]=I,i[D+1]=M,i[D+=19]=I,i[D+1]=M,i[D+=19]=I,i[D+1]=M,D+=19}if(null!=e.indices[h.VertexAttrConstants.AUXPOS1]&&null!=e.vertexAttr[h.VertexAttrConstants.AUXPOS1]){var L=e.indices[h.VertexAttrConstants.AUXPOS1],V=e.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,F=a+v.findAttribute(S,"auxpos1").offset/4;for(d=0;d<L.length;++d){u=4*L[d];f.fill(V,u,i,F,null,4),F+=19,f.fill(V,u,i,F,null,4),F+=19,f.fill(V,u,i,F,null,4),F+=19,f.fill(V,u,i,F,null,4),F+=19,f.fill(V,u,i,F,null,4),F+=19,f.fill(V,u,i,F,null,4),F+=19}}if(null!=e.indices[h.VertexAttrConstants.AUXPOS2]&&null!=e.vertexAttr[h.VertexAttrConstants.AUXPOS2]){var z=e.indices[h.VertexAttrConstants.AUXPOS2],U=e.vertexAttr[h.VertexAttrConstants.AUXPOS2].data,N=a+v.findAttribute(S,"auxpos2").offset/4;for(d=0;d<z.length;++d){u=4*z[d];f.fill(U,u,i,N,null,4),N+=19,f.fill(U,u,i,N,null,4),N+=19,f.fill(U,u,i,N,null,4),N+=19,f.fill(U,u,i,N,null,4),N+=19,f.fill(U,u,i,N,null,4),N+=19,f.fill(U,u,i,N,null,4),N+=19}}},t.prototype.intersect=function(e,t,n,r,i,o,s,l){if(r.isSelection&&r.enableHUDSelection&&!a.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var c=e.getData(),d=this.params,p=1,f=1;if(_.toMat3(n,V),l){var v=l(U);p=v[0],f=v[5],function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+n*n+r*r),u=1/Math.sqrt(i*i+a*a+o*o),p=1/Math.sqrt(s*s+l*l+c*c);e[0]=t*d,e[1]=n*d,e[2]=r*d,e[3]=i*u,e[4]=a*u,e[5]=o*u,e[6]=s*p,e[7]=l*p,e[8]=c*p}(V)}var m=c.getVertexAttr()[h.VertexAttrConstants.POSITION],b=c.getVertexAttr()[h.VertexAttrConstants.SIZE],x=c.getVertexAttr()[h.VertexAttrConstants.NORMAL];h.assert(m.size>=3);for(var S=r.point,w=r.camera,A=g(d),C=0;C<m.data.length/m.size;C++){var O=C*m.size;y.set3(m.data[O],m.data[O+1],m.data[O+2],T),_.multiplyVec3(n,T,T);var R=C*b.size;B[0]=b.data[R]*p,B[1]=b.data[R+1]*f,_.multiplyVec3(w.viewMatrix,T);var P=C*x.size;if(y.set3(x.data[P],x.data[P+1],x.data[P+2],D),this.applyVerticalOffsetTransformation(T,D,V,w,E),w.applyProjection(T,I),I[0]>-1){var M=Math.floor(I[0]),z=Math.floor(I[1]);u.applyPrecomputedScaleFactorVec2(B,E.factor,B);var j=M-N-(A[0]>0?B[0]*A[0]:0),G=j+B[0]+2*N,H=z-N-(A[1]>0?B[1]*A[1]:0),k=H+B[1]+2*N;if(d.textureIsSignedDistanceField){var W=d.outlineSize/2,q=d.distanceFieldBoundingBox;j+=B[0]*q[0],H+=B[1]*q[1],G-=B[0]*(1-q[2]),k-=B[1]*(1-q[3]),j-=W,G+=W,H-=W,k+=W}if(S[0]>j&&S[0]<G&&S[1]>H&&S[1]<k){var $=r.p0,X=r.p1;_.multiplyVec3(_.inverse(w.viewMatrix,F),T,L),I[0]=S[0],I[1]=S[1],w.unprojectPoint(I,T);var Y=y.negate(r.getDirection(),y.create());s(y.dist($,T)/y.dist($,X),Y,-1,1,!0,L)}}}}},t.prototype.normalAndViewAngle=function(e,t,n,r){return void 0===r&&(r=z),b.multiplyVec3(t,e,r.normal),_.multiplyVec3(n.viewInverseTransposeMatrix,r.normal),r.cosAngle=y.dot(M,j),r},t.prototype.updateScaleInfo=function(e,t,n){var r=this.params;r.screenSizePerspective?e.factor=u.precomputeScaleFactor(z.cosAngle,n,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?(e.scaleAlignment=u.precomputeScale(z.cosAngle,n,r.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=r.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,n,r,i,a){var o=this.params;if(16===n.length&&(n=_.toMat3(n,V)),!o.verticalOffset||!o.verticalOffset.screenLength){if(i&&(o.screenSizePerspective||o.screenSizePerspectiveAlignment)){var s=this.normalAndViewAngle(t,n,r),l=y.length(e);this.updateScaleInfo(i,s.cosAngle,l)}else i&&(i.factor.scale=1,i.scaleAlignment=1);return a?y.set(e,a):e}var c=this.normalAndViewAngle(t,n,r),d=y.length(e),u=o.screenSizePerspectiveAlignment||o.screenSizePerspective,p=f.verticalOffsetAtDistance(r,d,o.verticalOffset,c.cosAngle,u);return i&&this.updateScaleInfo(i,c.cosAngle,d),y.add(e,y.scale(c.normal,p),a)},t.prototype.getGLMaterials=function(){return{color:O,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:R}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,n){return void 0===n&&(n=i.create()),function(e,t,n,r){void 0===r&&(r=P),m.set(e.anchorPos,r),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n}(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n},t.prototype.calculateAnchorPosForRendering=function(e){return g(this.params,e)},t.loadShaders=function(e,t,n){e._parse(r);var i=function(e){e.addDefine("OcclTest","OCCL_TEST"),e.addDefine("SDF","SIGNED_DISTANCE_FIELD"),e.addDefine("vvSize","VV_SIZE"),e.addDefine("vvColor","VV_COLOR"),e.addDefine("verticalOffset","VERTICAL_OFFSET"),e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),e.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},a=new p("hud",["vertexShaderHUD","fragmentShaderHUD"],null,t,e,n);i(a),a.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER"),t.addShaderVariations("hud-material-shader-variations",a);var o=new p("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,t,e,n);i(o),o.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION"),t.addShaderVariations("hud-material-highlight-shader-variations",o);var s=new p("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,t,e,n);s.addDefine("verticalOffset","VERTICAL_OFFSET"),s.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),s.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN"),t.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",s)},t.shouldRenderVisibilityDuringRenderPass=function(e){return e===c.MATERIAL||c.MATERIAL_HIGHLIGHT},t}(l),C=function(e){function t(t,n,r){var i=e.call(this,t,n,r,t.getParams().textureId)||this;return i.params=f.copyParameters(t.getParams()),i.selectProgram(),i.selectSlot(),i}return n(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?d.HUDMATERIAL2:d.HUDMATERIAL1},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.color=e.color,t.texCoordScale=e.texCoordScale,t.polygonOffset=e.polygonOffset,t.anchorPos=e.anchorPos,t.screenOffset=e.screenOffset,t.verticalOffset=e.verticalOffset,t.screenSizePerspective=e.screenSizePerspective,t.screenSizePerspectiveAlignment=e.screenSizePerspectiveAlignment,t.shaderPolygonOffset=e.shaderPolygonOffset,t.textureIsSignedDistanceField=e.textureIsSignedDistanceField,t.outlineColor=e.outlineColor,t.outlineSize=e.outlineSize,t.vvSizeEnabled=e.vvSizeEnabled,t.vvSizeMinSize=e.vvSizeMinSize,t.vvSizeMaxSize=e.vvSizeMaxSize,t.vvSizeOffset=e.vvSizeOffset,t.vvSizeFactor=e.vvSizeFactor,t.vvColorEnabled=e.vvColorEnabled,t.vvColorValues=e.vvColorValues,t.vvColorColors=e.vvColorColors,this.updateTexture(e.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var n=this.params,r=this.getProgram();this.bindTexture(e,r),r.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),r.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75),r.setUniform4fv("overrideColor",n.color),r.setUniform1f("pixelRatio",t.pixelRatio),n.textureIsSignedDistanceField&&(r.setUniform4fv("outlineColor",n.outlineColor),r.setUniform1f("outlineSize",n.outlineSize)),n.vvSizeEnabled&&(r.setUniform3fv("vvSizeMinSize",n.vvSizeMinSize),r.setUniform3fv("vvSizeMaxSize",n.vvSizeMaxSize),r.setUniform3fv("vvSizeOffset",n.vvSizeOffset),r.setUniform3fv("vvSizeFactor",n.vvSizeFactor)),n.vvColorEnabled&&(r.setUniform1fv("vvColorValues",n.vvColorValues),r.setUniform4fv("vvColorColors",n.vvColorColors)),r.setUniform2fv("texScale",n.texCoordScale),r.setUniform2f("screenOffset",2*n.screenOffset[0],2*n.screenOffset[1]),r.setUniform2fv("anchorPos",g(n)),n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var n=t.cameraAboveGround?1:-1,r=this.getProgram(),i=this.params;e.bindProgram(r),r.setUniform1f("cameraGroundRelative",n),r.setUniform1f("polygonOffset",i.shaderPolygonOffset),r.setUniform4fv("viewport",t.viewport),f.bindVerticalOffset(i.verticalOffset,t,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.screenSizePerspective&&(f.bindScreenSizePerspective(i.screenSizePerspective,r,"screenSizePerspective"),f.bindScreenSizePerspective(i.screenSizePerspectiveAlignment||i.screenSizePerspective,r,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var n=t.origin,r=this.getProgram();f.bindView(n,t.view,r),f.bindCamPos(n,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var n=this.getProgram();n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(s),O=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.isOcclusionSlot=!1,i}return n(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits]),this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,!!e.debugDrawBorder])},t.prototype.getDrawMode=function(e){var t=e.gl;return this.isOcclusionSlot?t.POINTS:t.TRIANGLES},t.prototype.release=function(e){var t=e.gl;e.setDepthFunction(t.LESS),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){var n=e.gl;this.bindProjection(e,t);var r=this.getProgram();e.setDepthTestEnabled(!0),e.setDepthFunction(n.LEQUAL),this.isOcclusionSlot?r.setUniform4f("color",1,1,1,1):(this.bindRender(e,t),this.bindTexture(e,r))},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=e===d.OCCLUSION_PIXELS,e===d.OCCLUSION_PIXELS||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(C),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,e.binaryHighlightOcclusion])},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(C),E={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},P=[0,0],T=y.create(),D=y.create(),I=y.create(),M=y.create(),L=y.create(),V=b.create(),F=_.create(),z={normal:M,cosAngle:0},U=_.create();_.identity(U);var N=1,B=[0,0],j=[0,0,1];return A}.apply(null,r))||(e.exports=i)},1527:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1500),n(1649),n(1487)],void 0===(i=function(e,t,n,r,i){function a(e){var t=i.getFirstObjectValue(e);return t.data.length/t.size}return function(){function e(t,i,o,s){void 0===i&&(i=e.DefaultIndices),void 0===o&&(o=e.DefaultOffsets),void 0===s&&(s="triangle"),this.preinterleaved=!1;var l={};for(var c in t){var d=t[c],u=d.data,p=d.size;l[c]={data:u,size:p,offsetIdx:0,strideIdx:p}}if(i===e.DefaultIndices){var h=a(l),f=r.generateDefaultIndexArray(h);for(var v in i={},l)i[v]=f}this._id=r.getNewId(),this._vertexAttributes=l,this._indices=i,this._componentOffsets=n.createOffsets(o),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return i.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices.position){var t=3;e+=this._indices.position.length*t*4}if(this._indices.normal){t=3;e+=this._indices.normal.length*t*4}if(this._indices.uv0){t=2;e+=this._indices.uv0.length*t*4}if(this._indices.color){t=1;e+=this._indices.color.length*t*4}return e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}()}.apply(null,r))||(e.exports=i)},1529:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=!!Map.prototype.entries;t.forEachUntilMap=n?function(e,t){for(var n=e.entries();;){var r=n.next();if(r.done)break;if(!1===t(r.value[1],r.value[0]))return!1}return!0}:function(e,t){var n=!0;return e.forEach(function(e,r){n&&(n=!1!==t(e,r))}),n}}.apply(null,r))||(e.exports=i)},1530:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1504)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=new n;t.generateHighlightId=function(){return r.gen("highlight")}}.apply(null,r))||(e.exports=i)},1531:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1513),n(1516),n(473),n(1550),n(1698),n(1501),n(49),n(1511)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){var u=function(){function e(t,n,r,i,a,o,l,c){this.type="object3d",this._addedToStage=!1,this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=t,this.uniqueMaterials=i,this.uniqueGeometries=r,this.uniqueTextures=a,this.stageObject=n,this.elevationAligner=o,this.elevationContext=new s(l),this.stage=null,this.stageLayer=null,this._visible=!1,this.visibilityMode=null!=c?c:e.VisibilityModes.HIDE_FACERANGE}return e.prototype.initialize=function(e,t){if(this.stageLayer=e,this.stage=t,this.uniqueMaterials)for(var n=0;n<this.uniqueMaterials.length;n++)t.add(d.ModelContentType.MATERIAL,this.uniqueMaterials[n]);if(this.uniqueGeometries)for(n=0;n<this.uniqueGeometries.length;n++)t.add(d.ModelContentType.GEOMETRY,this.uniqueGeometries[n]);if(this.uniqueTextures)for(n=0;n<this.uniqueTextures.length;n++)t.add(d.ModelContentType.TEXTURE,this.uniqueTextures[n]);t.add(d.ModelContentType.OBJECT,this.stageObject)},e.prototype.setVisibility=function(t){if(null!=this.stage){if(this._visible!==t){this._visible=t,this._visible?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===e.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var n=this.stage.view.getEdgeView();return n&&n.hasObject(this.stageObject)&&n.updateObjectVisibility(this.stageObject,this._visible),!0}return!1}},e.prototype.destroy=function(){var e=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var t=0;t<this.uniqueMaterials.length;t++)e.remove(d.ModelContentType.MATERIAL,this.uniqueMaterials[t].id);if(this.uniqueGeometries)for(t=0;t<this.uniqueGeometries.length;t++)e.remove(d.ModelContentType.GEOMETRY,this.uniqueGeometries[t].id);if(this.uniqueTextures)for(t=0;t<this.uniqueTextures.length;t++)e.remove(d.ModelContentType.TEXTURE,this.uniqueTextures[t].id)}e.remove(d.ModelContentType.OBJECT,this.stageObject.id),this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var n=this.stage.view.getEdgeView();n&&n.hasObject(this.stageObject)&&n.removeObject(this.stageObject),this._visible=!1,this.stageLayer=null,this.stage=null},e.prototype.alignWithElevation=function(e,t,n){if(this.elevationAligner){o.setContextFeature(this.elevationContext.featureExpressionInfoContext,n);var r=this.elevationAligner(this,this.elevationContext,e,t);null!=r&&(this.alignedTerrainElevation=r)}},e.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},e.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)},e.prototype.getBoundingBoxObjectSpace=function(e){return function(e,t,n){return n||(n=a.create()),a.setMin(n,e.getBBMin(t)),a.setMax(n,e.getBBMax(t)),n}(this.stageObject,!0,e)},e.prototype.getProjectedBoundingBox=function(e,t,n,o){return i(this,void 0,void 0,function(){var i,s,d,u,g,m,y,b,_;return r(this,function(r){switch(r.label){case 0:for(i=this.getBoundingBoxObjectSpace(n),s=v,d=a.isPoint(i)?1:s.length,m=0;m<d;m++)u=s[m],h[0]=i[u[0]],h[1]=i[u[1]],h[2]=i[u[2]],c.mat4d.multiplyVec3(this.stageObject.objectTransformation,h),p[3*m+0]=h[0],p[3*m+1]=h[1],p[3*m+2]=h[2];if(!e(p,0,d))return[2,null];for(a.empty(i),g=null,this.calculateRelativeScreenBounds&&(g=this.calculateRelativeScreenBounds()),m=0;m<3*d;m+=3){for(y=0;y<3;y++)i[y]=Math.min(i[y],p[m+y]),i[y+3]=Math.max(i[y+3],p[m+y]);g&&o.push({location:p.slice(m,m+3),screenSpaceBoundingRect:g})}if(!t)return[3,5];if(a.center(i,f),"absolute-height"===this.elevationContext.mode)return[3,5];b=void 0,_=l.demResolutionForBoundingBox(i,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.service.queryElevation(f[0],f[1],_)];case 2:return b=r.sent(),[3,4];case 3:return r.sent(),b=null,[3,4];case 4:null!=b&&a.offset(i,0,0,-this.alignedTerrainElevation+b),r.label=5;case 5:return[2,i]}})})},e.prototype.addHighlight=function(e,t){var n=this.stageObject.highlightAllComponents(t);e.addObject(this.stageObject,n)},e.prototype.removeHighlight=function(e){e.removeObject(this.stageObject)},e}();!function(e){!function(e){e[e.REMOVE_OBJECT=0]="REMOVE_OBJECT",e[e.HIDE_FACERANGE=1]="HIDE_FACERANGE"}(e.VisibilityModes||(e.VisibilityModes={}))}(u||(u={}));var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=c.vec3d.create(),f=c.vec3d.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return u}.apply(null,r))||(e.exports=i)},1532:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1488)],void 0===(i=function(e,t,n){var r=n.vec3d,i=n.mat4d;return function(){function e(e,t,n,i,a,o,s,l,c,d,u){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=n,this.origin=null,this.center=r.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=a,i&&this.updateTransformation(i,o),this.castShadow=s,this.singleUse=l,this.name=c,this.uniqueName=d,this.idx=u,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||i.maxScale(e),i.multiplyVec3(e,this.boundingInfo.getCenter(),n),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.create()),i.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,r))||(e.exports=i)},1534:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(7),n(16),n(1),n(475),n(1509)],void 0===(i=function(e,t,n,r,i,a,o,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsHeightUnitConversion=!1,t}return n(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,n){a.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var r=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);r?n(r):t()})})},r([o.property()],t.prototype,"view",void 0),r([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(o.declared(l))}.apply(null,r))||(e.exports=i)},1536:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(23),n(1520),n(1501),n(49),n(1512),n(98),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=l.VertexAttrConstants,d=new n,u=a.vec3d.create(),p=a.vec3d.create(),h=a.vec3d.create(),f=a.vec3d.create(),v=a.mat4d.create(),g={verticalDistanceToGround:0,terrainElevation:0};t.perVertexElevationAligner=function(e,n,i,a){var s=e.stageObject,l=i.spatialReference;d.spatialReference=l;for(var f=s.getGeometryRecords(),v=f.length,m="absolute-height"!==n.mode,y=0,b=0;b<v;b++){var _=f[b].geometry,x=f[b].getShaderTransformation(),S=_.getData();p[0]=x[12],p[1]=x[13],p[2]=x[14],_.invalidateBoundingInfo();for(var w=S.getVertexAttr(),A=w[c.POSITION],C=A.data,O=w.mapPos.data,R=A.size,E=C.length/R,P=0,T=0,D=!1,I=0,M=0;M<E;M++){d.x=O[T++],d.y=O[T++],d.z=O[T++],h[0]=C[P],h[1]=C[P+1],h[2]=C[P+2];var L=r.computeElevation(i,d,n,a,m?g:null);if(m&&(I+=g.terrainElevation),u[0]=C[P]+p[0],u[1]=C[P+1]+p[1],u[2]=C[P+2]+p[2],a.setAltitude(L,u),C[P]=u[0]-p[0],C[P+1]=u[1]-p[1],C[P+2]=u[2]-p[2],o.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)D=!0;else{var V=t.updateThresholdInMeters/a.unitInMeters;(Math.abs(h[0]-C[P])>=V||Math.abs(h[1]-C[P+1])>=V||Math.abs(h[2]-C[P+2])>=V)&&(D=!0)}P+=R}y+=I/E,D&&s.geometryVertexAttrsUpdated(b)}return y/v},t.perObjectElevationAligner=function(e,n,a,l,c){var d=e.stageObject,p=n.centerPointInElevationSR,h=0,f=0;if(d.metadata.usesVerticalDistanceToGround)h=r.computeElevation(a,p,n,l,g),i.updateVertexAttributeAuxpos1w(d,g.verticalDistanceToGround),f=g.terrainElevation;else{var v="absolute-height"!==n.mode;h=r.computeElevation(a,p,n,l,v?g:null),v&&(f=g.terrainElevation)}var m=d.getObjectTransformation(),y=[m[12],m[13],m[14]];o.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=p.x,u[1]=p.y,u[2]=h,s.computeLinearTransformation(p.spatialReference,u,m,l.spatialReference)&&d.setObjectTransformation(m)):l.setAltitudeOfTransformation(h,m);var b=t.updateThresholdInMeters/l.unitInMeters;return(Math.abs(m[12]-y[0])>=b||Math.abs(m[13]-y[1])>=b||Math.abs(m[14]-y[2])>=b)&&d.setObjectTransformation(m),f},t.perLodInstanceElevationAligner=function(e,t,n,i,a){var l,c=t.centerPointInElevationSR,d=0,p="absolute-height"!==t.mode;l=r.computeElevation(n,c,t,i,p?g:null),p&&(d=g.terrainElevation);var h=e.graphics3DSymbolLayer.lodRenderer.instanceData;return h.getTranslation(e.instanceIndex,f),o.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=c.x,u[1]=c.y,u[2]=l,s.computeLinearTransformation(c.spatialReference,u,v,i.spatialReference)&&h.setTransform(e.instanceIndex,v)):i.setAltitude(l,f),h.setTranslation(e.instanceIndex,f),d},t.updateThresholdInMeters=.01,t.iterativeUpdatesEnabled=!0}.apply(null,r))||(e.exports=i)},1537:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1563)],void 0===(i=function(e,t,n){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=n.now()},e.prototype.stop=function(){var e=n.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,r))||(e.exports=i)},1538:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(185),n(1488),n(1506),n(1568),n(1532),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s){var l=s.assert,c=r.vec3d,d=r.mat4d,u=s.logWithBase;return function(){function e(){for(var e in this.dirtySet=new a(this),this._uniqueIdx=0,this._id2origin={},this.content={},i)this.content[i[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return l(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var n=this.content[e];l(void 0!==n);var r=t.id;l(null==n[r],"Model/Stage already contains object to be added"),n[r]=t,e===i.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var n=this.content[e];l(void 0!==n);var r=n[t];return l(void 0!==r,"Model/Stage doesn't contain object to be removed"),delete n[t],e===i.TEXTURE&&r.unload(),e===i.LAYER&&this.notifyDirty(e,r,"layerRemoved"),r},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,n,r){this.dirtySet.handleUpdate(t,n,r)},e.prototype.getOrigin=function(e,t,n){void 0===n&&(n=10);var r=0,i=t*n/1e4;i>1&&(r=Math.ceil(u(i,2)));var a=1e4*Math.pow(2,r),o=Math.round(e[0]/a),s=Math.round(e[1]/a),l=Math.round(e[2]/a),d=r+"_"+o+"_"+s+"_"+l,p=this._id2origin[d];return null==p&&(p={vec3:c.createFrom(o*a,s*a,l*a),id:d},this._id2origin[d]=p),p},e.prototype.getGeometryRenderGeometries=function(e,t,n){var r=e.id,i=t.geometry,a=i.getData(),s=!!i.singleUse,l=t.materials,c=t.instanceParameters,u=e.getCombinedStaticTransformation(t),p=d.maxScale(u),h=t.origin,f=i.getBoundingInfo(),v=t.id,g=this._uniqueIdx++,m=new o(a,f,l[0],u,t.customTransformation,p,e.getCastShadow(),s,r,v,g);m.origin=h||this.getOrigin(m.center,m.bsRadius),m.instanceParameters=c,n.push(m)},e.prototype.updateRenderGeometryTransformation=function(e,t,n){e.getCombinedStaticTransformation(t,n.transformation),n.updateTransformation(n.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var r in t[0]="<table>",i){var a=i[r];t[0]+="<tr><td>"+a+'</td><td style="text-align: right">'+Object.keys(this.getAll(a)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var r in t[0]="",i){a=i[r];t[0]+=n.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(i.OBJECT);for(var t in e)this.validateObject(e[t]);var n=this.getAll(i.LAYER);for(var r in n)this.validateLayer(n[r]);var a=this.getAll(i.MATERIAL);for(var o in a)this.validateMaterial(a[o])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,n=0;n<t.length;++n){var r=t[n];l(null!=this.get(i.GEOMETRY,r.geometry.id)),l(1===r.materials.length,"object materials do not match geometry groups"),l(null!=this.get(i.MATERIAL,r.materials[0].id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),n=0;n<t.length;++n){var r=this.get(i.OBJECT,t[n].id);l(null!=r)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),n=0;n<t.length;++n){var r=this.get(i.TEXTURE,t[n]);l(null!=r)}},e.ContentType=i,e}()}.apply(null,r))||(e.exports=i)},1539:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1570),n(1492),n(1488),n(1503),n(1487),n(1495),n(1493),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c){return function(){function e(e,t,n){this._quadVAO=null,this._rctx=n,this._colorFBO=void 0,this._viewportToRestore=i.vec4d.create(),this.programRep=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){o.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){o.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this.programRep.get("render-occluded-apply");e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,c.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=a.createQuadVAO(this._rctx),this._colorFBO=s.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e.loadShaders=function(e,t,i){e._parse(n),t.add("render-occluded-apply",new l(i,e.vsRenderOccludedApply,e.fsRenderOccludedApply,r.Default3D))},e}()}.apply(null,r))||(e.exports=i)},1540:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1529),n(1500),n(1492),n(1573),n(1574),n(1575),n(1488),n(1576),n(1577),n(1578),n(1579),n(1580),n(1572),n(1507),n(1491),n(1581),n(1582),n(1487),n(1541),n(1594),n(1526),n(1497),n(1598),n(1490),n(1489),n(1496)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A,C,O,R){function E(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;return r.generateVisibleIndexRanges(t,n)}function P(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,n=e.instanceParameters.componentHighlights,i=e.componentOffsets;return r.generateHighlightedIndexRanges(t,n,i)}function T(e,t,n){var r=e.origin.vec3;b.setMatrixTranslation3(k,-r[0],-r[1],-r[2]),F.multiply(k,e.transformation,t),F.inverse(t,n),F.transpose(n)}function D(e,t,n){for(var r in e){var i=e[r];t(r,i),i.origin2data.forEach(function(e,t){n(t,e)})}}function I(e){return M(e.data)>=1}function M(e){return!1===e.preinterleaved?b.getFirstObjectValue(e.indices).length:e.indexCount}var L,V=l.vec2d,F=l.mat4d,z=F.identity(),U=1535,N=function(){function e(e,t,n,r,i){this._lighting=new x.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._externalRenderers=new a,this._renderContext=new f,this._isRendering=!1,this._highlights=[],this._pixelRatio=1,this._threshold=U,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new B,this._edgeView=null,this._edgeViewLoaded=!1,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=i,this._rctx=r,this._fxaaPass=new s(r),this._smaaPass=new m(r),this._renderContext.rctx=r,this._renderContext.lightingData=this._lighting.getOld(),r.setDepthTestEnabled(!0),r.setFaceCullingEnabled(!0),r.setBlendingEnabled(!1),r.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null},this._linearDepthTextureHelper=new p(r),this._normalTextureHelper=new h(r),this._highlightTextureHelper=new c(r),this._stencilRenderingHelper=new y(r),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,n=new C(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:n}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},n=function(e,t){if(t.type===L.Preinterleaved)for(var n in t.instances)t.instances[n].vao.dispose(!0);else t.vao.dispose(!0)};D(this._mat2DataMerged,t,n),D(this._mat2DataInstanced,t,n),D(this._mat2DataPreinterleaved,t,n),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._highlightTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return this._edgeViewLoaded||(this._edgeViewLoaded=!0,_.EdgeView.isSupported(this._rctx)&&(this._edgeView=new _.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize())),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},e.prototype.setPixelRatio=function(e){this._pixelRatio=e,this._needsRender=!0},e.prototype.getPixelRatio=function(){return this._pixelRatio},e.prototype.addExternalRenderer=function(e,t){return this._externalRenderers.addRenderer(e,t),!0},e.prototype.removeExternalRenderer=function(e){return this._externalRenderers.removeRenderer(e),!0},e.prototype.getExternalRenderers=function(){return this._externalRenderers},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._externalRenderers.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},n=function(t,n){if(n.type===L.Preinterleaved)for(var r in n.instances){var i=n.instances[r].vao.size;e._stats.VBOallocatedSize+=i/4,e._stats.VBOusedSize+=i/4,e._stats.VBOoptimalSize+=i/4}else e._stats.VBOallocatedSize+=n.buffer.getArray().length,e._stats.VBOusedSize+=n.buffer.getSize(),e._stats.VBOoptimalSize+=n.optimalCount};return D(this._mat2DataMerged,t,n),D(this._mat2DataInstanced,t,n),D(this._mat2DataPreinterleaved,t,n),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,n=S.shouldRenderVisibilityDuringRenderPass(e.pass),r=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,i=!1;return n&&r&&e.offscreenRenderingHelper.renderHUDVisibility(function(){i=t._renderInternalSlot(g.OCCLUSION_PIXELS,e)}),i},e.prototype.renderGeometrySlotsPt1=function(e){this._externalRenderers.render(g.INTERNAL_MATERIAL,e),this._renderInternalSlot(g.STENCIL_MATERIAL,e),this._externalRenderers.render(g.OPAQUE_TERRAIN,e),this._renderInternalSlot(g.OPAQUE_MATERIAL,e),this._externalRenderers.render(g.OPAQUE_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._externalRenderers.render(g.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext),this._renderInternalSlot(g.TRANSPARENT_MATERIAL,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(g.LINE_CALLOUTS,this._renderContext)),this._externalRenderers.render(g.TRANSPARENT_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._externalRenderers.render(g.TRANSPARENT_TERRAIN,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(g.LINE_CALLOUTS_HUD_DEPTH,this._renderContext),this._renderInternalSlot(g.HUDMATERIAL1,this._renderContext),this._renderInternalSlot(g.HUDMATERIAL2,this._renderContext)},e.prototype._renderHighlights=function(e,t,n){var r=!!n&&n.enabled&&(this.hasHighlights||this._externalRenderers.needsHighlight());if(this._highlightTextureHelper.enabled=r,r){var i=null;n.profilingCallback&&(i=A.startMeasurement(this._renderContext.rctx)),this._highlightTextureHelper.setupFBOs(e),this._highlightTextureHelper.prepareHighlightPass(),this.renderGeometryPass(v.MATERIAL_HIGHLIGHT,e,null,null);var a=this._rctx.gl;this._rctx.clear(a.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(t);var o=this._highlightTextureHelper.framebuffer;n.render(e,t,o),null!==i&&n.profilingCallback&&i.stop(function(e){n.profilingCallback&&n.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var n=this._mat2DataInstanced[t][0];if(n&&n.renderOccluded&&n.beginSlot(e)&&n.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,n){if(t&&n&&n.enabled){var r=this._needsRenderOccluded(g.OPAQUE_MATERIAL)||this._needsRenderOccluded(g.TRANSPARENT_MATERIAL);if(t.enabled=r,r){var i=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),i.pass=v.MATERIAL,i.renderOccludedOnly=!0,this._renderInternalSlot(g.OPAQUE_MATERIAL,i),this._renderInternalSlot(g.TRANSPARENT_MATERIAL,i),i.renderOccludedOnly=!1,t.finish(n.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,n,r){var i=this,a=this._rctx;this._isRendering=!0,this._stats.reset(),this._updateGlobalUniforms(e.projectionMatrix),this._renderContext.pass=v.MATERIAL,this._renderContext.camera=e,this._renderContext.pixelRatio=this._pixelRatio,this._renderContext.shadowMap=t,this._renderContext.ssaoHelper=r.ssao,this._renderContext.offscreenRenderingHelper=r.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,r.offscreenRendering.enabled=!0,r.offscreenRendering.initializeFrame(e),this._externalRenderers.render(g.BACKGROUND,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&r.offscreenRendering.renderSeparateAndComposite(function(){i._edgeView.render(i._bindParameters)},void 0,"alpha");var o={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(o.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(g.LINE_CALLOUTS,this._renderContext)),o.transparentTerrain=this.renderTransparentTerrain(this._renderContext),o.transparentTerrain&&o.hudVisibility&&(r.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),r.offscreenRendering.renderToTargets(function(){return i.renderHUD("occluded")},r.offscreenRendering.mainColor,r.offscreenRendering.tmpDepth,void 0,!0)),o.transparentTerrain&&r.offscreenRendering.compositeTransparentTerrainOntoMain(),r.offscreenRendering.renderToTargets(function(){i._externalRenderers.render(g.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,i._renderContext),i._externalRenderers.render(g.POSTPROCESSING_EXTERNAL,i._renderContext),i._renderOccluded(e,r.renderOccluded,r.offscreenRendering)},r.offscreenRendering.mainColor,r.offscreenRendering.mainDepth);var s=this.renderOptions.antialiasing;"smaa"===s&&this._smaaPass.loadResources(function(){i._needsRender=!0}),"smaa"===s&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:r.offscreenRendering.colorTexture},null)):"fxaa"===s&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:r.offscreenRendering.colorTexture},null)):(r.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),a.bindFramebuffer(null),this._renderContext.framebufferTex=r.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,n,r.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights(this._highlights)},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,n=0;n<this._renderOrder.length;n++){var r,i,a=this._renderOrder[n][1];if(a.instanced)(i=(r=a.instanced||a.merged)[e.pass])&&i.isVisible()&&(this._renderInternalInstanced(r,i,this._bindParameters,1/0),t=null);if(a.merged)if((i=(r=a.merged)[e.pass])&&i.isVisible()){var o=i.getProgram();o!==t&&(o.setUniformMatrix4fv("model",z),o.hasUniform("modelNormal")&&o.setUniformMatrix4fv("modelNormal",z)),t=o,this._renderInternalMerged(r,i,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,H[0]=t.near,H[1]=t.far,this._bindParameters.nearFar=H,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._externalRenderers.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t,n){this._orderedRendering?this._renderOrdered(v.MATERIAL,e):this._renderUnordered(e,n.shadowMap,t,n)},e.prototype.renderAuxiliaryBuffers=function(e,t,n){var r=n.ssao,i=n.shadowMap,a=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();this._linearDepthTextureHelper.enabled=a,a&&(this._linearDepthTextureHelper.setupFBOs(e),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(v.MATERIAL_DEPTH,e,i,r),this._linearDepthTextureHelper.finish(t)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(e),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(v.MATERIAL_NORMAL,e,i,r),this._normalTextureHelper.finish(t)),this.ssaoEnabled&&r.computeSSAO(e,t,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer),r.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,n,r){this._isRendering=!0,this._updateGlobalUniforms(t.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=t,this._renderContext.pixelRatio=this._pixelRatio,this._renderContext.shadowMap=n,this._renderContext.ssaoHelper=r,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e,t){void 0===t&&(t=null);for(var n=!1,r=0;r<e.length;++r){var i=e[r],a=i.matData[v.MATERIAL_HIGHLIGHT];a&&(null===t||a.beginSlot(t))&&a.isVisible()&&(n=this._renderInternalHighlight(i,this._bindParameters,v.MATERIAL_HIGHLIGHT)||n)}return n},e.prototype._renderInternalSlotOccluded=function(e,t){var n=!1;for(var r in this._mat2DataInstanced){var i=this._mat2DataInstanced[r],a=i[t.pass];a&&a.renderOccluded&&a.beginSlot(e)&&a.isVisible()&&(n=this._renderInternalInstanced(i,a,this._bindParameters,e)||n)}return n},e.prototype._renderInternalSlotMaterial=function(e,t){var n=!1;for(var r in this._mat2DataInstanced){(c=(l=this._mat2DataInstanced[r])[t.pass])&&c.beginSlot(e)&&c.isVisible()&&(n=this._renderInternalInstanced(l,c,this._bindParameters,e)||n)}for(var i=this._programRep.getProgramsUsingUniform("model"),a=this._programRep.getProgramsUsingUniform("modelNormal"),o=0;o<i.length;o++){var s=i[o];s.setUniformMatrix4fv("model",z),a.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",z)}for(var r in this._mat2DataMerged){(c=(l=this._mat2DataMerged[r])[t.pass])&&c.beginSlot(e)&&c.isVisible()&&(n=this._renderInternalMerged(l,c,this._bindParameters,e)||n)}for(var r in this._mat2DataPreinterleaved){var l,c;(c=(l=this._mat2DataPreinterleaved[r])[t.pass])&&c.beginSlot(e)&&c.isVisible()&&(n=this._renderInternalPreinterleaved(l,c,this._bindParameters,e)||n)}return e===g.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish(),n},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(this._highlights,e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,H[0]=t.camera.near,H[1]=t.camera.far;var n=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=H,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=n?n.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.hudVisibilityTexture=n?n.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,n,r){var i=this,a=this._rctx,o=a.gl,s=!1,l=t.getDrawMode(a),c=a.capabilities.instancing,d=!1;return e.origin2data.forEach(function(e){n.origin=e.origin,r===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass());var u=!1;if(t.instanced)for(var p in e.perGeometryDataInfo){var h=e.perGeometryDataInfo[p];s||(t.bind(a,n),s=!0),a.bindVAO(h.vao);var f=t.getProgram();O.assertCompatibleVertexAttributeLocations(h.vao,f),u||(t.bindView(a,n),u=!0);var v=h.to-h.from,m=h.refCount;l===o.TRIANGLES&&(i._stats.trianglesRendered+=m*v/3),c.drawArraysInstanced(l,h.from,v,m),d=!0,i._stats.drawCallsAngleInstanced++,i._stats.instancesDrawnAngle+=m}else{var y=e.instances;for(var b in y){var _=y[b],x=_.displayedIndexRange;x&&0===x.length||(s||(t.bind(a,n),s=!0),u||(a.bindVAO(e.vao),t.bindView(a,n),u=!0),t.bindInstance(a,_),i._stats.drawCallsInstanced++,l===o.TRIANGLES&&(i._stats.trianglesRendered+=(_.to-_.from)/3),x?i._drawArraysFaceRange(x,_.from,l):a.drawArrays(l,_.from,_.to-_.from),d=!0)}}}),a.bindVAO(null),s&&t.release(a,n),d},e.prototype._renderInternalHighlight=function(e,t,n){var r=this._rctx,i=r.gl,a=e.matData[n],o=a.getDrawMode(r),s=e.instance,l=s.highlightedIndexRange,c=this._renderContext.offscreenRenderingHelper,d=(c?c.depthTexture:null)||this._getFallbackDepthTexture(),u=a.getProgram(),p=r.capabilities.instancing;t.origin=e.originData.origin;var h=!1;if(a.instanced&&e.type===L.Instanced){var f=e.instancedVAO;a.bind(r,t),r.bindVAO(f),O.assertCompatibleVertexAttributeLocations(f,u),a.bindView(r,t);for(var v=0;v<l.length;v++){var g=(_=l[v]).range?_.range[0]+s.from:s.from,m=_.range?_.range[1]-_.range[0]+1:s.to-s.from;r.bindTexture(d,5),u.setUniform1i("depthTex",5),u.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),p.drawArraysInstanced(o,g,m,1),o===i.TRIANGLES&&(this._stats.trianglesRendered+=1*m/3),this._stats.drawCallsHighlight++,h=!0}}else if(e.type===L.Instanced&&a.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{a.bind(r,t),a.bindView(r,t);var y=null;switch(e.type){case L.Merged:var b=e.originData;r.bindVAO(b.vao),u.setUniformMatrix4fv("model",z);break;case L.Instanced:b=e.originData;r.bindVAO(b.vao),a.bindInstance(r,s);break;case L.Preinterleaved:f=(b=e.originData).instances[e.uniqueName].vao;r.bindVAO(f),a.bindInstance(r,s),y=f.indexBuffer&&f.indexBuffer.indexType}for(v=0;v<l.length;v++){var _;g=(_=l[v]).range?_.range[0]+s.from:s.from,m=_.range?_.range[1]-_.range[0]+1:s.to-s.from;if(r.bindTexture(d,5),a.getProgram().setUniform1i("depthTex",5),u.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),y){var x=O.getBytesPerElement(y);r.drawElements(o,m,y,g*x)}else r.drawArrays(o,g,m);o===i.TRIANGLES&&(this._stats.trianglesRendered+=m/3),this._stats.drawCallsHighlight++,h=!0}}return r.bindVAO(null),a.release(r,t),h},e.prototype._drawArraysFaceRange=function(e,t,n){for(var r=this._rctx,i=0,a=e;i<a.length;i++){var o=a[i];r.drawArrays(n,o[0]+t,o[1]-o[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,n,r){for(var i=this._rctx,a=O.getBytesPerElement(r),o=0,s=e;o<s.length;o++){var l=s[o],c=l[1]-l[0]+1,d=l[0]+t;i.drawElements(n,c,r,d*a)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,n,r){var i=this,a=this._rctx,o=a.gl,s=!1,l=!1;return e.origin2data.forEach(function(e){if(n.origin=e.origin,r===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){l||(t.bind(a,n),l=!0);var c=t.getProgram();a.bindVAO(e.vao),O.assertCompatibleVertexAttributeLocations(e.vao,c),t.bindView(a,n),i._stats.drawCallsMerged++;var d=t.getDrawMode(a);d===o.TRIANGLES&&(i._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?i._drawArraysFaceRange(e.displayedIndexRange,0,d):a.drawArrays(d,0,O.vertexCount(e.vao,"geometry")),s=!0}}),l&&t.release(a,n),s},e.prototype._renderInternalPreinterleaved=function(e,t,n,r){var i=this,a=this._rctx,o=a.gl,s=!1,l=!1,c=t.getDrawMode(a);return e.origin2data.forEach(function(e){n.origin=e.origin;var d=!1;for(var u in r===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),e.instances){var p=e.instances[u],h=p.instance,f=p.vao,v=h.displayedIndexRange;if(!v||0!==v.length){l||(t.bind(a,n),l=!0);var m=t.getProgram();O.assertCompatibleVertexAttributeLocations(f,m),a.bindVAO(f),d||(t.bindView(a,n),d=!0),t.bindInstance(a,h),i._stats.drawCallsPreinterleaved++,c===o.TRIANGLES&&(i._stats.trianglesRendered+=(h.to-h.from)/3);var y=f.indexBuffer&&f.indexBuffer.indexType;if(v)y?i._drawElementsFaceRange(v,h.from,c,y):i._drawArraysFaceRange(v,h.from,c);else if(y){var b=O.getBytesPerElement(y);a.drawElements(c,h.to-h.from,y,h.from*b)}else a.drawArrays(c,h.from,h.to-h.from);s=!0}}}),a.bindVAO(null),l&&t.release(a,n),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),n=0;n<t.length;n++)t[n].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(n=0;n<t.length;n++)this._lighting.setUniforms(t[n]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(n=0;n<t.length;n++)this._lighting.setUniforms(t[n])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,n=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+n);var r=0;D(this._mat2DataMerged,function(){},function(e,t){r+=Object.keys(t.instances).length});var i=0;D(this._mat2DataInstanced,function(){},function(e,t){i+=Object.keys(t.instances).length});var a=0;D(this._mat2DataPreinterleaved,function(){},function(e,t){a+=Object.keys(t.instances).length}),console.log("number of instances (merged/instanced/preinterleaved): "+r+"/"+i+"/"+a)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!n.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!n.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!n.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}return!0},e.prototype.modify=function(e,t,n,r){this._isRendering&&console.warn("Renderer.modify called while rendering");var i=[],a=[],o=[];this._classifyRenderGeometry(e,i,a,o);var s=[],l=[],c=[];this._classifyRenderGeometry(t,s,l,c);var d={};n&&this._performUpdates(n,d);var u=[];this._modifyMerged(i,s,u,d),this._modifyInstanced(a,l,u),this._modifyPreinterleaved(o,c,u),this._updateMergedFaceranges(d),this._releaseMaterials(u);var p=this._highlights.length;t&&t.length>0&&p>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),p!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),r&&this._modifyMaterials(r),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,n,r){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(I(o))switch(this._getType(o)){case L.Merged:t.push(o);break;case L.Instanced:n.push(o);break;case L.Preinterleaved:r.push(o)}}},e.prototype._performUpdates=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n],a=i.updateType,o=i.renderGeometry,s=this._getType(o)===L.Merged;if(I(o)){if(2&a&&this._updateFaceranges(o,t),32&a){var l=this._getInstance(o);l&&this._updateHighlightFaceranges(o,l.instance)}4&a||s&&16&a?this._updateVertexAttributes(o,!s):!s&&16&a&&this._updateInstanceTransformation(o)}}},e.prototype._updateFaceranges=function(e,t){var n,r,i=e.material.id,a=e.origin.id,o=this._getType(e);o===L.Preinterleaved?n=(r=this._getOriginData(o,i,a)).instances[e.uniqueName].instance:(n=(r=this._getOriginData(o,i,a)).instances[e.uniqueName])&&o===L.Merged&&(t[this._modifiedMergedFacerangesKey(i,a)]=r);n&&(n.displayedIndexRange=E(e),this._updateHighlightFaceranges(e,n))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var n=t.highlightedIndexRange,r=P(e);t.highlightedIndexRange=r,r&&!n?this._addHighlight(e):!r&&n&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e){var n=e[t];n.displayedIndexRange=[];var r=n.instances,i=!0;for(var a in r){var o=r[a];o.displayedIndexRange?(n.displayedIndexRange.push.apply(n.displayedIndexRange,u.offsetIntervals(o.displayedIndexRange,o.from)),i=!1):n.displayedIndexRange.push([o.from,o.to-1])}n.displayedIndexRange=i?null:u.mergeIntervals(n.displayedIndexRange)}},e.prototype._updateVertexAttributes=function(e,t){var n=e.material,r=n.id,i=e.origin.id,a=O.getStride(n.getVertexBufferLayout())/4,o=this._getType(e);if(o!==L.Preinterleaved){var s,l,c=this._getOriginData(o,r,i),d=c.instances[e.uniqueName],u=c.buffer.getArray(),p=c.vao;t||(T(e,W,q),s=W,l=q),n.fillInterleaved(e.data,s,l,e.instanceParameters,u,d.from*a),b.assert(d.from+n.getOutputAmount(M(e.data))/a===d.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(u,d.from*a*4,d.from*a*4,d.to*a*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),n=e.material.id,r=e.origin.id;if(t===L.Preinterleaved){T(e,(a=(i=this._getOriginData(t,n,r)).instances[e.uniqueName].instance).transformation,a.transformationNormal)}else{var i,a=(i=this._getOriginData(t,n,r)).instances[e.uniqueName],o=i.perGeometryDataInfo[e.data.id],s=o.instanceBufferData;if(T(e,a.transformation,a.transformationNormal),s){var l=s.getSlot(e.idx);s.fill(l,0,a.transformation),s.fill(l,16,a.transformationNormal);var c=4*s.getOffset(l),d=O.getStride(o.vao.layout.instance);o.vao.vertexBuffers.instance.setSubData(s.getArray(),c,c,c+d)}}},e.prototype._modifyMerged=function(e,t,n,r){var i=this._compMatToDelta(e,t,L.Merged),a=this._mat2DataMerged;for(var o in i){var s=i[o];for(var l in s){var c=s[l],d=c.optimalCount,u=c.sparseCount,p=c.material,h=p.getVertexBufferLayout(),f=O.getStride(h)/4,v=a[o];null==v&&(b.assert(d>0),v=this._initializeMatData(p),a[o]=v,this._orderedRendering&&this._insertIntoRenderOrder(v,p.renderPriority,"merged"));var g=v.origin2data.get(l);if(null==g&&(b.assert(d>0),g=this._createMergedData(h,d,c.origin),v.origin2data.set(l,g)),0===d)g.vao.dispose(!0),g.vao=null,v.origin2data.delete(l),0===v.origin2data.size&&(n.push(o),delete a[o],this._orderedRendering&&this._removeFromRenderOrder(v,"merged"));else{var m=d<c.sparseCount/2,y=m?d:u,_=G,x=g.buffer.getSize(),S=g.buffer.getArray(),w=g.buffer.resize(y);m||w?this._rebuildMerged(g,c.toRemove,f,S,_):c.toRemove.length>0?(this._removeMergedByErasing(g,c.toRemove,f,_),c.toAdd.length>0&&(_.end=x)):(_.begin=x,_.end=x);var A=k;b.setMatrixTranslation3(A,-c.origin[0],-c.origin[1],-c.origin[2]),this._appendMerged(g,p,c.toAdd,f,A,_);var C=g.vao.vertexBuffers.geometry;if(C.byteSize!==g.buffer.getArray().buffer.byteLength)C.setData(g.buffer.getArray());else{var R=_.begin,E=_.end;if(R<E){var P=g.buffer.getArray(),T=4*R,D=4*E;C.setSubData(P,T,T,D)}}(_.updatedDisplayedIndexRange||g.displayedIndexRange)&&(r[this._modifiedMergedFacerangesKey(o,l)]=g)}}}},e.prototype._createMergedData=function(e,t,n){return{type:L.Merged,instances:{},vao:new R(this._rctx,i.Default3D,{geometry:e},{geometry:w.createVertex(this._rctx,35044)}),buffer:new o(t),optimalCount:0,origin:n}},e.prototype._rebuildMerged=function(e,t,n,r,i){for(var a=0;a<t.length;++a){var o=e.instances[t[a].uniqueName];e.optimalCount-=(o.to-o.from)*n,delete e.instances[t[a].uniqueName]}var s=0,l=e.buffer.getArray();i.begin=0,i.end=0;var c=-1,d=-1,u=0;for(var p in e.instances){var h=(o=e.instances[p]).from*n,f=o.to*n,v=f-h;c!==d&&d!==h?(l.set(r.subarray(c,d),u),u+=d-c,c=h):-1===c&&(c=h),d=f,o.from=s/n,s+=v,o.to=s/n}c!==d&&l.set(r.subarray(c,d),u),i.end=s},e.prototype._removeMergedByErasing=function(e,t,n,r){if(0!==t.length){r.begin=1/0,r.end=-1/0;for(var i=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,c=e.instances[l].from*n,d=e.instances[l].to*n;i!==a&&a!==c?(e.buffer.erase(i,a),i=c):-1===i&&(i=c),a=d,delete e.instances[l],e.optimalCount-=d-c,c<r.begin&&(r.begin=c),d>r.end&&(r.end=d)}i!==a&&e.buffer.erase(i,a)}},e.prototype._appendMerged=function(e,t,n,r,i,a){a.updatedDisplayedIndexRange=!1;for(var o=0,s=n;o<s.length;o++){var l=s[o],c=l.data;F.multiply(i,l.transformation,W),F.inverse(W,q),F.transpose(q);var d=a.end;t.fillInterleaved(c,W,q,l.instanceParameters,e.buffer.getArray(),a.end);var u=t.getOutputAmount(M(c)),p=d+u;b.assert(null==e.instances[l.uniqueName]);var h=E(l),f=new j(l.name,d/r,p/r,h,void 0,void 0,l.idx);e.instances[l.uniqueName]=f,this._updateHighlightFaceranges(l,f),h&&(a.updatedDisplayedIndexRange=!0),e.optimalCount+=u,a.end+=u}},e.prototype._modifyInstanced=function(e,t,n){var r=this._rctx,a=L.Instanced,s=this._compMatToDelta(e,t,a),l=this._mat2DataInstanced;for(var c in s){var u=s[c];for(var p in u){var h=u[p];if(0!==h.optimalCount){var f=h.material,g=l[c];if(null==g){var m=f.renderPriority;g=this._initializeMatData(f),l[c]=g,this._orderedRendering&&this._insertIntoRenderOrder(g,m,"instanced")}var y=f.getVertexBufferLayout(),_=g[v.MATERIAL].instanced?f.getInstanceBufferLayout():void 0,x=_&&O.findAttribute(_,"instanceColor"),S=_&&O.findAttribute(_,"instanceFeatureAttribute"),A=O.getStride(y)/4,C=g.origin2data.get(p);null==C&&(C={type:a,instances:{},vao:new R(r,i.Default3D,{geometry:y},{geometry:w.createVertex(r,35044)}),buffer:new o(h.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:h.origin},g.origin2data.set(p,C));var P=C.buffer.getSize(),T=C.buffer.getArray(),D=h.optimalCount<h.sparseCount/2,I=C.buffer.resize(D?h.optimalCount:h.sparseCount);for(var V in h.perGeometryDelta){if((J=C.perGeometryDataInfo[V])&&J.instanceBufferData){var z=h.perGeometryDelta[V].removeCount;z>0&&J.instanceBufferData.prepareFree(z)}}var U=h.toRemove;if(D||I){for(var N=0;N<U.length;++N){var B=U[N];delete C.instances[B.uniqueName];V=B.data.id;0==--(q=J=C.perGeometryDataInfo[V]).refCount&&null==h.dataId2refCount[V]?(C.optimalCount-=(q.to-q.from)*A,delete C.perGeometryDataInfo[V]):J.instanceBufferData&&J.instanceBufferData.free(B.idx)}P=0;var G=C.buffer.getArray(),H={};for(var W in C.perGeometryDataInfo){var q=C.perGeometryDataInfo[W];b.assert(null==H[q.from]),H[q.from]=q}for(var $ in H){var X=(q=H[$]).from*A,Y=q.to*A;G.set(T.subarray(X,Y),P),q.from=P/A,P+=Y-X,q.to=P/A}for(var Q in C.instances){(ae=C.instances[Q]).from=C.perGeometryDataInfo[ae.dataId].from,ae.to=C.perGeometryDataInfo[ae.dataId].to}}else for(N=0;N<U.length;++N){B=U[N];delete C.instances[B.uniqueName];V=B.data.id;if(0==--(J=C.perGeometryDataInfo[V]).refCount&&null==h.dataId2refCount[V]){X=J.from*A,Y=J.to*A;C.buffer.erase(X,Y),C.optimalCount-=Y-X,delete C.perGeometryDataInfo[V]}else J.instanceBufferData&&J.instanceBufferData.free(B.idx)}for(var V in b.setMatrixTranslation3(k,-h.origin[0],-h.origin[1],-h.origin[2]),h.perGeometryDelta){if((J=C.perGeometryDataInfo[V])&&J.instanceBufferData){var Z=h.perGeometryDelta[V].addCount;Z>0&&J.instanceBufferData.prepareAllocate(Z)}}var K=h.toAdd;for(N=0;N<K.length;++N){var J,ee=(B=K[N]).data;V=ee.id;if(null==(J=C.perGeometryDataInfo[V])){f.fillInterleaved(ee,void 0,void 0,void 0,C.buffer.getArray(),P);var te=f.getOutputAmount(M(ee));X=P/A,Y=(P+=te)/A;if(C.optimalCount+=te,J={refCount:1,from:X,to:Y,vao:null,instanceBufferData:null},_){var ne=O.getStride(_)/4;J.vao=new R(r,i.Default3D,{geometry:y,instance:_},{geometry:C.vao.vertexBuffers.geometry,instance:w.createVertex(r,35044)}),J.instanceBufferData=new d(ne,h.perGeometryDelta[V].addCount)}C.perGeometryDataInfo[V]=J}else++J.refCount;b.assert(J.from*A<=C.buffer.getSize()&&J.to*A<=C.buffer.getSize());var re=F.create();F.multiply(k,B.transformation,re);var ie=E(B),ae=new j(B.name,J.from,J.to,ie,re,B.instanceParameters,B.idx,V);C.instances[B.uniqueName]=ae,this._updateHighlightFaceranges(B,ae);var oe=J.instanceBufferData;if(oe){var se=oe.allocate(B.idx);oe.fill(se,0,ae.transformation),oe.fill(se,16,ae.transformationNormal),x&&oe.fill(se,x.offset/4,B.instanceParameters.color),S&&oe.fill(se,S.offset/4,B.instanceParameters.featureAttribute)}}b.assert(C.optimalCount===h.optimalCount);var le=new Float32Array(C.buffer.getArray().buffer,0,C.buffer.getSize());for(var V in C.vao.vertexBuffers.geometry.setData(le),C.perGeometryDataInfo){var ce=C.perGeometryDataInfo[V];if(ce.vao){var de=ce.vao.vertexBuffers.instance;if(de){var ue=h.perGeometryDelta[V];if(ue.addCount+ue.removeCount>0){var pe=ce.instanceBufferData.compact();de.setData(pe)}}}}}else{var he=l[c];he.origin2data.get(p).vao.dispose(!0),he.origin2data.delete(p),0===he.origin2data.size&&(n.push(c),delete l[c],this._orderedRendering&&this._removeFromRenderOrder(he,"instanced"))}}}},e.prototype._modifyPreinterleaved=function(e,t,n){for(var r=this._rctx,a=L.Preinterleaved,o=this._mat2DataPreinterleaved,s=0,l=e;s<l.length;s++){var c=(P=(O=l[s]).material).id,d=O.origin.id,u=O.origin.vec3;null==(T=o[c])&&(T=this._initializeMatData(P),o[c]=T);var p=T.origin2data.get(d);null==p&&(p={type:a,origin:u,count:0,instances:{}},T.origin2data.set(d,p)),b.setMatrixTranslation3(k,-u[0],-u[1],-u[2]);var h=F.create();F.multiply(k,O.transformation,h);var f=E(O),v=O.data;if(v.preinterleaved)if(null!=v.vertexData){var g=v.indexCount,m=v.id,y=new j(O.name,0,g,f,h,O.instanceParameters,O.idx,m),_=v.indexData?w.createIndex(r,35044,v.indexData):null,x=P.getVertexBufferLayout(),S=new R(r,i.Default3D,{geometry:x},{geometry:w.createVertex(r,35044)},_);S.vertexBuffers.geometry.setData(v.vertexData),v.vertexData=null,p.count+=1,p.instances[O.uniqueName]={instance:y,vao:S},this._updateHighlightFaceranges(O,y)}else b.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else b.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var A=0,C=t;A<C.length;A++){u=(O=C[A]).origin,c=(P=O.material).id,d=u.id;var O,P,T,D=O.uniqueName,I=(T=o[c]).origin2data.get(d);I.instances[D].vao.dispose(),delete I.instances[D],I.count-=1,0===I.count&&T.origin2data.delete(d),0===T.origin2data.size&&(n.push(c),delete o[c])}},e.prototype._compMatToDelta=function(e,t,n){var r={};return this._updateMatToDelta(e,!0,n,r),this._updateMatToDelta(t,!1,n,r),r},e.prototype._updateMatToDelta=function(e,t,n,r){for(var i=n===L.Instanced,a=0,o=e;a<o.length;a++){var s=o[a],l=s.origin,c=s.material,d=c.id,u=i?this._mat2DataInstanced[d]:this._mat2DataMerged[d],p=u&&u.origin2data.get(l.id),h=r[d];null==h&&(h={},r[d]=h);var f=h[l.id];if(null==f){if(f={optimalCount:null==p?0:p.optimalCount,sparseCount:null==p?0:p.buffer.getSize(),material:c,toAdd:[],toRemove:[],perGeometryDelta:null,origin:l.vec3},i){var v={};if(void 0!==p)for(var g in p.perGeometryDataInfo)v[g]=p.perGeometryDataInfo[g].refCount;f.dataId2refCount=v,f.perGeometryDelta={}}h[l.id]=f}var m=c.getOutputAmount(M(s.data));if(i){var y=s.data.id,b=f.perGeometryDelta[y];b||(b={addCount:0,removeCount:0},f.perGeometryDelta[y]=b),t?(b.addCount++,null==f.dataId2refCount[y]&&(f.dataId2refCount[y]=0),1==++f.dataId2refCount[y]&&(f.optimalCount+=m,f.sparseCount+=m),f.toAdd.push(s)):(b.removeCount++,0==--f.dataId2refCount[y]&&(delete f.dataId2refCount[y],f.optimalCount-=m),f.toRemove.push(s))}else t?(f.optimalCount+=m,f.sparseCount+=m,f.toAdd.push(s)):(f.optimalCount-=m,f.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return L.Preinterleaved;var t=!1,n=M(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||n>this._threshold),t?L.Instanced:L.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case L.Merged:return this._mat2DataMerged;case L.Instanced:return this._mat2DataInstanced;case L.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,n){return this._getTargetMat2Data(e)[t].origin2data.get(n)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,n){for(var r=e[v.MATERIAL].materialId,i=this._renderOrder.length,a=0;a<i&&this._renderOrder[a][0]>=t;){var o=this._renderOrder[a][1];if(o.id===r)return b.assert(!o[n],"matData for type already exists"),void(o[n]=e);a++}var s={id:r,instanced:null,merged:null};s[n]=e,this._renderOrder.splice(a,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var n=e[v.MATERIAL].materialId,r=0;this._renderOrder[r][1].id!==n;)r++;var i=this._renderOrder[r][1];i[t]=null,i.instanced||i.merged||this._renderOrder.splice(r,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var n=e.matData[v.MATERIAL].renderPriority,r=t.matData[v.MATERIAL].renderPriority;return n>r?-1:r>n?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var n=t.length,r=0;r<n&&t[r][1].id!==e;)r++;if(r<n){var i=t[r][1],a=(i.merged||i.instanced)[v.MATERIAL].renderPriority,o=t[r][0];if(a!==t[r][0]){t[r][0]=a;var s=a>o?-1:1;for(r+=s;r>-1&&r<n&&s*t[r][0]>s*a;){var l=t[r];t[r]=t[r-s],t[r-s]=l,r+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[v.MATERIAL]=this._materialRep.aquire(e),t[v.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(e),t[v.MATERIAL_NORMAL]=this._materialRep.aquireNormal(e),t[v.MATERIAL_DEPTH]=this._materialRep.aquireDepth(e),t[v.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,n=0;n<t.length;n++)this._materialRep.release(t[n]),this._materialRep.releaseDepthShadowMap(t[n]),this._materialRep.releaseNormal(t[n]),this._materialRep.releaseDepth(t[n]),this._materialRep.releaseHighlight(t[n]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,n=e.uniqueName,r=t.id,i=this._getType(e),a=this._getTargetMat2Data(i),o=e.origin.id,s=a[r];if(!s)return null;var l,c=s.origin2data.get(o);return c?(l=c.type===L.Preinterleaved?c.instances[n].instance:c.instances[n])?{type:i,uniqueName:n,instance:l,matData:s,originData:c,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,n=e.instance,r=e.originData;if(e.type===L.Instanced&&r.perGeometryDataInfo){var i=r.perGeometryDataInfo[n.dataId],a=i.instanceBufferData;if(a){var o=i.vao,s=a.getSlot(n.idx);if(e.instancedVAOBaseInstance!==s){var l=O.setBaseInstanceOffset(o.layout,s);e.instancedVAO=new R(t,o.locations,l,o.vertexBuffers,o.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}(),B=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}(),j=function(){return function(e,t,n,r,i,a,o,s){this.name=e,this.from=t,this.to=n,this.displayedIndexRange=r,this.transformation=i,this.instanceParameters=a,this.idx=o,this.dataId=s,null!=i&&(this.transformationNormal=F.create(),F.set(i,this.transformationNormal),F.inverse(this.transformationNormal,this.transformationNormal),F.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(L||(L={}));var G={updatedDisplayedIndexRange:!1,begin:0,end:0},H=V.create(),k=F.identity(),W=F.create(),q=F.create();return N}.apply(null,r))||(e.exports=i)},1541:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(10),n(1516),n(1513),n(251),n(7),n(255),n(253),n(49),n(1535),n(1583),n(1542),n(1584),n(1633),n(1585),n(1487),n(1554),n(1552),n(1682),n(1452),n(1589),n(1592),n(1593),n(1497),n(1496),n.dj.m(e)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A,C,O){Object.defineProperty(t,"__esModule",{value:!0});var R=function(){function t(e,t,n){this.rctx=e,this.programRepository=t,this.callbacks=n,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new h.LocalOriginManager(new v(1e4)),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new _,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=c.vec3d.create(),this.tmpCameraPosition=c.vec3d.create(),this.componentColorManager=new m.BufferManager(this.rctx,2)}return t.isSupported=function(e){return!!e.capabilities.instancing},t.loadShaders=function(e,t,n){x.EdgeRenderer.loadShaders(e,t,n)},t.prototype.initialize=function(){var t=this;l.open(s.getAbsMid("./EdgeProcessingWorker",e,O),{client:this}).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var n=y.VertexLayout.createBuffer(4),r=0;r<4;r++)n.sideness.set(r,0,0===r||3===r?0:1),n.sideness.set(r,1,0===r||1===r?0:1);this.verticesBufferObject=A.createVertex(this.rctx,35044,n.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage/1048576},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,n){return r(this,void 0,void 0,function(){var r,a,s,l,c,d;return i(this,function(i){switch(i.label){case 0:if(this.hasObject(e))return[2];if(r=new Array,s={loaded:o.create(function(e){a=e}),renderables:[]},this.perObjectData.set(e,s),n&&n.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))r.push(this.addObjectMergedGeometries(e,s,t));else for(l=0;l<e.geometries.length;l++)c=e.geometries[l],d=e.geometryRecords[l],d.materials[0].supportsEdges&&(c.data instanceof f?r.push(this.addGeometryPreinterleaved(e,s,c,c.data,d,t)):r.push(this.addGeometryNonPreinterleaved(e,s,c,c.data,d,t[0])));return[4,o.all(r)];case 1:return i.sent(),this.callbacks.setNeedsRender(),a(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return r(this,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:return(n=this.perObjectData.get(e))?[4,n.loaded]:[2];case 1:return i.sent(),r=t instanceof Array?function(e){return t[e]}:function(e){return t},n.renderables.forEach(function(e){for(var t=e.components.meta.length,n=0;n<t;n++){var i=r(n),a=e.components.meta[n],o=a.index;a.material.opacity=i,e.components.buffer.textureBuffer.setDataElement(o,1,3,255*i)}e.allTransparent=w.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t){return r(this,void 0,void 0,function(){var n,r=this;return i(this,function(i){switch(i.label){case 0:return(n=this.perObjectData.get(e))?[4,n.loaded]:[2];case 1:return i.sent(),n.renderables.forEach(function(e){var n=w.determineRequiresUberRenderer(t),i=x.EdgeRenderer.getKey(n,t[0].type);if(i!==e.rendererKey){var a=r.renderers.get(e.rendererKey),o=r.aquireRenderer(n,t[0].type);a.removeRenderable(e),a.refCount.decrement(),e.rendererKey=i,o.addRenderable(e)}for(var s=0;s<t.length;s++)e.components.meta[s].material=t[s];r.updateComponentBuffer(e.components),e.allTransparent=w.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return(n=this.perObjectData.get(e))?[4,n.loaded]:[2];case 1:return r.sent(),n.renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,n=this.perObjectData.get(e);n&&(this.perObjectData.delete(e),n.loaded.then(function(){n.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,n){e.removeObject(n)})},t.prototype.createSolidEdgeMaterial=function(e){return n({},E,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return n({},P,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var n=e.view,r=0,i=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){r+=e.statistics.averageEdgeLength,i++})});var a={distanceFalloffFactor:40*(r/i),minimumEdgeLength:w.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},o=this.rctx.capabilities.blendMinMax;o?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,o.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(n){t.renderRegularEdges(n,e,a),t.renderSilhouetteEdges(n,e,a)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=n},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,n){if(e.getCombinedStaticTransformation(t,n),t.origin)this.localOrigins.register(t.origin);else{var r=c.vec3d.set3(n[12],n[13],n[14],this.tmpModelPosition);t.origin=this.localOrigins.aquire(r)}return p.applyToModelMatrix(t.origin.vec3,n),n},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,n=e.buffer,r=0;r<t.length;r++){var i=t[r].material,a=t[r].index,o=g.clamp(Math.round(i.size*x.LINE_WIDTH_FRACTION_FACTOR),0,255),s=g.clamp(i.extensionLength,-x.EXTENSION_LENGTH_OFFSET,255-x.EXTENSION_LENGTH_OFFSET)+x.EXTENSION_LENGTH_OFFSET,l="solid"===i.type?0:1,c=255*i.opacity,d=i.color,u=255*d[0],p=255*d[1],h=255*d[2],f=255*d[3];n.textureBuffer.setData(a,0,u,p,h,f),n.textureBuffer.setData(a,1,o,s,l,c)}},t.prototype.createComponentBuffers=function(e){for(var t=[],n=this.componentColorManager.getBuffer(e.length),r=0;r<e.length;r++){var i=e[r],a=n.aquireIndex();t.push({index:a,material:i})}var o={meta:t,buffer:n};return this.updateComponentBuffer(o),o},t.prototype.extractEdges=function(e,t,n,r){return this.worker.process({data:t,originalIndices:r,writerSettings:e,skipDeduplicate:n},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var n=new C(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:A.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:n,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){n=new C(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:A.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:n,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,n,a,o,s){return r(this,void 0,void 0,function(){var n,r,l,d;return i(this,function(i){switch(i.label){case 0:return n=a.getAttribute("position"),r=this.computeModelTransformWithLocalOrigin(e,o,c.mat4d.create()),l=o.origin,d={position:n,indices:a.getIndices("position"),modelTransform:r,origin:l},[4,this.addNonPreinterleaved(e,t,d,s)];case 1:return i.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,n,a){return r(this,void 0,void 0,function(){var e,r,o,s,l,c,d,u,p,h,f,v,g,m,b;return i(this,function(i){switch(i.label){case 0:for(e=this.aquireRenderer(!1,a.type),r=n.modelTransform,o=n.origin,s=n.indices,l=n.position,c=l.data.length/l.strideIdx,d=y.EdgeInputBufferLayout.createBuffer(c),u=0;u<c;u++)d.position.set(u,0,l.data[l.offsetIdx+u*l.strideIdx+0]),d.position.set(u,1,l.data[l.offsetIdx+u*l.strideIdx+1]),d.position.set(u,2,l.data[l.offsetIdx+u*l.strideIdx+2]);return p=this.createComponentBuffers([a]),w.fillComponenBufferIndices(p.meta,[0,d.componentIndex.count],d.componentIndex),[4,this.extractEdges(e.writerSettings,d,!1,s)];case 1:return h=i.sent(),f=this.createEdgeResources(h),v=f.regular,g=f.silhouette,m=(v?v.vao.size:0)+(g?g.vao.size:0),b={regular:v,silhouette:g,transform:{modelMatrix:r,origin:o},statistics:{gpuMemoryUsage:m,averageEdgeLength:h.averageEdgeLength},components:p,visible:!0,allTransparent:w.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(b),e.addRenderable(b),this.gpuMemoryUsage+=m,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,n,a,o,s){return r(this,void 0,void 0,function(){var n,r,l,p,h,f,v,g,m,b,_,x,S,A,C,O,R;return i(this,function(i){switch(i.label){case 0:return(n=a.getAttribute("position"))&&n.data instanceof Float32Array?(r=s[0],l=w.determineRequiresUberRenderer(s),p=this.aquireRenderer(l,r.type),h=this.computeModelTransformWithLocalOrigin(e,o,c.mat4d.create()),f=o.origin,v=a.getIndices("position"),g=new d.BufferViewVec3f(n.data.buffer,4*n.offsetIdx,4*n.strideIdx),m=y.EdgeInputBufferLayout.createBuffer(g.count),u.unrolledCopyVec3(m.position,g),b=this.createComponentBuffers(s),w.fillComponenBufferIndices(b.meta,a.componentOffsets,m.componentIndex,v),_=a.hasPositionData,[4,this.extractEdges(p.writerSettings,m,_,v)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return x=i.sent(),S=this.createEdgeResources(x),A=S.regular,C=S.silhouette,O=(A?A.vao.size:0)+(C?C.vao.size:0),R={regular:A,silhouette:C,transform:{modelMatrix:h,origin:f},statistics:{gpuMemoryUsage:O,averageEdgeLength:x.averageEdgeLength},components:b,visible:!e.isHidden(o),allTransparent:w.determineAllTransparent(b.meta),distanceToCamera:0,rendererKey:p.key},t.renderables.push(R),p.addRenderable(R),this.gpuMemoryUsage+=O,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,n=null,r=0;r<e.geometries.length;r++){var i=e.geometries[r],o=e.geometryRecords[r];if(o.materials[0].supportsEdges){if(i.data instanceof f)return!1;if(t){if(!a.equals(t,o.transformation))return!1}else t=o.transformation;if(!n&&o.origin)n=o;else if(n&&o.origin&&n.origin.id!==o.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,n){return r(this,void 0,void 0,function(){var r,a,o,s,l,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A;return i(this,function(i){switch(i.label){case 0:for(r=new Map,a=0,o=null,s=null,w=0;w<e.geometries.length;w++)h=e.geometries[w],l=e.geometryRecords[w],l.materials[0].supportsEdges&&(!s&&l.origin&&(s=l),g=h.data.getIndices("position"),a+=g?g.length:0,(g&&null==o||o===Uint16Array)&&(o=g instanceof Uint16Array?Uint16Array:Uint32Array));for(d=a?new o(a):null,u=[],p=0,w=0;w<e.geometries.length;w++)if(h=e.geometries[w],f=e.geometryRecords[w],f.materials[0].supportsEdges){if(v=h.data.getAttribute("position"),g=h.data.getIndices("position"),null==(m=r.get(v.data))){for(m=u.length/3,y=v.offsetIdx;y<v.data.length;y+=v.strideIdx)u.push(v.data[y+0]),u.push(v.data[y+1]),u.push(v.data[y+2]);r.set(v.data,m)}if(g)for(b=0;b<g.length;b++)d[p++]=m+g[b]}for(_=s||e.geometryRecords[0],x=this.computeModelTransformWithLocalOrigin(e,_,c.mat4d.create()),S=_.origin,w=0;w<e.geometryRecords.length;w++)e.geometryRecords[w].origin=S;return A={position:{data:u,offsetIdx:0,strideIdx:3},indices:d,modelTransform:x,origin:S},[4,this.addNonPreinterleaved(e,t,A,n[0])];case 1:return i.sent(),[2]}})})},t.prototype.aquireRenderer=function(e,t){var n=x.EdgeRenderer.getKey(e,t),r=this.renderers.get(n);return this.strokesTexture||(this.strokesTexture=S.generateStrokesTexture(this.rctx)),r||(r=new x.EdgeRenderer(this.rctx,this.programRepository,{type:t,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(n,r)),r.refCount.increment(),r},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var n=0,r=e.components.meta;n<r.length;n++){var i=r[n];e.components.buffer.releaseIndex(i.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,n=e.viewInvTransp;c.vec3d.set3(n[3],n[7],n[11],this.tmpCameraPosition),this.perObjectData.forEach(function(e,n){var r=c.vec3d.dist(n.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=r})})},t.prototype.renderRegularEdges=function(e,t,n){var r=this;e.bindRegularEdges(t,n),e.forEachRenderable(function(i){if(i.visible&&i.regular&&!i.allTransparent){var a=w.computeEdgeCount(i.regular.lod.lengths,i.distanceToCamera,n);t.view=r.localOrigins.getViewMatrix(i.transform.origin),e.renderRegularEdges(i,t,a),r.numberOfRenderedEdges+=a}})},t.prototype.renderSilhouetteEdges=function(e,t,n){var r=this;e.bindSilhouetteEdges(t,n),e.forEachRenderable(function(i){if(i.visible&&i.silhouette&&!i.allTransparent){var a=w.computeEdgeCount(i.silhouette.lod.lengths,i.distanceToCamera,n);t.view=r.localOrigins.getViewMatrix(i.transform.origin),e.renderSilhouetteEdges(i,t,a),r.numberOfRenderedEdges+=a}})},t}();t.EdgeView=R;var E={color:c.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1},P={color:c.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,r))||(e.exports=i)},1542:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var n=t,r=-e[0],i=-e[1],a=-e[2],o=n[3],s=n[7],l=n[11],c=n[15];n[0]+=o*r,n[1]+=o*i,n[2]+=o*a,n[4]+=s*r,n[5]+=s*i,n[6]+=s*a,n[8]+=l*r,n[9]+=l*i,n[10]+=l*a,n[12]+=c*r,n[13]+=c*i,n[14]+=c*a},t.applyToViewMatrix=function(e,t){var n=t,r=e[0],i=e[1],a=e[2];n[12]+=r*n[0]+i*n[4]+a*n[8],n[13]+=r*n[1]+i*n[5]+a*n[9],n[14]+=r*n[2]+i*n[6]+a*n[10],n[14]+=r*n[3]+i*n[7]+a*n[11]}}.apply(null,r))||(e.exports=i)},1543:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1505),n(1494)],void 0===(i=function(e,t,n,r,i){return function(e){function t(t,n,r,a,o){void 0===o&&(o=!1);var s=e.call(this,t,n)||this;return s.textureRep=r,s.textureId=a,s.initTransparent=o,s.glTextureRef=i.aquireIfNotUndefined(s.textureId,r,s.initTransparent),s}return n(t,e),t.prototype.dispose=function(){i.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(i.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=i.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var n=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",n.descriptor.width,n.descriptor.height)}},t}(r)}.apply(null,r))||(e.exports=i)},1544:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){function r(e){return Math.abs(e*e*e)}function i(e,t,n,i){void 0===i&&(i=d);var a=n.parameters,o=n.paddingPixelsOverride;return i.scale=Math.min(a.divisor/(t-a.offset),1),i.factor=r(e),i.minPixelSize=a.minPixelSize,i.paddingPixels=o,i}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),a(e,t))}function s(e,t,n){var r=i(e,t,n);return r.minPixelSize=0,r.paddingPixels=0,o(1,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new l(e,t.defaultDescription)},t.getLabelSettings=function(e){var n=t.defaultDescription.curvatureDependent,r=t.defaultDescription.scaleStart,i=t.defaultDescription.scaleFallOffRange;return new l(e,{curvatureDependent:{min:{curvature:n.min.curvature,tiltAngle:n.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:n.max.curvature,tiltAngle:n.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:i,minPixelSize:c.minPixelSize})},t.perspectiveFactor=r,t.scaleFactor=i,t.applyScaleFactor=o,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScale=s,t.precomputeScaleFactor=function(e,t,n,r){return r.scale=s(e,t,n),r.factor=0,r.minPixelSize=n.parameters.minPixelSize,r.paddingPixels=n.paddingPixelsOverride,r},t.applyPrecomputedScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var r=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=e[0]*r,n[1]=e[1]*r,n},t.scale=function(e,t,n,r){return o(e,i(t,n,r))};var l=function(){function e(e,t,n,r){void 0===n&&(n={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=n,this._paddingPixelsOverride=r,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var n=this.description,r=n.scaleStart,i=n.scaleFallOffRange,a=n.minPixelSize,o=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),d=l.tiltAngle,u=l.scaleFallOffFactor,p=Math.sin(d)*s,h=.5*Math.PI-d-o*(.5-r*c),f=p/Math.cos(h),v=h+o*i*c,g=(f-u*(p/Math.cos(v)))/(1-u);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=g,t.divisor=f-g,t.minPixelSize=a,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=u),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=u);var r=this.description.curvatureDependent,i=1+e.distance/p,a=Math.sqrt(i*i-1),o=[r.min.curvature,r.max.curvature],s=o[0],l=o[1],c=n.clamp((a-s)/(l-s),0,1),d=[r.min,r.max],h=d[0],f=d[1];return t.tiltAngle=n.lerp(h.tiltAngle,f.tiltAngle,c),t.scaleFallOffFactor=n.lerp(h.scaleFallOffFactor,f.scaleFallOffFactor,c),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=p*p,r=t.tiltAngle+.5*Math.PI,i=e.fovY,a=e.distance,o=a*a+n-2*Math.cos(r)*a*p,s=Math.sqrt(o),l=Math.sqrt(o-n);return(Math.acos(l/s)-Math.asin(p/(s/Math.sin(r)))+.5*i)/i},e}();t.defaultDescription={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var c={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},u={tiltAngle:0,scaleFallOffFactor:0},p=6378137}.apply(null,r))||(e.exports=i)},1545:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1599),n(1492),n(1488),n(1491),n(1494),n(1493)],void 0===(i=function(e,t,n,r,i,a,o,s){var l=i.vec4d.createFrom(1,1,1,1);return function(){function e(e,t,n,r,i){this.program=e.get("texOnly"),this.color=n,this.depthFunc=i,this.blend=r,this.texGLName=t}return e.prototype.beginSlot=function(e){return e===a.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",o.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:l),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){o.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e.loadShaders=function(e,t,i){e._parse(n);var a=new s(i,e.vertexShaderTexOnly,e.fragmentShaderTexOnly,r.Default3D);t.add("texOnly",a)},e}()}.apply(null,r))||(e.exports=i)},1546:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1602),n(1512),n(1492),n(1498),n(1488),n(1503),n(1487),n(1497),n(1495),n(1493),n(1489),n(1496)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h){return function(){function e(e,t,n){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=n,this.viewportToRestore=o.vec4d.create(),this.programRep=e,this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return r.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t,n){var i=!r.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,a=r.HIGHLIGHTS_VISUALIZE_BLOCKS,s=this._rctx;l.assert(this.enabled),o.vec4d.set(e.fullViewport,this.viewportToRestore);var c=n.width,d=n.height,u=Math.ceil(c/1),h=Math.ceil(d/1);this.blur0Fbo.resize(u,h),this.blur1Fbo.resize(u,h),s.bindVAO(this.quadVAO),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.setBlendingEnabled(!1);var f=null,v=null,g=null,m=null;if(i){var y=this._grid;this._gridUpdateResources(n,32),this._gridComputeMipmap(),g=y.vao,m=4,f=this.programRep.get("highlight-blur-grid-5"),s.bindProgram(f),s.bindTexture(y.coverageMipmap[y.mipmapLevels].colorTexture,1),f.setUniform1i("coverageTex",1)}else g=this.quadVAO,m=5,f=this.programRep.get("highlight-blur-5"),s.bindProgram(f);if(s.bindVAO(g),s.bindFramebuffer(this.blur0Fbo),s.setViewport(0,0,u,h),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),f.setUniform1i("tex",0),s.bindTexture(n.colorTexture,0),f.setUniform2f("blurSize",1/u,0),s.drawArrays(m,0,p.vertexCount(g,"geometry")),s.bindFramebuffer(this.blur1Fbo),s.clear(s.gl.COLOR_BUFFER_BIT),s.bindTexture(this.blur0Fbo.colorTexture,0),f.setUniform2f("blurSize",0,1/h),s.drawArrays(m,0,p.vertexCount(g,"geometry")),s.bindFramebuffer(t),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(770,771,1,771),s.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),i){v=this.programRep.get(a?"highlight-apply-grid-debug":"highlight-apply-grid"),s.bindProgram(v),v.setUniform1i("coverageTex",2);var b=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;s.bindTexture(b,2)}else v=this.programRep.get("highlight-apply"),s.bindProgram(v);v.setUniform1i("tex",0),s.bindTexture(this.blur1Fbo.colorTexture,0),v.setUniform1i("origin",1),s.bindTexture(n.colorTexture,1),v.setUniform4fv("color",this.defaultOptions.color),v.setUniform1f("outlineSize",8.6),v.setUniform1f("blurSize",.4),v.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),s.drawArrays(m,0,p.vertexCount(g,"geometry")),s.bindVAO(null),s.setDepthWriteEnabled(!0),s.setDepthTestEnabled(!0),s.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=s.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=d.createWithAttachments(this._rctx,t,e),this.blur1Fbo=d.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var n=this._rctx,r=this._grid,o=!1;if(null===r.coverageMipmap&&(r.coverageMipmap=[e],o=!0),r.viewportWidth===e.width&&r.viewportHeight===e.height||(o=!0,r.viewportWidth=e.width,r.viewportHeight=e.height),r.coverageMipmap[0]=e,r.cellPixelSize!==t&&(r.cellPixelSize=t,o=!0),o){for(var s=1;s<r.coverageMipmap.length;s++)r.coverageMipmap[s].dispose();r.mipmapLevels=Math.ceil(Math.log(r.cellPixelSize)*Math.LOG2E),r.coverageMipmap.length=r.mipmapLevels+1;for(s=0;s<r.mipmapLevels;s++){var l=r.coverageMipmap[s],u={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},f=d.createWithAttachments(n,u,p);r.coverageMipmap[s+1]=f}}var v=Math.ceil(e.height/r.cellPixelSize),g=Math.ceil(e.width/r.cellPixelSize);if(!r.vao||r.verticalCellCount!==v||r.horizontalCellCount!==g){r.verticalCellCount=v,r.horizontalCellCount=g;for(var m=v+1,y=g+1,b=1/v,_=1/g,x=new Float32Array(24*m*y),S=0,w=0;w<m;w++)for(var A=0;A<y;A++)x[S+0]=(A-.5)*_*2-1,x[S+1]=(w-.5)*b*2-1,x[S+2]=A*_,x[S+3]=w*b,x[S+4]=(A+.5)*_*2-1,x[S+5]=(w-.5)*b*2-1,x[S+6]=A*_,x[S+7]=w*b,x[S+8]=(A-.5)*_*2-1,x[S+9]=(w+.5)*b*2-1,x[S+10]=A*_,x[S+11]=w*b,x[S+12]=(A-.5)*_*2-1,x[S+13]=(w+.5)*b*2-1,x[S+14]=A*_,x[S+15]=w*b,x[S+16]=(A+.5)*_*2-1,x[S+17]=(w-.5)*b*2-1,x[S+18]=A*_,x[S+19]=w*b,x[S+20]=(A+.5)*_*2-1,x[S+21]=(w+.5)*b*2-1,x[S+22]=A*_,x[S+23]=w*b,S+=24;r.vao&&r.vao.dispose(!0),r.vao=new h(n,i.Default3D,{geometry:a.Pos2Tex},{geometry:c.createVertex(n,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,n=this.programRep.get("conservative-downsample");e.bindVAO(this.quadVAO);for(var r=0;r<t.mipmapLevels;r++){e.bindFramebuffer(t.coverageMipmap[r+1]),e.bindTexture(t.coverageMipmap[r].colorTexture,0);var i=t.coverageMipmap[r+1].width,a=t.coverageMipmap[r+1].height;e.bindProgram(n),n.setUniform1i("tex",0),n.setUniform2f("invFramebufferDim",1/i,1/a),e.setViewport(0,0,i,a),e.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}},e.loadShaders=function(e,t,r){e._parse(n);for(var a=0,o=["3","5","7","9"];a<o.length;a++){var s=o[a];t.add("highlight-blur-"+s,new u(r,e.vsHighlightBlurFastGaussian,e.fsHighlightBlurFastGaussian,i.Default3D,{GAUSSIAN_SAMPLES:s})),t.add("highlight-blur-grid-"+s,new u(r,e.vsHighlightBlurFastGaussian,e.fsHighlightBlurFastGaussian,i.Default3D,{GAUSSIAN_SAMPLES:s,GRID_OPTIMIZATION:"true"}))}t.add("highlight-apply",new u(r,e.vsHighlightApply,e.fsHighlightApply,i.Default3D)),t.add("highlight-apply-grid",new u(r,e.vsHighlightApply,e.fsHighlightApply,i.Default3D,["GRID_OPTIMIZATION"])),t.add("highlight-apply-grid-debug",new u(r,e.vsHighlightApply,e.fsHighlightApply,i.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"])),t.add("conservative-downsample",new u(r,e.vsConservativeDownsample,e.fsConservativeDownsample,i.Default3D))},e}()}.apply(null,r))||(e.exports=i)},1547:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1603),n(1492),n(1503),n(1604),n(1487),n(1493),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l){var c=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._programRep=e,this._rctx=t,this.renderTargetHelper=new a.RenderTargetHelper(t);var n=this.renderTargetHelper;this.mainColor=n.registerColorTarget({name:"mainColor"}),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"})}return e.loadShaders=function(e,t,i){e._parse(n);var a=new s(i,e.vsOffscreenRenderer,e.fsOffscreenRenderer,r.Default3D);t.add("offscreenProgram",a);var o=new s(i,e.vsOffscreenRenderer,e.fsOffscreenRendererTransparentToHUDVisibility,r.Default3D);t.add("transparentToHUDVisibility",o)},Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e){o.assert(this.enabled);var t=this._rctx,n=t.gl,r=e.fullViewport;this.dimensions.width=r[2],this.dimensions.height=r[3],this.bindTarget(this.mainColor,this.mainDepth),t.setClearStencil(0);var i=this._background.color;t.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),t.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,n){void 0===t&&(t=d),void 0===n&&(n=u),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,n)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,p)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var n=e._programRep.get("transparentToHUDVisibility");t.bindProgram(n),n.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,l.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,n){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=null),void 0===n&&(n=u);var r=this._rctx,i=this._programRep.get("offscreenProgram");switch(r.bindFramebuffer(t),r.setDepthTestEnabled(!1),r.bindProgram(i),i.setUniform1i("tex",1),r.bindTexture(e,1),n){case"none":r.setBlendingEnabled(!1);break;case"alpha":r.setBlendFunctionSeparate(770,771,1,771),r.setBlendingEnabled(!0);break;case"premultiplied-alpha":r.setBlendFunction(1,771),r.setBlendingEnabled(!0)}r.bindVAO(this.quadVAO),r.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry")),r.setDepthTestEnabled(!0),r.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=i.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,n,r,i){var a=this._rctx,o=a.gl;this.bindTarget(t,n);var s=0;if(r){var l=Math.max(1e-13,r[3]);a.setClearColor(r[0],r[1],r[2],l),s|=o.COLOR_BUFFER_BIT}i&&(s|=o.DEPTH_BUFFER_BIT),a.clear(s),e(),o.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var n=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(n)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),d=[0,0,0,0],u="none",p=[0,1,0,1];return c}.apply(null,r))||(e.exports=i)},1548:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1607),n(9),n(1522),n(1492),n(1498),n(1488),n(1503),n(1487),n(1497),n(1495),n(1493),n(1490),n(1489),n(1496)],void 0===(i=function(e,t,r,i,a,o,s,l,c,d,u,p,h,f,v,g){var m=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,n,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=l.vec4d.create(),this._rctx=n,this._programRep=e,this._requestRender=r,this._emptyTexture=c.createEmptyTexture(n)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),n=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return e.capabilities.standardDerivatives&&!(t||n)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,n,r){if(this._noiseTexture){d.assert(this.enabled);var i=this._rctx,a=n.width,o=n.height,s=a/this._BLUR_F,u=o/this._BLUR_F;this._ssaoFBO.resize(a,o),this._blur0FBO.resize(s,u),this._blur1FBO.resize(s,u);var p=1*a,h=1*o;i.bindFramebuffer(this._ssaoFBO),l.vec4d.set(e.fullViewport,this._viewportToRestore),i.setViewport(0,0,a,o);var f=this._programRep.get(this._samples<=8?"ssao8":this._samples<=16?"ssao16":this._samples<=32?"ssao32":"ssao64"),g=this._programRep.get("blur");f.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,o/this._noiseTexture.descriptor.height),f.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),i.bindProgram(f);var m=this._data.minDiscrepancy,y=this._samples<m.length?m[this._samples]:5779;f.setUniform1f("numSpiralTurns",y);var x=_,S=b;d.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,S),f.setUniform4fv("projInfo",x),f.setUniform2fv("zScale",S),f.setUniform2f("nearFar",e.near,e.far);var w=1/e.computePixelSizeAtDist(1);f.setUniform1f("projScale",1*w),f.setUniform2f("screenDimensions",p,h);var A=2*this._radius,C=l.vec3d.dist(e.eye,e.center);A=20*e.computePixelSizeAtDist(C),A=Math.max(.1,A),f.setUniform1f("radius",A),f.setUniform1f("intensity",4*this._attenuation/Math.pow(A,6)),f.setUniform1i("rnm",0),f.setUniform1i("normalMap",1),f.setUniform1i("depthMap",2),i.bindTexture(this._noiseTexture,0),i.bindTexture(r.colorTexture,1),i.bindTexture(n.colorTexture,2);var O=c.createQuadVAO(this._rctx);i.bindVAO(O),i.drawArrays(5,0,v.vertexCount(O,"geometry"));i.bindTexture(this._ssaoFBO.colorTexture,0),i.setViewport(0,0,p/this._BLUR_F,h/this._BLUR_F),i.bindFramebuffer(this._blur0FBO),g.setUniform2f("screenDimensions",p,h),g.setUniform1i("tex",0),g.setUniform1i("normalMap",1),g.setUniform1i("depthMap",2),g.setUniform2f("blurSize",0,1*this._BLUR_F/h),g.setUniform1i("radius",4),g.setUniform1f("g_BlurFalloff",.08),g.setUniform2f("nearFar",e.near,e.far),C>5e4&&(w=Math.max(0,w-(C-5e4))),g.setUniform1f("projScale",w),g.setUniform2f("zScale",1,0),i.drawArrays(5,0,v.vertexCount(O,"geometry")),g.setUniform2f("blurSize",1*this._BLUR_F/p,0),i.bindFramebuffer(this._blur1FBO),i.bindTexture(this._blur0FBO.colorTexture,0),i.drawArrays(5,0,v.vertexCount(O,"geometry")),i.bindFramebuffer(t),i.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,n=this._rctx;n.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),n.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),n=0;n<t.length;n++)this.setUniforms(t[n])},e.prototype.drawQuad=function(e){d.assert(this.enabled);var t=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new g(this._rctx,o.Default3D,{geometry:s.Pos2Tex},{geometry:u.createVertex(this._rctx,35044,x)}));var n=this._rctx;n.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),n.bindTexture(this._ssaoFBO.colorTexture,0),n.bindVAO(this._debugQuadVAO),n.drawArrays(5,0,v.vertexCount(this._debugQuadVAO,"geometry")),n.setDepthTestEnabled(!0)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void m.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():n.e(60).then(function(){var r=[n(1692)];(function(n){t._data=n,e()}).apply(null,r)}).catch(n.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},n={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,t,n),this._blur0FBO=p.createWithAttachments(this._rctx,t,n),this._blur1FBO=p.createWithAttachments(this._rctx,t,n),a.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new f(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())})},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e.loadShaders=function(e,t,n){d.assert(null==e.samples),e._parse(r);var i=new h(n,e.vertexShaderShowDepth,e.fragmentShaderShowDepth,o.Default3D),a=e.createFsSSAOSrcObscurance,s=new h(n,e.vsUVQuad,a,o.Default3D,{NUM_TAP_SAMPLES:"8"}),l=new h(n,e.vsUVQuad,a,o.Default3D,{NUM_TAP_SAMPLES:"16"}),c=new h(n,e.vsUVQuad,a,o.Default3D,{NUM_TAP_SAMPLES:"32"}),u=new h(n,e.vsUVQuad,a,o.Default3D,{NUM_TAP_SAMPLES:"64"}),p=new h(n,e.vsUVQuad,e.fsBlurEdgeAware,o.Default3D,{RADIUS:4..toString()});t.add("showDepth",i),t.add("ssao8",s),t.add("ssao16",l),t.add("ssao32",c),t.add("ssao64",u),t.add("blur",p)},e}(),b=l.vec2d.create(),_=l.vec4d.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return y}.apply(null,r))||(e.exports=i)},1549:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(1522),n(1630),n(1498),n(1488),n(1503),n(1504),n(1487),n(1495),n(1490),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p){function h(e,t,n,i,a,o,s){s=!1!==s,r.requestImage(t).then(function(t){if(c.assert(t.width>=1&&t.height>=1),n.samplingMode=s?9987:9729,n.hasMipmap=s,!s&&33071===n.wrapMode||c.isPowerOfTwo(t.width)&&c.isPowerOfTwo(t.height)){n.width=t.width,n.height=t.height;var r=new u(e,n,t);e.bindTexture(r),o(r)}else{r=f(e,t,n,i,a);e.bindTexture(r),o(r)}}).catch(function(e){var n=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;v.error("Failed to load image from uri",n,e),o(null)})}function f(e,t,n,r,i){var o=c.nextHighestPowerOfTwo(t.width),l=c.nextHighestPowerOfTwo(t.height);c.assert(o!==t.width||l!==t.height),n.width=o,n.height=l;var h=new u(e,n),f=d.createWithAttachments(e,h,{colorTarget:0,depthStencilTarget:0}),v=new u(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t);if(e.bindFramebuffer(f),void 0===i){var m=e.getViewport();i=[m.x,m.y,m.width,m.height]}e.setViewport(0,0,o,l);var y=r.get("texOnly"),b=g.identity();e.bindProgram(y),y.setUniformMatrix4fv("model",b),y.setUniformMatrix4fv("view",b),y.setUniformMatrix4fv("proj",b),y.setUniform4f("color",1,1,1,1),y.setUniform1i("tex",0);var _=s.createQuadVAO(e,a.Pos3Tex);return e.bindTexture(v,0),e.bindVAO(_),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,p.vertexCount(_,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(i[0],i[1],i[2],i[3]),_.dispose(!0),v.dispose(),e.bindFramebuffer(null),f.detachColorTexture(),f.dispose(),n.hasMipmap&&h.generateMipmap(),h}var v=n.getLogger("esri.views.3d.webgl-engine.lib.Texture"),g=o.mat4d;return function(){function e(t,n,r){this.data=t,this.id=e.idGen.gen(n),this.unloadFunc=void 0,this.params=r||{},this.params.wrapClamp=this.params.wrapClamp||!1,this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.estimatedTexMemRequiredMB=e.estimateTexMemRequiredMB(this.data,this.params)}return e.estimateTexMemRequiredMB=function(e,t){return null==e?0:e instanceof ArrayBuffer||e instanceof Uint8Array?e.byteLength/1e6:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4/1e6:(t.mipmap?4/3:1)*t.width*t.height*4/1e6||0},e.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,n,r,a,o){var s=this.data;if(n.flipped=!this.params.noUnpackFlip,n.samplingMode=this.params.mipmap?9987:9729,n.hasMipmap=this.params.mipmap,n.wrapMode=this.params.wrapClamp?33071:10497,n.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof s)h(t,s,n,r,a,o,this.params.mipmap);else if(s instanceof Image||s instanceof ImageData||s instanceof HTMLCanvasElement){if(this.params.width=s.width,this.params.height=s.height,!(this.params.mipmap||!this.params.wrapClamp)||c.isPowerOfTwo(s.width)&&c.isPowerOfTwo(s.height)){n.width=s.width,n.height=s.height;var l=new u(t,n,s);t.bindTexture(l),o(l)}else{l=f(t,s,n,r,a);t.bindTexture(l),o(l)}}else if(s instanceof ArrayBuffer&&this.params.encoding===e.DDS_ENCODING){l=i.createDDSTexture(t,n,s,this.params.mipmap);t.bindTexture(l),o(l)}else if(s instanceof Uint8Array&&this.params.encoding===e.DDS_ENCODING){l=i.createDDSTexture(t,n,s.buffer,this.params.mipmap);t.bindTexture(l),o(l)}else if(s instanceof Uint8Array){c.assert(this.params.width>0&&this.params.height>0),n.pixelFormat=1===this.params.components?6409:6408,n.width=this.params.width,n.height=this.params.height;l=new u(t,n,s);t.bindTexture(l),o(l)}else{if(null!==s)throw console.warn("Unsupported image data"),new Error("Unsupported image data");l=new u(t,n,null);t.bindTexture(l),o(l)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrapClamp:!0})},e.idGen=new l,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,r))||(e.exports=i)},1550:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(86)],void 0===(i=function(e,t,n){function r(e){return null!=e.cachedResult}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,r){var i=null,a=e&&e.expression;if("string"==typeof a){var o=function(e){return"0"===e?0:null}(a);if(null!=o)i={cachedResult:o};else{var s=n.createSyntaxTree(a);n.dependsOnView(s)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),i={cachedResult:0}):i={arcade:{func:n.createFunction(s),context:n.createExecContext(null,{sr:t})}}}}return i},t.createFeature=function(e,t){return n.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||r(e)||n.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(r(e))return e.cachedResult;var t=e.arcade,i=n.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var n=e&&e.featureExpressionInfo,r=n&&n.expression;return t||"0"===r||(n=null),n},t.zeroContext={cachedResult:0}}.apply(null,r))||(e.exports=i)},1553:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(11),n(1488),n(1521),n(1537)],void 0===(i=function(e,t,n,r,i,a){var o=r.vec3d.create(),s=r.vec3d.create(),l=n("dojo-debug-messages"),c=function(){function e(e,t,n,i,o,s,c,p){void 0===p&&(p=!1),this.dir=r.vec3d.create(),this.normalDir=null,this.minResult=new d,this.maxResult=new d,this.transform=r.mat4d.create(),this._transformInverse=new u({value:this.transform},r.mat4d.inverse,r.mat4d.create),this._transformInverseTranspose=new u(this._transformInverse,r.mat4d.transpose,r.mat4d.create),this._transformTranspose=new u({value:this.transform},r.mat4d.transpose,r.mat4d.create),this._transformInverseRotation=new u({value:this.transform},r.mat4d.toInverseMat3,r.mat3d.create),this.enableHUDSelection=!0,this.enableTerrain=!0,this.enableInvisibleTerrain=!1,this.enableBackfacesTerrain=!0,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.viewingMode=e||"global",this.intersectObject=this.intersectObject.bind(this),l&&(this.timer=new a(1)),this.init(t,n,i,o,s,c,p)}return e.prototype.init=function(e,t,n,i,a,o,s){if(t&&n&&r.vec3d.subtract(n,t,this.dir),this.minResult.init(t,n),this.maxResult.init(t,n),this.numObjectsTested=0,this.point=i,this.camera=a,this.isSelection=s,this.layers=e,this.p0=t,this.p1=n,this.hudResults=[],null==o&&(o=1e-5),this.tolerance=o,this.layers){l&&this.timer.start();for(var c=0;c<this.layers.length;++c){var d=this.layers[c],u=d.getSpatialQueryAccelerator?d.getSpatialQueryAccelerator():void 0;if(u)u.forEachAlongRay(this.p0,this.dir,this.intersectObject),s&&u.forEachDegenerateObject(this.intersectObject);else for(var p=d.getObjects(),h=0;h<p.length;++h)this.intersectObject(p[h])}l&&(this.timer.stop(),this.performanceInfo.queryDuration=this.timer.getLast(),this.performanceInfo.numObjectsTested=this.numObjectsTested)}},Object.defineProperty(e.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.getDirection=function(){return this.normalDir||(this.normalDir=r.vec3d.create(),r.vec3d.normalize(this.dir,this.normalDir)),this.normalDir},e.prototype.intersectObject=function(e){var t=this;this.numObjectsTested++;for(var n,i=e.id,a=e.getGeometryRecords(),l=e.objectTransformation,c=0;c<a.length;c++){var u=a[c],p=u.geometry,h=u.materials,f=u.instanceParameters;f.hidden||(n=p.id,r.mat4d.set(l,this.transform),r.mat4d.multiply(this.transform,u.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),r.mat4d.multiplyVec3(this.transformInverse,this.p0,o),r.mat4d.multiplyVec3(this.transformInverse,this.p1,s),h[0].intersect(p,f,this.transform,this,o,s,function(r,a,o,s,l,c){if(r>=0)if(l){var u=new d;u.init(t.p0,t.p1),u.set(e,i,r,a,s,c,n,o),t.hudResults.push(u)}else(null==t.minResult.priority||s>=t.minResult.priority)&&(null==t.minResult.dist||r<t.minResult.dist)&&t.minResult.set(e,i,r,a,s,null,n,o),(null==t.maxResult.priority||s>=t.maxResult.priority)&&(null==t.maxResult.dist||r>t.maxResult.dist)&&t.maxResult.set(e,i,r,a,s,null,n,o)},u.customTransformation))}},e.prototype.getMinResult=function(){return this.minResult},e.prototype.getMaxResult=function(){return this.maxResult},e.prototype.getHudResults=function(){return this.hudResults},e.DEFAULT_TOLERANCE=1e-5,e}(),d=function(){function e(e,t){this.normal=r.vec3d.create(),this.init(e,t)}return e.prototype.getIntersectionPoint=function(e){return null!=this.dist&&(r.vec3d.lerp(this.p0,this.p1,this.dist,e),!0)},e.prototype.set=function(e,t,n,a,o,s,l,c){e instanceof i&&(e={type:"stage",obj:e}),this.dist=n,r.vec3d.set(a,this.normal),this.target=e,this.name=t,this.priority=o,this.center=s?r.vec3d.create(s):null,this.geometryId=l,this.triangleNr=c},e.prototype.copyFrom=function(e){this.p0=e.p0,this.p1=e.p1,this.dist=e.dist,this.target=e.target,this.name=e.name,this.priority=e.priority,this.center=e.center?r.vec3d.create(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,r.vec3d.set(e.normal,this.normal)},e.prototype.setIntersector=function(e){this.intersector=e},e.prototype.init=function(e,t){this.dist=void 0,this.target=void 0,this.name=void 0,this.priority=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",this.p0=e,this.p1=t},e}(),u=function(){function e(e,t,n){this.original=e,this.update=t,this.dirty=!0,this.transform=n()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}();return c}.apply(null,r))||(e.exports=i)},1554:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1586)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,r=this.buffers;t<r.length;t++){var i=r[t];if(i.availableCount>=e)return i}if(e>n.MAX_INDEX_COUNT)return null;var a=new n.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(a),a},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=r}.apply(null,r))||(e.exports=i)},1555:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){function n(e,t,n){for(var r=0;r<n;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=n,t.decodeDoubleArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[2*r]+e[2*r+1]},t.encodeDoubleArraySplit=function(e,t,a,o){for(var s=0;s<o;++s)r[0]=e[s],n(r,i,1),t[s]=i[0],a[s]=i[1]};var r=new Float64Array(1),i=new Float32Array(2)}.apply(null,r))||(e.exports=i)},1556:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1615),n(1498),n(1505),n(1502),n(1491),n(1499),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u){var p=i.Pos3Col,h=u.getStride(p)/4,f={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1},v=function(e){function t(t,n){var r=e.call(this,n)||this;return r.supportsEdges=!0,r.params=d.copyParameters(t,f),r}return n(t,e),t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return d.copyParameters(this.params)},t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.setTransparent=function(e){this.params.transparent=e,this.notifyDirty("matChanged")},t.prototype.getTransparent=function(){return this.params.transparent},t.prototype.getOutputAmount=function(e){return e*h*1},t.prototype.getVertexBufferLayout=function(){return p},t.prototype.getInstanceBufferLayout=function(){},t.prototype.fillInterleaved=function(e,t,n,r,i,a,o){d.fillInterleaved(e,t,n,r,p,i,a,o)},t.prototype.intersect=function(e,t,n,r,i,a,o,s){d.intersectTriangleGeometry(e,t,n,r,i,a,o)},t.prototype.getGLMaterials=function(){return{color:g,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:m}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,n){e._parse(r);var i=new l("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,t,e,n);i.addDefine("Color","VERTEXCOLORS"),t.addShaderVariations("colorMaterial",i)},t}(o),g=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])},t.prototype.beginSlot=function(e){return e===(this.params.color[3]<1?s.TRANSPARENT_MATERIAL:s.OPAQUE_MATERIAL)},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,r=this.params;e.bindProgram(n),n.setUniform4fv("eColor",r.color),e.setFaceCullingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1)),r.transparent&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;e.setPolygonOffsetFillEnabled(!1),t.transparent&&e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){d.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(a),m=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])},t.prototype.beginSlot=function(e){return e===s.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,r=this.params;e.bindProgram(n),n.setUniform4fv("eColor",r.color),e.setFaceCullingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1))},t.prototype.release=function(e){e.setPolygonOffsetFillEnabled(!1)},t.prototype.bindView=function(e,t){d.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(a);return v}.apply(null,r))||(e.exports=i)},1557:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1617),n(1505),n(1502),n(1491),n(1499),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){function u(e,t,n){3===n.length?e.setUniform4f(t,n[0],n[1],n[2],1):e.setUniform4fv(t,n)}var p=l.VertexAttrConstants,h=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],f={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"},v=function(e){function t(n,r){var i=e.call(this,r)||this;return i.params=c.copyParameters(n,f),i._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(i.params),i}return n(t,e),Object.defineProperty(t.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getGLMaterials=function(){return{color:g,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.fillAttributeData=function(e,t,n,r,i,a){var o=e.indices[t],s=e.vertexAttr[t].data;if(o&&s)for(var l=n+d.findAttribute(h,t).offset/4,u=0;u<o.length;u++)for(var p=r*o[u],f=0;f<6;f++)c.fill(s,p,a,l,i,r),l+=12},t.prototype.fillInterleaved=function(e,t,n,r,i,a,o){this.fillAttributeData(e,p.POSITION,a,3,t,i),this.fillAttributeData(e,p.NORMAL,a,3,n,i),this.fillAttributeData(e,p.AUXPOS1,a,4,null,i);for(var s=a+d.findAttribute(h,p.UV0).offset/4,l=0,c=m;l<c.length;l++){var u=c[l];i[s+0]=u[0],i[s+1]=u[1],s+=12}},t.prototype.getOutputAmount=function(e){return 48*e*6},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return h},t.prototype.intersect=function(e,t,n,r,i,a,o,s){},t.prototype.getParameterValues=function(){var e=this.params;return{verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,screenOffset:e.screenOffset,centerOffsetUnits:e.centerOffsetUnits,color:[e.color[0],e.color[1],e.color[2],e.color[3]],size:e.size,borderColor:e.borderColor,occlusionTest:e.occlusionTest,shaderPolygonOffset:e.shaderPolygonOffset,depthHUDAlignStart:e.depthHUDAlignStart}},t.prototype.setParameterValues=function(e){c.updateParameters(this.params,e)&&(this._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))},t.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t.loadShaders=function(e,t,n){e._parse(r);var i=new s("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,t,e,n);i.addDefine("occlTest","OCCL_TEST"),i.addDefine("verticalOffset","VERTICAL_OFFSET"),i.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),i.addDefine("depthHud","DEPTH_HUD"),i.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START"),i.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN"),t.addShaderVariations("line-callout-material-shader-variations",i)},t}(a),g=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.isRenderSlot=!0,i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!e.occlusionTest,!!e.verticalOffset,!!e.screenSizePerspective,!1,!!e.depthHUDAlignStart,"screen"===e.centerOffsetUnits]),this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!e.occlusionTest,!!e.verticalOffset,!!e.screenSizePerspective,!0,!!e.depthHUDAlignStart,"screen"===e.centerOffsetUnits])},t.prototype.beginSlot=function(e){switch(e){case o.LINE_CALLOUTS:return this.isRenderSlot=!0,!0;case o.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1},Object.defineProperty(t.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(){return this.program},t.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t.prototype.bind=function(e,t){var n=t.cameraAboveGround?1:-1,r=this.program,i=this.params;e.bindProgram(r),r.setUniform1f("cameraGroundRelative",n),r.setUniform1f("polygonOffset",i.shaderPolygonOffset),r.setUniform4fv("viewport",t.viewport),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),r.setUniform1i("hudVisibilityTexture",0),e.bindTexture(t.hudVisibilityTexture,0),u(r,"color",i.color),r.setUniform2f("screenOffset",i.screenOffset[0],i.screenOffset[1]),this.bindBorder(e,t),c.bindVerticalOffset(i.verticalOffset,t,r),this.bindSizing(e,t),c.bindScreenSizePerspective(i.screenSizePerspective,r),this.isRenderSlot?this.bindRender(e,t):this.bindHUDDepth(e,t)},t.prototype.bindRender=function(e,t){e.setBlendFunctionSeparate(1,771,770,771),e.setBlendingEnabled(!0),e.setDepthWriteEnabled(!1)},t.prototype.bindHUDDepth=function(e,t){e.setColorMask(!1,!1,!1,!1),e.setDepthWriteEnabled(!0),e.setBlendingEnabled(!1),e.setDepthTestEnabled(!0)},t.prototype.bindView=function(e,t){var n=this.program;c.bindView(t.origin,t.view,n),c.bindCamPos(t.origin,t.viewInvTransp,n)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e,t){this.isRenderSlot?this.releaseRender(e,t):this.releaseHUDDepth(e,t)},t.prototype.releaseRender=function(e,t){e.setBlendingEnabled(!1),e.setBlendFunction(770,771),e.setDepthWriteEnabled(!0)},t.prototype.releaseHUDDepth=function(e,t){e.setColorMask(!0,!0,!0,!0)},t.prototype.bindSizing=function(e,t){var n=this.program,r=this.params;n.setUniform2f("pixelToNDC",2/t.viewport[2],2/t.viewport[3]),n.setUniform1f("lineSize",Math.ceil(r.size))},t.prototype.bindBorder=function(e,t){var n=this.program,r=this.params;null!==r.borderColor?(u(n,"borderColor",r.borderColor),n.setUniform1f("borderSize",1)):(n.setUniform4f("borderColor",0,0,0,0),n.setUniform1f("borderSize",0))},t}(i),m=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return v}.apply(null,r))||(e.exports=i)},1558:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1620),n(9),n(1510),n(1500),n(1498),n(1488),n(1505),n(1502),n(1491),n(1499),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v){var g=h.VertexAttrConstants,m="ribbon-line-material-shader-variations",y="ribbon-line-material-highlight-shader-variations",b=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),_=function(e){function t(t,n){var r=e.call(this,n)||this;return r.params=f.copyParameters(t,B),"miter"!==r.params.join&&(r.params.miterLimit=0),r.numVertsAtJoin="wall"===r.params.type?2:4,r.numVertsAtCap=2,r.canBeMerged="screen"===r.params.type&&null==r.params.stippleLength,r}return n(t,e),t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=this.params;return{color:e.color,width:e.width,type:e.type,join:e.join,polygonOffset:e.polygonOffset,miterLimit:e.miterLimit,stippleLength:e.stippleLength}},t.prototype.setParameterValues=function(e){for(var t in e)h.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),h.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.getOutputAmount=function(e){var t=(e/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t*v.getStride(G)/4},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?j:G},t.prototype.fillInterleaved=function(e,t,n,r,i,a){var o=e.vertexAttr[g.POSITION].data,s=e.vertexAttr[g.COLOR]?e.vertexAttr[g.COLOR].data:w,l=e.vertexAttr[g.SIZE]?e.vertexAttr[g.SIZE].data:A,c=e.indices&&e.indices[g.POSITION];c&&c.length!==2*(o.length/3-1)&&console.warn("RibbonLineMaterial does not support indices"),"wall"===this.params.type?this.fillWithoutAuxpos(o,t,i,a):this.fillWithAuxpos(o,s,l,t,i,a)},t.prototype.intersect=function(e,t,n,r,i,s,c,d){if(r.isSelection&&!o.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!h.isTranslationMatrix(n))return void b.error("intersection assumes a translation-only matrix");var u=e.getData(),p=u.getVertexAttr()[g.POSITION].data,f=u.getVertexAttr()[g.SIZE],v=f&&f.data[0],m=r.camera,y=r.point,_=(v+this.params.width)/2+4;l.vec3d.set3(y[0]-_,y[1]+_,0,L[0]),l.vec3d.set3(y[0]+_,y[1]+_,0,L[1]),l.vec3d.set3(y[0]+_,y[1]-_,0,L[2]),l.vec3d.set3(y[0]-_,y[1]-_,0,L[3]);for(var x=0;x<4;x++)m.unprojectPoint(L[x],V[x]);a.plane.fromPoints(m.eye,V[0],V[1],F),a.plane.fromPoints(m.eye,V[1],V[2],z),a.plane.fromPoints(m.eye,V[2],V[3],U),a.plane.fromPoints(m.eye,V[3],V[0],N);var S=Number.MAX_VALUE;for(x=0;x<p.length-5;x+=3)if(C[0]=p[x]+n[12],C[1]=p[x+1]+n[13],C[2]=p[x+2]+n[14],O[0]=p[x+3]+n[12],O[1]=p[x+4]+n[13],O[2]=p[x+5]+n[14],!(a.plane.distance(F,C)<0&&a.plane.distance(F,O)<0||a.plane.distance(z,C)<0&&a.plane.distance(z,O)<0||a.plane.distance(U,C)<0&&a.plane.distance(U,O)<0||a.plane.distance(N,C)<0&&a.plane.distance(N,O)<0)){if(m.projectPoint(C,P),m.projectPoint(O,T),P[2]<0&&T[2]>0){l.vec3d.subtract(C,O,R);var w=m.frustumPlanes,A=-a.plane.distance(w[4],C)/l.vec3d.dot(R,w[4]);l.vec3d.scale(R,A,R),l.vec3d.add(C,R,C),m.projectPoint(C,P)}else if(P[2]>0&&T[2]<0){l.vec3d.subtract(O,C,R);w=m.frustumPlanes,A=-a.plane.distance(w[4],O)/l.vec3d.dot(R,w[4]);l.vec3d.scale(R,A,R),l.vec3d.add(O,R,O),m.projectPoint(O,T)}else if(P[2]<0&&T[2]<0)continue;var B=h.pointLineSegmentDistanceSquared2D(P,T,y);B<S&&(S=B,l.vec3d.set(C,D),l.vec3d.set(O,I))}var j=r.p0,G=r.p1;if(S<_*_){var H=h.lineLineDistanceSquared3D(D,I,j,G,M),k=Number.MAX_VALUE;if(H.success){l.vec3d.subtract(H.pa,j,E);var W=l.vec3d.length(E);l.vec3d.scale(E,1/W),k=W/l.vec3d.dist(j,G)}c(k,E)}}},t.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:S}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.fillWithAuxpos=function(e,t,n,r,i,a){var o=e.length/3,s=e[0],l=e[1],c=e[2],d=0,u=a,p=v.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(a+=p),r&&(s=r[0]*s+r[4]*l+r[8]*c+r[12],l=r[1]*s+r[5]*l+r[9]*c+r[13],c=r[2]*s+r[6]*l+r[10]*c+r[14]);var h=s,f=l,g=c,m=e[3],y=e[4],b=e[5];r&&(m=r[0]*m+r[4]*y+r[8]*b+r[12],y=r[1]*m+r[5]*y+r[9]*b+r[13],b=r[2]*m+r[6]*y+r[10]*b+r[14]);for(var _=0;_<o;_++){var x=3*_;_<o-1&&(m=e[x+3],y=e[x+4],b=e[x+5],r&&(m=r[0]*m+r[4]*y+r[8]*b+r[12],y=r[1]*m+r[5]*y+r[9]*b+r[13],b=r[2]*m+r[6]*y+r[10]*b+r[14])),d+=Math.sqrt((h-s)*(h-s)+(f-l)*(f-l)+(g-c)*(g-c)),i[a++]=h,i[a++]=f,i[a++]=g,i[a++]=d,i[a++]=0===_?-1.2:-1,i[a++]=s,i[a++]=l,i[a++]=c,i[a++]=m,i[a++]=y,i[a++]=b,i[a++]=t[0],i[a++]=t[1],i[a++]=t[2],i[a++]=t[3],i[a++]=n[0],i[a++]=h,i[a++]=f,i[a++]=g,i[a++]=d,i[a++]=0===_?1.2:1,i[a++]=s,i[a++]=l,i[a++]=c,i[a++]=m,i[a++]=y,i[a++]=b,i[a++]=t[0],i[a++]=t[1],i[a++]=t[2],i[a++]=t[3],i[a++]=n[0],_>0&&_<o-1&&(i[a++]=h,i[a++]=f,i[a++]=g,i[a++]=d,i[a++]=-1.2,i[a++]=s,i[a++]=l,i[a++]=c,i[a++]=m,i[a++]=y,i[a++]=b,i[a++]=t[0],i[a++]=t[1],i[a++]=t[2],i[a++]=t[3],i[a++]=n[0],i[a++]=h,i[a++]=f,i[a++]=g,i[a++]=d,i[a++]=1.2,i[a++]=s,i[a++]=l,i[a++]=c,i[a++]=m,i[a++]=y,i[a++]=b,i[a++]=t[0],i[a++]=t[1],i[a++]=t[2],i[a++]=t[3],i[a++]=n[0]),s=h,l=f,c=g,h=m,f=y,g=b}if(this.canBeMerged){for(_=u;_<u+p;_++)i[_]=i[_+p];var S=a-p;for(_=0;_<p;_++)i[a++]=i[S++]}},t.prototype.fillWithoutAuxpos=function(e,t,n,r){for(var i,a,o,s=e.length/3,l=0,c=e[0],d=e[1],u=e[2],p=0;p<s;p++){var h=3*p;i=c,a=d,o=u,c=e[h],d=e[h+1],u=e[h+2],t&&(c=t[0]*c+t[4]*d+t[8]*u+t[12],d=t[1]*c+t[5]*d+t[9]*u+t[13],u=t[2]*c+t[6]*d+t[10]*u+t[14]),l+=Math.sqrt((c-i)*(c-i)+(d-a)*(d-a)+(u-o)*(u-o)),n[r++]=c,n[r++]=d,n[r++]=u,n[r++]=l,n[r++]=-1,n[r++]=c,n[r++]=d,n[r++]=u,n[r++]=l,n[r++]=1}},t.loadShaders=function(e,t,n){e._parse(r);var i=function(e){e.addDefine("Screen","SCREENSCALE"),e.addDefine("Strip","STRIP"),e.addDefine("Wall","WALL"),e.addDefine("Stipple","STIPPLE")},a=new p("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,t,e,n);i(a),t.addShaderVariations(m,a);var o=new p("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,t,e,n);i(o),t.addShaderVariations(y,o)},t}(d),x=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.params=f.copyParameters(t.getParams()),delete r.params.join,r.program=n.getShaderVariationsProgram(m,["screen"===r.params.type,"strip"===r.params.type,"wall"===r.params.type,null!=r.params.stippleLength]),r}return n(t,e),t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.polygonOffset=e.polygonOffset,t.color=e.color,t.width=e.width,t.miterLimit="miter"===e.join?e.miterLimit:0,t.stippleLength=e.stippleLength},t.prototype.beginSlot=function(e){return e===u.TRANSPARENT_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,r=this.params;if(e.bindProgram(n),n.setUniform4fv("eColor",r.color),n.setUniform1f("miterLimit",r.miterLimit),n.setUniform1f("nearPlane",t.nearFar[0]),"screen"===r.type?(n.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),n.setUniform1f("extLineWidth",r.width*t.pixelRatio)):n.setUniform1f("extLineWidth",r.width),null!=r.stippleLength){var i=r.stippleLength?1/(2*r.stippleLength):0;n.setUniform1f("stippleLengthDoubleInv",i)}r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(r.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setBlendingEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){f.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t}(c),S=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.params=f.copyParameters(t.getParams()),delete r.params.join,r.program=n.getShaderVariationsProgram(y,["screen"===r.params.type,"strip"===r.params.type,"wall"===r.params.type,null!=r.params.stippleLength]),r}return n(t,e),t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.polygonOffset=e.polygonOffset,t.color=e.color,t.width=e.width,t.miterLimit="miter"===e.join?e.miterLimit:0,t.stippleLength=e.stippleLength},t.prototype.beginSlot=function(e){return e===u.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,r=this.params;if(e.bindProgram(n),n.setUniform4fv("eColor",r.color),n.setUniform1f("miterLimit",r.miterLimit),n.setUniform1f("nearPlane",t.nearFar[0]),"screen"===r.type?(n.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),n.setUniform1f("extLineWidth",r.width*t.pixelRatio)):n.setUniform1f("extLineWidth",r.width),null!=r.stippleLength){var i=r.stippleLength?1/(2*r.stippleLength):0;n.setUniform1f("stippleLengthDoubleInv",i)}r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(r.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){f.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t}(c),w=[255,255,255,255],A=[0,0,0,0],C=l.vec3d.create(),O=l.vec3d.create(),R=l.vec3d.create(),E=l.vec3d.create(),P=l.vec3d.create(),T=l.vec3d.create(),D=l.vec3d.create(),I=l.vec3d.create(),M={success:!1,dist2:0,pa:l.vec3d.create(),pb:l.vec3d.create()},L=[l.vec3d.create(),l.vec3d.create(),l.vec3d.create(),l.vec3d.create()],V=[l.vec3d.create(),l.vec3d.create(),l.vec3d.create(),l.vec3d.create()],F=a.plane.create(),z=a.plane.create(),U=a.plane.create(),N=a.plane.create(),B={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,polygonOffset:!1,stippleLength:null},j=s.Pos3Tex,G=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return _}.apply(null,r))||(e.exports=i)},1559:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(49)],void 0===(i=function(e,t,n){function r(e,t,r,i){var a=s;return e?(r&&i&&(a.len=n.vec3d.dist(t,r)),n.vec3d.set(e,a.dir)):i?(a.len=n.vec3d.dist(t,r),n.vec3d.scale(n.vec3d.subtract(r,t,a.dir),1/a.len)):n.vec3d.normalize(n.vec3d.subtract(r,t,a.dir)),a}function i(e,t){return-n.vec3d.dot(t,e)-e[3]}function a(e,t,r){var a=n.vec3d.dot(e,r.dir),o=i(e,t);if(o<0&&a>=0)return!1;if(a>-1e-6&&a<1e-6)return o>0;if((o<0||a<0)&&!(o<0&&a<0))return!0;var s=o/a;return a>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function o(e,t,n,r){r.clip[0]=0,r.clip[1]=n?r.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!a(e[i],t,r))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,n){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<n},t.frustumSphere=function(e,t,n){var r=t[0],i=t[1],a=t[2];return!(e[0][0]*r+e[0][1]*i+e[0][2]*a+e[0][3]>n||e[1][0]*r+e[1][1]*i+e[1][2]*a+e[1][3]>n||e[2][0]*r+e[2][1]*i+e[2][2]*a+e[2][3]>n||e[3][0]*r+e[3][1]*i+e[3][2]*a+e[3][3]>n||e[4][0]*r+e[4][1]*i+e[4][2]*a+e[4][3]>n||e[5][0]*r+e[5][1]*i+e[5][2]*a+e[5][3]>n)},t.frustumRay=function(e,t,n,i){return o(e,t,null,r(i,t,n,!1))},t.frustumPoint=function(e,t){for(var n=0;n<6;n++)if(i(e[n],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,n,i){return o(e,t,n,r(i,t,n,!0))},t.closestPointOnRay=function(e,t,r,i){var a=n.vec3d.dot(t,n.vec3d.subtract(r,e,i));return n.vec3d.add(e,n.vec3d.scale(t,a,i),i),i};var s={dir:n.vec3d.create(),len:0,clip:n.vec2d.create()}}.apply(null,r))||(e.exports=i)},1560:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1510),n(487),n(1527),n(1488),n(1487)],void 0===(i=function(e,t,n,r,i,a,o){function s(e,t,n,r,i){return!(Math.abs(a.vec3.dot(t,e))>i||(a.vec3.cross(e,t,n),a.vec3.normalize(n),a.vec3.cross(n,e,r),a.vec3.normalize(r),0))}function l(e,t,n,r,i,a,o){return s(e,t,i,a,o)||s(e,n,i,a,o)||s(e,r,i,a,o)}var c,d,u,p,h=r.Vec3Compact;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],a=[0,0,1,0,1,1,0,1],s=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=new Array(36),c=0;c<6;c++)for(var d=0;d<6;d++)l[6*c+d]=c;var u=new Array(36);for(c=0;c<6;c++)u[6*c+0]=0,u[6*c+1]=1,u[6*c+2]=2,u[6*c+3]=2,u[6*c+4]=3,u[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=n[c][0]*e[0],t[3*c+1]=n[c][1]*e[1],t[3*c+2]=n[c][2]*e[2];var d={};d[o.VertexAttrConstants.POSITION]=new Uint32Array(s),d[o.VertexAttrConstants.NORMAL]=new Uint32Array(l),d[o.VertexAttrConstants.UV0]=new Uint32Array(u);var p={};return p[o.VertexAttrConstants.POSITION]={size:3,data:t},p[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},p[o.VertexAttrConstants.UV0]={size:2,data:new Float32Array(a)},new i(p,d)}}(c||(c={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],a=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],s=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];(d||(d={})).createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),l=0;l<6;l++)t[3*l]=n[l][0]*e[0],t[3*l+1]=n[l][1]*e[1],t[3*l+2]=n[l][2]*e[2];var c={};c[o.VertexAttrConstants.POSITION]=new Uint32Array(a),c[o.VertexAttrConstants.NORMAL]=new Uint32Array(s);var d={};return d[o.VertexAttrConstants.POSITION]={size:3,data:t},d[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)},new i(d,c)}}(),function(e){var t=a.vec3.createFrom(-.5,0,-.5),n=a.vec3.createFrom(.5,0,-.5),r=a.vec3.createFrom(0,0,.5),s=a.vec3.createFrom(0,.5,0),l=a.vec3.create(),c=a.vec3.create(),d=a.vec3.create(),u=a.vec3.create(),p=a.vec3.create();a.vec3.subtract(t,s,l),a.vec3.subtract(t,n,c),a.vec3.cross(l,c,d),a.vec3.normalize(d,d),a.vec3.subtract(n,s,l),a.vec3.subtract(n,r,c),a.vec3.cross(l,c,u),a.vec3.normalize(u,u),a.vec3.subtract(r,s,l),a.vec3.subtract(r,t,c),a.vec3.cross(l,c,p),a.vec3.normalize(p,p);var h=[t,n,r,s],f=[0,-1,0,d[0],d[1],d[2],u[0],u[1],u[2],p[0],p[1],p[2]],v=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),n=0;n<4;n++)t[3*n]=h[n][0]*e[0],t[3*n+1]=h[n][1]*e[1],t[3*n+2]=h[n][2]*e[2];var r={};r[o.VertexAttrConstants.POSITION]=new Uint32Array(v),r[o.VertexAttrConstants.NORMAL]=new Uint32Array(g);var a={};return a[o.VertexAttrConstants.POSITION]={size:3,data:t},a[o.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(f)},new i(a,r)}}(u||(u={})),function(e){e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=d.createGeometry,e.createTetrahedronGeometry=u.createGeometry,e.createSphereGeometry=function(e,t,n,r,a,s,l){e=e||50,r=void 0!==r?r:-Math.PI,a=void 0!==a?a:2*Math.PI,s=void 0!==s?s:.5*-Math.PI,l=void 0!==l?l:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),d=Math.max(2,Math.floor(n)||6),u=(c+1)*(d+1),p=new Float32Array(3*u),h=new Float32Array(3*u),f=new Float32Array(2*u),v=[],g=0,m=0;m<=d;m++){for(var y=[],b=m/d,_=s+b*l,x=Math.cos(_),S=0;S<=c;S++){var w=S/c,A=r+w*a,C=Math.cos(A)*x,O=Math.sin(_),R=-Math.sin(A)*x;p[3*g]=C*e,p[3*g+1]=O*e,p[3*g+2]=R*e,h[3*g]=C,h[3*g+1]=O,h[3*g+2]=R,f[2*g]=w,f[2*g+1]=b,y.push(g),++g}v.push(y)}var E=new Uint32Array(2*c*(d-1)*3);for(g=0,m=0;m<d;m++)for(S=0;S<c;S++){var P=v[m][S],T=v[m][S+1],D=v[m+1][S+1],I=v[m+1][S];0===m?(E[g++]=P,E[g++]=D,E[g++]=I):m===d-1?(E[g++]=P,E[g++]=T,E[g++]=D):(E[g++]=P,E[g++]=T,E[g++]=D,E[g++]=D,E[g++]=I,E[g++]=P)}o.assert(g===E.length);var M={};M[o.VertexAttrConstants.POSITION]=E,M[o.VertexAttrConstants.NORMAL]=E,M[o.VertexAttrConstants.UV0]=E;var L={};return L[o.VertexAttrConstants.POSITION]={size:3,data:p},L[o.VertexAttrConstants.NORMAL]={size:3,data:h},L[o.VertexAttrConstants.UV0]={size:2,data:f},new i(L,M)},e.createPolySphereGeometry=function(e,t,n){function r(t,n){var r;t>n&&(t=(r=[n,t])[0],n=r[1]);var i=t.toString()+"."+n.toString();if(u[i])return u[i];var o=a.length;return a.length+=3,h.add(a,3*t,a,3*n,a,o),h.scale(a,o,e/h.length(a,o)),o/=3,u[i]=o,o}var a,s,l=e;if(n)a=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var c=l*(1+Math.sqrt(5))/2;a=[-l,c,0,l,c,0,-l,-c,0,l,-c,0,0,-l,c,0,l,c,0,-l,-c,0,l,-c,c,0,-l,c,0,l,-c,0,-l,-c,0,l],s=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var d=0;d<a.length;d+=3)h.scale(a,d,e/h.length(a,d));var u={};for(d=0;d<t;d++){for(var p=s.length,f=new Uint32Array(4*p),v=0;v<p;v+=3){var g=s[v],m=s[v+1],y=s[v+2],b=r(g,m),_=r(m,y),x=r(y,g),S=4*v;f[S]=g,f[S+1]=b,f[S+2]=x,f[S+3]=m,f[S+4]=_,f[S+5]=b,f[S+6]=y,f[S+7]=x,f[S+8]=_,f[S+9]=b,f[S+10]=_,f[S+11]=x}s=f,u={}}var w=new Float32Array(a);for(d=0;d<w.length;d+=3)h.normalize(w,d);var A={};A[o.VertexAttrConstants.POSITION]=s,A[o.VertexAttrConstants.NORMAL]=s;var C={};return C[o.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(a)},C[o.VertexAttrConstants.NORMAL]={size:3,data:w},new i(C,A)},e.createPointGeometry=function(e,t,n,r,a,s,l){var c=t?new Float32Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),d=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),u=s?new Float32Array(s):new Float32Array([0,0]),p=n?new Uint8Array([255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]):new Uint8Array([255,255,255,255]),h=null!=r&&2===r.length?new Float32Array(r):new Float32Array([1,1]),f=new Uint32Array([0]),v={};v[o.VertexAttrConstants.POSITION]=f,v[o.VertexAttrConstants.NORMAL]=f,v[o.VertexAttrConstants.UV0]=f,v[o.VertexAttrConstants.COLOR]=f,v[o.VertexAttrConstants.SIZE]=f;var g={};if(g[o.VertexAttrConstants.POSITION]={size:3,data:c},g[o.VertexAttrConstants.NORMAL]={size:3,data:d},g[o.VertexAttrConstants.UV0]={size:u.length,data:u},g[o.VertexAttrConstants.COLOR]={size:4,data:p},g[o.VertexAttrConstants.SIZE]={size:2,data:h},null!=a){var m=new Float32Array([a[0],a[1],a[2],a[3]]);v[o.VertexAttrConstants.AUXPOS1]=f,g[o.VertexAttrConstants.AUXPOS1]={size:4,data:m}}if(null!=l){var y=new Float32Array([l[0],l[1],l[2],l[3]]);v[o.VertexAttrConstants.AUXPOS2]=f,g[o.VertexAttrConstants.AUXPOS2]={size:4,data:y}}return new i(g,v,i.DefaultOffsets,"point")},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),a=new Uint32Array(e.length),s=new Uint32Array(e.length),l=0;l<e.length;l++)n[3*l]=e[l][0],n[3*l+1]=e[l][1],n[3*l+2]=e[l][2],t&&(r[3*l]=t[l][0],r[3*l+1]=t[l][1],r[3*l+2]=t[l][2]),a[l]=l,s[l]=0;t||(r[0]=0,r[1]=1,r[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var d={};d[o.VertexAttrConstants.POSITION]=a,d[o.VertexAttrConstants.NORMAL]=t?a:s,d[o.VertexAttrConstants.UV0]=s;var u={};return u[o.VertexAttrConstants.POSITION]={size:3,data:n},u[o.VertexAttrConstants.NORMAL]={size:3,data:r},u[o.VertexAttrConstants.UV0]={size:2,data:c},new i(u,d,i.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),n=new Float32Array([0,1,0]),r=new Uint32Array([0,0,0]),a=new Float32Array([0,0]),s=new Uint32Array([0,0,0]),l={};l[o.VertexAttrConstants.POSITION]=t,l[o.VertexAttrConstants.NORMAL]=r,l[o.VertexAttrConstants.UV0]=s;var c={};return c[o.VertexAttrConstants.POSITION]={size:3,data:e},c[o.VertexAttrConstants.NORMAL]={size:3,data:n},c[o.VertexAttrConstants.UV0]={size:2,data:a},new i(c,l)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var n=0;n<4;n++)for(var r=0;r<3;r++)t[3*n+r]=e[n][r];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var a=new Uint32Array([0,1,2,2,3,0]),s=new Float32Array([0,0,1]),l=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),d=new Uint8Array([255,255,255,255]),u={};u[o.VertexAttrConstants.POSITION]=a,u[o.VertexAttrConstants.NORMAL]=l,u[o.VertexAttrConstants.UV0]=a,u[o.VertexAttrConstants.COLOR]=l;var p={};return p[o.VertexAttrConstants.POSITION]={size:3,data:t},p[o.VertexAttrConstants.NORMAL]={size:3,data:s},p[o.VertexAttrConstants.UV0]={size:2,data:c},p[o.VertexAttrConstants.COLOR]={size:4,data:d},new i(p,u)},e.createConeGeometry=function(e,t,n,r){var s=0,l=t,c=e,d=a.vec3.createFrom(0,s,0),u=a.vec3.createFrom(0,s+c,0),p=a.vec3.createFrom(0,-1,0),h=a.vec3.createFrom(0,1,0);r&&(s=c,u=a.vec3.createFrom(0,0,0),d=a.vec3.createFrom(0,s,0),p=a.vec3.createFrom(0,1,0),h=a.vec3.createFrom(0,-1,0));var f=[u,d],v=[p,h],g=n+2,m=Math.sqrt(c*c+l*l);if(r)for(var y=n-1;y>=0;y--){var b=y*(2*Math.PI/n),_=a.vec3.createFrom(Math.cos(b)*l,s,Math.sin(b)*l);f.push(_);var x=a.vec3.createFrom(c*Math.cos(b)/m,-l/m,c*Math.sin(b)/m);v.push(x)}else for(y=0;y<n;y++)b=y*(2*Math.PI/n),_=a.vec3.createFrom(Math.cos(b)*l,s,Math.sin(b)*l),f.push(_),x=a.vec3.createFrom(c*Math.cos(b)/m,l/m,c*Math.sin(b)/m),v.push(x);var S=new Uint32Array(2*(n+2)*3),w=new Uint32Array(2*(n+2)*3),A=0,C=0;for(y=3;y<f.length;y++)S[A++]=1,S[A++]=y-1,S[A++]=y,w[C++]=0,w[C++]=0,w[C++]=0;for(S[A++]=f.length-1,S[A++]=2,S[A++]=1,w[C++]=0,w[C++]=0,w[C++]=0,y=3;y<f.length;y++)S[A++]=y,S[A++]=y-1,S[A++]=0,w[C++]=y,w[C++]=y-1,w[C++]=1;S[A++]=0,S[A++]=2,S[A++]=f.length-1,w[C++]=1,w[C++]=2,w[C++]=v.length-1;var O=new Float32Array(3*g);for(y=0;y<g;y++)O[3*y]=f[y][0],O[3*y+1]=f[y][1],O[3*y+2]=f[y][2];var R=new Float32Array(3*g);for(y=0;y<g;y++)R[3*y]=v[y][0],R[3*y+1]=v[y][1],R[3*y+2]=v[y][2];var E={};E[o.VertexAttrConstants.POSITION]=S,E[o.VertexAttrConstants.NORMAL]=w;var P={};return P[o.VertexAttrConstants.POSITION]={size:3,data:O},P[o.VertexAttrConstants.NORMAL]={size:3,data:R},new i(P,E)},e.createCylinderGeometry=function(e,t,n,r,s,l){var c=r?a.vec3.create(r):a.vec3.createFrom(1,0,0),d=s?a.vec3.create(s):a.vec3.createFrom(0,0,0),u=void 0===l||l,p=a.vec3.create();a.vec3.normalize(c,p);var h=a.vec3.create();a.vec3.scale(p,Math.abs(e),h);var f=a.vec3.create();a.vec3.scale(h,-.5,f),a.vec3.add(f,d);var v=a.vec3.createFrom(0,1,0);Math.abs(1-a.vec3.dot(p,v))<.2&&a.vec3.set3(0,0,1,v);var g=a.vec3.create();a.vec3.cross(p,v,g),a.vec3.normalize(g),a.vec3.cross(g,p,v);var m=2*n+(u?2:0),y=n+(u?2:0),b=new Float32Array(3*m),_=new Float32Array(3*y),x=new Float32Array(2*m),S=new Uint32Array(3*n*(u?4:2)),w=new Uint32Array(3*n*(u?4:2));u&&(b[3*(m-2)+0]=f[0],b[3*(m-2)+1]=f[1],b[3*(m-2)+2]=f[2],x[2*(m-2)]=0,x[2*(m-2)+1]=0,b[3*(m-1)+0]=b[3*(m-2)+0]+h[0],b[3*(m-1)+1]=b[3*(m-2)+1]+h[1],b[3*(m-1)+2]=b[3*(m-2)+2]+h[2],x[2*(m-1)]=1,x[2*(m-1)+1]=1,_[3*(y-2)+0]=-p[0],_[3*(y-2)+1]=-p[1],_[3*(y-2)+2]=-p[2],_[3*(y-1)+0]=p[0],_[3*(y-1)+1]=p[1],_[3*(y-1)+2]=p[2]);for(var A=function(e,t,n){S[e]=t,w[e]=n},C=0,O=a.vec3.create(),R=a.vec3.create(),E=0;E<n;E++){var P=E*(2*Math.PI/n);a.vec3.scale(v,Math.sin(P),O),a.vec3.scale(g,Math.cos(P),R),a.vec3.add(O,R),_[3*E+0]=O[0],_[3*E+1]=O[1],_[3*E+2]=O[2],a.vec3.scale(O,t),a.vec3.add(O,f),b[3*E+0]=O[0],b[3*E+1]=O[1],b[3*E+2]=O[2],x[2*E+0]=E/n,x[2*E+1]=0,b[3*(E+n)+0]=b[3*E+0]+h[0],b[3*(E+n)+1]=b[3*E+1]+h[1],b[3*(E+n)+2]=b[3*E+2]+h[2],x[2*(E+n)+0]=E/n,x[2*E+1]=1;var T=(E+1)%n;A(C++,E,E),A(C++,E+n,E),A(C++,T,T),A(C++,T,T),A(C++,E+n,E),A(C++,T+n,T)}if(u){for(E=0;E<n;E++)T=(E+1)%n,A(C++,m-2,y-2),A(C++,E,y-2),A(C++,T,y-2);for(E=0;E<n;E++)T=(E+1)%n,A(C++,E+n,y-1),A(C++,m-1,y-1),A(C++,T+n,y-1)}var D={};D[o.VertexAttrConstants.POSITION]=S,D[o.VertexAttrConstants.NORMAL]=w,D[o.VertexAttrConstants.UV0]=S;var I={};return I[o.VertexAttrConstants.POSITION]={size:3,data:b},I[o.VertexAttrConstants.NORMAL]={size:3,data:_},I[o.VertexAttrConstants.UV0]={size:2,data:x},new i(I,D)},e.createTubeGeometry=function(t,n,r,i,a){r=r||10,i=null==i||i,o.assert(t.length>1);for(var s=[],l=[],c=0;c<r;c++){s.push([0,-c-1,-(c+1)%r-1]);var d=c/r*2*Math.PI;l.push([Math.cos(d)*n,Math.sin(d)*n])}return e.createPathExtrusionGeometry(l,t,[[0,0,0]],s,i,a)},e.createPathExtrusionGeometry=function(e,t,r,s,c,d){var u=e.length,p=new Float32Array(t.length*u*3+(6*r.length||0)),h=new Float32Array(t.length*u+(2*r.length||0)),v=new Float32Array(t.length*u*3+(r?6:0)),g=(t.length-1)*u*6+3*s.length*2,m=new Uint32Array(g),y=new Uint32Array(g),b=0,_=0,x=0,S=0,w=0,A=a.vec3.create(),C=a.vec3.create(),O=a.vec3.create(),R=a.vec3.create(),E=a.vec3.create(),P=a.vec3.create(),T=a.vec3.create(),D=a.vec3.create(),I=a.vec3.create(),M=a.vec3.create(),L=a.vec3.create(),V=a.vec3.create(),F=a.vec3.create(),z=n.plane.create();a.vec3.set3(0,1,0,I),a.vec3.subtract(t[1],t[0],C),a.vec3.normalize(C),c?(a.vec3.add(t[0],d,D),a.vec3.normalize(D,O)):a.vec3.set3(0,0,1,O),l(C,O,I,I,E,O,f),a.vec3.set(O,R),a.vec3.set(E,V);for(var U=0;U<r.length;U++)a.vec3.scale(E,r[U][0],P),a.vec3.scale(O,r[U][2],D),a.vec3.add(P,D),a.vec3.add(P,t[0]),p[b++]=P[0],p[b++]=P[1],p[b++]=P[2],h[x++]=0;for(v[_++]=-C[0],v[_++]=-C[1],v[_++]=-C[2],U=0;U<s.length;U++)m[S++]=s[U][0]>0?s[U][0]:-s[U][0]-1+r.length,m[S++]=s[U][1]>0?s[U][1]:-s[U][1]-1+r.length,m[S++]=s[U][2]>0?s[U][2]:-s[U][2]-1+r.length,y[w++]=0,y[w++]=0,y[w++]=0;for(var N=r.length,B=r.length-1,j=0;j<t.length;j++){var G=!1;j>0&&(a.vec3.set(C,A),j<t.length-1?(a.vec3.subtract(t[j+1],t[j],C),a.vec3.normalize(C)):G=!0,a.vec3.add(A,C,M),a.vec3.normalize(M),a.vec3.add(t[j-1],R,L),n.plane.fromPositionAndNormal(t[j],M,z),n.plane.intersectRay(z,L,A,D)?(a.vec3.subtract(D,t[j]),a.vec3.normalize(D,O),a.vec3.cross(M,O,E),a.vec3.normalize(E)):l(M,R,V,I,E,O,f),a.vec3.set(O,R),a.vec3.set(E,V)),c&&(a.vec3.add(t[j],d,D),a.vec3.normalize(D,F));for(var H=0;H<u;H++)if(a.vec3.scale(E,e[H][0],P),a.vec3.scale(O,e[H][1],D),a.vec3.add(P,D),a.vec3.normalize(P,T),v[_++]=T[0],v[_++]=T[1],v[_++]=T[2],h[x++]=c?a.vec3.dot(P,F):P[2],a.vec3.add(P,t[j]),p[b++]=P[0],p[b++]=P[1],p[b++]=P[2],!G){var k=(H+1)%u;m[S++]=N+H,m[S++]=N+u+H,m[S++]=N+k,m[S++]=N+k,m[S++]=N+u+H,m[S++]=N+u+k;for(var W=0;W<6;W++)y[w++]=m[S-6+W]-B}N+=u}var q=t[t.length-1];for(U=0;U<r.length;U++)a.vec3.scale(E,r[U][0],P),a.vec3.scale(O,r[U][1],D),a.vec3.add(P,D),a.vec3.add(P,q),p[b++]=P[0],p[b++]=P[1],p[b++]=P[2],h[x++]=0;var $=_/3;v[_++]=C[0],v[_++]=C[1],v[_++]=C[2];var X=N-u;for(U=0;U<s.length;U++)m[S++]=s[U][0]>=0?N+s[U][0]:-s[U][0]-1+X,m[S++]=s[U][2]>=0?N+s[U][2]:-s[U][2]-1+X,m[S++]=s[U][1]>=0?N+s[U][1]:-s[U][1]-1+X,y[w++]=$,y[w++]=$,y[w++]=$;var Y={};Y[o.VertexAttrConstants.POSITION]=m,Y[o.VertexAttrConstants.NORMAL]=y;var Q={};return Q[o.VertexAttrConstants.POSITION]={size:3,data:p},Q.zOffset={size:1,data:h},Q[o.VertexAttrConstants.NORMAL]={size:3,data:v},new i(Q,Y)},e.createPolylineGeometry=function(e,t){o.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),o.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),o.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),o.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float32Array(3*e.length),r=new Uint32Array(2*(e.length-1)),a=0,s=0,l=0;l<e.length;l++){for(var c=0;c<3;c++)n[a++]=e[l][c];l>0&&(r[s++]=l-1,r[s++]=l)}var d={},u={};if(d[o.VertexAttrConstants.POSITION]=r,u[o.VertexAttrConstants.POSITION]={size:3,data:n},t){var p=new Float32Array(3*t.length),h=0;for(l=0;l<e.length;l++)for(c=0;c<3;c++)p[h++]=t[l][c];d[o.VertexAttrConstants.NORMAL]=r,u[o.VertexAttrConstants.NORMAL]={size:3,data:p}}return new i(u,d,i.DefaultOffsets,"line")},e.addVertexColors=function(e,t){var n=t||[1,1,1,1],r=new Uint8Array(4);r[0]=255*n[0],r[1]=255*n[1],r[2]=255*n[2],r[3]=255*(n.length>3?n[3]:1);var a={},s=e.getVertexAttr();for(var l in s)a[l]=s[l];a[o.VertexAttrConstants.COLOR]={size:4,data:r};var c={};for(var l in e.indices)c[l]=e.indices[l];var d=c[o.VertexAttrConstants.POSITION].length;return c[o.VertexAttrConstants.COLOR]=new Uint32Array(d),new i(a,c,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),n=e.indices,i=r.Vec3Compact.subtract,s=n.position.length/3,l=new Float32Array(3*s),c=t.position.data,d=0,u=n.position,p=new Uint32Array(u.length),h=0;h<u.length;h+=3){i(c,3*u[h],c,3*u[h+2],g,0),i(c,3*u[h],c,3*u[h+1],v,0),a.vec3d.cross(v,g),a.vec3d.normalize(v);var f=d/3;l[d++]=v[0],l[d++]=v[1],l[d++]=v[2],p[h]=f,p[h+1]=f,p[h+2]=f}t[o.VertexAttrConstants.NORMAL]={size:3,data:l,offsetIdx:0,strideIdx:3},n[o.VertexAttrConstants.NORMAL]=p},e.cgToGIS=function(e,t){void 0===t&&(t=e);var n=e.getVertexAttr(),r=n.position.data,i=n.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(r)for(l=0;l<r.length;l+=3)c=r[l+1],o[l+1]=-r[l+2],o[l+2]=c;return t}}(p||(p={}));var f=.99619469809,v=a.vec3.create(),g=a.vec3.create();return p}.apply(null,r))||(e.exports=i)},1563:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(143)],void 0===(i=function(e,t,n){return{now:n}}.apply(null,r))||(e.exports=i)},1565:function(e,t,n){var r;void 0===(r=function(){function e(e,t,n,r){for(var i=t,a=t,o=n>>>1,s=e[i-1];a<=o;){(a=i<<1)<n&&r(e[a-1],e[a])<0&&++a;var l=e[a-1];if(r(l,s)<=0)break;e[i-1]=l,i=a}e[i-1]=s}function t(e,t){return e<t?-1:e>t?1:0}return{sort:function(n,r,i,a){void 0===r&&(r=0),void 0===i&&(i=n.length),void 0===a&&(a=t);for(var o=i>>>1;o>r;o--)e(n,o,i,a);var s=r+1;for(o=i-1;o>r;o--){var l=n[r];n[r]=n[o],n[o]=l,e(n,s,o,a)}return n}}}.apply(null,[]))||(e.exports=r)},1566:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(480)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=n.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(n.meterIn[e]||1)}}.apply(null,r))||(e.exports=i)},1567:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1504)],void 0===(i=function(e,t,n){return function(){function e(t,n,r,i,a,o){this.id=e._idGen.gen(t.id),this.geometry=t,this.materials=n,this.transformation=r,this.instanceParameters=i,this.origin=a,this.customTransformation=o}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation},e._idGen=new n,e}()}.apply(null,r))||(e.exports=i)},1568:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(251),n(1529),n(1506),n(1487)],void 0===(i=function(e,t,n,r,i,a){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return r.forEachUntilMap(this._dirtyGeomRecords,function(t){if(e)return!1;r.forEachUntilMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,n){return a.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,n)},e.prototype.shaderTransformationChanged=function(e){var t=this,n=this._residentGeomRecords.get(e.id);n&&n.forEach(function(e,n){var r=t._model.content[i.OBJECT][n];r&&r.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,n=e[1];t<n.length;t++)n[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(n.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,n=[],r=[],o=[],s=this,l=0;l<e.length;l++)!function(l){var c=e[l],d=s._dirtyGeomRecords.get(c);if(!d)return"continue";d.forEach(function(e,s){var l=t._ensureGeomRecord(c,s);e.forEach(function(e,c){var d,u=e[0],p=e[1],h=e[2],f=2&p&&1&h;(4&p||f)&&((d=l.get(c))?r.push.apply(r,d[1]):4===p&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),d&&l.delete(c));if(1&p||f){var v=[u,[]],g=t._model.get(i.OBJECT,s);t._model.getGeometryRenderGeometries(g,u,v[1]),n.push.apply(n,v[1]),l.set(c,v)}if(2&p&&!f)if(d=l.get(c)){var m=d[1],y=m.length;if(16&h){g=t._model.get(i.OBJECT,s);for(var b=0;b<y;b++){var _=m[b];t._model.updateRenderGeometryTransformation(g,u,_)}}for(b=0;b<y;b++){_=m[b];o.push({renderGeometry:_,updateType:h})}}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===l.size&&t._residentGeomRecords.get(c).delete(s)}),0===s._residentGeomRecords.get(c).size&&s._residentGeomRecords.delete(c),s._dirtyGeomRecords.delete(c)}(l);return[n,r,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(n.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=this._residentGeomRecords.get(r);i&&i.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,n){if(null!=t)this._componentPropertyChanged(e,t,n,2);else for(var r=0,i=e.getGeometryRecords();r<i.length;r++){var a=i[r];this._componentPropertyChanged(e,a,n,2)}},e.prototype.componentHighlightChanged=function(e,t,n){if(null!=t)this._componentPropertyChanged(e,t,n,32);else for(var r=0,i=e.getGeometryRecords();r<i.length;r++){var a=i[r];this._componentPropertyChanged(e,a,n,32)}},e.prototype.vertexAttrsUpdated=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),n=0;n<t.length;n++)this.layObjectAdded(e,t[n])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),n=0;n<t.length;n++)this.layObjectRemoved(e,t[n])},e.prototype.layObjectAdded=function(e,t){for(var n=e.id,r=t.getGeometryRecords(),i=0;i<r.length;i++)this.objGeometryAdded(t,r[i],n)},e.prototype.layObjectRemoved=function(e,t){for(var n=e.id,r=t.getGeometryRecords(),i=0;i<r.length;i++)this.objGeometryRemoved(t,r[i],n)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var n=this;t=t||this._getParentLayerId(e);var r=e.id;this._ensureGeomRecord(t,r).forEach(function(r){n._updateOrCreateDirtyRecord(e,r[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var n=this;t=t||this._getParentLayerId(e);var r=e.id;this._ensureGeomRecord(t,r).forEach(function(r){n._updateOrCreateDirtyRecord(e,r[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,n,r){this._updateOrCreateDirtyRecord(e,t,n,2,0,0,2,5,r)},e.prototype._updateOrCreateDirtyRecord=function(e,t,n,r,i,o,s,l,c){n=n||this._getParentLayerId(e);var d=e.id,u=t.id,p=this._ensureDirtyRecord(n,d),h=p.get(u);if(h){var f=h[1];f&i?p.delete(u):f&o?(h[1]=r,h[2]=c):f&s?h[2]|=c:f&l||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else p.set(u,[t,r,c])},e.prototype._ensureGeomRecord=function(e,t){var n=this._residentGeomRecords.get(e);n||(n=new Map,this._residentGeomRecords.set(e,n));var r=n.get(t);return r||(r=new Map,n.set(t,r)),r},e.prototype._ensureDirtyRecord=function(e,t){var n=this._dirtyGeomRecords.get(e);n||(n=new Map,this._dirtyGeomRecords.set(e,n));var r=n.get(t);return r||(r=new Map,n.set(t,r)),r},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],n="";return this._dirtyGeomRecords.forEach(function(e,r){e.forEach(function(e,i){n.length>0&&(n+="\n"),n+=r+"."+i;var a=[];e.forEach(function(e){var t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(var o=0;o<a.length;o++)if(a[o]){n+=" "+t[o-1]+": ";for(var s=0;s<a[o].length;s++)n+=a[o][s]+", "}})}),n},e}()}.apply(null,r))||(e.exports=i)},1569:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(82),n(1571),n(1488),n(1600),n(1601),n(1546),n(1547),n(1605),n(1539),n(1606),n(1548),n(1608),n(1514),n(1610),n(1538),n(1625),n(474),n(481),n(1669)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x){var S=a.vec3d,w=a.vec4d,A=n.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function e(e,t,n,r){var a=this;this._backgroundColor=w.createFrom(1,1,1,1),this._lightDirection=S.createFrom(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._screenCaptureQueue=[],this._container=e,this._stage=t,this._initializeContext(r),this._initializeShaders(r);this._textureRep=new s(t.getAll(m.ContentType.TEXTURE),this._programRepository,function(){return a._viewport.getCamera().viewport},this._rctx),this._materialRep=new o(this._textureRep,this._programRepository),this._viewport=new y(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new i(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,n),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){f.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,e._viewport.render(e._lightDirection,null))},postRender:function(){f.end()},update:function(){e._performScreenCaptures(),e.resetNeedsRender()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},n=_.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=f.instrumentContext(n);var i={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new x(this._gl,i),!e.alpha&&this._rctx.contextAttributes.alpha&&A.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&r("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)},e.prototype._initializeShaders=function(e){var t="global"===e.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n";this._shaderSnippets=new p({enableRequiredExtensions:"\n#extension GL_OES_standard_derivatives : enable\n",fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:t}),this._programRepository=new d,g.initializeShaders(this._shaderSnippets,this._programRepository,this._rctx),l.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),u.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),h.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),c.loadShaders(this._shaderSnippets,this._programRepository,this._rctx)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){S.set3(0,0,0,this._lightDirection);for(var t=0,n=e.lights;t<n.length;t++){var r=n[t];if(r instanceof v.MainLight){S.negate(r.direction,this._lightDirection);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t=this._viewport.getViewParams(e);return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor),this._viewport.setViewParams(e)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"standardDerivatives"===e?!!this._rctx.capabilities.standardDerivatives:"shaderTextureLOD"===e?!!this._rctx.capabilities.shaderTextureLOD:"instancedRendering"===e&&!!this._rctx.capabilities.instancing},e.prototype.modify=function(e,t,n,r){this._viewport.modify(e,t,n,r)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getPickRay=function(e,t,n){this._viewport.getPickRay(e,t,n)},e.prototype.pickRayWithBeginPoint=function(e,t,n,r,i){this._viewport.pickRayWithBeginPoint(e,t,n,r,i)},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.requestScreenCapture=function(e,t){this._screenCaptureQueue.push({settings:e||{},callback:t}),this._needsRender=!0},e.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()},e.prototype.getTextureLoaded=function(e){return this._textureRep.getIsLoaded(e)},e.prototype.addTextureListener=function(e){this._textureRep.addTextureListener(e)},e.prototype.removeTextureListener=function(e){this._textureRep.removeTextureListener(e)},e.prototype.addExternalRenderer=function(e,t){return!!this._viewport.addExternalRenderer(e,t)&&(t.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,programRep:this._programRepository,textureRep:this._textureRep,materialRep:this._materialRep}),!0)},e.prototype.removeExternalRenderer=function(e){return!!this._viewport.removeExternalRenderer(e)&&(e.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0)},e.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var e=0;e<this._screenCaptureQueue.length;e++){var t=this._screenCaptureQueue[e],n={x:0,y:0,width:this._canvas.width,height:this._canvas.height},r={x:0,y:0,width:this._canvas.width,height:this._canvas.height},i=t.settings.area;if(i&&(n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height),void 0!==t.settings.width&&void 0!==t.settings.height){var a=t.settings.width/t.settings.height;if(n.height*a<n.width){var o=n.height*a;n.x+=Math.floor((n.width-o)/2),n.width=Math.floor(o)}else{var s=n.width/a;n.y+=Math.floor((n.height-s)/2),n.height=Math.floor(s)}r.width=t.settings.width,r.height=t.settings.height}else r.width=n.width,r.height=n.height;var l=this._canvas,c=null;if(0!==n.x||0!==n.y||n.width!==this._canvas.width||n.height!==this._canvas.height||0!==r.x||0!==r.y||r.width!==this._canvas.width||r.height!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas")),this._resizeCanvas.width=r.width,this._resizeCanvas.height=r.height;var d=this._resizeCanvas.getContext("2d");c=new Uint8Array(n.width*n.height*4),this._gl.readPixels(n.x,this._canvas.height-(n.y+n.height),n.width,n.height,6408,5121,c);var u=d.getImageData(r.x,r.y,r.width,r.height);b.resampleHermite(c,n.width,n.height,u.data,r.width,r.height,!0),d.putImageData(u,r.x,r.y),l=this._resizeCanvas,d=null}var p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[t.settings.format?t.settings.format.toLowerCase():"png"],h=1;void 0!==t.settings.quality&&(h=t.settings.quality/100);var f={dataURL:l.toDataURL(p,h),x:r.x,y:r.y,width:r.width,height:r.height};t.settings.returnByteBuffer&&(f.data=c),t.callback(f)}this._screenCaptureQueue=[]}},e}()}.apply(null,r))||(e.exports=i)},1570:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRenderOccludedApply"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position, 0.0, 1.0);\n    uv = $position.xy * 0.5 + vec2(0.5);\n  }\n]]></snippet>\n\n<snippet name="fsRenderOccludedApply"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D occludedColorMap;\n\n  varying vec2 uv;\n\n  void main() {\n    vec4 occludedColor = texture2D(occludedColorMap, uv);\n    gl_FragColor = occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\n  }\n\n]]></snippet>\n\n</snippets>\n'},1571:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1512),n(1517),n(1500),n(1498),n(1488),n(1503),n(1530),n(1540),n(1507),n(1487),n(1514),n(1545),n(1495),n(1490),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g){var m=o.vec3d,y=o.vec4d,b=o.mat4d,_=function(){function e(e,t,n,r,i,a){var o=this;this._renderTargets={},this._clearColor=y.createFrom(0,0,0,0),this._id2origin={},this._uniqueIdx=0,this._rctx=e,this._canvas=t,this._programRep=n,this._modelDirtySet=a,this._modelDirtySet.onMaterialChanged=function(e){return o.materialChanged(e)},this._renderer=new c(n,r,i,this._rctx,!0),this._renderer.onHasHighlightsChanged=function(e){o.onHasHighlightsChanged&&o.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new p.AmbientLight(m.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t.getOrigin(e.center,e.bsRadius)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var n=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],n),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var n=e.instanceParameters,r=l.generateHighlightId();return n.componentHighlights=i.addHighlight(n.componentHighlights,null,t,r),this.updateRenderGeometries([e],32),r},e.prototype.removeRenderGeometryHighlight=function(e,t){var n=e.instanceParameters;n.componentHighlights=i.removeHighlight(n.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!n.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(d.MATERIAL,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(d.MATERIAL_HIGHLIGHT,e,t)},e.prototype.drawPass=function(e,t,r){if(this.isEmpty()||e===d.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!r.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var i=this._renderTargets[t];if(!i)return!1;var a=this._rctx,o=a.gl,s=r.width,l=r.height;i.width===s&&i.height===l||(i.resize(s,l),i.colorTexture.setSamplingMode(9729)),S.near=1,S.far=1e4,a.bindFramebuffer(i),a.setDepthTestEnabled(!1),a.setBlendFunctionSeparate(770,771,1,771),a.setClearColor.apply(a,this._clearColor),a.clear(o.COLOR_BUFFER_BIT),this._renderer.setPixelRatio(r.pixelRatio||1);for(var c=0;c<r.views.length;c++){var u=r.views[c];S.viewport=u.viewport,b.ortho(0,u.extent[2]-u.extent[0],0,u.extent[3]-u.extent[1],S.near,S.far,S.projectionMatrix),b.identity(S.viewMatrix),b.translate(S.viewMatrix,[-u.extent[0],-u.extent[1],0]),S.setGLViewport(this._rctx),n.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(s,l,x[r.index%x.length]),this._renderer.renderGeometryPass(e,S)}return a.setDepthTestEnabled(!0),a.setBlendFunctionSeparate(770,771,1,771),a.bindFramebuffer(null),a.setViewport(0,0,this._canvas.width,this._canvas.height),i.colorTexture.descriptor.hasMipmap&&i.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,n){var r=this._rctx,i=r.gl;if(!this._testPatternMat){for(var o=new Uint8Array(e*t*4),l=0,c=0;c<t;c++)for(var d=0;d<e;d++){var u=Math.floor(d/10),p=Math.floor(c/10);u<2||p<2||10*u>e-20||10*p>t-20?(o[l++]=255,o[l++]=255,o[l++]=255,o[l++]=255):(o[l++]=255,o[l++]=255,o[l++]=255,o[l++]=1&u&&1&p?1&d^1&c?0:255:1&u^1&p?0:128)}var f=new v(r,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},o);this._testPatternMat=new h(this._programRep,f,[1,1,1,1],!0,i.ALWAYS),this._testPatternBindParams={proj:b.identity(),view:b.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(r,a.Pos3Tex)}this._testPatternMat.setColor([n[0],n[1],n[2],1]),this._testPatternMat.bind(r,this._testPatternBindParams),this._testPatternMat.bindView(r,this._testPatternBindParams),r.bindVAO(this._quadVAO),r.drawArrays(5,0,g.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(r)},e.prototype.getOrigin=function(e,t){var n=0,r=10*t/1e4;r>1&&(n=Math.ceil(u.logWithBase(r,2)));var i=1e4*Math.pow(2,n),a=Math.round(e[0]/i),o=Math.round(e[1]/i),s=Math.round(e[2]/i),l=n+"_"+a+"_"+o+"_"+s,c=this._id2origin[l];return null==c&&(c={vec3:m.createFrom(a*i,o*i,s*i),id:l},this._id2origin[l]=c),c},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var n=e,r=0;this._renderTargets[n];)n=e+"_"+ ++r;return this._renderTargets[n]=f.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),n},e}(),x=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],S=new r;return _}.apply(null,r))||(e.exports=i)},1572:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1507),n(1491)],void 0===(i=function(e,t,n,r){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=n.MATERIAL,this.shadowMap=null,this.slot=r.BACKGROUND,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return this.pass===n.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0}),e}()}.apply(null,r))||(e.exports=i)},1573:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1523),n(1491)],void 0===(i=function(e,t,n,r){var i={near:0,far:0};return function(){function e(){this.renderersChanged=!1,this.renderers=[],this.slots=[];for(var e=0;e<r.MAX_SLOTS;++e)this.slots[e]=[]}return e.prototype.addRenderer=function(e,t){this.renderers.push(t);for(var n=0;n<e.length;++n){var r=e[n];this.slots[r].push(t)}this.renderersChanged=!0},e.prototype.removeRenderer=function(e){this.renderers=this.renderers.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});this.renderersChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,n=this.renderers;t<n.length;t++){var r=n[t];r.prepareRender&&r.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var n=!1,r=0,i=this.slots[e];r<i.length;r++){var a=i[r];a.render(t)&&(a.didRender=!0,n=!0)}return n},e.prototype.queryDepthRange=function(e){var t=i;t.near=1/0,t.far=-1/0;for(var r=0,a=this.renderers;r<a.length;r++){var o=a[r];if(o.queryDepthRange){var s=o.queryDepthRange(e);s&&n.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var e=0,t=this.renderers;e<t.length;e++){var n=t[e];n.resetNeedsRender?n.resetNeedsRender():n.didRender&&(n.needsRender=!1,n.didRender=!1)}},e}()}.apply(null,r))||(e.exports=i)},1574:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){return function(){function e(e){null==e?e=16:e<65536&&(e=n.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var n,r;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(n=this.array.length||1;n<this.size;)n*=2;return r=new Float32Array(n),t&&r.set(this.array),this.array=r,!0}if(this.size<=this.array.length/2){n=this.array.length;for(var i=2*this.size;n>=i;)n=Math.floor(n/2);return r=new Float32Array(n),t&&r.set(this.array.subarray(0,n)),this.array=r,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var n=e;n<t;++n)this.array[n]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,r))||(e.exports=i)},1575:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1497),n(1493),n(1496)],void 0===(i=function(e,t,n,r,i){var a=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(!this.isEnabled){var e=this.rctx;this.program=new r(e,o.shader.vertex,o.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new i(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(e,34962,35044,t)}),this.isEnabled=!0}},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var n=this.rctx;n.bindVAO(this.vao),n.bindFramebuffer(t);var r={x:0,y:0,width:0,height:0};null!=t?(r.width=t.descriptor.width,r.height=t.descriptor.height):(r.width=n.gl.canvas.width,r.height=n.gl.canvas.height),n.bindProgram(this.program),n.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/r.width,1/r.height),n.setFaceCullingEnabled(!1),n.drawArrays(4,0,3)},e}(),o={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return a}.apply(null,r))||(e.exports=i)},1576:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487),n(1495)],void 0===(i=function(e,t,n,r){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareHighlightPass=function(){n.assert(this.enabled);var e=this._rctx,t=e.gl;this.fbo.resize(this.width,this.height),e.bindFramebuffer(this.fbo),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.fbo=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.fbo.dispose(),this.fbo=null)},e}()}.apply(null,r))||(e.exports=i)},1577:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){return function(){function e(e,t){null==t&&(t=4);var r=n.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(r),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,n){this.array.set(n,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],n=e*this.perInstanceDataSize,r=t*this.perInstanceDataSize;this.array.set(this.array.subarray(n,n+this.perInstanceDataSize),r),this.array.set(this.zeroItem,n);var i=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=i,this.id2slot[i]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,n;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(n=new Float32Array(t)).set(this.array),this.array=n}else if(e<=this.array.length/2){t=this.array.length;for(var r=2*e;t>=r;)t/=2;(n=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=n}},e}()}.apply(null,r))||(e.exports=i)},1578:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push([r[0],r[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r[0]=r[0]*t,r[1]=r[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var n=[],r=0;r<e.length;r++){var i=e[r];if(!(i[1]<t[0]||i[0]>t[1])){var a=[i[0],i[1]];a[0]<t[0]&&(a[0]=t[0]),a[1]>t[1]&&(a[1]=t[1]),n.push(a)}}return n},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var n=1;n<e.length;n++){var r=t[t.length-1];r[1]+1<e[n][0]?t.push(e[n]):r[1]<e[n][1]&&(r[1]=e[n][1],t.pop(),t.push(r))}return t},e.invertIntervals=function(e,t){for(var n=[],r=0,i=0;i<e.length;i++){var a=e[i];a[0]>r&&n.push([r,a[0]-1]),r=a[1]+1}return r<=t&&n.push([r,t]),n},e.offsetIntervals=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];n.push([i[0]+t,i[1]+t])}return n},e}()}.apply(null,r))||(e.exports=i)},1579:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487),n(1495)],void 0===(i=function(e,t,n,r){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){n.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){n.assert(!this.enabled),this._depthFBO=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){n.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,r))||(e.exports=i)},1580:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487),n(1495)],void 0===(i=function(e,t,n,r){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.viewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){n.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=r.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,r))||(e.exports=i)},1581:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1522),n(1497),n(1495),n(1493),n(1490),n(1496)],void 0===(i=function(e,t,r,i,a,o,s,l){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,n.e(76).then(function(){var r=[n(1691)];(function(n){t.data=n,t._isLoadingResources=!1,e&&e()}).apply(null,r)}).catch(n.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new o(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new o(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new o(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new i(e,34962,35044,t)}),this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var n=this.rctx,r={x:0,y:0,width:0,height:0};null!=t?(r.width=t.descriptor.width,r.height=t.descriptor.height):(r.width=n.gl.canvas.width,r.height=n.gl.canvas.height),n.bindVAO(this.vao),n.setFaceCullingEnabled(!0),n.setCullFace(1029),n.setFrontFace(2305),n.setBlendingEnabled(!1),n.setDepthTestEnabled(!1),n.setViewport(r.x,r.y,r.width,r.height),this.tmpFramebufferEdges.resize(r.width,r.height),n.bindFramebuffer(this.tmpFramebufferEdges),n.setClearColor(0,0,0,1),n.clear(n.gl.COLOR_BUFFER_BIT),n.bindProgram(this.programEdgeDetect),n.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),n.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(r.width,r.height),n.bindFramebuffer(this.tmpFramebufferBlend),n.setClearColor(0,0,1,1),n.clear(n.gl.COLOR_BUFFER_BIT),n.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),n.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),n.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),n.drawArrays(4,0,3),n.bindFramebuffer(t),n.setClearColor(0,1,0,1),n.clear(n.gl.COLOR_BUFFER_BIT),n.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),n.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),n.drawArrays(4,0,3),n.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,n){var i=new s(this.rctx,{pixelFormat:n,dataType:5121,wrapMode:33071,samplingMode:t},null);return r.requestImage(e).then(function(e){i.resize(e.width,e.height),i.setData(e)}),i},e}()}.apply(null,r))||(e.exports=i)},1582:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){n.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,r))||(e.exports=i)},1583:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unrolledCopyVec3=function(e,t){for(var n=e.typedBuffer,r=e.typedBufferStride,i=t.typedBuffer,a=t.typedBufferStride,o=t.count,s=0;s<o;s++){var l=s*r,c=s*a;n[l]=i[c],n[l+1]=i[c+1],n[l+2]=i[c+2]}}}.apply(null,r))||(e.exports=i)},1584:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1488),n(1542)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:n.mat4d.identity(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){n.mat4d.set(e,t.viewMatrix),r.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=i}.apply(null,r))||(e.exports=i)},1585:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this._gridSize=e,this._origins={}}return e.prototype.getOrigin=function(t){var n=this._gridSize,r=Math.round(t[0]/n),i=Math.round(t[1]/n),a=Math.round(t[2]/n),o=""+e.ORIGIN_PREFIX+r+"/"+i+"/"+a,s=this._origins[o];if(!s){var l=this._gridSize,c=e.OFFSET;s={id:o,vec3:[r*l+c,i*l+c,a*l+c]},this._origins[o]=s}return s},e.ORIGIN_PREFIX="rg_",e.OFFSET=1.11,e}()}.apply(null,r))||(e.exports=i)},1586:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1587),n(1588)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var i=function(){function e(e,i){void 0===i&&(i=1),this.textureBuffer=new r.TextureBackedBuffer(e,i),this.indexManager=new n.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=i}.apply(null,r))||(e.exports=i)},1587:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=n}.apply(null,r))||(e.exports=i)},1588:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1535),n(1490)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new r(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new n.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,n,r,i,a){var o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,n),this.data.set(o,1,r),this.data.set(o,2,i),this.data.set(o,3,a)},e.prototype.setDataElement=function(e,t,n,r){var i=e*this.fieldCount+t;this.dirty=!0,this.data.set(i,n,r)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var r=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new n.BufferViewVec4u8(new ArrayBuffer(4*r));i.typedBuffer.set(this.data.typedBuffer),this.data=i}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=i}.apply(null,r))||(e.exports=i)},1589:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(10),n(12),n(1591),n(1590),n(49),n(80),n(1499),n(1552)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var d={type:"solid",uber:!0,strokesTexture:null},u=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),p=function(){function e(t,r,i){this.rctx=t,this.programRepository=r,this.refCount=new u,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=o.mat3d.create(),this.settings=n({},d,i),this.key=e.getKey(this.settings.uber,this.settings.type);var a=this.settings.strokesTexture.variants;this.writerSettings={variants:a},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,n){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",n.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3])},e.prototype.renderRegularEdges=function(e,t,n){this.render(this.programs.regular,e,e.regular.vao,t,n)},e.prototype.renderSilhouetteEdges=function(e,t,n){this.render(this.programs.silhouette,e,e.silhouette.vao,t,n)},e.prototype.render=function(e,t,n,r,i){this.setUniforms(e,t,r);var a=this.rctx;a.bindVAO(n),a.capabilities.instancing.drawArraysInstanced(6,0,4,i)},e.prototype.setUniforms=function(e,n,r){n.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",r.view),e.setUniformMatrix4fv("uModel",n.transform.modelMatrix);var i=r.viewInvTransp,a=o.mat4d.toMat3(i,this.tmpViewToWorldNormalMatrix);e.setUniform3f("uCameraPosition",i[3],i[7],i[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",a),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(r.fovY/2)/(r.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",n.transform.origin.vec3)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,n=t.texture;this.rctx.bindTexture(n,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/n.descriptor.width,1/n.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",s.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getDefines=function(e){return[e.silhouette,!!this.rctx.capabilities.blendMinMax,"solid"===this.settings.type&&!this.settings.uber,"sketch"===this.settings.type&&!this.settings.uber,this.settings.uber]},e.prototype.createPrograms=function(){var e=this.programRepository.getShaderVariationsProgram(h,this.getDefines({silhouette:!1}),void 0,void 0,c.EdgeShaderAttributeLocations),t=this.programRepository.getShaderVariationsProgram(h,this.getDefines({silhouette:!0}),void 0,void 0,c.EdgeShaderAttributeLocations);this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.loadShaders=function(e,t,n){if(e.EdgeRendererUtils_readComponentColor||e._parse(a),e.fsRibbonEdge||e._parse(i),!t.getShaderVariations(h)){var r=new l("ribbonEdge",["vsRibbonEdge","fsRibbonEdge"],null,t,e,n);r.addDefine("Silhouette","SILHOUETTE"),r.addDefine("AntiAliasing","ANTIALIASING"),r.addDefine("Solid","SOLID"),r.addDefine("Sketch","SKETCH"),r.addDefine("Uber","UBER"),t.addShaderVariations(h,r)}},e.getKey=function(e,t){return e?"edges-uber":"edges-t:"+t},e}();t.EdgeRenderer=p;var h="edge-shader-variations";t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,r))||(e.exports=i)},1590:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="EdgeRendererUtils_distanceBasedPerspectiveFactor"><![CDATA[\n  uniform float uDistanceFalloffFactor;\n\n  float distanceBasedPerspectiveFactor(float distance) {\n    return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_readComponentData"><![CDATA[\n  uniform sampler2D uComponentDataTex;\n  uniform vec2 uComponentDataTexInvDim;\n\n  attribute float aComponentIndex;\n\n  #define COMPONENT_COLOR_FIELD_OFFSET 0.0\n  #define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n  #define COMPONENT_FIELD_COUNT 2.0\n\n  #define LINE_WIDTH_FRACTION_FACTOR 8.0\n  #define EXTENSION_LENGTH_OFFSET 128.0\n\n  #define COMPONENT_TEX_WIDTH 4096.0\n\n  vec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n    float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n    float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n    float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n    vec2 linearIndex = vec2(\n      (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n      (rowIndex + 0.5) * uComponentDataTexInvDim.y\n    );\n\n    return linearIndex;\n  }\n\n  struct ComponentData {\n    vec4 color;\n    float lineWidth;\n    float extensionLength;\n    float type;\n  };\n\n  ComponentData readComponentData() {\n    vec2 colorIndex = componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n    vec2 otherIndex = componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n    vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n    vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n    return ComponentData(\n      vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n      otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n      otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n      -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n    );\n  }\n\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_isSilhouetteEdge"><![CDATA[\n  // #uniforms: uView, uModel\n  bool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n    // transform the two face normals\n    vec3 viewNormalA = (uView * uModel * vec4(normalA, 0.0)).xyz;\n    vec3 viewNormalB = (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n    // compute the direction from the edge to the camera\n    vec3 viewDir = -viewPos.xyz;\n\n    // check which of the two faces are visible\n    // display the edge if exactly one of the two is visible\n    float faceAVisible = dot(viewDir, viewNormalA); // positive if visible\n    float faceBVisible = dot(viewDir, viewNormalB); // positive if visible\n\n    // 1 if exactly one face visible, 0 otherwise\n    return faceAVisible * faceBVisible < 0.0;\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_adjustProjectedPosition"><![CDATA[\n  uniform vec2 uDepthBias;\n  uniform vec2 uViewportDimInv;\n\n  // Utility function to check for NaN values\n  bool isNaN(float val) {\n    return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n    // important: some nVidias failed to cope with version below.\n    // Probably wrong optimization.\n    /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n  }\n\n  // An offset in xy screen space, along the projected normal of the edge\n  // This reduces depth fighting when looking at a face from a flat angle\n  vec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n    float offsetXY = uDepthBias.x;\n    float offsetZ  = uDepthBias.y;\n\n    // screen space pixel offset\n    // we multiply by two to account for the fact that NDC go from -1 to 1\n    // we multiply by projPos.w to compensate for the perspective divison that happens later\n    // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n    // towards the camera\n    vec4 projNormal = uProj * uView * vec4(worldNormal, 0.0);\n\n    return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n  }\n\n  // A z-offset, using a depth based heuristic.\n  float calculateProjectedBiasZ(vec4 projPos) {\n    float offsetZ = uDepthBias.y;\n    return sqrt(projPos.z) * offsetZ;\n  }\n\n  vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n    vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n    // we currently have to do this check because some geometries come with 0 length edge normals.\n    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n    if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n      projPos.xy += offsetXY;\n    }\n\n    projPos.z += calculateProjectedBiasZ(projPos);\n\n    return projPos;\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_worldNormal"><![CDATA[\n  vec3 modelToWorldNormal(vec3 normal) {\n    return (uModel * vec4(normal, 0)).xyz;\n  }\n\n  vec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n    return modelToWorldNormal(normalize(normalA + normalB));\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_extensionFalloff"><![CDATA[\n  // Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n  // fall-off exponentially\n  float calculateExtensionLength(float extensionLength, float lineLength) {\n    return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n  }\n]]></snippet>\n\n</snippets>\n'},1591:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRibbonEdgeStyleOutputs"><![CDATA[\n#if defined(SKETCH) || defined(UBER)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x += aVariantOffset;\n\n    vLineIndex = lineIndex;\n  }\n#endif /* SKETCH || UBER */\n\n#if defined(SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif defined(SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif defined(UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType = unpackedAttributes.type;\n\n    if (unpackedAttributes.type <= 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeRegular"><![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineAmplitudeRegular() {\n    return 0.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) && !defined(SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeRegular();\n  }\n\n#endif /* !UBER && !SKETCH */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeSketch"><![CDATA[\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif /* SKETCH */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeUber"><![CDATA[\n\n#ifdef UBER\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type = unpackedAttributes.type;\n\n    if (type <= 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeRegular();\n    }\n  }\n\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdge"><![CDATA[\n  $vsprecisionf\n\n  // Transformations\n  uniform mat4 uProj;\n  uniform mat4 uView;\n  uniform mat4 uModel;\n  uniform vec3 uCameraPosition;\n\n  // Line configuration\n\n  // Conversion constants\n  uniform vec2 uPixelToNDC;\n  uniform vec2 uNDCToPixel;\n\n  // Inputs\n  attribute vec3 aPosition0;\n  attribute vec3 aPosition1;\n  attribute float aVariantOffset;\n  attribute float aVariantStroke;\n  attribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\n  attribute vec3 aNormalA;\n  attribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\n  attribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\n  vec2 sideness;\n  vec2 sidenessNorm;\n  float lineWidthPixels;\n  float extensionLengthPixels;\n\n#ifdef UBER\n\n  float type;\n\n#endif\n};\n\n  // Output required to compute color\n  varying vec4 vColor;\n\n  // Output required to compute distance to line/caps\n  varying vec3 vPosition;\n  varying float vRadius;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n\n  $EdgeRendererUtils_adjustProjectedPosition\n\n  $vsRibbonEdgeStyleOutputs\n\n  $vsRibbonEdgeLineAmplitudeRegular\n  $vsRibbonEdgeLineAmplitudeSketch\n  $vsRibbonEdgeLineAmplitudeUber\n\n  $EdgeRendererUtils_readComponentData\n  $EdgeRendererUtils_distanceBasedPerspectiveFactor\n  $EdgeRendererUtils_worldNormal\n  $EdgeRendererUtils_extensionFalloff\n\n#ifdef SILHOUETTE\n\n  $EdgeRendererUtils_isSilhouetteEdge\n\n#endif /* SILHOUETTE */\n\n  vec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vec2 sideness = unpackedAttributes.sideness;\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    vec4 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n    vec4 projPosV0 = uProj * viewPosV0;\n    vec4 projPosV1 = uProj * viewPosV1;\n    vec4 projPos = uProj * viewPos;\n\n    vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n    vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n    float lineLengthPixels = length(screenSpaceLinePixels);\n\n    float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n    vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n    float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z);\n    float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n    float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n    float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes);\n\n    vSizeFalloffFactor = falloffFactor;\n\n    float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n    float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n    const float aaPaddingPixels = 1.0;\n\n    // Line size with padding\n    float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n    float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n\n    // Line length with padding\n    float aaPaddedLineLengthPixels = extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n    float halfAAPaddedLineLengthPixels = aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n    // Even if there is no AA, we still want to do proper <1px rendering,\n    // so we effectively clamp the pixel sizes to minimum of 1px and compute\n    // coverage in the fragment shader\n    float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n    float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n\n    float halfAAPaddedLineLengthPixels = max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n    // Half line width in NDC including padding for anti aliasing\n    vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n    vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n    vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n    // Compute screen space position of vertex, offsetting for line size and end caps\n    vec2 ndcOffset = (\n        screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n      + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n    );\n\n    projPos.xy += ndcOffset * projPos.w;\n    projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n    projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n    // Line length with end caps\n    float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n    float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n    // Position in pixels with origin at first vertex of line segment\n    vPosition = vec3(\n      halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n      pixelPositionAlongLine,\n      pixelPositionAlongLine / extendedLineLengthPixels\n    );\n\n    // The line width radius in pixels\n    vRadius = lineWidthPixels * 0.5;\n    vLineLengthPixels = extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n    gl_Position = isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\n\n#else /* SILHOUETTE */\n\n    gl_Position = projPos;\n\n#endif /* SILHOUETTE */\n\n#ifdef UBER\n\n    if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) {\n      gl_Position = vec4(10, 10, 10, 1);\n    }\n\n#elif defined(SKETCH)\n\n    if (lineLengthPixels <= 3.0) {\n      gl_Position = vec4(10, 10, 10, 1);\n    }\n\n#endif\n\n    return projPos;\n  }\n\n#ifdef UBER\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n\n    vec2 sidenessNorm = aSideness;\n    vec2 sideness = sidenessNorm * 2.0 - 1.0;\n\n    float fType = component.type;\n    float extensionLengthPixels = component.extensionLength;\n    float lineWidth = component.lineWidth;\n\n    if (fType <= 0.0) {\n      extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n    }\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n  }\n\n#else /* UBER */\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n    vec2 sidenessNorm = aSideness;\n    vec2 sideness = sidenessNorm * 2.0 - 1.0;\n    float extensionLengthPixels = component.extensionLength;\n\n#ifdef SKETCH\n\n    extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n\n#endif /* SKETCH */\n\n    float lineWidth = component.lineWidth;\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n  }\n\n#endif /* UBER */\n\n  void main() {\n    ComponentData component = readComponentData();\n    UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n    vec4 worldPosV0 = uModel * vec4(aPosition0, 1.0);\n    vec4 worldPosV1 = uModel * vec4(aPosition1, 1.0);\n\n    vec4 viewPosV0 = uView * worldPosV0;\n    vec4 viewPosV1 = uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n    vec3 worldNormal = silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n    vec3 worldNormal = modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n    // General geometric computation for all types of edges\n    vec4 projPos = calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n    // Component color\n    vColor = component.color;\n\n    // Specific computation for different edge styles\n    calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n  }\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetSketch"><![CDATA[\n\n$rgba2float\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif /* SKETCH */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetRegular"><![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineOffsetRegular() {\n    return 0.0;\n  }\n\n  float calculateLinePressureRegular() {\n    return 1.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) && !defined(SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetRegular();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureRegular();\n  }\n\n#endif /* !UBER || !SKETCH */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetUber"><![CDATA[\n\n#ifdef UBER\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType <= 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetRegular();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType <= 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureRegular();\n    }\n  }\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdge"><![CDATA[\n  $fsprecisionf\n\n  varying vec4 vColor;\n  varying float vRadius;\n  varying vec3 vPosition;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n  varying float vLineIndex;\n\n  // At which coverage threshold we discard a fragment completely\n  #define COVERAGE_TEST_THRESHOLD 0.01\n\n  $fsRibbonEdgeLineOffsetRegular\n  $fsRibbonEdgeLineOffsetSketch\n  $fsRibbonEdgeLineOffsetUber\n\n  vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n    float lineOffset = calculateLineOffset();\n    float positionX = position.x - lineOffset;\n\n    if (radius < 1.0) {\n      // Handle this specifically for subpixel sizes:\n      // 1. Compute correct coverage (note coverage is computed by\n      //    0.5 - dist, so we make sure that that will lead to correct\n      //    subpixel coverage\n      // 2. Ignore rounded caps\n      float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n      float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n      float coverage = min(coverageX, coverageY);\n\n      return vec2(0.5 - coverage, 0.0);\n    }\n    else {\n      // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n      float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n      vec2 lineToPosition = vec2(positionX, positionOnCap);\n      return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n    }\n  }\n\n  void main() {\n\n    float radius = vRadius * calculateLinePressure();\n\n    vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n    float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n    const float coverageLimit = COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n    // Use subpixel coverage computation when lines get subpixel widths\n    // so we still render them appropriately. Otherwise discard anything\n    // that is not fully within the line\n    float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n    if (coverage < coverageLimit) {\n      discard;\n    }\n\n    float alpha = vColor.a * coverage;\n\n    gl_FragColor = vec4(vColor.rgb, alpha);\n  }\n]]></snippet>\n\n</snippets>\n'},1592:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(10),n(80),n(1487),n(1490)],void 0===(i=function(e,t,n,r,i,a){function o(e,t){if(!e)return null;for(var n=e.length/2,r=s*n,i=new Array(n),a=0,o=1===t,c=0;c<e.length;c+=2){var d=(e[c]+e[c+1])/2;i[a++]=o?Math.min(r,1-(1-d)*l):Math.min(r,d*l)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var n=t.strokesDefinition.resolution,s=n/2,l=new Uint8Array(4*n*n),c=4*n*s,d=t.strokesDefinition.amplitude,u=2*d,p=4*n,h=r.log2(n)+1,f=t.strokesDefinition.strokes.length,v=(h-1)*f*p,g=0,m=t.strokesDefinition.strokes;g<m.length;g++){for(var y=m[g],b=y.distance,_=y.pressure,x=v,S=0;S<h;S++){0!==S&&(b=o(b,0),_=o(_,1));for(var w=0;w<t.strokesDefinition.resolution;w++){var A=.5+(b?b[w%b.length]/u:0),C=_?_[w%_.length]:1;i.packFloatRGBA(A,l,x),i.packFloatRGBA(C,l,x+c),x+=4}x-=p*(f+1)}v+=p}return{resolution:n,texture:new a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:n,height:n,wrapMode:10497},l),normalizationScale:u,amplitude:d,variants:f}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,r))||(e.exports=i)},1593:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(251)],void 0===(i=function(e,t,n){function r(e,t){var r=n.binaryIndexOf(e,t,!0);return-1===r?t<e[0]?0:e.length:r}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=e[0].type,n=0;n<e.length;n++)if(t!==e[n].type)return!0;return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++){var n=e[t].material;if(n.size*n.color[3]*n.opacity>0)return!1}return!0},t.cloneIndices=function(e){if(Uint16Array.from)return e instanceof Uint16Array?Uint16Array.from(e):Uint32Array.from(e);for(var t=e instanceof Uint16Array?new Uint16Array(e.length):new Uint32Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t},t.estimateLengthAtDistance=function(e,t,n,r){return n*(r/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=r,t.computeEdgeCount=function(e,t,n){return e.length-r(e,t*n.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i].index,o=t[i],s=t[i+1];if(r)for(var l=o;l<s;l++){var c=r[l];n.set(c,a)}else for(l=o;l<s;l++)n.set(l,a)}}}.apply(null,r))||(e.exports=i)},1594:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(49),n(1595)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=n.vec3d,a=n.vec4d,o=i.create(),s=function(){function e(){this._renderLighting={main:{intensity:i.create(),direction:i.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=i.create(),this._oldSpecular=a.create(),this._oldDiffuse=a.create(),this._oldAmbient=a.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var n=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",n)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var r=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",r.r[0],r.r[1],r.r[2],r.r[3]),e.setUniform4f("lightingAmbientSH_G",r.g[0],r.g[1],r.g[2],r.g[3]),e.setUniform4f("lightingAmbientSH_B",r.b[0],r.b[1],r.b[2],r.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]),e.setUniform4f("lightingAmbientSH_R1",r.r[1],r.r[2],r.r[3],r.r[4]),e.setUniform4f("lightingAmbientSH_G1",r.g[1],r.g[2],r.g[3],r.g[4]),e.setUniform4f("lightingAmbientSH_B1",r.b[1],r.b[2],r.b[3],r.b[4]),e.setUniform4f("lightingAmbientSH_R2",r.r[5],r.r[6],r.r[7],r.r[8]),e.setUniform4f("lightingAmbientSH_G2",r.g[5],r.g[6],r.g[7],r.g[8]),e.setUniform4f("lightingAmbientSH_B2",r.b[5],r.b[6],r.b[7],r.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,r.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),i.negate(this._renderLighting.main.direction,this._oldDirection);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var n=i.set(this._oldDiffuse,o);i.scale(n,.4*this._info.globalFactor),i.add(this._oldAmbient,n)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=s}.apply(null,r))||(e.exports=i)},1595:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(49),n(80),n(1596),n(1514)],void 0===(i=function(e,t,n,r,i,a){function o(e){return(e+1)*(e+1)}function s(e){return r.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,n){var r=e[0],i=e[1],a=e[2],s=n||[];return s.length=o(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*a,s[3]=.4886025119*i),t>=2&&(s[4]=1.09254843059*r*i,s[5]=1.09254843059*i*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*r*a,s[8]=.54627421529*(r*r-i*i)),s}function c(e,t){var n=o(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=n;for(var i=0;i<n;i++)r.r[i]=r.g[i]=r.b[i]=0;return r}function d(e,t){for(var n=s(t.r.length),r=0,a=e;r<a.length;r++){var o=a[r];p.negate(o.direction,y),l(y,n,g),i.elementwiseProduct(g,b),i.scalarProduct(g,o.intensity[0],m),i.add(t.r,m),i.scalarProduct(g,o.intensity[1],m),i.add(t.g,m),i.scalarProduct(g,o.intensity[2],m),i.add(t.b,m)}return t}function u(e,t){l(y,0,g);for(var n=0,r=e;n<r.length;n++){var i=r[n];t.r[0]+=g[0]*b[0]*i.intensity[0]*4*Math.PI,t.g[0]+=g[0]*b[0]*i.intensity[1]*4*Math.PI,t.b[0]+=g[0]*b[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0});var p=n.vec3d;t.numberOfCoefficients=o,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=l,t.initSHCoefficients=c,t.projectFillLights=d,t.projectAmbientLights=u,t.combineLights=function(e,t,n,r){c(t,r.sh),p.set3(0,0,0,n.intensity);var o=!1,s=h,l=f,g=v;s.length=0,l.length=0,g.length=0;for(var m=0,y=e;m<y.length;m++)(x=y[m])instanceof a.MainLight&&!o?(p.set(x.direction,n.direction),n.intensity[0]=x.intensity[0],n.intensity[1]=x.intensity[1],n.intensity[2]=x.intensity[2],n.castShadows=x.castShadows,o=!0):x instanceof a.MainLight||x instanceof a.FillLight?s.push(x):x instanceof a.AmbientLight?l.push(x):x instanceof a.SphericalHarmonicsLight&&g.push(x);d(s,r.sh),u(l,r.sh);for(var b=0,_=g;b<_.length;b++){var x=_[b];i.add(r.sh.r,x.sh.r),i.add(r.sh.g,x.sh.g),i.add(r.sh.b,x.sh.b)}};var h=[],f=[],v=[],g=[0],m=[0],y=p.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,r))||(e.exports=i)},1596:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n},t.elementwiseProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t[r];return n},t.scalarProduct=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t;return n},t.add=function(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}}.apply(null,r))||(e.exports=i)},1597:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderHUD"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  uniform float pixelRatio;\n  uniform vec2 screenOffset;\n  uniform vec2 anchorPos;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspective;\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n\n  attribute vec2 $uv0;\n  attribute vec4 $color;\n  attribute vec2 $size;\n  attribute vec4 $auxpos2;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n  $vvUniforms\n\n  $alignToPixelCenter\n  $alignToPixelOrigin\n  $projectPositionHUD\n  $vvFunctions\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 posProj = projectPositionHUD(projectAux);\n\n    vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n    inputSize = screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n    vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n    inputSize = $size;\n\n    vec2 screenOffsetScaled = screenOffset;\n#endif\n\n#ifdef VV_SIZE\n    // only use width (.xx) for proportional scaling\n    // (if no width was defined in vv, width\n    //  will be a copy of height vv)\n    inputSize *= vvGetScale($auxpos2).xx;\n#endif\n\n    vec2 combinedSize = inputSize * pixelRatio;\n    vec4 quadOffset = vec4(0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n    bool visible = testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  voccluded = visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n    if (visible) {\n#endif\n      // UV goes from 0 to 1.99999, where the integer part is used\n      // for the normalized vertex coordinates, and the fractional\n      // part is used for texture sampling\n      vec2 uv01 = floor($uv0);\n      vec2 uv = $uv0 - uv01;\n\n      // Displace icon based on anchor position (normalized for size) and\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n      // SDF primitives might be scaled so that the SDF texture resolution does\n      // not match the resolution of the canvas, but we still want to render\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\n      // pixel border at the geometry center achieves this, since SDF textures\n      // always have power of 2 dimensions.\n      posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n      posProj += quadOffset;\n\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\n      // border renders textures with pixel-perfect results. If the texture\n      // resolution does not match the canvas resolution then aligning is\n      // redundant.\n      if (inputSize.x == $size.x) {\n        posProj = alignToPixelOrigin(posProj, viewport.zw);\n      }\n#endif\n\n      gl_Position = posProj;\n\n      vtc = uv;\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords = vec3(uv01, 1.0 / combinedSize);\n#endif\n\n      vsize = inputSize;\n#ifdef OCCL_TEST\n    } else {\n      vtc = vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords = vec3(0);\n#endif\n\n    }\n#endif\n\n    gl_Position = posProj;\n\n#ifdef VV_COLOR\n    vcolor = vvGetColor($auxpos2, vvColorValues, vvColorColors);\n#else\n    vcolor = $color / 255.0;\n#endif\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderHUDBaseVariables"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec4 overrideColor;\n  uniform vec4 outlineColor;\n  uniform float outlineSize;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n]]></snippet>\n\n<snippet name="fragmentShaderHUDBaseMain"><![CDATA[\n  vec4 premultiply(vec4 v) {\n    return vec4(v.rgb * v.a, v.a);\n  }\n\n  $rgba2float\n\n  void main() {\n\n#ifdef SIGNED_DISTANCE_FIELD\n    vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n    vec4 fillPixelColor = overrideColor * vcolor;\n\n    // Attempt to sample texel centers to avoid that thin cross outlines\n    // disappear with large symbol sizes.\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n    const float txSize = 128.0;\n    const float texelSize = 1.0 / txSize;\n    // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n    vec2 scaleFactor = (vsize - txSize) * texelSize;\n    vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n    // Get distance and map it into [-0.5, 0.5]\n    float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n    // Distance in output units (i.e. pixels)\n    float dist = d * vsize.x;\n\n    // Create smooth transition from the icon into its outline\n    fillPixelColor.a *= clamp(0.5 - dist, 0.0, 1.0);\n\n    if (outlineSize > 0.25) {\n      vec4 outlinePixelColor = outlineColor;\n      float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n      // Create smooth transition around outline\n      outlinePixelColor.a *= clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n      float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n      vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n      gl_FragColor = vec4(compositeColor, compositeAlpha);\n    }\n    else {\n      gl_FragColor = premultiply(fillPixelColor);\n    }\n\n    // visualize SDF:\n    // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n    // fragment color. Input textures should already be pre-multiplied and so\n    // don\'t require adjustment, but the override and vertex colors must be\n    // modulated by their alpha values.\n\n    gl_FragColor = texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n     float isBorder = float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n     gl_FragColor = mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\n#endif\n\n    if (gl_FragColor.a < 0.1) {\n      discard;\n    }\n\n]]></snippet>\n\n<snippet name="fragmentShaderHUD"><![CDATA[\n$fragmentShaderHUDBaseVariables\n$fragmentShaderHUDBaseMain\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderHUDHighlight"><![CDATA[\n$fragmentShaderHUDBaseVariables\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n$fragmentShaderHUDBaseMain\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\n    // do it for all highlight pixel based on the centroid occlusion. This\n    // is a temporary solution for:\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n    if (voccluded == 1.0) {\n      gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    } else {\n      gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n    }\n#else\n    $highlightWrite\n#endif\n  }\n]]></snippet>\n\n\n<snippet name="vertexShaderOcclusionTestPixel"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  $alignToPixelCenter\n  $projectPositionHUD\n\n  void main(void) {\n    vec4 posProjCenter;\n\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\n    // of clip space.\n    if (dot($position, $position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\n      // the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n]]></snippet>\n\n</snippets>\n'},1598:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new n(t):null},t.getTimestamp=function(e,t,n){void 0===n&&(n=50);var r=e.capabilities.disjointTimerQuery;if(!r)return null;if(r.timestampBits()<=0)return null;var i=r.createQuery();r.createTimestamp(i);var a=function(){var e=r.resultAvailable(i),o=r.disjoint();if(!e||o)o?t():setTimeout(a,n);else{var s=r.getResult(i);t(s/1e6)}};a()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var n=t.timestampBits();return console.log({bits:n}),n>0};var n=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var n=this.timer.getResult(this.query);this.cb(n/1e6)}},e}()}.apply(null,r))||(e.exports=i)},1599:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderTexOnly"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n    vtc = $uv0;\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderTexOnly"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec4 color;\n  varying vec2 vtc;\n\n  void main() {\n    vec4 texColor = texture2D(tex, vtc);\n    gl_FragColor = texColor * color;\n  }\n]]></snippet>\n\n</snippets>\n'},1600:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){function r(e,t){return e+"_"+t}var i=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,n.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var n,a=r(e.id,t),o=this.id2glMaterialRef[a];if(null==o){var s=e.getGLMaterials()[t];n=s?new s(e,this.programRep,this.textureRep):void 0,o=new i(n),this.id2glMaterialRef[a]=o}else n=o.getGLMaterial();return o.incRefCnt(),n&&this.increaseProgramReferences(n),n},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var n=r(e,t),i=this.id2glMaterialRef[n];if(i.decRefCnt(),0===i.getRefCnt()){var a=i.getGLMaterial();a&&(this.decreaseProgramReferences(a),a.dispose()),delete this.id2glMaterialRef[n]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[r(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var n=this.id2glMaterialRef[r(e,"depth")];n&&n.getGLMaterial()&&this.updateParamsForMat(n.getGLMaterial());var i=this.id2glMaterialRef[r(e,"depthShadowMap")];i&&i.getGLMaterial()&&this.updateParamsForMat(i.getGLMaterial());var a=this.id2glMaterialRef[r(e,"normal")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial());var o=this.id2glMaterialRef[r(e,"highlight")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),n=this.programRep,r=0;r<t.length;r++)n.increaseRefCount(t[r])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),n=this.programRep,r=0;r<t.length;r++)n.decreaseRefCount(t[r])},e}()}.apply(null,r))||(e.exports=i)},1601:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(1487),n(1490)],void 0===(i=function(e,t,n,r,i){var a=n.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),o=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,r.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();return function(){function e(e,t,n,r){this.NUM_PARALLEL=8,this.textures=e,this._programRepository=t,this.getViewportToRestore=n,this._rctx=r,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=r.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?r.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(e,t,n){var s=this,l=this.id2textureRef[e];if(null==l){var c=this.textures[e];r.assert(void 0!==c),c.setUnloadFunc(this._unload.bind(this));var d=!0===t,u=this._createGLTextureDescription(c);if(l=new o(null),r.assert(null==this.id2textureRef[e]),this.id2textureRef[e]=l,c.initializeThroughRender){var p=c.initializeThroughRender(this._rctx,u);l.setGLTexture(p),n&&n(l)}else if(c.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(e,u,n):this._queue.push([e,u,n]);else try{c.initializeThroughUpload(this._rctx,u,this._programRepository,this.getViewportToRestore(),function(e){l.setGLTexture(e),s._needsRender=!0,n&&n(l)})}catch(e){a.error("#aquire","Error loading texture: "+e.toString())}null==l.getGLTexture()&&l.setGLTexture(new i(this._rctx,this._fallbackTextureDesc,d?this._fallbackTextureTransparentData:this._fallbackTextureData)),this._needsRender=!0}return l.incRefCnt(),l},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),r.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getIsLoaded=function(e){if(null==this.id2textureRef[e])return!1;if(void 0!==this.loading[e])return!1;for(var t=0;t<this._queue.length;++t)if(this._queue[t][0]===e)return!1;return!0},e.prototype.addTextureListener=function(e){r.assert(-1===this.listeners.indexOf(e)),this.listeners.push(e)},e.prototype.removeTextureListener=function(e){var t=this.listeners.indexOf(e);r.assert(-1!==t),this.listeners.splice(t,1)},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var n=t.getGLTexture();n&&n.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrapClamp;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t?33071:void 0}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),n=Object.keys(this.loading);this.listeners.forEach(function(r){r(e,t,n)}),this.processQueue()}},e.prototype._loadImage=function(e,t,n){var i=this;r.assert(null==this.loading[e]),this.loading[e]=!0;var a=this.textures[e];r.assert(void 0!==a),setTimeout(function(){var r=i.id2textureRef[e];r&&r.getRefCnt()&&a.initializeThroughUpload(i._rctx,t,i._programRepository,i.getViewportToRestore(),function(t){i.next(e),i._needsRender=!0,r&&r.getRefCnt()&&(r.setGLTexture(t),n&&n(r))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var n=this._queue[t][0],r=this.id2textureRef[n];void 0!==r&&(0===r.getRefCnt()?(r.getGLTexture().dispose(),delete this.id2textureRef[n]):e.push(this._queue[t]))}this._queue=e;var i=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<i;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,i)},e}()}.apply(null,r))||(e.exports=i)},1602:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n\x3c!--\n===============================================================================\nSmartly downsamples a texture, halfing its resolution. This allows for a square\nscreen region to check if none, any or all pixels were set.\n\nThe red channel is always ceiled after interpolating the 4 merged pixels.\nThis allows to evaluate:\nany(pixels.red != 0.0) as red == 1.0\nnone(pixels.red != 0.0) as red == 0.0\n\nThe green and blue channels are set to floor(max(green, blue)).\nThis allows to evaluate:\nall(pixels.green || pixels.blue) as green == 1.0\n===============================================================================\n--\x3e\n\n<snippet name="vsConservativeDownsample"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n\n  void main()\n  {\n    gl_Position = vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fsConservativeDownsample"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec2 invFramebufferDim;\n\n  void main()\n  {\n    vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n    vec4 value = texture2D(tex, coord);\n    float mx = floor(max(value.g, value.b));\n    gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n  }\n]]></snippet>\n\n\x3c!--\n===============================================================================\nGaussian blur with linear sampling. Supports different number of samples, but\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\nthe number of samples taken.\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGAUSSIAN_SAMPLES (3,5,7)\n\nThis technique requires linear filtering on source texture\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n===============================================================================\n--\x3e\n<snippet name="vsHighlightBlurFastGaussian"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform sampler2D coverageTex;\n    varying vec3 blurCoordinate;\n  #else\n    uniform vec2 blurSize;\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    gl_Position = vec4($position, 0.0, 1.0);\n\n    #ifdef GRID_OPTIMIZATION\n      // sample the coverage texture at the block center\n      // and if no coverage detected, create degenerate triangle\n      vec4 cov = texture2D(coverageTex, $uv0);\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0,0,0,0);\n      }\n\n      // create texture coordinate for blur center\n      // encode information about fully inside block in z coordinate\n      blurCoordinate = vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n    #else\n      vec2 uv = $position.xy * .5 + vec2(.5);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n      #elif GAUSSIAN_SAMPLES == 5\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n        blurCoordinates[5] = uv + blurSize * 5.1;\n        blurCoordinates[6] = uv - blurSize * 5.1;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n        blurCoordinates[5] = uv + blurSize * 5.1;\n        blurCoordinates[6] = uv - blurSize * 5.1;\n        blurCoordinates[7] = uv + blurSize * 7.1;\n        blurCoordinates[8] = uv - blurSize * 7.1;\n      #endif\n    #endif\n  }\n]]></snippet>\n\n<snippet name="fsHighlightBlurFastGaussian"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform vec2 blurSize;\n    varying vec3 blurCoordinate;\n  #else\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      vec2 uv = blurCoordinate.xy;\n      vec4 center = texture2D(tex, uv);\n\n      // do not blur if no pixel or all pixels in neighborhood are set\n      if (blurCoordinate.z == 1.0) {\n        gl_FragColor = center;\n      }\n      else {\n        vec4 sum = vec4(0.0);\n\n        #if GAUSSIAN_SAMPLES == 3\n          // not proper gaussian weights\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        #elif GAUSSIAN_SAMPLES == 5\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        #elif GAUSSIAN_SAMPLES == 7\n          // not proper gaussian weights\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv + blurSize * 5.1) * 0.03;\n          sum += texture2D(tex, uv - blurSize * 5.1) * 0.03;\n        #elif GAUSSIAN_SAMPLES == 9\n          // not proper gaussian weights\n          sum += center * 0.154164;\n          sum += texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n          sum += texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n          sum += texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n          sum += texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n          sum += texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n          sum += texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n          sum += texture2D(tex, uv + blurSize * 7.5) * 0.05;\n          sum += texture2D(tex, uv - blurSize * 7.5) * 0.05;\n        #endif\n\n        gl_FragColor = sum;\n      }\n    #else\n      vec4 sum = vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      #elif GAUSSIAN_SAMPLES == 5\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[5]) * 0.03;\n        sum += texture2D(tex, blurCoordinates[6]) * 0.03;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.154164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.204005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.204005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.123913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.123913;\n        sum += texture2D(tex, blurCoordinates[5]) * 0.09;\n        sum += texture2D(tex, blurCoordinates[6]) * 0.09;\n        sum += texture2D(tex, blurCoordinates[7]) * 0.05;\n        sum += texture2D(tex, blurCoordinates[8]) * 0.05;\n      #endif\n\n      gl_FragColor = sum;\n    #endif\n  }\n]]></snippet>\n\n\x3c!--\n===============================================================================\nMerging blurred outlines with source image, advanced version\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGRID_DEBUG (set or !set)\n===============================================================================\n--\x3e\n<snippet name="vsHighlightApply"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  #ifdef GRID_OPTIMIZATION\n    attribute vec2 $uv0;\n    uniform sampler2D coverageTex;\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      #ifdef GRID_DEBUG\n        vec4 cov = texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block,\n        // or all pixels set, hide block\n        if (cov.r == 0.0 || cov.g == 1.0 || cov.b == 1.0) {\n          gl_Position = vec4(0,0,0,0);\n          return;\n        }\n        gl_Position = vec4($position, .0, 1.0);\n        uv = $uv0;\n        return;\n      #else\n        vec4 cov = texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block, hide block\n        if (cov.r == 0.0) {\n          gl_Position = vec4(0,0,0,0);\n          return;\n        }\n      #endif\n    #endif\n\n    gl_Position = vec4($position, .0, 1.0);\n    uv = $position.xy * .5 + vec2(.5);\n  }\n]]></snippet>\n\n<snippet name="fsHighlightApply"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform sampler2D origin;\n\n  uniform vec4 color;\n  uniform float outlineSize;\n  uniform float blurSize;\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\n  varying vec2 uv;\n\n  void main()\n  {\n    #if defined(GRID_OPTIMIZATION) && defined(GRID_DEBUG)\n      gl_FragColor = vec4(uv, 0, 1.0);\n    #else\n      // Read the highlight intensity from the blurred highlight image\n      vec4 blurredHighlightValue = texture2D(tex, uv);\n      float highlightIntensity = blurredHighlightValue.a;\n\n      // Discard all pixels which are not affected by highlight\n      if (highlightIntensity == 0.0) {\n        discard;\n      }\n\n      vec4 origin_color = texture2D(origin, uv);\n\n      float outlineIntensity;\n      float fillIntensity;\n\n      // if occluded\n      if (blurredHighlightValue.g > blurredHighlightValue.b) {\n        outlineIntensity = color.w * opacities[1];\n        fillIntensity = color.w * opacities[3];\n      }\n      // if unoccluded\n      else {\n        outlineIntensity = color.w * opacities[0];\n        fillIntensity = color.w * opacities[2];\n      }\n\n      float inner = 1.0 - outlineSize / 9.0;\n      float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n      float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n      //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n      float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n      float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      // I.e., color should not be premultiplied with alpha\n      gl_FragColor = vec4(color.xyz, intensity);\n    #endif\n  }\n]]></snippet>\n\n</snippets>\n'},1603:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsOffscreenRenderer"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = vec4($position.xy, 0.0, 1.0);\n    vtc = $position.xy * 0.5 + 0.5;\n  }\n]]></snippet>\n\n<snippet name="fsOffscreenRenderer"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  varying vec2 vtc;\n\n  void main() {\n    gl_FragColor = texture2D(tex, vtc);\n  }\n]]></snippet>\n\n<snippet name="fsOffscreenRendererTransparentToHUDVisibility"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  varying vec2 vtc;\n\n  void main() {\n    gl_FragColor = vec4(1.0 - texture2D(tex, vtc).a);\n  }\n]]></snippet>\n\n\n\n</snippets>\n'},1604:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(10),n(1495),n(1659),n(1490)],void 0===(i=function(e,t,n,r,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o={dataType:5121},s={},l=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var n=this.depthTextures.get(e.id);return n&&(n.descriptor.width===t.width&&n.descriptor.height===t.height||(n.dispose(),n=void 0)),n||(n=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,n)),n}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var r=this.depthBuffers.get(e.id);return r?r.descriptor.width===t.width&&r.descriptor.height===t.height||r.resize(t.width,t.height):(r=new i(this.rctx,n({internalFormat:34041},t)),this.depthBuffers.set(e.id,r)),r}},e.prototype.getColorTexture=function(e,t){var n=this.colorTextures.get(e.id);return n&&(n.descriptor.width===t.width&&n.descriptor.height===t.height||(n.dispose(),n=void 0)),n||(n=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,n)),n},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return n({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return n({id:t},o,e)},e.prototype.getFramebuffer=function(e,t,n){var i=this.getKey(t,n),a=this.framebuffers.get(i),o=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=n?this.getDepthTexture(n,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o||a.depthStencilTexture!==s)&&(a.detachColorTexture(),a.detachDepthStencilTexture(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilTexture(s)),a):(a=n?r.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:4},s):r.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(i,a),a)}var l=n?this.getDepthBuffer(n,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o)&&(a.detachColorTexture(),a.detachDepthStencilBuffer(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilBuffer(l)),a):(a=r.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:n?3:0},l),this.framebuffers.set(i,a),a)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=l}.apply(null,r))||(e.exports=i)},1605:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){return function(){function e(){this.shaderVariators={},this._nextId=0,this._programsByName={},this._namesById=[],this._programRefCount=[],this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){for(var e in this._programsByName)this._programsByName[e].dispose();this._programsByName=null,this._namesById=null,this._programRefCount=null},e.prototype.add=function(e,t){n.assert(null==this._programsByName[e]),this._programsByName[e]=t,this._namesById[t.id]=e},e.prototype.get=function(e){return this._programsByName[e]},e.prototype.addShaderVariations=function(e,t){this.shaderVariators[e]=t},e.prototype.getShaderVariations=function(e){return this.shaderVariators[e]},e.prototype.getShaderVariationsProgram=function(e,t,n,r,i){var a=this.getShaderVariations(e);return a&&a.getProgram(t,n,r,i)},e.prototype.getProgramsUsingUniform=function(e){return this._commonUniforms[e]||[]},e.prototype.increaseRefCount=function(e){var t=e.id;this._programRefCount[t]?this._programRefCount[t]++:(this._programRefCount[t]=1,this._findCommonUniforms(e))},e.prototype.decreaseRefCount=function(e){var t=e.id;this._programRefCount[t]>1?this._programRefCount[t]--:(this._forgetCommonUniforms(e),this._programRefCount[t]=0)},e.prototype._getNextId=function(){return this._nextId++},e.prototype._findCommonUniforms=function(e){for(var t in this._commonUniforms)e.hasUniform(t)&&(n.assert(-1===this._commonUniforms[t].indexOf(e),"common uniforms of program have already been determined"),this._commonUniforms[t].push(e))},e.prototype._forgetCommonUniforms=function(e){for(var t in this._commonUniforms){var n=this._commonUniforms[t],r=n.indexOf(e);r>-1&&(n[r]=n[n.length-1],n.pop())}},e}()}.apply(null,r))||(e.exports=i)},1606:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1660),n(1487)],void 0===(i=function(e,t,n,r){return function(){function e(e){var t=r.VertexAttrConstants;for(var n in t)this[t[n]]=r.VertexAttrConstants[n];if(e)for(var i in e)this[i]=e[i]}return e.prototype._parse=function(e){for(var t=n.parse(e).getElementsByTagName("snippet"),i=/\$[a-zA-Z0-9_]+[ \t]*/,a=/[\$\s]+/g,o=0;o<t.length;o++){var s=t[o].getAttribute("name");r.assert(null==this[s]);for(var l=t[o].textContent;;){var c=l.match(i);if(null==c)break;var d=this[c[0].replace(a,"")];r.assert(void 0!==d),l=l.replace(c[0],d)}this[s]=l}},e}()}.apply(null,r))||(e.exports=i)},1607:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n  <snippet name="createFsSSAOSrc"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D rnm;\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n  uniform float   ssaoAtt;\n  uniform vec2    rnmScale;\n  uniform float   radius;\n  uniform vec2    nearFar;\n  uniform vec3    pSphere[64];\n\n  varying vec2    uv;\n\n  const float   strength = .07;\n  const float   falloff = .000002;\n\n  $rgba2float\n  void main(void) {\n    vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n    float currentPixelDepth = rgba2float(texture2D(depthMap, uv));\n    vec3 ep = vec3(uv.xy, currentPixelDepth);\n    vec3 norm = vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\n    float bl = .0;\n    float f = mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\n    float radD = radius / f;\n    radD = min(radD, .5);\n    float depthDifference;\n    vec3 ray;\n\n    for(int i = 0; i < NUM_TAP_SAMPLES; ++i) {\n      ray = radD*reflect(pSphere[i], fres);\n      vec2 tc = ep.xy + sign(dot(ray, norm) ) * ray.xy;\n      if (tc.x >= .0 && tc.y >= .0 && tc.x <= 1.0 && tc.y <= 1.0) {\n        float occluderDepth = rgba2float(texture2D(depthMap, tc));\n        vec3 occluderNormal = vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\n        depthDifference = currentPixelDepth - occluderDepth;\n        bl += step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\n      }\n    }\n\n    float ao = 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\n    gl_FragColor.a = ao;\n  }\n]]></snippet>\n\n  <snippet name="getDepthLinear"><![CDATA[\n  float getDepthLinear(vec2 ssC) {\n    return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\n  }\n]]></snippet>\n\n<snippet name="createFsSSAOSrcObscurance"><![CDATA[\n  $fsprecisionf\n\n  uniform mat4 projMatrixInv;\n\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n\n  uniform float     intensity;\n\n  uniform float projScale;\n  uniform float     radius;\n  uniform vec2      nearFar;\n\n  uniform vec4      projInfo;\n\n  uniform vec2    screenDimensions;\n\n  //noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\n  uniform vec3    pSphere[NUM_TAP_SAMPLES]; //tap position\n  uniform vec2    rnmScale;\n  uniform sampler2D rnm; //noise texture\n\n  //set z scaling, used to prevent division in ortho mode\n  uniform vec2 zScale;\n\n  varying vec2  uv;\n  varying vec4  camPos;\n\n  $rgba2float\n  $getDepthLinear\n\n  /** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\n  /*uniform float numSpiralTurns;\n  vec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    // Radius relative to ssR\n    float alpha = (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\n    float angle = alpha * (numSpiralTurns * 6.28) + spinAngle;\n\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n  }*/\n\n\n  float fallOffFunction(float vv, float vn, float bias) {\n    float radius2 = radius * radius;\n\n    // A: From the HPG12 paper\n    // Note large epsilon to avoid overdarkening within cracks\n    // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n    // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n    float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n    // C: Medium contrast (which looks better at high radii), no division.  Note that the\n    // contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\n    // more computationally efficient and happens to be aesthetically pleasing.\n    // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n    // D: Low contrast, no division operation\n    // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n  }\n\n\n  /** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\n  float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(normalize(v), n_C);\n    return fallOffFunction(vv, vn, 0.1);\n  }\n\n\n  /**\n   * Reconstruct camera-space P.xyz from screen-space S = (x, y) in\n   * pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n   * is at (0.5, 0.5) [but that need not be the location at which the sample tap\n   * was placed!]\n   *\n   * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n   */\n  vec3 reconstructCSPosition(vec2 S, float z) {\n    return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n  }\n\n  void main(void) {\n    //Hash function used in the HPG12 AlchemyAO paper\n    //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n    //ivec2 ssC = ivec2(gl_FragCoord.xy);\n    //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n    vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n    float currentPixelDepth = getDepthLinear(uv);\n\n    if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n      gl_FragColor = vec4(0);\n      return;\n    }\n\n    vec3 currentPixelPos = reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n    // get the normal of current fragment\n    vec4 norm4 = texture2D(normalMap, uv);\n    vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n    bool isTerrain = norm4.w<0.5;\n\n    float sum = .0;\n\n    vec4 occluderFragment;\n    vec3 ray;\n\n    vec3 tapPixelPos;\n\n    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n    // bug or deviation from CE somewhere else?\n    float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n    for(int i = 0; i < NUM_TAP_SAMPLES; ++i)\n    {\n      // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n      //float ssR;\n      //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n      // get the depth of the occluder fragment\n      //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n      vec2 unitOffset = reflect(pSphere[i], fres).xy;\n      vec2 offset = vec2(-unitOffset*radius*ps);\n\n\n      //don\'t use current or very nearby samples\n      if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n\n      vec2 tc = vec2(gl_FragCoord.xy + offset);\n      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n      vec2 tcTap = tc/screenDimensions;\n      float occluderFragmentDepth = getDepthLinear(tcTap);\n\n      if (isTerrain) {\n        bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n        if (isTerrainTap) {\n          continue;\n        }\n      }\n\n      tapPixelPos = reconstructCSPosition(tc, occluderFragmentDepth);\n\n      sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n    }\n\n    // output the result\n\n    float A = max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\n\n    // Anti-tone map to reduce contrast and drag dark region farther\n    // (x^0.2 + 1.2 * x^4)/2.2\n    A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n\n    //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n    //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n    //gl_FragColor = vec4(tapPixelPos.x/100.0);\n    gl_FragColor = vec4(A);\n\n\n  }\n]]></snippet>\n\n<snippet name="fsBlurEdgeAware"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n  uniform sampler2D tex;\n\n\n  uniform vec2 blurSize;\n\n\n  uniform float g_BlurFalloff;\n  uniform float projScale;\n\n\n  varying vec2 uv;\n\n  uniform vec2    nearFar;\n\n  //set z scaling, used to prevent division in ortho mode\n  uniform vec2 zScale;\n\n  $rgba2float\n  $getDepthLinear\n\n  float BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\n  {\n    float c = texture2D(tex, uv).r;\n    float d = getDepthLinear(uv);\n\n    float ddiff = d - center_d;\n\n    float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n    w_total += w;\n\n    return w*c;\n  }\n\n  void main(void)\n  {\n\n    float b = 0.0;\n    float w_total = 0.0;\n\n    float center_d =  getDepthLinear(uv);\n\n    float sharpness = -0.05*projScale/(center_d*zScale.x+zScale.y);\n    for (int r = -RADIUS; r <= RADIUS; ++r)\n    {\n      float rf = float(r);\n      vec2 uvOffset = uv + rf*blurSize;\n      b += BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n    }\n\n    gl_FragColor = vec4(b/w_total);\n  }\n]]></snippet>\n\n\n  <snippet name="fsBlurSrc0"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform float blurSize;\n  varying vec2 uv;\n\n  void main() {\n    int rad = RADIUS - 1;\n\n    vec4 sum = vec4(0.0);\n    for (int k = -RADIUS; k <= RADIUS; ++k) {     // NOTE for-variable-init must be a const expression\n      float fi = float(k);\n]]></snippet>\n\n  <snippet name="fsBlurSrc1"><![CDATA[\n    }\n\n    gl_FragColor = sum / float(RADIUS * RADIUS);\n  }\n]]></snippet>\n\n  <snippet name="fsBlurH"><![CDATA[\n  $fsBlurSrc0\n      sum += texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\n  $fsBlurSrc1\n]]></snippet>\n\n  <snippet name="fsBlurV"><![CDATA[\n  $fsBlurSrc0\n      sum += texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\n  $fsBlurSrc1\n]]></snippet>\n\n</snippets>\n'},1608:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1609),n(1642)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=null,a=[];t.enabled=!1,t.begin=function(){t.enabled&&(i=[])},t.trace=function(e){t.enabled&&null!=i&&i.push(e)},t.end=function(){if(t.enabled){var e=i;return i=null,e&&(a.forEach(function(t){return t(e)}),a.length=0),e}},t.instrumentContext=function(e){return t.enabled?r.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):n.makeDebugContext(e,void 0,function(e,r){t.enabled&&i&&i.push("gl."+e+"("+n.glFunctionArgsToString(e,r)+")")}):e},t.request=function(e){a.push(e)}}.apply(null,r))||(e.exports=i)},1609:function(e,t,n){var r;void 0===(r=function(){function e(e){if(null==l)for(var t in l={},c={},e)"number"==typeof e[t]&&(l[e[t]]=t,c[t]=e[t])}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function n(e){t();var n=l[e];return void 0!==n?"gl."+n:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function r(e,t,r,i){var a;if(void 0!==(a=s[e])&&(void 0!==(a=a[t])&&a[r])){if("object"==typeof a[r]&&void 0!==a[r].enumBitwiseOr){for(var o=a[r].enumBitwiseOr,l=0,d=[],u=0;u<o.length;++u){var p=c[o[u]];0!=(i&p)&&(l|=p,d.push(n(p)))}return l===i?d.join(" | "):n(i)}return n(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function i(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function a(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(n);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<i;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var o=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,c=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==l[e]},glEnumToString:n,glFunctionArgToString:r,glFunctionArgsToString:function(e,t){for(var n="",i=t.length,a=0;a<i;++a)n+=(0==a?"":", ")+r(e,i,a,t[a]);return n},makeDebugContext:function t(a,s,l,c){function d(e,t){return function(){l&&l(t,arguments);var n=e[t].apply(e,arguments),r=c.getError();return 0!=r&&(u[r]=!0,s(r,t,arguments)),n}}c=c||a,e(a),s=s||function(e,t,i){for(var a="",s=i.length,l=0;l<s;++l)a+=(0==l?"":", ")+r(t,s,l,i[l]);o("WebGL error "+n(e)+" in "+t+"("+a+")")};var u={},p={};for(var h in a)if("function"==typeof a[h])if("getExtension"!=h)p[h]=d(a,h);else{var f=d(a,h);p[h]=function(){return t(f.apply(a,arguments),s,l,c)}}else i(p,a,h);return p.getError=function(){for(var e in u)if(u.hasOwnProperty(e)&&u[e])return u[e]=!1,e;return a.NO_ERROR},p},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function n(){++v,p||f==v&&e.loseContext()}function r(e,t){var r=e[t];return function(){if(n(),!p)return r.apply(e,arguments)}}function o(e){return{statusMessage:e,preventDefault:function(){g=!0}}}var s,l=[],c=[],d={},u=1,p=!1,h=[],f=0,v=0,g=!1,m=0,y={};e.getContext=function(t){return function(){var a=t.apply(e,arguments);if(a instanceof WebGLRenderingContext){if(a!=s){if(s)throw"got different context";d=function(e){for(var t in e)"function"==typeof e[t]?d[t]=r(e,t):i(d,e,t);d.getError=function(){if(n(),!p)for(;e=s.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return d.NO_ERROR};for(var a=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],o=0;o<a.length;++o)d[f=a[o]]=function(t){return function(){if(n(),p)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=u,h.push(r),r}}(e[f]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(o=0;o<l.length;++o)d[f=l[o]]=function(t){return function(){return n(),p?null:t.apply(e,arguments)}}(d[f]);var c=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(o=0;o<c.length;++o){var f;d[f=c[o]]=function(t){return function(){return n(),!p&&t.apply(e,arguments)}}(d[f])}return d.checkFramebufferStatus=function(t){return function(){return n(),p?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return n(),p?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return n(),p?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return p},d}(s=a)}return d}return a}}(e.getContext);var b=function(e){l.push(t(e))},_=function(e){c.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":b(r);break;case"webglcontextrestored":_(r);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!p){for(p=!0,f=0,++u;s.getError(););(function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e]})(),y[s.CONTEXT_LOST_WEBGL]=!0;var t=o("context lost"),n=l.slice();setTimeout(function(){for(var r=0;r<n.length;++r)n[r](t);m>=0&&setTimeout(function(){e.restoreContext()},m)},0)}},e.restoreContext=function(){p&&c.length&&setTimeout(function(){if(!g)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<h.length;++e){var t=h[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),a(s),p=!1,v=0,g=!1;for(var e=c.slice(),t=o("context restored"),n=0;n<e.length;++n)e[n](t)},0)},e.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";f=v+e},e.getNumCalls=function(){return v},e.setRestoreTimeout=function(e){m=e},e},resetToInitialState:a}}.apply(null,[]))||(e.exports=r)},1610:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1611),n(1612),n(1541),n(1613),n(1556),n(1515),n(1526),n(1557),n(1618),n(1558),n(1621),n(1623),n(1545)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f){Object.defineProperty(t,"__esModule",{value:!0}),t.initializeShaders=function(e,t,v){e._parse(r),e._parse(n),h.loadShaders(e,t,v),f.loadShaders(e,t,v),s.loadShaders(e,t,v),l.loadShaders(e,t,v),c.loadShaders(e,t,v),u.loadShaders(e,t,v),p.loadShaders(e,t,v),o.loadShaders(e,t,v),d.loadShaders(e,t,v),i.EdgeView.loadShaders(e,t,v),a.loadShaders(e,t,v)}}.apply(null,r))||(e.exports=i)},1611:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="commonAttributesAndUniformsHUD"><![CDATA[\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec4 $auxpos1;\n\n  uniform mat4 proj;\n\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n\n  uniform vec4 viewport;\n\n  uniform vec3 camPos;\n\n  uniform float polygonOffset;\n  uniform float cameraGroundRelative;\n\n#ifdef VERTICAL_OFFSET\n\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  // [ divisor, offset, minPixelSize, paddingPixels ]\n  uniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\n  uniform sampler2D hudVisibilityTexture;\n]]></snippet>\n\n<snippet name="projectPositionHUD"><![CDATA[\n  $screenSizePerspective\n\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\n  const float SMALL_OFFSET_ANGLE = 0.984807753012208;\n\n  struct ProjectHUDAux {\n    vec3 posModel;\n    vec3 posView;\n    vec3 vnormal;\n\n    float distanceToCamera;\n    float absCosAngle;\n  };\n\n\n  /**\n   * Apply the simulated polygon offset for HUD objects that improves\n   * issues with Z-fighting.\n   *\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n   *   and the view direction.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n    float pointGroundSign = sign(pointGroundDistance);\n\n    if (pointGroundSign == 0.0) {\n      pointGroundSign = 1.0;\n    }\n\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n    float groundRelative = cameraGroundRelative * pointGroundSign;\n\n    // view angle dependent part of polygon offset emulation\n    // we take the absolute value because the sign that is dropped is\n    // instead introduced using the ground-relative position of the symbol and the camera\n    if (polygonOffset > .0) {\n      float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n      float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n      float factor = (1.0 - tanAlpha / viewport[2]);\n\n      // same side of the terrain\n      if (groundRelative > 0.0) {\n        posView *= factor;\n      }\n      // opposite sides of the terrain\n      else {\n        posView /= factor;\n      }\n    }\n\n    return groundRelative;\n  }\n\n  /**\n   * Project the 3d position of a HUD object from world space to clip space. In addition\n   * to standard model view projection, it also emulates a polygon offset to\n   * help with points above/below ground and icon flickering. The resulting location\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\n   * visibility of the HUD object. Note that the returned projected position is not\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - position: contains the point world position\n   *     - normal: contains the world normal pointing up at the point\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - model: the object -> world transformation matrix\n   *     - modelNormal: the object -> world normal transformation matrix (inv transp of model)\n   *     - view: the world -> view transformation matrix\n   *     - viewNormal: the world -> view normal transformation matrix (inv transp of view)\n   *     - proj: the view -> clip projection matrix\n   *     - verticalOffset: a vec4 containing:\n   *         - the screen height of the vertical offset\n   *         - the screen height of the vertical offset as a fraction of camera distance.\n   *         - the minimum world size vertical offset.\n   *         - the maximum world size vertical offset.\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\n   *     - screenSizePerspectiveAlignment: a vec3 containing\n   *         - the view distance dependent divisor\n   *         - the view distance dependent offset\n   *         - the minimum pixel size\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - camPos: the position of the camera in world space\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\n    // centerOffset is in view space and is used to implement world size offsetting\n    // of labels with respect to objects. It also pulls the label towards the viewer\n    // so that the label is visible in front of the object.\n    vec3 centerOffset = $auxpos1.xyz;\n\n    // The pointGroundDistance is the distance of the geometry to the ground and is\n    // negative if the point is below the ground, or positive if the point is above\n    // ground.\n    float pointGroundDistance = $auxpos1.w;\n\n    aux.posModel = (model * vec4($position, 1.0)).xyz;\n    aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n    aux.vnormal = (modelNormal * vec4($normal, 1.0)).xyz;\n\n    // Screen sized offset in world space, used for example for line callouts\n    // Note: keep this implementation in sync with the CPU implementation, see\n    //   - MaterialUtil.verticalOffsetAtDistance\n    //   - HUDMaterial.applyVerticalOffsetTransformation\n\n    aux.distanceToCamera = length(aux.posView);\n\n    vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n    float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n    aux.absCosAngle = abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n    vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n    float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n    float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n    vec3 modelOffset = aux.vnormal * worldOffset;\n\n    aux.posModel += modelOffset;\n\n    vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n    aux.posView += viewOffset;\n\n    // Since we elevate the object, we need to take that into account\n    // in the distance to ground\n    pointGroundDistance += worldOffset;\n\n#endif\n\n    float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n    aux.posView += vec3(centerOffset.x, centerOffset.y, 0);\n\n    // Same material all have same z != 0.0 condition so should not lead to\n    // branch fragmentation and will save a normalization if it\'s not needed\n    if (centerOffset.z != 0.0) {\n      aux.posView -= normalize(aux.posView) * centerOffset.z;\n    }\n#endif\n\n    vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n    float centerOffsetY = centerOffset.y;\n#endif\n\n    posProj.xy += vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n    // constant part of polygon offset emulation\n    posProj.z -= groundRelative * polygonOffset * posProj.w;\n\n    return posProj;\n  }\n\n  uniform float uRenderTransparentlyOccludedHUD;\n\n  /**\n   * Test for visibility of a HUD object.\n   *\n   * Dependencies:\n   *\n   *   Uniforms:\n   *     - hudVisibilityTexture: the texture that contains the visibility information\n   *     - markerColor: the special marker color that is used to write visibility information\n   *     - viewport: the viewport\n   */\n  bool testVisibilityHUD(vec4 posProj) {\n    // For occlusion testing, use the nearest pixel center to avoid\n    // subpixel filtering messing up the color we use to test for\n    vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n    vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n    // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n    // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n    // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n    // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n    if (uRenderTransparentlyOccludedHUD > 0.5) {\n      // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n      // uRenderTransparentlyOccludedHUD = 0.75\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n    }\n    // and visible pixels that are not occluded by semi-transparent geometry here\n    else {\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n\n    // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r > 0.0;\n  }\n]]></snippet>\n\n</snippets>\n'},1612:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="alignToPixelCenter"><![CDATA[\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1), bias towards right pixel edge\n    vec2 xy = vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz = vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel center\n    vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]></snippet>\n\n<snippet name="alignToPixelOrigin"><![CDATA[\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1),\n    vec2 xy = vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz = vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel border, (0 : 1)\n    vec2 ij = floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]></snippet>\n\n<snippet name="float2rgba"><![CDATA[\n  // This is the maximum float value representable as 32bit fixed point,\n  // it is rgba2float(vec4(1)) inlined.\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n  const vec4 fixedPointFactors = vec4(1, 256, 256 * 256, 256 * 256 * 256);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n]]></snippet>\n\n<snippet name="rgba2float"><![CDATA[\n  // Factors to convert rgba back to float\n  const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\n\n  float rgba2float(vec4 rgba) {\n    // Convert components from 0->1 back to 0->255 and then\n    // add the components together with their corresponding\n    // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n    return dot(rgba, rgba2float_factors);\n  }\n]]></snippet>\n\n<snippet name="calcFragDepth"><![CDATA[\n  float calcFragDepth(const in float depth) {\n    //calc polygon offset\n    const float SLOPE_SCALE = 2.0;\n    const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n    float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n    float result = depth + SLOPE_SCALE * m + BIAS;\n    return clamp(result, .0, .999999);\n  }\n]]></snippet>\n\n<snippet name="evalShadow"><![CDATA[\n  $rgba2float\n\n  // "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n  // once IE11 is fine with it, const should probably be re-introduced\n  float evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n    //choose correct cascade\n    int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n    if (i >= num) return .0;\n\n    mat4 mat = i == 0 ? matrix[0] : i == 1 ? matrix[1] : i == 2 ? matrix[2] : matrix[3];\n\n    vec4 lv = mat * vec4(vpos, 1.0);\n    lv.xy /= lv.w;\n\n    //vertex completely outside? -> no shadow\n    vec3 lvpos = .5 * lv.xyz + vec3(.5);\n    if (lvpos.z >= 1.0) return .0;\n    if (lvpos.x < .0 || lvpos.x > 1.0 || lvpos.y < .0 || lvpos.y > 1.0) return .0;\n\n    //calc coord in cascade texture\n    vec2 uv = vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n    float texSize = .5 / halfPxSz;\n\n    //filter, offset by half pixels\n    vec2 st = fract((vec2(halfPxSz) + uv) * texSize);\n\n    float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n\n    return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n  }\n]]></snippet>\n\n\n\x3c!--\n  Scene Lighting Definitions:\n  ================================================\n\n  defines:\n    - SH_ORDER: 1|2|3\n  input:\n    - normal: vec3\n    - albedo: vec3\n    - shadow: float\n    - ssao: float\n  return:\n    - color: vec3\n--\x3e\n<snippet name="sceneLightingDefinitions"><![CDATA[\n  $viewingMode\n\n  // main light\n  /////////////////////////////////////////\n  uniform vec3 lightingMainDirection;\n  uniform vec3 lightingMainIntensity;\n\n  // ambient lighting\n  /////////////////////////////////////////\n  #ifndef SH_ORDER\n    #define SH_ORDER 2\n  #endif\n\n  #if SH_ORDER == 0\n    uniform vec3 lightingAmbientSH0;\n  #elif SH_ORDER == 1\n    uniform vec4 lightingAmbientSH_R;\n    uniform vec4 lightingAmbientSH_G;\n    uniform vec4 lightingAmbientSH_B;\n  #elif SH_ORDER == 2\n    uniform vec3 lightingAmbientSH0;\n    uniform vec4 lightingAmbientSH_R1;\n    uniform vec4 lightingAmbientSH_G1;\n    uniform vec4 lightingAmbientSH_B1;\n    uniform vec4 lightingAmbientSH_R2;\n    uniform vec4 lightingAmbientSH_G2;\n    uniform vec4 lightingAmbientSH_B2;\n  #endif\n\n  // special tweaking\n  //////////////////////////////////////////\n  uniform float lightingFixedFactor;\n  uniform float lightingGlobalFactor;\n\n  uniform float ambientBoostFactor;\n\n  // evaluation\n  //////////////////////////////////////////\n\n  vec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n    // evaluate the main light\n    float dotVal = mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\n    vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n    // evaluate the sh ambient light\n    #if SH_ORDER == 0\n      vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n    #elif SH_ORDER == 1\n      vec4 sh0 = vec4(\n        0.282095,\n        0.488603 * normal.x,\n        0.488603 * normal.z,\n        0.488603 * normal.y\n      );\n      vec3 ambientLight = vec3(\n        dot(lightingAmbientSH_R, sh0),\n        dot(lightingAmbientSH_G, sh0),\n        dot(lightingAmbientSH_B, sh0)\n      );\n    #elif SH_ORDER == 2\n      vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n      vec4 sh1 = vec4(\n        0.488603 * normal.x,\n        0.488603 * normal.z,\n        0.488603 * normal.y,\n        1.092548 * normal.x * normal.y\n      );\n      vec4 sh2 = vec4(\n        1.092548 * normal.y * normal.z,\n        0.315392 * (3.0 * normal.z * normal.z - 1.0),\n        1.092548 * normal.x * normal.z,\n        0.546274 * (normal.x * normal.x - normal.y * normal.y)\n      );\n      ambientLight += vec3(\n        dot(lightingAmbientSH_R1, sh1),\n        dot(lightingAmbientSH_G1, sh1),\n        dot(lightingAmbientSH_B1, sh1)\n      );\n      ambientLight += vec3(\n        dot(lightingAmbientSH_R2, sh2),\n        dot(lightingAmbientSH_G2, sh2),\n        dot(lightingAmbientSH_B2, sh2)\n      );\n    #endif\n    ambientLight *= (1.0 - ssao);\n\n    // inverse gamma correction on the albedo color\n    float gamma = 2.1;\n    vec3 albedoGammaC = pow(albedo, vec3(gamma));\n\n    // physically correct BRDF normalizes by PI\n    const float PI = 3.14159;\n    vec3 totalLight = mainLight + ambientLight + additionalLight;\n    totalLight = min(totalLight, vec3(PI, PI, PI));\n    vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n    // apply gamma correction to the computed color\n    outColor = pow(outColor, vec3(1.0/gamma));\n\n    return outColor;\n  }\n\n]]></snippet>\n\n<snippet name="sceneLightingAdditionalLightGlobal"><![CDATA[\n  vec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n    // heuristic lighting model originally used in the terrain shading\n    // now used to generated additional ambient light\n\n#ifdef VIEWING_MODE_GLOBAL\n\n      float vndl = -dot(normalize(worldPos), lightingMainDirection);\n\n#else\n\n      float vndl = -dot(vec3(0,0,1), lightingMainDirection);\n\n#endif\n\n    additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n  }\n]]></snippet>\n\n<snippet name="normal2envTC"><![CDATA[\n  vec2 normal2envTC(vec3 normal) {\n    float v = .5 + .5 * asin(normal.y) * 0.63661977;\n    float u = .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\n    return vec2(u, v);\n  }\n]]></snippet>\n\n<snippet name="vertexShaderShowDepth"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = proj * vec4($position.x, $position.y, .0, 1.0);\n    vtc = $uv0;\n  }\n]]></snippet>\n\n  <snippet name="fragmentShaderShowDepth"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D depthTex;\n  varying vec2 vtc;\n  $rgba2float\n  void main() {\n  // gl_FragColor = vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\n     gl_FragColor = vec4(rgba2float(texture2D(depthTex, vtc)));\n  // gl_FragColor = texture2D(depthTex, vtc);\n  }\n]]></snippet>\n\n<snippet name="vsUVQuad"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position.x, $position.y, .0, 1.0);\n    uv = $position * .5 + vec2(.5);\n  }\n]]></snippet>\n\n<snippet name="toScreenCoords"><![CDATA[\n  vec4 toScreenCoords(vec3 vertex) {\n    vec4 vClipSpace = proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n    vClipSpace.xy *= screenSize;\n    return vClipSpace/abs(vClipSpace.w);\n  }\n]]></snippet>\n\n<snippet name="vvUniforms"><![CDATA[\n#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotation;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n]]></snippet>\n\n<snippet name="vvFunctions"><![CDATA[\n// Evaluation of size\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    // Normal transform is the inverse transpose of model transform\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n]]></snippet>\n\n<snippet name="rgb2hsv"><![CDATA[\nvec3 rgb2hsv(vec3 c)\n{\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n]]></snippet>\n\n<snippet name="hsv2rgb"><![CDATA[\nvec3 hsv2rgb(vec3 c)\n{\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]></snippet>\n\n<snippet name="colorMixMode"><![CDATA[\n$rgb2hsv\n$hsv2rgb\n\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a == 0.0) {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n  else if (symbolColor.a <= maxTint) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a <= maxReplace) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n\n]]></snippet>\n\n<snippet name="highlightWrite"><![CDATA[\n  // the following uniforms are common to all highlight shaders:\n  // uniform sampler2D depthTex\n  // uniform vec4 highlightViewportPixelSz\n  float sceneDepth = texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n  if (gl_FragCoord.z > sceneDepth + 5e-6) {\n    gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="screenSizePerspective"><![CDATA[\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding = 2 * factor.w\n  //   minSize = factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size > 0, and 0 otherwise\n  float nonZeroSize = 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -> 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n#endif\n]]></snippet>\n\n<snippet name="computeNormal"><![CDATA[\n  #ifdef GROUND_NORMAL_SHADING\n    #ifdef VIEWING_MODE_GLOBAL\n      vec3 normal = normalize(vpos + localOrigin);\n    #else\n      vec3 normal = vec3(0,0,1);\n    #endif\n  #else\n    // compute normal\n    #ifdef DOUBLESIDED\n      vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal = vnormal;\n    #endif\n    normal = normalize(normal);\n  #endif\n]]></snippet>\n\n<snippet name="decodeNormal"><![CDATA[\nvec3 decodeNormal(vec2 f)\n{\n    float z = 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n]]></snippet>\n\n</snippets>\n'},1613:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1614),n(1505),n(1502),n(1491),n(1499),n(1487),n(1494),n(1494)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){var u=[{name:l.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:20,normalized:!1},{name:l.VertexAttrConstants.UV0,count:2,type:5126,offset:12,stride:20,normalized:!1}],p={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,polygonOffset:!1},h=function(e){function t(t,n){var r=e.call(this,n)||this;return r.canBeMerged=!1,r.params=c.copyParameters(t,p),r}return n(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{size:e.size,color1:e.color1,color2:e.color2,transparent:e.transparent,polygonOffset:e.polygonOffset}},t.prototype.setParameterValues=function(e){c.updateParameters(this.params,e)&&this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 5*e},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return u},t.prototype.fillInterleaved=function(e,t,n,r,i,a){d.fillInterleaved(e,t,n,r,u,i,a)},t.prototype.intersect=function(e,t,n,r,i,a,o,s){return d.intersectTriangleGeometry(e,t,n,r,i,a,o)},t.prototype.getGLMaterials=function(){return{color:f,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,n){e._parse(r);var i=new s("checker-board",["vsCheckerBoard","fsCheckerBoard"],null,t,e,n);t.addShaderVariations("checker-board-material-shader-variations",i)},t}(a),f=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.programRep=n,i.params=c.copyParameters(t.getParams()),i.selectProgram(),i}return n(t,e),t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("checker-board-material-shader-variations",[])},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.transparent?o.TRANSPARENT_MATERIAL:o.OPAQUE_MATERIAL)},t.prototype.getProgram=function(){return this.program},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t.prototype.bind=function(e,t){var n=this.program;e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!1),e.setFaceCullingEnabled(!1),this.params.transparent&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),this.params.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-25)),e.bindProgram(n),n.setUniform2fv("size",this.params.size),n.setUniform4fv("color1",this.params.color1),n.setUniform4fv("color2",this.params.color2)},t.prototype.bindView=function(e,t){var n=t.origin,r=this.getProgram();c.bindView(n,t.view,r)},t.prototype.bindInstance=function(e,t){this.getProgram().setUniformMatrix4fv("model",t.transformation)},t.prototype.release=function(e){e.setDepthWriteEnabled(!0),this.params.transparent&&e.setBlendingEnabled(!1),this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1)},t}(i);return h}.apply(null,r))||(e.exports=i)},1614:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsCheckerBoard"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  varying vec2 vUV;\n\n  void main(void) {\n    vUV = $uv0;\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fsCheckerBoard"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  uniform vec2 size;\n  uniform vec4 color1;\n  uniform vec4 color2;\n\n  varying vec2 vUV;\n\n  void main() {\n    vec2 uvScaled = vUV / (2.0 * size);\n\n    vec2 uv = fract(uvScaled - 0.25);\n    vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n    float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n    float t = mix(abs(ab.x + ab.y), 0.5, fade);\n\n    gl_FragColor = mix(color2, color1, t);\n  }\n]]></snippet>\n</snippets>\n'},1615:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderColorMaterial"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  attribute vec3 $position;\n#ifdef VERTEXCOLORS\n  attribute vec4 $color;\n\n  varying vec4 vColor;\n#endif\n\n  void main(void) {\n#ifdef VERTEXCOLORS\n    vColor = $color * 0.003921568627451; // = 1/255;\n#endif\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderColorMaterial"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 eColor;\n#ifdef VERTEXCOLORS\n  varying vec4 vColor;\n#endif\n\n  void main() {\n#ifdef VERTEXCOLORS\n    gl_FragColor = vColor * eColor;\n#else\n    gl_FragColor = eColor;\n#endif\n  }\n]]></snippet>\n</snippets>\n'},1616:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="calculateVerticalOffset"><![CDATA[\n  $viewingMode\n\n#ifdef VERTICAL_OFFSET\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspectiveAlignment;\n\n  $screenSizePerspective\n\n#endif\n\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n    float viewDistance = length((view * vec4(worldPos, 1)).xyz);\n    float verticalOffsetOffsetDistance = verticalOffset.x * viewDistance;\n\n#ifdef VIEWING_MODE_GLOBAL\n    vec3 worldNormal = normalize(worldPos + localOrigin);\n#else\n    vec3 worldNormal = vec3(0, 0, 1);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n\n    float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n    float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n    // Screen sized offset in world space, used for example for line callouts\n    float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n    return worldNormal * worldOffset;\n  }\n#endif\n]]>\n</snippet>\n\n<snippet name="vsViewInputs"><![CDATA[\n  uniform mat4 proj;\n  uniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\n  uniform vec3 viewOriginHi;\n  uniform vec3 viewOriginLo;\n#endif\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n]]>\n</snippet>\n\n<snippet name="vsTransformInputs"><![CDATA[\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\n  attribute vec3 modelOriginHi;\n  attribute vec3 modelOriginLo;\n  attribute mat3 model;\n  attribute mat3 modelNormal;\n#else\n  attribute mat4 model;\n  attribute mat4 modelNormal;\n#endif\n#else /* INSTANCED */\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif /* INSTANCED */\n]]>\n</snippet>\n\n<snippet name="vsLocalPosition"><![CDATA[\n#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition($position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4($position, 1.0); }\n#endif\n]]>\n</snippet>\n\n<snippet name="vsLocalNormal"><![CDATA[\n  $decodeNormal\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute); }\n# else\nvec4 localNormal() { return vvTransformNormal($normal, instanceFeatureAttribute); }\n# endif\n#else\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vec4(decodeNormal($normalCompressed), 1.0); }\n# else\nvec4 localNormal() { return vec4($normal, 1.0); }\n# endif\n#endif\n]]>\n</snippet>\n\n<snippet name="vsLocalCenter"><![CDATA[\n#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\n# endif\n#endif\n]]>\n</snippet>\n\n<snippet name="doublePrecisionArithmethic"><![CDATA[\n// based on https://www.thasler.com/blog/blog/glsl-part2-emu\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 = hiA + hiB;\n  vec3 e = t1 - hiA;\n  vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n]]>\n</snippet>\n\n\x3c!-- Keep is synchronized with the logic in Material.js:isVisible --\x3e\n<snippet name="externalColorMix"><![CDATA[\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n  #if defined(VERTEXCOLORS)\n      // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #else\n      // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #endif\n  albedo_+= 0.25 * specular; // don\'t completely ignore specular for now\n]]></snippet>\n\n<snippet name="calcMipMapLevel"><![CDATA[\n  float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n    // from:\n    //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n    //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n    //   - http://www.linedef.com/virtual-texture-demo.html\n    float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n    return max(0.0, 0.5 * log2(deltaMaxSqr));\n  }\n]]></snippet>\n\n<snippet name="coverageCorrectionFactor"><![CDATA[\n  // base on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\n  float coverageCorrectionFactor(vec2 uv) {\n#ifdef ALPHA_COVERAGE_CORRECTION\n    const float MipScale = 0.25;\n    uv *= texSize;\n    return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\n#else\n    return 1.0;\n#endif\n  }\n]]></snippet>\n\n<snippet name="alphaThreshold"><![CDATA[\n#ifdef ALPHA_COVERAGE_CORRECTION\n  #define ALPHA_THRESHOLD 0.5\n#else\n  #define ALPHA_THRESHOLD 0.33\n#endif\n]]></snippet>\n\n<snippet name="vsPhongSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n#ifdef INSTANCEDCOLOR\n  attribute vec4 instanceColor;\n#endif\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vpos;\n  varying vec3 vnormal;\n\n#ifdef COMPONENTCOLORS\n  uniform sampler2D uComponentColorTex;\n  uniform vec2 uComponentColorTexInvDim;\n\n  attribute float $componentIndex;\n\n  vec4 readComponentColor() {\n    float normalizedIndex = ($componentIndex + 0.5) * uComponentColorTexInvDim.x;\n    vec2 indexCoord = vec2(\n      mod(normalizedIndex, 1.0),\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n    );\n    return texture2D(uComponentColorTex, indexCoord);\n  }\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\n  attribute vec4 $color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  attribute vec4 $symbolColor;\n#endif\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n\n$vvUniforms\n\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n\n  // Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n  // We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n  // there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n  // since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n  // This should be further cleaned up later with through the following issue:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\n  uniform vec4 externalColor;\n  varying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n  $vvFunctions\n\n  $colorMixMode\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalNormal\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vpos = model * localPosition().xyz ;\n    vnormal = normalize(modelNormal * localNormal().xyz);\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vpos = (model * localPosition()).xyz;\n    vnormal = normalize((modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\n    // passed as varying to properly drive the cascading shadow map index.\n    linearDepth = gl_Position.w;\n#endif\n\n#ifdef VERTEXCOLORS\n    vcolor = $color * 0.003921568627451; // = 1/255\n#endif\n\n    vcolorExt = externalColor;\n\n#ifdef INSTANCEDCOLOR\n    vcolorExt *= instanceColor;\n#endif\n#ifdef VV_COLOR\n    vcolorExt *= vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n    int symbolColorMixMode;\n    vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n    colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n#ifdef COMPONENTCOLORS\n    int symbolColorMixMode;\n    vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n    colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n]]></snippet>\n\n<snippet name="fsPhongSrc"><![CDATA[\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n  $sceneLightingDefinitions\n  $sceneLightingAdditionalLightGlobal\n\n  // material parameters\n  //////////////////////////////////////////\n  uniform vec3 ambient;\n  uniform vec3 diffuse;\n  uniform vec3 specular;\n  uniform float opacity;\n  uniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\n  uniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  uniform sampler2D depthTex;\n  uniform int shadowMapNum;\n  uniform vec4 shadowMapDistance;\n  uniform mat4 shadowMapMatrix[4];\n  uniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\n  uniform sampler2D ssaoTex;\n  uniform vec4 viewportPixelSz;\n#endif\n\n\n  varying vec3 vpos;\n  varying vec3 vnormal;\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n  varying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n  $evalShadow\n#endif\n\n  $colorMixMode\n\n  void main() {\n    vec3 viewDir = normalize(vpos - camPos);\n\n    $computeNormal\n\n    vec3 reflDir = normalize(reflect(viewDir, normal));\n\n    // compute ssao\n    #ifdef RECEIVE_SSAO\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n    #else\n        float ssao = 1.0;\n    #endif\n\n    // At global scale we create some additional ambient light based on the main light to simulate global illumination\n    float additionalAmbientScale;\n    vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n    // compute shadowing\n    float shadow = 0.0;\n    #ifdef RECEIVE_SHADOWS\n      shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n    #elif defined(VIEWING_MODE_GLOBAL)\n      // at global scale (and in global scenes) we fall back to this approximation\n      // to shadow objects on the dark side of the earth\n      shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n    #endif\n\n\n]]></snippet>\n\n<snippet name="vsPhong"><![CDATA[\n  $vsprecisionf\n\n  $vsPhongSrc\n  }\n]]></snippet>\n\n<snippet name="fsPhong"><![CDATA[\n    $fsprecisionf\n\n    $fsPhongSrc\n\n    vec4 texColor = vec4(1,1,1,1);\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsPhongTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\n  }\n]]></snippet>\n\n<snippet name="fsPhongTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsPhongSrc\n\n    // read texture color\n    vec4 texColor = texture2D(tex, vtc);\n    if (texColor.a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsPhongAtlasTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec4 $uv0;\n  attribute vec4 $region;\n  varying vec2 vtc;\n  varying vec4 regionV;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc = $uv0.xy;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n    regionV = $region/65535.0;\n  }\n]]></snippet>\n\n<snippet name="fsPhongAtlasTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n  varying vec4 regionV;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsPhongSrc\n\n    vec2 uv = vtc;\n    uv = fract(uv);\n    //[umin, vmin, umax, vmax]\n\n    vec2 atlasScale = regionV.zw - regionV.xy;\n    uv = uv.xy * atlasScale + regionV.xy;\n\n    vec4 texColor;\n\n    // calculate derivative of continuous texture coordinate\n    // to avoid mipmapping artifacts caused by manual wrapping in shader\n    vec2 dUVdx = dFdx(vtc) * atlasScale;\n    vec2 dUVdy = dFdy(vtc) * atlasScale;\n\n    #ifdef GL_EXT_shader_texture_lod\n      #extension GL_EXT_shader_texture_lod : enable\n\n      // workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\n      // see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\n      const float epsilon = 1.0E-32;\n      float zeroUVShift = uv.x == 0.0 && uv.y == 0.0 ? epsilon : 0.0;\n\n      texColor = texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\n    #else\n      // use bias to compensate for difference in automatic vs desired mipmap level\n      vec2 dUVdxAuto = dFdx(uv);\n      vec2 dUVdyAuto = dFdy(uv);\n      float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n      float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n      texColor = texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\n    #endif\n\n    if (texColor.a * coverageCorrectionFactor(uv) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsDepthSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n  uniform vec2 nearFar;\n  attribute vec3 $position;\n  varying float depth;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz;\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    vec4 eye = view * vec4(vpos, 1);\n\n    gl_Position = proj * eye;\n    depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n]]></snippet>\n\n<snippet name="vsDepth"><![CDATA[\n  $vsprecisionf\n\n  $vsDepthSrc\n  }\n]]></snippet>\n\n<snippet name="vsDepthTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsDepthSrc\n#ifndef FLIPV\n        vtc = $uv0;\n#else\n        vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="vsNormalSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n  uniform mat4 viewNormal;\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vnormal;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalNormal\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz + modelOriginHi;\n    vnormal = normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n    vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1);\n]]></snippet>\n\n<snippet name="vsNormal"><![CDATA[\n  $vsprecisionf\n\n  $vsNormalSrc\n  }\n]]></snippet>\n\n<snippet name="vsNormalTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsNormalSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="vsHighlightSrc"><![CDATA[\n  $vsprecisionf\n\n  $vsViewInputs\n  $vsTransformInputs\n\n  attribute vec3 $position;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz;\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1);\n]]></snippet>\n\n<snippet name="vsHighlight"><![CDATA[\n  $vsHighlightSrc\n  }\n]]></snippet>\n\n<snippet name="vsHighlightTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsHighlightSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsDepthSrc"><![CDATA[\n  varying float depth;\n\n  void main() {\n]]></snippet>\n\n<snippet name="fsDepth"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  $calcFragDepth\n  $float2rgba\n  $fsDepthSrc\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n#else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsDepthTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n\n  $calcFragDepth\n  $float2rgba\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsDepthSrc\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n#else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsNormal"><![CDATA[\n  $fsprecisionf\n\n  varying vec3 vnormal;\n  void main() {\n    vec3 normal = normalize(vnormal);\n    if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n\n  }\n]]></snippet>\n\n<snippet name="fsNormalTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  varying vec3 vnormal;\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  void main() {\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n    vec3 normal = normalize(vnormal);\n    if (gl_FrontFacing == false) normal = -normal;\n#ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsHighlight"><![CDATA[\n  $fsprecisionf\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  void main() {\n    $highlightWrite\n  }\n]]></snippet>\n\n<snippet name="fsHighlightTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  void main() {\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $highlightWrite\n  }\n]]></snippet>\n\n</snippets>\n'},1617:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderLineCallout"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  attribute vec2 $uv0;\n\n  uniform float lineSize;\n  uniform vec2 pixelToNDC;\n  uniform float borderSize;\n  uniform vec2 screenOffset;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  $alignToPixelOrigin\n  $alignToPixelCenter\n\n  $projectPositionHUD\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 endPoint = projectPositionHUD(projectAux);\n\n#ifdef OCCL_TEST\n    if (!testVisibilityHUD(endPoint)) {\n      gl_Position = vec4(1e38, 1e38, 1e38, 1);\n    }\n    else {\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n      vec2 screenOffsetScaled = screenOffset;\n#endif\n\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * model * vec4($position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\n\n      vec4 startPoint = proj * vec4(posView, 1);\n\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n      endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n      startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n      vec4 projectedPosition = mix(startAligned, endAligned, $uv0.y);\n\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n\n#endif\n\n      float halfPixelSize = lineSizeScaled * 0.5;\n\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + $uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = ($uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n\n#ifdef OCCL_TEST\n    }\n#endif\n  }\n]]></snippet>\n\n<snippet><![CDATA[\n\n]]></snippet>\n\n<snippet name="fragmentShaderLineCallout"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n  uniform vec4 borderColor;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  void main() {\n    // Mix between line and border coverage offsets depending on whether we need\n    // a border (based on the sidedness).\n    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n    // Mix between border and line color based on the line coverage (conceptually the line\n    // blends on top of the border background).\n    //\n    // Anti-alias by blending final result using the full (including optional border) coverage\n    // and the color alpha\n    float borderAlpha = color.a * borderColor.a * coverage.y;\n    float colorAlpha = color.a * coverage.x;\n\n    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n    if (finalAlpha < 0.01) {\n      discard;\n    }\n\n#else\n\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n    // need to divide by finalAlpha). We avoid the division here by setting the\n    // appropriate blending function in the material.\n    vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n    gl_FragColor = vec4(finalRgb, finalAlpha);\n\n#endif\n\n  }\n]]></snippet>\n\n</snippets>\n'},1618:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1619),n(1488),n(1505),n(1502),n(1491),n(1499),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u){var p=i.vec3d,h=i.mat4d,f=[{name:c.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:c.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:c.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:c.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],v={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},g=function(e){function t(t,n){var r=e.call(this,n)||this;return r.params=d.copyParameters(t,v),r}return n(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{width:e.width,outlineSize:e.outlineSize,outlineColor:e.outlineColor,stripeLength:e.stripeLength,stripeEvenColor:e.stripeEvenColor,stripeOddColor:e.stripeOddColor,polygonOffset:e.polygonOffset}},t.prototype.setParameterValues=function(e){d.updateParameters(this.params,e)&&this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 2*(e/2+1)*9},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return f},t.prototype.fillInterleaved=function(e,t,n,r,i,a){var o=e.vertexAttr[c.VertexAttrConstants.POSITION].data,s=e.vertexAttr[c.VertexAttrConstants.NORMAL].data,l=o.length/3,v=e&&e.indices&&e.indices.position;v&&v.length!==2*(l-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var g=a+u.findAttribute(f,c.VertexAttrConstants.POSITION).offset/4,m=a+u.findAttribute(f,c.VertexAttrConstants.NORMAL).offset/4,w=a+u.findAttribute(f,c.VertexAttrConstants.UV0).offset/4,A=a+u.findAttribute(f,c.VertexAttrConstants.AUXPOS1).offset/4,C=y,O=b,R=_,E=x,P=S,T=0,D=0;D<l;++D){var I=3*D;if(p.set3(o[I],o[I+1],o[I+2],C),D<l-1){var M=3*(D+1);p.set3(o[M],o[M+1],o[M+2],O),p.set3(s[M],s[M+1],s[M+2],P),p.normalize(P),p.subtract(O,C,R),p.normalize(R),p.cross(P,R,E),p.normalize(E)}var L=p.dist(C,O);t&&n&&(h.multiplyVec3(t,C),h.multiplyVec3(t,O),h.multiplyVec3(n,E)),d.fill(C,0,i,g,void 0,3),g+=9,d.fill(C,0,i,g,void 0,3),g+=9,d.fill(E,0,i,m,void 0,3),m+=9,d.fill(E,0,i,m,void 0,3),m+=9,i[w]=T,i[w+1]=-1,i[w+=9]=T,i[w+1]=1,w+=9,D<l-1&&(T+=L)}for(D=0;D<l;++D)i[A]=T,i[A+=9]=T,A+=9},t.prototype.intersect=function(e,t,n,r,i,a,o,s){},t.prototype.getGLMaterials=function(){return{color:m,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,n){e._parse(r);var i=new l("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,t,e,n);t.addShaderVariations("measurement-arrow-material-shader-variations",i)},t}(o),m=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.params=d.copyParameters(t.getParams()),i.selectProgram(),i}return n(t,e),t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",[])},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===s.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t.prototype.bind=function(e,t){var n=this.program;e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!0),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!1),this.params.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.bindProgram(n),n.setUniform1f("width",this.params.width),n.setUniform1f("outlineSize",this.params.outlineSize),n.setUniform4fv("outlineColor",this.params.outlineColor),n.setUniform1f("stripeLength",this.params.stripeLength),n.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor),n.setUniform4fv("stripeOddColor",this.params.stripeOddColor)},t.prototype.bindView=function(e,t){var n=t.origin,r=this.getProgram();d.bindView(n,t.view,r)},t.prototype.bindInstance=function(e,t){this.getProgram().setUniformMatrix4fv("model",t.transformation)},t.prototype.release=function(e){e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!0),e.setBlendingEnabled(!1),this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1)},t}(a),y=p.create(),b=p.create(),_=p.create(),x=p.create(),S=p.create(),w=h.create();return h.identity(w),g}.apply(null,r))||(e.exports=i)},1619:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsMeasurementArrow"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float width;\n\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec2 $uv0;\n  attribute float $auxpos1;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  void main(void) {\n    vec3 bitangent = $normal;\n\n    vtc = $uv0;\n    vlength = $auxpos1;\n    vradius = 0.5 * width;\n\n    vec4 pos = view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\n    gl_Position = proj * pos;\n  }\n]]></snippet>\n\n<snippet name="fsMeasurementArrow"><![CDATA[\n  $fsprecisionf\n\n  uniform float outlineSize;\n  uniform vec4 outlineColor;\n  uniform float stripeLength;\n  uniform vec4 stripeEvenColor;\n  uniform vec4 stripeOddColor;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\n\n  vec4 arrowColor(vec2 tc, float len) {\n    float d = INV_SQRT2 * (tc.x - abs(tc.y));\n    d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n    d = min(d, 1.0 - abs(tc.y));\n\n    if (d < 0.0) {\n      return vec4(0.0);\n    } else if (d < outlineSize) {\n      return outlineColor;\n    } else {\n      return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n    }\n  }\n\n  void main(void) {\n    vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n    vec4 color = arrowColor(ntc, vlength / vradius);\n    if (color.a == 0.0) {\n      discard;\n    }\n    gl_FragColor = color;\n  }\n\n]]></snippet>\n\n</snippets>\n'},1620:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRibbonLine"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float extLineWidth;\n  uniform float nearPlane;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  attribute vec4 $color;\n  varying vec4 vColor;\n\n  attribute float $size;\n\n#ifndef WALL\n  uniform float miterLimit;\n  attribute vec3 $auxpos1;\n  attribute vec3 $auxpos2;\n#endif\n\n#ifdef SCREENSCALE\n  uniform vec2 screenSize;\n  $toScreenCoords\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y > 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y < 0.0\n\n#endif //ifdef SCREENSCALE\n\n  float interp(float ncp, vec4 a, vec4 b) {\n    return (-ncp - a.z) / (b.z - a.z);\n  }\n\n#ifdef SCREENSCALE\n\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n    float vnp = nearPlane*0.99;\n\n    //We have four vertices per point on the line. Start and end vertices\n    //are treated differently --\x3e d > 0, d < 0\n    float d = abs($uv0.y) - 1.1;\n\n    //current pos behind ncp --\x3e we need to clip\n    if(pos.z > -nearPlane) {\n      if (d < 0.0) {\n        //previous in front of ncp\n        if(prev.z < -nearPlane) {\n          pos = mix(prev, pos, interp(vnp, prev, pos));\n          next = pos;\n        } else {\n          pos = vec4(0, 0, 0, 1);\n        }\n      }\n      //next in front of ncp\n      if(d > 0.0) {\n        if(next.z < -nearPlane) {\n          pos = mix(pos, next, interp(vnp, pos, next));\n          prev = pos;\n        } else {\n          pos = vec4(0, 0, 0, 1);\n        }\n      }\n    } else {\n      //current position visible\n      //previous behind ncp\n      if (prev.z > -nearPlane) {\n        prev = mix(pos, prev, interp(vnp, pos, prev));\n      }\n      //next behind ncp\n      if (next.z > -nearPlane) {\n        next = mix(next, pos, interp(vnp, next, pos));\n      }\n    }\n\n    pos= proj * pos;\n    pos.xy *= screenSize;\n    pos /= pos.w;\n\n    next = proj * next;\n    next.xy *= screenSize;\n    next /= next.w;\n\n    prev = proj * prev;\n    prev.xy *= screenSize;\n    prev /= prev.w;\n  }\n\n#endif // SCREENSCALE\n\n  void main(void) {\n\n#ifdef SCREENSCALE\n  // Check for special value of uv0.y which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just\n  // project outside of clip space.\n  if ($uv0.y == 0.0) {\n    // Project out of clip space\n    gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  else {\n#endif\n\n  float lineWidth = extLineWidth + $size;\n\n#ifdef SCREENSCALE\n\n#if 0\n    vec4 pos = toScreenCoords($position.xyz);\n    vec2 left = (pos - toScreenCoords($auxpos1)).xy;\n    vec2 right = (toScreenCoords($auxpos2) - pos).xy;\n#else\n    vec4 pos  = view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\n    vec4 prev = view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\n    vec4 next = view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\n\n    clipAndTransform(pos, prev, next);\n\n    vec2 left = (pos - prev).xy;\n    vec2 right = (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n    vec4 pos = vec4($position, 1.0);\n#ifndef WALL\n    vec3 left = $position.xyz - $auxpos1;\n    vec3 right = $auxpos2 - $position.xyz;\n    vec3 up = normalize($position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n    float displacementLen = lineWidth;\n    vec3 displacementDir = normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n    float leftLen = length(left);\n    left = (leftLen > 0.001) ? left/leftLen : ZEROVEC;\n\n    float rightLen = length(right);\n    right = (rightLen > 0.001) ? right/rightLen : ZEROVEC;\n\n    // determine if vertex is on the "outside or "inside" of the join\n    bool isOutside = ISOUTSIDE;\n\n    // compute miter join position first\n    float displacementLen = lineWidth;\n    VECTYPE displacementDir = normalize(left + right);\n    displacementDir = PERPENDICULAR(displacementDir);\n    if (leftLen > 0.001 && rightLen > 0.001) {\n      float nDotSeg = dot(displacementDir, left);\n      displacementLen /= length(nDotSeg*left - displacementDir);\n\n      // limit displacement of inner vertices\n      if (!isOutside) {\n        displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n      }\n    }\n\n    if (isOutside && (displacementLen > miterLimit*lineWidth)) {\n      // convert to bevel join if miterLimit is exceeded\n      if (leftLen < 0.001) {\n        displacementDir = right;\n      }\n      else if (rightLen < 0.001) {\n        displacementDir = left;\n      }\n      else {\n        displacementDir = (abs($uv0.y) - 1.1 < 0.0) ? left : right;\n      }\n      displacementDir = normalize(displacementDir);\n      displacementDir = PERPENDICULAR(displacementDir);\n      displacementLen = lineWidth;\n    }\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n    pos.xy += displacementDir * floor($uv0.y + 0.5) * displacementLen;\n    pos.xy /= screenSize;\n#else\n    pos.xyz += displacementDir * floor($uv0.y + 0.5) * displacementLen;\n    pos = proj * view * model * pos;\n#endif\n\n    vtc = $uv0;\n    vColor = $color * 0.003921568627451; // = 1/255\n    gl_Position = pos;\n\n#ifdef SCREENSCALE\n    }\n#endif\n  }\n]]></snippet>\n\n\n<snippet name="fsRibbonLine"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 eColor;\n  varying vec4 vColor;\n  varying vec2 vtc;\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n  void main() {\n\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor = eColor * vColor;\n  }\n]]></snippet>\n\n<snippet name="fsRibbonLineHighlight"><![CDATA[\n  $fsprecisionf\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n  void main() {\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n  }\n]]></snippet>\n\n</snippets>\n'},1621:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1622),n(1492),n(1493)],void 0===(i=function(e,t,n,r,i){return function(){function e(){}return e.loadShaders=function(e,t,a){e._parse(n);var o=new i(a,e.vertexShaderBlendLayers,e.fragmentShaderBlendLayers,r.Default3D);t.add("blendLayers",o)},e}()}.apply(null,r))||(e.exports=i)},1622:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderBlendLayers"><![CDATA[\n  $vsprecisionf\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  uniform float scale;\n  uniform vec2 offset;\n\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position, 1.0);\n    uv = $uv0 * scale + offset;;\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderBlendLayers"><![CDATA[\n  $fsprecisionf\n\n  varying vec2 uv;\n\n  uniform sampler2D tex;\n  uniform float opacity;\n\n  void main() {\n    vec4 color = texture2D(tex, uv);\n\n    // Note: output in pre-multiplied alpha for correct alpha compositing\n    gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n  }\n]]></snippet>\n\n</snippets>\n'},1623:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1624),n(1492),n(1491),n(1494),n(1493)],void 0===(i=function(e,t,n,r,i,a,o){return function(){function e(e,t,n,r){void 0===r&&(r=4),this.program=e.get("simple"),this.color=t,this.depthFunc=n,this.drawMode=r}return e.prototype.beginSlot=function(e){return e===i.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",a.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",this.color),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){a.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return this.drawMode},e.loadShaders=function(e,t,i){e._parse(n);var a=new o(i,e.vertexShaderSimple,e.fragmentShaderSimple,r.Default3D);t.add("simple",a)},e}()}.apply(null,r))||(e.exports=i)},1624:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderSimple"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n  attribute vec3 $position;\n\n  void main(void) {\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderSimple"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n\n  void main() {\n    gl_FragColor = color;\n  }\n]]></snippet>\n</snippets>\n'},1625:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(11),n(1510),n(1517),n(1488),n(1537),n(1487),n(1626)],void 0===(i=function(e,t,n,r,i,a,o,s,l){var c=2e4,d=[0,0],u=a.mat4d.create(),p=[r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create()],h=n("dojo-debug-messages");return function(){function e(e,t,n,r,s){this._content=new Map,this._frustumCullingEnabled=!0,this._maxFarNearRatio=c,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=s,this._gl=s.gl,this._visualizer=new l(e,t,n,r,this._rctx),this._camera=new i(a.vec3.createFrom(0,100,-100),a.vec3.createFrom(0,0,0)),h&&(this._stats.visualizerRenderTimer=new o(10),this._stats.viewportRenderTimer=new o(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var n in t)e[n]=t[n];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,h&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var r=this._gl.getUsedTextureMemoryStats();for(var i in r)e["texMem type: "+i]=r[i]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.getViewParams=function(e){var t=this._visualizer.getViewParams(e);return e&&!e.frustumCullingEnabled||(t.frustumCullingEnabled=this._frustumCullingEnabled),e&&!e.maxFarNearRatio||(t.maxFarNearRatio=this._maxFarNearRatio),t},e.prototype.setViewParams=function(e){void 0!==e.frustumCullingEnabled&&(this._frustumCullingEnabled=e.frustumCullingEnabled),void 0!==e.maxFarNearRatio&&(-1===e.maxFarNearRatio?this._maxFarNearRatio=c:this._maxFarNearRatio=e.maxFarNearRatio),this._visualizer.setViewParams(e),this._needsRender=!0},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,n,r){this._visualizer.modify(e,t,n,r),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._updateNearFar(),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},e.prototype.getPickRay=function(e,t,n){return this.pickRayWithBeginPoint(e,void 0,this._camera.viewMatrix,t,n)},e.prototype.pickRayWithBeginPoint=function(e,t,n,r,i){return this._visualizer.getPickRay(e,t,this._camera,n,r,i)},e.prototype.addExternalRenderer=function(e,t){return this._visualizer.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){return this._visualizer.removeExternalRenderer(e)},e.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()},e.prototype.render=function(e,t){h&&this._stats.viewportRenderTimer.start(),this._updateNearFar(),h&&this._stats.visualizerRenderTimer.start(),this._visualizer.render(this._camera,e,t),h&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e.prototype._updateNearFar=function(){(this._frustumCullingEnabled||this._maxFarNearRatio>0)&&(d[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,d),this._maxFarNearRatio>0&&d[1]>0&&(this._camera.far=d[1],this._camera.near=Math.max(d[0],this._camera.far/this._maxFarNearRatio)))},e.prototype._computeFrustumCullingAndNearFar=function(e,t){var n=this;a.mat4d.perspective(this._camera.fovY,this._camera.aspect,1,10,u),s.matrixToFrustumPlanes(this._camera.viewMatrix,u,p),this._stats.renderGeometriesTotal=0,this._stats.renderGeometriesVisible=0;var r=-Number.MAX_VALUE,i=-Number.MAX_VALUE,o=p[0][0],l=p[0][1],c=p[0][2],d=p[0][3],h=p[1][0],f=p[1][1],v=p[1][2],g=p[1][3],m=p[2][0],y=p[2][1],b=p[2][2],_=p[2][3],x=p[3][0],S=p[3][1],w=p[3][2],A=p[3][3],C=p[4][0],O=p[4][1],R=p[4][2],E=p[4][3],P=p[5][3];this._content.forEach(function(e){n._stats.renderGeometriesTotal++;var t=e.center,a=t[0],s=t[1],u=t[2],p=e.bsRadius;if(!(o*a+l*s+c*u+d>p||h*a+f*s+v*u+g>p||m*a+y*s+b*u+_>p||x*a+S*s+w*u+A>p)){var E=C*a+O*s+R*u,P=E+p,T=-E+p;P>r&&(r=P),T>i&&(i=T),n._stats.renderGeometriesVisible++}});var T=r!==-Number.MAX_VALUE;r+=E,i+=P,this._stats.renderGeometriesVisible>0&&T&&(t[0]=.99*Math.max(1-r,2),t[1]=1.01*Math.max(10+i,t[0]+1))},e}()}.apply(null,r))||(e.exports=i)},1626:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1627),n(1512),n(1523),n(1628),n(1488),n(1546),n(1547),n(1540),n(1539),n(1507),n(1629),n(1548),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f){var v=o.vec3d,g=o.mat4d,m=f.assert;return function(){function e(e,t,n,r,i){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=i,this._renderer=new c(t,n,r,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new p(t,this._rctx),ssao:new h(t,r,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,r,this._rctx),renderOccluded:new d(t,r,this._rctx),offscreenRendering:new l(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.getViewParams=function(e){var t=e||{};return e&&!e.pixelRatio||(t.pixelRatio=this._renderer.getPixelRatio()),t},e.prototype.setViewParams=function(e){null!=e.pixelRatio&&this._renderer.setPixelRatio(e.pixelRatio)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return this._helpers.shadowMap.isSupported&&(e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades),this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.modify=function(e,t,n,r){this._renderer.modify(e,t,n,r);for(var i=0;i<t.length;++i)this._content.delete(t[i].uniqueName);for(i=0;i<e.length;++i)this._content.set(e[i].uniqueName,e[i]);for(i=0;i<n.length;++i)m(this._content.get(n[i].renderGeometry.uniqueName)===n[i].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getPickRay=function(e,t,n,r,i,a){v.unproject(v.createFrom(e[0],e[1],0),r,n.projectionMatrix,n.fullViewport,i),v.unproject(v.createFrom(e[0],e[1],1),r,n.projectionMatrix,n.fullViewport,a)},e.prototype.getProjectionMatrix=function(e,t,n,r,i){var a=f.fovx2fovy(t,e[2],e[3]);g.perspective(180*a/Math.PI,e[2]/e[3],n,r,i)},e.prototype.addExternalRenderer=function(e,t){return this._renderer.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){return this._renderer.removeExternalRenderer(e)},e.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e,t,i){var a=e.viewport;if(this._renderer.prepareRender(e),this._helpers.shadowMap.enabled){r.ENABLE_PROFILE_DEPTH_RANGE&&n.begin("depthRange");var o=this.computeDepthRange(e);r.ENABLE_PROFILE_DEPTH_RANGE&&n.end("depthRange"),this._helpers.shadowMap.prepare(e,t,this._content,o);for(var s=this._helpers.shadowMap.getCascades(),l=0;l<s.length;++l){var c=s[l];c.camera.setGLViewport(this._rctx),this._renderer.renderGeometryPass(u.MATERIAL_DEPTH_SHADOWMAP,c.camera)}this._helpers.shadowMap.finish(i),e.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,i,this._helpers),this._renderer.render(e,i,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var d=g.ortho(a[0],a[2],a[1],a[3],-1,1);this._helpers.shadowMap.drawDebugQuad(d)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){d=g.ortho(a[0],a[2],a[1],a[3],-1,1);this._helpers.ssao.drawQuad(d)}},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=a.depthRangeFromScene(e,this._content,this._stage.getLayers());return i.union(t,this.getExternalRenderers().queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,r))||(e.exports=i)},1627:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){var n=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in i||(i[t]=new e(t)),i[t]}function n(e){console.log(t(e).toJSON())}var r=1e3,i={},a={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,i){void 0===i&&(i=!0),t(e).end();var o=performance.now();!i||e in a&&!(o>=a[e]+r)||(n(e),a[e]=o)},e.log=n,e.logAll=function(){for(var e in i)n(e)}}(n||(n={})),n}.apply(null,r))||(e.exports=i)},1628:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1519),n(1559),n(1500),n(1523),n(1488),n(1487)],void 0===(i=function(e,t,n,r,i,a,o,s){function l(e,t){var n=a.empty(),r=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,n){var r=t.eye,i=t.viewForward,o=t.frustumPlanes,s=function(e){return!e.areAllComponentsHidden()},l=n.objectCount;if(l<f)a.set(w,t.near,Math.min(e.near,t.far)),n.forEachInDepthRange(r,i,"front-to-back",w,function(n,r){c(e,t,n),w.far=e.near,r.setRange(w)},o,s),a.set(w,Math.max(e.far,t.near),t.far),n.forEachInDepthRange(r,i,"back-to-front",w,function(n,r){c(e,t,n),w.near=e.far,r.setRange(w)},o,s);else{var d=Math.max(Math.min(l,v),Math.ceil(l*g)),p=n.findClosest(i,"front-to-back",o,s,d),h=n.findClosest(i,"back-to-front",o,s,d);p&&h&&(u(e,t,p.getCenter(),p.getBSRadius()),u(e,t,h.getCenter(),h.getBSRadius()))}}(n,e,t.getSpatialQueryAccelerator()):function(e,t,n){A.clear(),n.forEach(function(e){e.areAllComponentsHidden()||A.add(e)}),A.empty||(A.sort(t),a.set(w,t.near,Math.min(e.near,t.far)),A.forEachInDepthRange(w,"front-to-back",function(n,r,i){r<e.near&&c(e,t,n)}),a.set(w,Math.max(e.far,t.near),t.far),A.forEachInDepthRange(w,"back-to-front",function(t,n,r){e.far=Math.max(e.far,r)}))}(n,e,r),n}function c(e,t,n){if(!n.areAllComponentsHidden()&&r.frustumSphere(t.frustumPlanes,n.getCenter(),n.getBSRadius())){var i=n.objectTransformation,a=S;n.geometryRecords.forEach(function(n){o.mat4d.multiply(i,n.getShaderTransformation(),a);var r=o.mat4d.maxScale(a),s=n.geometry.getBoundingInfo();d(e,t,s,a,r)})}}function d(e,t,n,i,a){var s=t.eye,l=t.viewForward;o.mat4d.multiplyVec3(i,n.center,x);var c=l[0]*(x[0]-s[0])+l[1]*(x[1]-s[1])+l[2]*(x[2]-s[2]),u=n.bsRadius*a;if(!(c-u>e.near&&c+u<e.far)&&r.frustumSphere(t.frustumPlanes,x,u))if(n.bsRadius>h&&n.getChildren())for(var p=n.getChildren(),f=0;f<8;++f)p[f]&&d(e,t,p[f],i,a);else O.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,n.bbMin,n.bbMax)}function u(e,t,n,r){var i=t.eye,a=t.viewForward,o=(n[0]-i[0])*a[0]+(n[1]-i[1])*a[1]+(n[2]-i[2])*a[2];e.near=Math.min(e.near,o-r),e.far=Math.max(e.far,o+r)}Object.defineProperty(t,"__esModule",{value:!0});var p=1e4,h=100,f=500,v=500,g=.1;t.depthRangeFromScene=function(e,t,n){if(t.size<p)return C.compute(e,t);var r=a.empty();for(var i in n){var o=n[i];a.union(r,l(e,o))}return r},t.depthRangeFromLayer=l;var m=function(){function e(){this._items=new n({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,n=e.viewForward;this._items.forEach(function(e){var r=e.obj,i=r.getCenter(),a=r.getBSRadius(),o=(i[0]-t[0])*n[0]+(i[1]-t[1])*n[1]+(i[2]-t[2])*n[2];e.distance=o,e.near=o-a,e.far=o+a}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,n){if("front-to-back"===t)for(var r=0;r<this._items.length;++r){(i=this._items.data[r]).far<e.near||i.near>e.far||n(i.obj,i.near,i.far)}else for(r=this._items.length-1;r>=0;--r){var i;(i=this._items.data[r]).far<e.near||i.near>e.far||n(i.obj,i.near,i.far)}},e}(),y=function(){function e(){this.view=o.mat4d.create(),this.viewProj=o.mat4d.create(),this.planes=[o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create()],this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var n=this;this.reset(),o.mat4d.set(e.viewMatrix,this.view),o.mat4d.multiply(e.projectionMatrix,this.view,this.viewProj),e.copyFrustumPlanes(this.planes);var r=this.view,a=r[2],s=r[6],l=r[10],c=r[14],d=this.range,u=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;if(!i.isAllHidden(t,r)&&e.castShadow){var o,d;e.hasShaderTransformation?(o=e.getBoundingSphere(e.getShaderTransformation(),1,x),d=x):(o=e.bsRadius,d=e.center);var p=a*d[0]+s*d[1]+l*d[2]+c,h=p-o,f=p+o;n.geometries[u]=e,n.near[u]=-f,n.far[u]=-h,++u}}),0===this.geometries.length)return d;for(var p=0;p<this.geometries.length;++p)this.near[p]>d.far&&(d.far=this.near[p]),this.near[p]>2&&this.far[p]<d.near&&(d.near=this.far[p]);var h=this.looseRange;h.near=Math.max(.5*d.near,2),h.far=2*d.far;var f=0,v=0;for(p=0;p<this.geometries.length;++p)this.near[p]<d.near&&(this.near[p]>=h.near?d.near=this.near[p]:this.nearCandidates[f++]=p),this.far[p]>d.far&&(this.far[p]<=h.far?d.far=this.far[p]:this.farCandidates[v++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return d;this.nearCandidates.sort(function(e,t){return n.near[e]<n.near[t]?-1:n.near[e]>n.near[t]?1:0}),this.farCandidates.sort(function(e,t){return n.far[e]<n.far[t]?1:n.far[e]>n.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var g=this.nearCandidates[p];if(this.near[g]<d.near){var m=(y=this.geometries[g]).boundingInfo;this.includeNearBoundingInfoRec(m,y.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){g=this.farCandidates[p];if(this.far[g]>d.far){var y;m=(y=this.geometries[g]).boundingInfo;this.includeFarBoundingInfoRec(m,y.getShaderTransformation())}}return d},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var n=e.getBSRadius(),r=e.getCenter();o.mat4d.multiplyVec3(t,r,x);var i=o.mat4d.maxScale(t),a=x[0],s=x[1],l=x[2];if(n*=i,!(this.planes[0][0]*a+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>n||this.planes[1][0]*a+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>n||this.planes[2][0]*a+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>n||this.planes[3][0]*a+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>n)){var c=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14],d=c+n;if(!(-(c-n)<2||-d>=this.range.near)){if(-d>this.looseRange.near)return void(this.range.near=-d);if(n>h){var u=e.getChildren();if(void 0!==u){for(var p=0;p<8;++p)void 0!==u[p]&&this.includeNearBoundingInfoRec(u[p],t);return}}O.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var n=e.getBSRadius(),r=e.getCenter();o.mat4d.multiplyVec3(t,r,x);var i=o.mat4d.maxScale(t),a=x[0],s=x[1],l=x[2];if(n*=i,!(this.planes[0][0]*a+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>n||this.planes[1][0]*a+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>n||this.planes[2][0]*a+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>n||this.planes[3][0]*a+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>n)){var c=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14]-n;if(!(-c<=this.range.far)){if(-c<this.looseRange.far)return void(this.range.far=-c);if(n>h){var d=e.getChildren();if(void 0!==d){for(var u=0;u<8;++u)void 0!==d[u]&&this.includeFarBoundingInfoRec(d[u],t);return}}O.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var b=function(){function e(){this.modelViewProj=o.mat4d.create(),this.clipPosition=[o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create(),o.vec4d.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,n,r,i){var a=this.modelViewProj;o.mat4d.multiply(t,n,a);for(var s=!1,l=0;l<8;++l){var c=this.clipPosition[l],d=0===l||3===l||4===l||7===l?r[0]:i[0],u=0===l||1===l||4===l||5===l?r[1]:i[1],p=l<4?r[2]:i[2];c[0]=a[0]*d+a[4]*u+a[8]*p+a[12],c[1]=a[1]*d+a[5]*u+a[9]*p+a[13],c[2]=a[2]*d+a[6]*u+a[10]*p+a[14],c[3]=a[3]*d+a[7]*u+a[11]*p+a[15]}for(l=0;l<12;++l){for(var h=this.clipPosition[_[l][0]],f=this.clipPosition[_[l][1]],v=this.clipPosition[_[l][2]],g=this.clipTriangle(h,f,v),m=!0,y=0;y<g.length;++y){if((b=g[y][3])>=2){m=!1;break}}if(!m){s=!0;for(y=0;y<g.length;++y){var b;(b=g[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void s.assert(!1)},e.prototype.intersect=function(e,t,n){var r=0;return 0===n?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===n?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===n?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===n&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),o.vec4d.lerp(e,t,r,o.vec4d.create())},e.prototype.clipTriangle=function(e,t,n){for(var r=[e,t,n],i=0;i<4;++i){var a=r;r=[];for(var o=0;o<a.length;++o){var s=a[o],l=a[(o+1)%a.length];this.inside(l,i)?(this.inside(s,i)||r.push(this.intersect(s,l,i)),r.push(l)):this.inside(s,i)&&r.push(this.intersect(s,l,i))}}return r},e}(),_=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],x=o.vec3d.create(),S=o.mat4d.create(),w=a.empty(),A=new m,C=new y,O=new b}.apply(null,r))||(e.exports=i)},1629:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(1517),n(1492),n(1498),n(1488),n(1503),n(1487),n(1497),n(1495),n(1490),n(1489),n(1496)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h){function f(e,t,n,r,i,a,s,c){o.vec2d.set2(0,0,N);for(var d=0;d<4;++d)o.vec2d.add(N,e[d],N);o.vec2d.scale(N,.25),o.vec2d.set2(0,0,B);for(d=4;d<8;++d)o.vec2d.add(B,e[d],B);o.vec2d.scale(B,.25),o.vec2d.lerp(e[4],e[5],.5,j[0]),o.vec2d.lerp(e[5],e[6],.5,j[1]),o.vec2d.lerp(e[6],e[7],.5,j[2]),o.vec2d.lerp(e[7],e[4],.5,j[3]);var u=0,p=o.vec2d.dist2(j[0],N);for(d=1;d<4;++d){var h=o.vec2d.dist2(j[d],N);h<p&&(p=h,u=d)}o.vec2d.subtract(j[u],e[u+4],G);var f,v,g=G[0];G[0]=-G[1],G[1]=g,o.vec2d.subtract(B,N,H),o.vec2d.lerp(G,H,n),o.vec2d.normalize(G),f=v=o.vec2d.dot(o.vec2d.subtract(e[0],N,k),G);for(d=1;d<8;++d){var m=o.vec2d.dot(o.vec2d.subtract(e[d],N,k),G);m<f?f=m:m>v&&(v=m)}o.vec2d.set(N,r),o.vec2d.scale(G,f-t,k),o.vec2d.add(r,k,r);var y=-1,b=1,_=0,x=0;for(d=0;d<8;++d){o.vec2d.subtract(e[d],r,W),o.vec2d.normalize(W);var S=G[0]*W[1]-G[1]*W[0];S>0?S>y&&(y=S,_=d):S<b&&(b=S,x=d)}l.verify(y>0,"leftArea"),l.verify(b<0,"rightArea"),o.vec2d.scale(G,f,q),o.vec2d.add(q,N,q),o.vec2d.scale(G,v,$),o.vec2d.add($,N,$),X[0]=-G[1],X[1]=G[0];var w=l.rayRay2D(r,e[x],$,o.vec2d.add($,X,k),1,i),A=l.rayRay2D(r,e[_],$,k,1,a),C=l.rayRay2D(r,e[_],q,o.vec2d.add(q,X,k),1,s),O=l.rayRay2D(r,e[x],q,k,1,c);l.verify(w,"rayRay"),l.verify(A,"rayRay"),l.verify(C,"rayRay"),l.verify(O,"rayRay")}function v(e,t){return 3*t+e}function g(e,t){return o.vec3d.set3(e[t],e[t+3],e[t+6],Y),Y}function m(e,t,n,r,i){o.vec2d.scale(o.vec2d.subtract(n,r,Q),.5),Z[0]=Q[0],Z[1]=Q[1],Z[2]=0,Z[3]=Q[1],Z[4]=-Q[0],Z[5]=0,Z[6]=Q[0]*Q[0]+Q[1]*Q[1],Z[7]=Q[0]*Q[1]-Q[1]*Q[0],Z[8]=1,Z[v(0,2)]=-o.vec2d.dot(g(Z,0),e),Z[v(1,2)]=-o.vec2d.dot(g(Z,1),e);var a=o.vec2d.dot(g(Z,0),n)+Z[v(0,2)],s=o.vec2d.dot(g(Z,1),n)+Z[v(1,2)],l=o.vec2d.dot(g(Z,0),r)+Z[v(0,2)],c=o.vec2d.dot(g(Z,1),r)+Z[v(1,2)];a=-(a+l)/(s+c),Z[v(0,0)]+=Z[v(1,0)]*a,Z[v(0,1)]+=Z[v(1,1)]*a,Z[v(0,2)]+=Z[v(1,2)]*a,a=1/(o.vec2d.dot(g(Z,0),n)+Z[v(0,2)]),s=1/(o.vec2d.dot(g(Z,1),n)+Z[v(1,2)]),Z[v(0,0)]*=a,Z[v(0,1)]*=a,Z[v(0,2)]*=a,Z[v(1,0)]*=s,Z[v(1,1)]*=s,Z[v(1,2)]*=s,Z[v(2,0)]=Z[v(1,0)],Z[v(2,1)]=Z[v(1,1)],Z[v(2,2)]=Z[v(1,2)],Z[v(1,2)]+=1,a=-.5*((a=o.vec2d.dot(g(Z,1),t)+Z[v(1,2)])/(s=o.vec2d.dot(g(Z,2),t)+Z[v(2,2)])+(l=o.vec2d.dot(g(Z,1),n)+Z[v(1,2)])/(c=o.vec2d.dot(g(Z,2),n)+Z[v(2,2)])),Z[v(1,0)]+=Z[v(2,0)]*a,Z[v(1,1)]+=Z[v(2,1)]*a,Z[v(1,2)]+=Z[v(2,2)]*a,a=o.vec2d.dot(g(Z,1),t)+Z[v(1,2)],l=-(s=o.vec2d.dot(g(Z,2),t)+Z[v(2,2)])/a,Z[v(1,0)]*=l,Z[v(1,1)]*=l,Z[v(1,2)]*=l,i[0]=Z[0],i[1]=Z[1],i[2]=0,i[3]=Z[2],i[4]=Z[3],i[5]=Z[4],i[6]=0,i[7]=Z[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=Z[6],i[13]=Z[7],i[14]=0,i[15]=Z[8]}for(var y=n.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap"),b=function(){return function(){this.camera=new r,this.lightMat=o.mat4d.create()}}(),_=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var n=0;n<4;++n)this.cascades.push(new b)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this.rctx.capabilities.standardDerivatives},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=l.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)F[e]=this.cascades[e];return F.length=this.numCascades,F},e.prototype.prepare=function(e,t,n,r){l.assert(this.enabled),o.mat4d.multiply(e.projectionMatrix,e.viewMatrix,S);var i=r.near,a=r.far;i<2&&(i=2),a<2&&(a=2),i>=a&&(i=2,a=4),this.numCascades=Math.min(1+Math.floor(l.logWithBase(a/i,4)),this.maxNumCascades);for(var s=Math.pow(a/i,1/this.numCascades),c=0;c<this.numCascades+1;++c)this.cascadeDistances[c]=i*Math.pow(s,c);o.mat4d.inverse(S,w),o.mat4d.lookAt([0,0,0],[-t[0],-t[1],-t[2]],[0,1,0],L);var d=e.viewMatrix,u=e.projectionMatrix;for(c=0;c<this.numCascades;++c){var p=this.cascades[c],h=-this.cascadeDistances[c],v=-this.cascadeDistances[c+1],g=(u[10]*h+u[14])/Math.abs(u[11]*h+u[15]),y=(u[10]*v+u[14])/Math.abs(u[11]*v+u[15]);l.assert(g<y);for(var b=0;b<8;++b){var _=b%4==0||b%4==3?-1:1,O=b%4==0||b%4==1?-1:1,F=b<4?g:y;o.vec4d.set4(_,O,F,1,A),o.mat4d.multiplyVec4(w,A,C[b]);for(var z=0;z<3;++z)C[b][z]/=C[b][3]}o.vec3d.negate(C[0],V),o.mat4d.translate(L,V,x),p.camera.viewMatrix=x;for(b=0;b<8;++b)o.mat4d.multiplyVec3(p.camera.viewMatrix,C[b]);o.vec3d.set(C[0],R),o.vec3d.set(C[0],E);for(b=1;b<8;++b)for(z=0;z<3;++z)R[z]=Math.min(R[z],C[b][z]),E[z]=Math.max(E[z],C[b][z]);R[2]-=200,E[2]+=200,p.camera.near=-E[2],p.camera.far=-R[2],i=1/C[0][3],a=1/C[4][3],l.assert(i<a);var U=i+Math.sqrt(i*a),N=Math.sin(Math.acos(d[2]*t[0]+d[6]*t[1]+d[10]*t[2]));f(C,U/=N,N,P,T,D,I,M),m(P,T,I,M,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(R[2]-E[2]),p.camera.projectionMatrix[14]=-(R[2]+E[2])/(R[2]-E[2]),o.mat4d.multiply(p.camera.projectionMatrix,p.camera.viewMatrix,p.lightMat);var B=this.textureRes/2;p.camera.viewport[0]=c%2==0?0:B,p.camera.viewport[1]=0===Math.floor(c/2)?0:B,p.camera.viewport[2]=B,p.camera.viewport[3]=B}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*a;var j=this.rctx,G=j.gl;j.bindFramebuffer(this.fbo),j.bindTexture(null,7),j.setClearColor(1,1,1,1),j.clear(G.COLOR_BUFFER_BIT|G.DEPTH_BUFFER_BIT),j.setBlendingEnabled(!1)},e.prototype.finish=function(e){l.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,n=this.enabled;t.bindTexture(n?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",n?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),n=0;n<t.length;n++)this.bind(t[n])},e.prototype.bindView=function(e,t){if(this.enabled){var n=this.lastOrigin;if(!n||n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]){this.lastOrigin=this.lastOrigin||o.vec3d.create(),o.vec3d.set(t,this.lastOrigin);for(var r=0;r<this.numCascades;++r){o.mat4d.translate(this.cascades[r].lightMat,t,z);for(var i=0;i<16;++i)U[16*r+i]=z[i]}}e.setUniformMatrix4fv("shadowMapMatrix",U)}},e.prototype.drawDebugQuad=function(e){l.assert(this.enabled);var t=this.rctx,n=t.gl;if(!this.debugQuadVAO){var r=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new h(t,i.Default3D,{geometry:a.Pos2Tex},{geometry:c.createVertex(t,n.STATIC_DRAW,r)})}var o=this.programRep.get("showDepth"),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(o),o.setUniformMatrix4fv("proj",e),o.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),p.assertCompatibleVertexAttributeLocations(s,o),t.drawArrays(n.TRIANGLE_STRIP,0,p.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){if(!this.isSupported)return void y.warn("Shadow maps are not supported for this browser or hardware");var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new u(this.rctx,t),this.fbo=d.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=o.mat4d.create(),S=o.mat4d.create(),w=o.mat4d.create(),A=o.vec4d.create(),C=[],O=0;O<8;++O)C.push(o.vec4d.create());var R=o.vec3d.create(),E=o.vec3d.create(),P=o.vec2d.create(),T=o.vec2d.create(),D=o.vec2d.create(),I=o.vec2d.create(),M=o.vec2d.create(),L=o.mat4d.create(),V=o.vec3d.create(),F=[],z=o.mat4d.create(),U=new Float32Array(64),N=o.vec2d.create(),B=o.vec2d.create(),j=[o.vec2d.create(),o.vec2d.create(),o.vec2d.create(),o.vec2d.create()],G=o.vec2d.create(),H=o.vec2d.create(),k=o.vec2d.create(),W=o.vec2d.create(),q=o.vec2d.create(),$=o.vec2d.create(),X=o.vec2d.create(),Y=o.vec3d.create(),Q=o.vec2d.create(),Z=o.mat3d.create();return _}.apply(null,r))||(e.exports=i)},1630:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1490)],void 0===(i=function(e,t,n){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var i=542327876,a=131072,o=4,s=33776,l=33778,c=33779,d=r("DXT1"),u=r("DXT3"),p=r("DXT5"),h=31,f=0,v=1,g=2,m=3,y=4,b=7,_=20,x=21;t.createDDSTexture=function(e,t,r,S){var w=new Int32Array(r,0,h);if(w[f]!==i)return console.error("Invalid magic number in DDS header"),null;if(!(w[_]&o))return console.error("Unsupported format, must contain a FourCC code"),null;var A,C,O=w[x];switch(O){case d:A=8,C=s;break;case u:A=16,C=l;break;case p:A=16,C=c;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(O)),null}var R=1;w[g]&a&&!1!==S&&(R=Math.max(1,w[b]));var E,P,T=w[y],D=w[m],I=w[v]+4;t.samplingMode=R>1?9987:9729,t.hasMipmap=R>1,t.width=w[y],t.height=w[m];var M=new n(e,t);e.bindTexture(M);for(var L=0;L<R&&(P=Math.floor((T+3)/4)*Math.floor((D+3)/4)*A,E=new Uint8Array(r,I,P)),e.gl.compressedTexImage2D(e.gl.TEXTURE_2D,L,C,T,D,0,E),I+=P,(1!==T||1!==D)&&1!==R;++L)T=Math.max(1,T>>1),D=Math.max(1,D>>1);return M}}.apply(null,r))||(e.exports=i)},1643:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,n){if(null==e||"ignore"===t)return n[0]=255,n[1]=255,n[2]=255,void(n[3]=255);n[0]=Math.floor(255*e[0]),n[1]=Math.floor(255*e[1]),n[2]=Math.floor(255*e[2]);var r=Math.floor(85*e[3]);n[3]=0===r?0:"tint"===t?r:"replace"===t?r+85:r+170}}.apply(null,r))||(e.exports=i)},1644:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(25),n(32)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,i){var a=t&&t.enabled&&t.edges;if(!a)return null;var o=n.toUnitRGBA(a.color),s=i;switch(a.type){case"solid":return e.createSolidEdgeMaterial({color:o,size:r.pt2px(a.size),extensionLength:r.pt2px(a.extensionLength),opacity:s});case"sketch":return e.createSketchEdgeMaterial({color:o,size:r.pt2px(a.size),extensionLength:r.pt2px(a.extensionLength),opacity:s})}}}.apply(null,r))||(e.exports=i)},1645:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1519),n(1488),n(1487)],void 0===(i=function(e,t,n,r,i){function a(e,t,n){e[0]=Math.min(e[0],t[0]-n),e[1]=Math.min(e[1],t[1]-n),e[2]=Math.min(e[2],t[2]-n)}function o(e,t,n){e[0]=Math.max(e[0],t[0]+n),e[1]=Math.max(e[1],t[1]+n),e[2]=Math.max(e[2],t[2]+n)}function s(e,t,n){return(n=n||e)[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}function l(e,t,n){var r=e[0],i=e[1],a=e[2];return n[0][0]*r+n[0][1]*i+n[0][2]*a+n[0][3]>t||n[1][0]*r+n[1][1]*i+n[1][2]*a+n[1][3]>t||n[2][0]*r+n[2][1]*i+n[2][2]*a+n[2][3]>t||n[3][0]*r+n[3][1]*i+n[3][2]*a+n[3][3]>t||n[4][0]*r+n[4][1]*i+n[4][2]*a+n[4][3]>t||n[5][0]*r+n[5][1]*i+n[5][2]*a+n[5][3]>t}function c(e,t){for(var n=1/0,r=null,i=0;i<8;++i){var a=d(e,t,v[i]);a<n&&(n=a,r=v[i])}return r}function d(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}var u,p=function(){function e(e,t,n,i){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=n,i&&(void 0!==i.maximumObjectsPerNode&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),void 0!==i.maximumDepth&&(this._maximumDepth=i.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new h(null,r.vec3d.createFrom(0,0,0),.5):this._root=new h(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var n=this._objectOrObjectsArray(e);t=null==t?n.length:t,this._objectCount+=t,this._grow(n);for(var r=h.acquire(),i=0;i<t;i++){var a=n[i];r.init(this._root),this._isDegenerate(a)?this._degenerateObjects.add(a):this._add(a,r)}h.release(r)},e.prototype.remove=function(e,t){var n=this._objectOrObjectsArray(e);this._objectCount-=n.length;for(var r=h.acquire(),i=0;i<n.length;i++){var a=n[i],o=t||this._boundingSphereFromObject(a,w);this._isValidRadius(o.radius)?(r.init(this._root),this._remove(a,o,r)):this._degenerateObjects.delete(a)}h.release(r),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,n){var r=this;this._forEachNode(this._root,function(i){if(!r._intersectsNode(e,t,i))return!1;var a=i.node;return a.terminals.forEach(function(i){r._intersectsObject(e,t,i)&&n(i)}),null!==a.residents&&a.residents.forEach(function(i){r._intersectsObject(e,t,i)&&n(i)}),!0})},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,n,r,i){return this._findClosest(e,"front-to-back"===t?u.FRONT_TO_BACK:u.BACK_TO_FRONT,n,r,i)},e.prototype.forEachInDepthRange=function(e,t,n,r,i,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===n?u.FRONT_TO_BACK:u.BACK_TO_FRONT,r,i,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,n){return s(n.center,2*-n.halfSize,_),s(n.center,2*n.halfSize,x),i.rayBoxTest(e,t,_,x)},e.prototype._intersectsObject=function(e,t,n){var r=this._objectToBoundingSphere.getRadius(n);return!(r>0)||i.raySphere(e,t,this._objectToBoundingSphere.getCenter(n),r)},e.prototype._forEachNode=function(e,t){for(var n=h.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++){n.node.children[i]&&r.push(h.acquire().init(n).advance(i))}h.release(n)}},e.prototype._forEachNodeDepthOrdered=function(e,t,n,r){void 0===r&&(r=u.FRONT_TO_BACK);for(var i=h.acquire().init(e),a=[i],o=function(e,t,n){if(!E.length)for(var r=0;r<8;++r)E[r]={index:0,distance:0};for(r=0;r<8;++r){var i=f[r];E[r].index=r,E[r].distance=d(e,t,i)}for(E.sort(function(e,t){return e.distance-t.distance}),r=0;r<8;++r)n[r]=E[r].index;return n}(n,r,P);0!==a.length;){if(t(i=a.pop())&&!i.isLeaf())for(var s=7;s>=0;--s){var l=o[s];if(!(l>=i.node.children.length))i.node.children[l]&&a.push(h.acquire().init(i).advance(l))}h.release(i)}},e.prototype._findClosest=function(e,t,n,i,a){var o=this,s=1/0,u=1/0,p=null,h=c(e,t),f=0,v=function(r){if(++f,!i||i(r)){var a=o._objectToBoundingSphere.getCenter(r),c=o._objectToBoundingSphere.getRadius(r);if(!n||!l(a,c,n)){var h=d(e,t,a),v=h-c;v<s&&(s=v,u=h+c,p=r)}}};return this._forEachNodeDepthOrdered(this._root,function(i){if(null!=a&&f>=a)return!1;if(n&&l(i.center,i.halfSize*g,n))return!1;if(r.vec3d.scale(h,i.halfSize,b),r.vec3d.add(b,i.center),d(e,t,b)>u)return!1;var o=i.node;return o.terminals.forEach(function(e){v(e)}),null!==o.residents&&o.residents.forEach(function(e){v(e)}),!0},e,t),p},e.prototype._forEachInDepthRange=function(e,t,n,i,a,o,s,p){var h=this,f=-1/0,v=1/0,m={setRange:function(e){n===u.FRONT_TO_BACK?(f=Math.max(f,e.near),v=Math.min(v,e.far)):(f=Math.max(f,-e.far),v=Math.min(v,-e.near))}};m.setRange(i);var y=d(t,n,e),_=c(t,n),x=c(t,-1*n),S=0,w=function(e){if(++S,!s||s(e)){var r=h._objectToBoundingSphere.getCenter(e),i=h._objectToBoundingSphere.getRadius(e),c=d(t,n,r)-y;c-i>v||c+i<f||o&&l(r,i,o)||a(e,m)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=p&&S>=p)return!1;if(o&&l(e.center,e.halfSize*g,o))return!1;if(r.vec3d.scale(_,e.halfSize,b),r.vec3d.add(b,e.center),d(t,n,b)-y>v)return!1;if(r.vec3d.scale(x,e.halfSize,b),r.vec3d.add(b,e.center),d(t,n,b)-y<f)return!1;var i=e.node;return i.terminals.forEach(function(e){w(e)}),null!==i.residents&&i.residents.forEach(function(e){w(e)}),!0},t,n)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(m[0]=e,m)},e.prototype._remove=function(e,t,n){S.length=0;var r=n.advanceTo(t,function(e,t){S.push(e.node,t)})?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=S.length-2;i>=0;i-=2){var a=S[i],o=S[i+1];if(!this._purge(a,o))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new n({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,w))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=h.acquire().init(e);this._add(t.data[n],r),h.release(r)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var n=this._boundingSphereFromObjects(e,function(e,n){return t._boundingSphereFromObject(e,n)},A);if(this._isValidRadius(n.radius)&&!this._fitsInsideTree(n))if(this._nodeIsEmpty(this._root.node))r.vec3d.set(n.center,this._root.center),this._root.halfSize=1.25*n.radius;else{var i=h.acquire();this._rootBoundsForRootAsSubNode(n,i),this._placingRootViolatesMaxDepth(i)?this._rebuildTree(n,i):this._growRootAsSubNode(i),h.release(i)}}},e.prototype._rebuildTree=function(e,t){var n=this;r.vec3d.set(t.center,C.center),C.radius=t.halfSize;var i=this._boundingSphereFromObjects([e,C],function(e){return e},O),a=h.acquire().init(this._root);this._root.initFrom(null,i.center,1.25*i.radius),this._forEachNode(a,function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0}),h.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var n=e.radius,r=e.center,i=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=a[s]-o-(r[s]-n),c=r[s]+n-(a[s]+o),d=Math.max(0,Math.ceil(l/(2*o))),u=Math.max(0,Math.ceil(c/(2*o)))+1,p=Math.pow(2,Math.ceil(Math.log(d+u)*Math.LOG2E));i=Math.max(i,p),R[s].min=d,R[s].max=u}for(s=0;s<3;s++){var h=(i-((d=R[s].min)+(u=R[s].max)))/2;d+=Math.ceil(h),u+=Math.floor(h);var f=a[s]-o-d*o*2;y[s]=f+(u+d)*o}return t.initFrom(null,y,i*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;r.vec3d.set(this._root.center,A.center),A.radius=this._root.halfSize,this._root.init(e),e.advanceTo(A,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,n=this._root.halfSize,r=e.center;return e.radius<=n&&r[0]>=t[0]-n&&r[0]<=t[0]+n&&r[1]>=t[1]-n&&r[1]<=t[1]+n&&r[2]>=t[2]-n&&r[2]<=t[2]+n},e.prototype._boundingSphereFromObject=function(e,t){return r.vec3d.set(this._objectToBoundingSphere.getCenter(e),t.center),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,n){if(1===e.length){var i=t(e[0],A);r.vec3d.set(i.center,n.center),n.radius=i.radius}else{_[0]=1/0,_[1]=1/0,_[2]=1/0,x[0]=-1/0,x[1]=-1/0,x[2]=-1/0;for(var s=0;s<e.length;s++){i=t(e[s],A);this._isValidRadius(i.radius)&&(a(_,i.center,i.radius),o(x,i.center,i.radius))}r.vec3d.scale(r.vec3d.add(_,x,n.center),.5),n.radius=Math.max(x[0]-_[0],x[1]-_[1],x[2]-_[2])/2}return n},e}(),h=function(){function e(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0),this.center=r.vec3d.create(),this.initFrom(e,t,n,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,n,i,a){return void 0===t&&(t=null),void 0===i&&(i=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),n&&r.vec3d.set(n,this.center),this.halfSize=i,this.depth=a,this},e.prototype.advance=function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=f[t];return this.center[0]+=r[0]*this.halfSize,this.center[1]+=r[1]*this.halfSize,this.center[2]+=r[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,n){for(void 0===n&&(n=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!n)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var r=this._childIndex(e);t&&t(this,r),this.advance(r)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,n=this.center,r=0,i=0;i<3;i++)n[i]<t[i]&&(r|=1<<i);return r},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new n({shrink:!0}),residents:new n({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(u||(u={}));var f=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],v=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],g=Math.sqrt(3),m=[null],y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),S=[],w={center:r.vec3d.create(),radius:0},A={center:r.vec3d.create(),radius:0},C={center:r.vec3d.create(),radius:0},O={center:r.vec3d.create(),radius:0},R=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],E=[],P=[];return p}.apply(null,r))||(e.exports=i)},1650:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(480),n(1501),n(49)],void 0===(i=function(e,t,n,r,i){function a(e){return null!==e&&void 0!==e}function o(e){return"number"==typeof e}function s(e){return"string"==typeof e}function l(e,t){e&&e.push(t),d(t)}function c(e){S&&console.warn("[FastSymbolUpdates] "+e)}function d(e){S&&console.info("[FastSymbolUpdates] "+e)}function u(e,t,r,i,s){var c=e.minSize,d=e.maxSize;if(e.expression)return l(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var u=i.symbolSize[r];return t.minSize[r]=u,t.maxSize[r]=u,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(a(e.field))return a(e.stops)?2===e.stops.length&&o(e.stops[0].size)&&o(e.stops[1].size)?(p(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(l(s,"Could not convert size info: stops only supported with 2 elements"),!1):o(c)&&o(d)&&a(e.minDataValue)&&a(e.maxDataValue)?(p(c,d,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=n.meterIn[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/n.meterIn[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(l(s,"Could not convert size info: proportional size not supported"),!1):(l(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!a(e.field)){if(e.stops&&e.stops[0]&&o(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(o(c))return t.minSize[r]=c,t.maxSize[r]=c,t.offset[r]=c,t.factor[r]=0,t.type[r]=1,!0}return l(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function p(e,t,n,r,i,a){var o=Math.abs(r-n)>0?(t-e)/(r-n):0;i.minSize[a]=o>0?e:t,i.maxSize[a]=o>0?t:e,i.offset[a]=e-n*o,i.factor[a]=o}function h(e,t,n,r){if(e.normalizationField||e.valueRepresentation)return l(r,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||s(e)}(e.field))return l(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return l(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var i;switch(e.axis){case"width":return(i=u(e,t.size,0,n,r))?t:null;case"height":return(i=u(e,t.size,2,n,r))?t:null;case"depth":return(i=u(e,t.size,1,n,r))?t:null;case"width-and-depth":return(i=u(e,t.size,0,n,r))&&u(e,t.size,1,n,r),i?t:null;case null:case void 0:case"all":return(i=(i=(i=u(e,t.size,0,n,r))&&u(e,t.size,1,n,r))&&u(e,t.size,2,n,r))?t:null;default:return l(r,'Could not convert size info: unknown axis "'+e.axis+'""'),null}}function f(e,t,n){e[4*t+0]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function v(e,t,n){if(e.normalizationField)return l(n,"Could not convert color info: unsupported property"),null;if(s(e.field))if(e.stops){if(e.stops.length>8)return l(n,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var r=e.stops,i=0;i<8;++i){var o=r[Math.min(i,r.length-1)];t.color.values[i]=o.value,f(t.color.colors,i,o.color)}}else{if(!e.colors)return l(n,"Could not convert color info: missing stops or colors"),null;if(!a(e.minDataValue)||!a(e.maxDataValue))return l(n,"Could not convert color info: missing data values"),null;if(2!==e.colors.length)return l(n,"Could not convert color info: invalid colors array"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},t.color.values[0]=e.minDataValue,f(t.color.colors,0,e.colors[0]),t.color.values[1]=e.maxDataValue,f(t.color.colors,1,e.colors[1]);for(i=2;i<8;++i)t.color.values[i]=e.maxDataValue,f(t.color.colors,i,e.colors[1])}else{if(!(e.stops&&e.stops.length>=0||e.colors&&e.colors.length>=0))return l(n,"Could not convert color info: no field and no colors/stops"),null;var c=e.stops&&e.stops.length>=0?e.stops[0].color:e.colors[0];t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(i=0;i<8;i++)t.color.values[i]=1/0,f(t.color.colors,i,c)}return t}function g(e,t,n,r){var i=2===n&&"arithmetic"===e.rotationType;t.offset[n]=i?90:0,t.factor[n]=i?-1:1,t.type[n]=1}function m(e,t,n){if(!e)return null;var r=!t.supportedTypes||!!t.supportedTypes.size,i=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation;S&&(n=n||[]);var o=e.reduce(function(e,o){if(!e)return e;if(o.valueExpression)return l(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return r?h(o,e,t,n):e;case"color":return i?v(o,e,n):e;case"rotation":return a?function(e,t,n){if(!s(e.field))return l(n,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return l(n,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return g(e,t.rotation,0),t;case"roll":return g(e,t.rotation,1),t;case null:case void 0:case"heading":return g(e,t.rotation,2),t;default:return l(n,'Could not convert rotation info: unknown axis "'+e.axis+'""'),null}}(o,e,n):e;default:return l(n,"Could not convert visual variables: unsupported type "+o.type),null}},{size:null,color:null,rotation:null});return o&&o.size&&!function(e,t,n){for(var r=0;r<3;++r){var i=t.unitInMeters;1===e.type[r]&&(i*=t.modelSize[r],e.type[r]=2),e.minSize[r]=e.minSize[r]/i,e.maxSize[r]=e.maxSize[r]/i,e.offset[r]=e.offset[r]/i,e.factor[r]=e.factor[r]/i}var a;if(0!==e.type[0])a=0;else if(0!==e.type[1])a=1;else{if(0===e.type[2])return l(n,"No size axis contains a valid size or scale"),!1;a=2}for(r=0;r<3;++r)0===e.type[r]&&(e.minSize[r]=e.minSize[a],e.maxSize[r]=e.maxSize[a],e.offset[r]=e.offset[a],e.factor[r]=e.factor[a],e.type[r]=e.type[a]);return!0}(o.size,t,n)?null:o}function y(e){return e&&null!=e.size}function b(e,t,n){if(!!e!=!!t)return c("State update failed ({$name} enabled/disabled)"),!1;if(e&&e.field!==t.field)return c("State update failed ({$name} field changed)"),!1;if(e&&"rotation"===n)for(var r=e,i=t,a=0;a<3;a++)if(r.type[a]!==i.type[a]||r.offset[a]!==i.offset[a]||r.factor[a]!==i.factor[a])return!1;return!0}function _(e,t){var n={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},r=y(e);return e&&e.size?(n.vvSizeEnabled=!0,n.vvSizeMinSize=e.size.minSize,n.vvSizeMaxSize=e.size.maxSize,n.vvSizeOffset=e.size.offset,n.vvSizeFactor=e.size.factor):e&&r&&(n.vvSizeValue=t.transformation.scale),e&&r&&(n.vvSymbolAnchor=t.transformation.anchor,n.vvSymbolRotation=t.transformation.rotation),e&&e.color&&(n.vvColorEnabled=!0,n.vvColorValues=e.color.values,n.vvColorColors=e.color.colors),n}Object.defineProperty(t,"__esModule",{value:!0});var x,S=!1,w=!1;t.convertVisualVariables=m,t.initFastSymbolUpdatesState=function(e,t,n){if(w)return c("State not initialized, fast updates disabled (globally disabled)"),{enabled:!1};if(!t)return c("State not initialized, fast updates disabled (no shader support)"),{enabled:!1};if(!e)return c("State not initialized, fast updates disabled (no renderer)"),{enabled:!1};if(e.disableFastUpdates)return c("State not initialized, fast updates disabled (renderer.disableFastUpdates set)"),{enabled:!1};var r=m(e.visualVariables,n);return r?(d("State initialized, fast updates enabled"),{enabled:!0,visualVariables:r,materialParameters:_(r,n),customTransformation:y(r)}):(c("State not initialized, fast updates disabled (conversion failed)"),{enabled:!1})},t.updateFastSymbolUpdatesState=function(e,t,n){if(!t||!e.enabled)return!1;var r=e.visualVariables,i=m(t.visualVariables,n);return i?!!(b(r.size,i.size,"size")&&b(r.color,i.color,"color")&&b(r.rotation,i.rotation,"rotation"))&&(e.visualVariables=i,e.materialParameters=_(i,n),e.customTransformation=y(i),d("State updated"),!0):(c("State update failed (conversion failed)"),!1)},t.getMaterialParams=_,function(e){function t(e,t,n){return e<t?t:e>n?n:e}var n=i.mat4d,a=i.vec3,o=n.create(),s=a.create();e.evaluateModelTransform=function(e,i,a){if(!e.vvSizeEnabled)return a;if(n.set(a,o),r.computeObjectRotation(e.vvSymbolRotation[2],e.vvSymbolRotation[0],e.vvSymbolRotation[1],o),e.vvSizeEnabled){for(var l=0;l<3;++l){var c=e.vvSizeOffset[l]+i[0]*e.vvSizeFactor[l];s[l]=t(c,e.vvSizeMinSize[l],e.vvSizeMaxSize[l])}n.scale(o,s,o)}else n.scale(o,e.vvSizeValue,o);return n.translate(o,e.vvSymbolAnchor,o),o}}(x||(x={})),t.evaluateModelTransform=x.evaluateModelTransform}.apply(null,r))||(e.exports=i)},1651:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){function n(e,t){if(!e||e.symbol)return null;var n=t.renderer;return e&&n&&n.getObservationRenderer?n.getObservationRenderer(e):n}function r(e,t){if(e.symbol)return e.symbol;var r=n(e,t);return r&&r.getSymbol(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=n,t.getSymbol=r,t.getRenderingInfo=function(e,t){var i=n(e,t),a=r(e,t);if(!a)return null;var o={renderer:i,symbol:a};if(i){if(i.colorInfo&&(o.color=i.getColor(e).toRgba()),i.sizeInfo){var s=i.getSize(e);o.size=[s,s,s]}if(i.visualVariables){s=["proportional","proportional","proportional"];for(var l=0,c=i.getVisualVariableValues(e,t);l<c.length;l++){var d=c[l],u=d.variable,p=d.value;if("color"===u.type)o.color=p.toRgba();else if("size"===u.type)if("outline"===u.target)o.outlineSize=p;else{var h=u.axis,f=u.useSymbolValue?"symbolValue":p;"width"===h?s[0]=f:"depth"===h?s[1]=f:"height"===h?s[2]=f:s[0]=s[1]="width-and-depth"===h?f:s[2]=f}else"opacity"===u.type?o.opacity=p:"rotation"===u.type&&"tilt"===u.axis?o.tilt=p:"rotation"===u.type&&"roll"===u.axis?o.roll=p:"rotation"===u.type&&(o.heading=p)}(isFinite(s[0])||isFinite(s[1])||isFinite(s[2]))&&(o.size=s)}}return o}}.apply(null,r))||(e.exports=i)},1652:function(e,t,n){var r;!function(t){function n(e){this._callbacks=[],this._errbacks=[],this._cancelCallback=e,this._iscancelled=!1,this._isdone=!1,this._iserr=!1}n.prototype.cancel=function(e){this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e)},n.prototype.then=function(e,t,n){var r;if(!this._iscancelled)return this._isdone?r=e.apply(n,this.result):this._iserr&&t?r=t.apply(n,this.result):(this._callbacks.push(function(){return e.apply(n,arguments)}),t&&this._errbacks.push(function(){return t.apply(n,arguments)})),r},n.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]},n.prototype.resolve=n.prototype.done,n.prototype.reject=function(){if(!this._iscancelled){this.result=arguments,this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]}},n.prototype.isRejected=function(){return this._iserr},n.prototype.isFulfilled=function(){return this._isdone||this._iserr},n.prototype.isResolved=function(){return this._isdone},n.prototype.isCancelled=function(){return this._iscancelled};var i={Promise:n,join:function(e){function t(e,t){return function(){t&&(s=!0),a+=1,o[e]=Array.prototype.slice.call(arguments),a===i&&(s?r.reject():r.done(o))}}for(var r=new n,i=e.length,a=0,o=[],s=!1,l=0;l<i;l++)e[l].then(t(l,!1),t(l,!0));return 0===e.length&&r.done(),r},chain:function e(t,r){var i=new n;return 0===t.length?i.done.apply(i,r):t[0].apply(null,r).then(function(){t.splice(0,1),e(t,arguments).then(function(){i.done.apply(i,arguments)})}),i}};void 0===(r=function(){return i}.apply(null,[]))||(e.exports=r)}()},1653:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var n=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var r={};return this._listeners[e].set(r,t),{remove:function(){return n._listeners[e].delete(r)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=n}.apply(null,r))||(e.exports=i)},1670:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1488),n(1487)],void 0===(i=function(e,t,n,r){var i=n.vec3d;return function(){function e(e,t,n,a){r.assert(e.length>=1),r.assert(n.length%t==0),r.assert(n.length>=e.length*t),r.assert(3===a.size||4===a.size),this.primitiveIndices=e,this.indices=n,this._position=a,this._numIndexPerPrimitive=t;var o=a.data,s=a.offsetIdx,l=a.strideIdx,c=e.length,d=s+l*n[t*e[0]];this.bbMin=i.createFrom(o[d],o[d+1],o[d+2]),this.bbMax=i.create(this.bbMin);for(var u=0;u<c;++u)for(var p=t*e[u],h=0;h<t;++h){var f=s+l*n[p+h];this.bbMin[0]=Math.min(o[f],this.bbMin[0]),this.bbMax[0]=Math.max(o[f],this.bbMax[0]),++f,this.bbMin[1]=Math.min(o[f],this.bbMin[1]),this.bbMax[1]=Math.max(o[f],this.bbMax[1]),++f,this.bbMin[2]=Math.min(o[f],this.bbMin[2]),this.bbMax[2]=Math.max(o[f],this.bbMax[2])}this.center=i.create(),i.lerp(this.bbMin,this.bbMax,.5,this.center),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var v=this.bsRadius*this.bsRadius;for(u=0;u<c;++u)for(p=t*e[u],h=0;h<t;++h){var g=o[f=s+l*n[p+h]]-this.center[0],m=o[f+1]-this.center[1],y=o[f+2]-this.center[2],b=g*g+m*m+y*y;if(!(b<=v)){var _=Math.sqrt(b),x=.5*(_-this.bsRadius);this.bsRadius=this.bsRadius+x,v=this.bsRadius*this.bsRadius;var S=x/_;this.center[0]+=g*S,this.center[1]+=m*S,this.center[2]+=y*S}}}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.dist2(this.bbMin,this.bbMax)>1){for(var t=i.lerp(this.bbMin,this.bbMax,.5,i.create()),n=this.primitiveIndices.length,r=new Uint8Array(n),a=new Array(8),o=0;o<8;++o)a[o]=0;var s=this._position,l=s.data,c=s.offsetIdx,d=s.strideIdx;for(o=0;o<n;++o){for(var u=0,p=this._numIndexPerPrimitive*this.primitiveIndices[o],h=c+d*this.indices[p],f=l[h],v=l[h+1],g=l[h+2],m=1;m<this._numIndexPerPrimitive;++m){var y=l[h=c+d*this.indices[p+m]],b=l[h+1],_=l[h+2];y<f&&(f=y),b<v&&(v=b),_<g&&(g=_)}f<t[0]&&(u|=1),v<t[1]&&(u|=2),g<t[2]&&(u|=4),r[o]=u,++a[u]}var x=0;for(o=0;o<8;++o)a[o]>0&&++x;if(x<2)return;var S=new Array(8);for(o=0;o<8;++o)S[o]=a[o]>0?new Uint32Array(a[o]):void 0;for(o=0;o<8;++o)a[o]=0;for(o=0;o<n;++o){S[u=r[o]][a[u]++]=this.primitiveIndices[o]}this.children=new Array(8);for(o=0;o<8;++o)void 0!==S[o]&&(this.children[o]=new e(S[o],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}()}.apply(null,r))||(e.exports=i)},1671:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1513),n(1516),n(473),n(56),n(1501)],void 0===(i=function(e,t,n,r,i,a,o,s){var l=function(){function e(e,t,n){this.type="draped",this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=n,this.stage=null,this._visible=!1}return e.prototype.initialize=function(e,t){this.stage=t},e.prototype.setVisibility=function(e){if(null!=this.stage)return this._visible!==e&&(this._visible=e,this._visible?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0)},e.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),this._visible=!1,this.stage=null},e.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(e,t){return Math.max(e,t.bsRadius)},0)},e.prototype.getCenterObjectSpace=function(){return[0,0,0]},e.prototype.addHighlight=function(e,t){var n=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(r){var i=n.addRenderGeometryHighlight(r,t);e.addRenderGeometry(r,n,i)})},e.prototype.removeHighlight=function(e){this.renderGeometries.forEach(function(t){e.removeRenderGeometry(t)})},e.prototype.getProjectedBoundingBox=function(e,t,n,o){return i(this,void 0,void 0,function(){var i,l,d,p;return r(this,function(r){switch(r.label){case 0:for(a.empty(n),i=0;i<this.renderGeometries.length;i++)l=this.renderGeometries[i],this._getRenderGeometryProjectedBoundingRect(l,c,e,o),a.expand(n,c);if(!t)return[3,5];a.center(n,u),d=void 0,p=s.demResolutionForBoundingBox(n,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.service.queryElevation(u[0],u[1],p)];case 2:return d=r.sent(),[3,4];case 3:return r.sent(),d=null,[3,4];case 4:null!=d&&(n[2]=Math.min(n[2],d),n[5]=Math.max(n[5],d)),r.label=5;case 5:return[2,n]}})})},e.prototype._getRenderGeometryProjectedBoundingRect=function(e,t,n,r){if(this.boundingBox)a.set(d,this.boundingBox);else{var i=e.center,o=e.bsRadius;d[0]=i[0]-o,d[1]=i[1]-o,d[2]=i[2]-o,d[3]=i[0]+o,d[4]=i[1]+o,d[5]=i[2]+o}return n(d,0,2),this.calculateRelativeScreenBounds&&r.push({location:a.center(d),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),a.toRect(d,t)},e}(),c=o.create(),d=a.create(),u=[0,0,0];return l}.apply(null,r))||(e.exports=i)},1672:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(251),n(1488),n(1504),n(1506),n(1645)],void 0===(i=function(e,t,n,r,i,a,o){var s=r.vec3d;return function(){function e(t,n,r){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(r),this.name=t,n=n||{},this.group=n.group||"",this.isPickable=null==n.isPickable||n.isPickable,this.translation=s.create(n.translation),this._extent=[s.createFrom(0,0,0),s.createFrom(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return n.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return n.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.addParentLayer(this),this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.removeParentLayer(this),this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=s.create();return s.lerp(this._extent[0],this._extent[1],.5,e)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*s.dist(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,n,r){n=n||a.LAYER;for(var i=r||this,o=0;o<this._parentStages.length;o++)this._parentStages[o].notifyDirty(n,i,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,r=0;r<3;r++)t=Math.max(t,e[1][r]-e[0][r]);var i=s.create();s.lerp(e[0],e[1],.5,i),this._octree=new o(i,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(n.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(n){var r=n.getBBMin(),i=n.getBBMax();if(t)for(var a=0;a<3;++a)e._extent[0][a]=Math.min(e._extent[0][a],r[a]),e._extent[1][a]=Math.max(e._extent[1][a],i[a]);else t=[s.create(r),s.create(i)]}),this._extent=t}},e._idGen=new i,e}()}.apply(null,r))||(e.exports=i)},1673:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,n){this.items.push({type:"renderGeometry",highlightId:n,renderGeometry:e,renderer:t})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];n.highlightId===e&&(this.removeHighlight(n),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];"object"===n.type&&n.object===e&&(this.removeHighlight(n),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var n=this.items[t];"renderGeometry"===n.type&&n.renderGeometry===e&&(this.removeHighlight(n),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,r))||(e.exports=i)},1674:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var n=t.toLowerCase(),r=0,i=Object.keys(e);r<i.length;r++){var a=i[r];if(a.toLowerCase()===n)return e[a]}return null}}.apply(null,r))||(e.exports=i)},1683:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1566),n(1550)],void 0===(i=function(e,t,n,r){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=n.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.hasOffsetAdjustment=!1,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.hasOffsetAdjustment=e.hasOffsetAdjustment,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.setOffsetRenderUnits=function(e){this._meterUnitOffset=0,this._renderUnitOffset=e},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=r.execute(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,r))||(e.exports=i)},1688:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(7),n(30),n(489)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,a=e.layer.fullExtent,o=a&&a.spatialReference;return o?o.equals(t)?n.resolve(a.clone()):r.canProject(o,t)?n.resolve(r.project(a,t)):e.view.state.isLocal?i.projectGeometry(a,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null}):n.resolve(null):n.resolve(null)}}.apply(null,r))||(e.exports=i)},1696:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2}.apply(null,r))||(e.exports=i)},1697:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1513),n(1516),n(1729),n(99),n(473),n(56),n(252),n(1550),n(98)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){var u=new a(Array,function(e){return o.set(e,o.ZERO)},null,10,5),p=s.create();return function(){function e(e,t,n,r){this.addedToSpatialIndex=!1,this._labelGraphics=[],this._auxiliaryGraphics=[],this._visibilityFlags=function(e,t){for(var n=new Array(e),r=0;r<n.length;r++)n[r]=new Array(t);return n}(2,3),this._featureExpressionFeature=null,this.extent=null,this.graphics3DSymbol=t,this.graphic=e,this._graphics=n,this._featureExpressionFeature=c.createFeature(e,r)}return e.prototype.initialize=function(e,t){var n=this;this._layer=e,this._stage=t,this.forEachSymbolLayerGraphic(function(r){r.initialize(e,t),r.setVisibility(n.isVisible())})},e.prototype.destroy=function(){this.forEachRenderedGraphic(function(e){return e.destroy()}),this._graphics.length=0,this._labelGraphics.length=0,this._auxiliaryGraphics.length=0},e.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(e){return e.destroy()}),this._labelGraphics.length=0},e.prototype.addLabelGraphic=function(e,t,n){this._labelGraphics.push(e),e.initialize(t,n),e.setVisibility(this.isVisible(1))},e.prototype.addAuxiliaryGraphic=function(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._layer,this._stage),e.setVisibility(this.isVisible()))},e.prototype.isDraped=function(){var e=!1;return this.forEachSymbolLayerGraphic(function(t){"draped"===t.type&&(e=!0)}),e},e.prototype.areVisibilityFlagsSet=function(e,t,n){void 0===n&&(n=0);var r=this._visibilityFlags[n];if(null!=e)return r[e];for(var i=!0,a=0;a<r.length;a++)if(a!==t){var o=r[a];i=i&&(null==o||!0===o)}return i},e.prototype.isVisible=function(e){void 0===e&&(e=0);for(var t=0;t<=e;t++)for(var n=this._visibilityFlags[t],r=0;r<n.length;r++){var i=n[r];if(null!==i&&!1===i)return!1}return!0},e.prototype.setVisibilityFlag=function(e,t,n){void 0===n&&(n=0);var r=this.isVisible(n);this._visibilityFlags[n][e]=t;var i=this.isVisible(n);if(r===i)return!1;if(1===n)this.forEachLabelGraphic(function(e){return e.setVisibility(i)});else{this.forEachSymbolLayerGraphic(function(e){return e.setVisibility(i)});var a=this.isVisible(1);this.forEachLabelGraphic(function(e){return e.setVisibility(a)})}return!0},e.prototype.getBSRadius=function(){var e=0;return this.forEachSymbolLayerGraphic(function(t){e=Math.max(e,t.getBSRadius())}),e},e.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()},e.prototype.computeExtent=function(e){if(!this.extent){this.extent=s.create();var t=this.graphic.geometry,n=t.spatialReference;if(l.computeAABR(t,this.extent),!n.equals(e)&&!d.boundingRectToBoundingRect(this.extent,n,this.extent,e))return this.extent=null,!1}return!0},e.prototype.getProjectedBoundingBox=function(e,t,a,l){return r(this,void 0,void 0,function(){var c=this;return n(this,function(d){switch(d.label){case 0:return l||(l={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),l.boundingBox?o.empty(l.boundingBox):l.boundingBox=o.empty(),l.requiresDrapedElevation=!1,[4,i.forEach(this._graphics,function(i){return r(c,void 0,void 0,function(){var r,s,c;return n(this,function(n){switch(n.label){case 0:return i?(r="draped"===i.type?t:e,s=u.acquire(),[4,i.getProjectedBoundingBox(r,a,s,l.screenSpaceObjects)]):[2];case 1:return c=n.sent(),isFinite(c[2])&&isFinite(c[5])||(l.requiresDrapedElevation=!0),c&&o.expand(l.boundingBox,s),u.release(s),[2]}})})})];case 1:return d.sent(),o.allFinite(l.boundingBox)||s.allFinite(o.toRect(l.boundingBox,p))?[2,l]:[2,null]}})})},e.prototype.needsElevationUpdates=function(){for(var e=0,t=this._graphics;e<t.length;e++){if((i=t[e])&&("object3d"===i.type||"lod-instance"===i.type)&&i.needsElevationUpdates)return!0}for(var n=0,r=this._labelGraphics;n<r.length;n++){var i;if((i=r[n])&&i.needsElevationUpdates)return!0}return!1},e.prototype.alignWithElevation=function(e,t){var n=this;this.forEachRenderedGraphic(function(r){"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,n._featureExpressionFeature)})},e.prototype.addHighlight=function(e,t){this.forEachSymbolLayerGraphic(function(n){return n.addHighlight(e,t)})},e.prototype.removeHighlight=function(e){this.forEachSymbolLayerGraphic(function(t){return t.removeHighlight(e)})},e.prototype.forEachGraphicList=function(e,t){e.forEach(function(e,n){return e&&t(e,n)})},e.prototype.forEachSymbolLayerGraphic=function(e){this.forEachGraphicList(this._graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)},e.prototype.forEachLabelGraphic=function(e){this.forEachGraphicList(this._labelGraphics,e)},e.prototype.forEachRenderedGraphic=function(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)},e}()}.apply(null,r))||(e.exports=i)},1698:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1683)],void 0===(i=function(e,t,n,r){return function(e){function t(t){var n=e.call(this,t)||this;return n.centerPointInElevationSR=null,n}return n(t,e),t}(r)}.apply(null,r))||(e.exports=i)},1699:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1697),n(1755),n(1652)],void 0===(i=function(e,t,n,r,i,a){return function(e){function t(t,n,r){var a=e.call(this)||this;a.symbol=t;var o=t.symbolLayers;r&&(o=r.concat(o));var s=o.length;a.childGraphics3DSymbols=new Array(o.length),a.childGraphics3DSymbolPromises=new Array(o.length);for(var l=n.layerOrder,c=0,d=0,u=!1,p=function(e,t){t&&(this.childGraphics3DSymbols[e]=t,d++),c--,!this.isRejected()&&u&&c<1&&(d>0?this.resolve():this.reject())},h=0;h<s;h++){var f=o.getItemAt(h);if(!1!==f.enabled){n.layerOrder=l+(1-(1+h)/s),n.layerOrderDelta=1/s;var v=i.make(a.symbol,f,n,f._ignoreDrivers);v&&(c++,a.childGraphics3DSymbolPromises[h]=v,v.then(p.bind(a,h,v),p.bind(a,h,null)))}}return n.layerOrder=l,u=!0,!a.isRejected()&&c<1&&a.resolve(),a}return n(t,e),t.prototype.createGraphics3DGraphic=function(e,t){for(var n=e.graphic,i=new Array(this.childGraphics3DSymbols.length),a=0;a<this.childGraphics3DSymbols.length;a++){var o=this.childGraphics3DSymbols[a];o&&(i[a]=o.createGraphics3DGraphic(e))}return new r(n,t||this,i,e.layer)},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){for(var e=0,t=0;t<this.childGraphics3DSymbols.length;++t){var n=this.childGraphics3DSymbols[t];n&&(e+=n.numberOfVertices)}return e},enumerable:!0,configurable:!0}),t.prototype.layerPropertyChanged=function(e,t){for(var n=this.childGraphics3DSymbols.length,r=this,i=0;i<n;i++){var a=function(n){var i=r.childGraphics3DSymbols[n];if(i&&!i.layerPropertyChanged(e,t,function(e){return e._graphics[n]}))return{value:!1}}(i);if("object"==typeof a)return a.value}return!0},t.prototype.applyRendererDiff=function(e,t,n){return!!this.isResolved()&&this.childGraphics3DSymbols.reduce(function(r,i,a){return r&&(!i||i.applyRendererDiff(e,t,n,a))},!0)},t.prototype.getFastUpdateStatus=function(){var e=0,t=0,n=0;return this.childGraphics3DSymbolPromises.forEach(function(r){r&&!r.isFulfilled()?e++:r&&r.isFastUpdatesEnabled()?n++:r&&t++}),{loading:e,slow:t,fast:n}},t.prototype.setDrawOrder=function(e,t){for(var n=this.childGraphics3DSymbols.length,r=1/n,i=0;i<n;i++){var a=this.childGraphics3DSymbols[i];if(a){var o=e+(1-(1+i)/n);a.setDrawOrder(o,r,t)}}},t.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var e=0;e<this.childGraphics3DSymbolPromises.length;e++)this.childGraphics3DSymbolPromises[e]&&this.childGraphics3DSymbolPromises[e].destroy()},t}(a.Promise)}.apply(null,r))||(e.exports=i)},1700:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(9),n(1510),n(1500),n(1498),n(1488),n(1505),n(1502),n(1491),n(1487),n(1494),n(1489)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h){var f=u.VertexAttrConstants,v=o.Pos3,g=h.getStride(v)/4,m={color:[1,1,1,1]},y=r.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),b=function(e){function t(t,n){var r=e.call(this,n)||this;return r.params=p.copyParameters(t,m),r.canBeMerged=!0,r}return n(t,e),t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.getParameterValues=function(){return{color:this.params.color}},t.prototype.getOutputAmount=function(e){return e*g},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return v},t.prototype.fillInterleaved=function(e,t,n,r,i,a,o){var s=e.vertexAttr[f.POSITION].data;if(t){var l=s;s=z;for(var c=0;c<l.length;c+=3){var d=l[c],u=l[c+1],p=l[c+2];s[c]=t[0]*d+t[4]*u+t[8]*p+t[12],s[c+1]=t[1]*d+t[5]*u+t[9]*p+t[13],s[c+2]=t[2]*d+t[6]*u+t[10]*p+t[14]}}var h=e.indices[f.POSITION],v=a;for(c=0;c<h.length;c++){var g=3*h[c];i[v++]=s[g],i[v++]=s[g+1],i[v++]=s[g+2]}},t.prototype.intersect=function(e,t,n,r,o,l,c,d){if(r.isSelection&&!a.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!u.isTranslationMatrix(n))return void y.error("intersection assumes a translation-only matrix");var p=e.getData().getVertexAttr().position.data,h=r.camera,f=r.point;s.vec3d.set3(f[0]-2,f[1]+2,0,D[0]),s.vec3d.set3(f[0]+2,f[1]+2,0,D[1]),s.vec3d.set3(f[0]+2,f[1]-2,0,D[2]),s.vec3d.set3(f[0]-2,f[1]-2,0,D[3]);for(var v=0;v<4;v++)h.unprojectPoint(D[v],I[v]);i.plane.fromPoints(h.eye,I[0],I[1],M),i.plane.fromPoints(h.eye,I[1],I[2],L),i.plane.fromPoints(h.eye,I[2],I[3],V),i.plane.fromPoints(h.eye,I[3],I[0],F);var g=Number.MAX_VALUE;for(v=0;v<p.length-5;v+=3)if(S[0]=p[v]+n[12],S[1]=p[v+1]+n[13],S[2]=p[v+2]+n[14],w[0]=p[v+3]+n[12],w[1]=p[v+4]+n[13],w[2]=p[v+5]+n[14],!(i.plane.distance(M,S)<0&&i.plane.distance(M,w)<0||i.plane.distance(L,S)<0&&i.plane.distance(L,w)<0||i.plane.distance(V,S)<0&&i.plane.distance(V,w)<0||i.plane.distance(F,S)<0&&i.plane.distance(F,w)<0)){if(h.projectPoint(S,O),h.projectPoint(w,R),O[2]<0&&R[2]>0){s.vec3d.subtract(S,w,A);var m=h.frustumPlanes,b=-i.plane.distance(m[4],S)/s.vec3d.dot(A,m[4]);s.vec3d.scale(A,b,A),s.vec3d.add(S,A,S),h.projectPoint(S,O)}else if(O[2]>0&&R[2]<0){s.vec3d.subtract(w,S,A);m=h.frustumPlanes,b=-i.plane.distance(m[4],w)/s.vec3d.dot(A,m[4]);s.vec3d.scale(A,b,A),s.vec3d.add(w,A,w),h.projectPoint(w,R)}else if(O[2]<0&&R[2]<0)continue;var _=u.pointLineSegmentDistanceSquared2D(O,R,f);_<g&&(g=_,s.vec3d.set(S,E),s.vec3d.set(w,P))}var x=r.p0,z=r.p1;if(g<4){var U=u.lineLineDistanceSquared3D(E,P,x,z,T),N=Number.MAX_VALUE;if(U.success){s.vec3d.subtract(U.pa,x,C);var B=s.vec3d.length(C);s.vec3d.scale(C,1/B),N=B/s.vec3d.dist(x,z)}c(N,C)}}},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:x}},t.prototype.getAllTextureIds=function(){return[]},t}(c),_=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.program=n.get("simple"),i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues()},t.prototype.beginSlot=function(e){return e===d.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,r=this.params;e.bindProgram(n),n.setUniform4fv("color",r.color),e.setBlendingEnabled(r.color[3]<1),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){this.params.color[3]<1&&e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){p.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.LINES},t}(l),x=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.program=n.get("highlight"),i}return n(t,e),t.prototype.updateParameters=function(){},t.prototype.beginSlot=function(e){return e===d.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){e.bindProgram(this.program),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){p.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.LINES},t}(l),S=s.vec3d.create(),w=s.vec3d.create(),A=s.vec3d.create(),C=s.vec3d.create(),O=s.vec3d.create(),R=s.vec3d.create(),E=s.vec3d.create(),P=s.vec3d.create(),T={success:!1,dist2:0,pa:s.vec3d.create(),pb:s.vec3d.create()},D=[s.vec3d.create(),s.vec3d.create(),s.vec3d.create(),s.vec3d.create()],I=[s.vec3d.create(),s.vec3d.create(),s.vec3d.create(),s.vec3d.create()],M=i.plane.create(),L=i.plane.create(),V=i.plane.create(),F=i.plane.create(),z=[];return b}.apply(null,r))||(e.exports=i)},1701:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1527),n(1487),n(1700),n(1558)],void 0===(i=function(e,t,n,r,i,a){function o(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}Object.defineProperty(t,"__esModule",{value:!0});var s=r.VertexAttrConstants;t.createRibbonMaterial=function(e){var t={width:e.width,color:e.color,miterLimit:e.miterLimit,polygonOffset:!0};return"miter"===e.join||"bevel"===e.join?t.join=e.join:(t.join="miter",e.join&&console.warn("unsupported join type for line symbol: "+e.join)),new a(t,e.idHint+"_ribbonlinemat")},t.createNativeMaterial=function(e){return new i({color:e.color},e.idHint+"_nativelinemat")},t.isClosed=o,t.createPolylineGeometry=function(e,t,r,i,a){var l,c,d,u;if(r=r&&!o(e)){for(var p=new Float32Array(e.length+3),h=0;h<e.length;h++)p[h]=e[h];var f=p.length;p[f-3]=e[0],p[f-2]=e[1],p[f-1]=e[2],c=p,l=e.length/3+1,d=new Uint32Array(2*(l-1)),u=new Uint32Array(2*(l-1))}else l=e.length/3,d=new Uint32Array(2*(l-1)),u=new Uint32Array(2*(l-1)),c=e;var v=new Float32Array(1);v[0]=a;for(var g=0,m=0,y=0;y<l-1;y++)d[g++]=y,d[g++]=y+1,u[m++]=0,u[m++]=0;var b={},_={};return b[s.POSITION]=d,b[s.COLOR]=u,b[s.SIZE]=u,_[s.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3},_[s.COLOR]={size:4,data:i,offsetIdx:0,strideIdx:4},_[s.SIZE]={size:1,data:v,offsetIdx:0,strideIdx:1},t&&(b.mapPos=d,_.mapPos={size:3,data:t,offsetIdx:0,strideIdx:3}),new n(_,b,n.DefaultOffsets,"line")}}.apply(null,r))||(e.exports=i)},1702:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(34),n(142),n(21),n(8),n(5),n(9),n(7),n(20),n(1763),n(473),n(49),n(1511),n(1518),n(1527),n(1549),n(1515)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y){function b(e,t){return t.lods&&t.lods.length===e.length&&e.forEach(function(e,n){e.lodMetrics=t.lods[n].metrics}),e}function _(e,t){var n=(t=t||{}).streamDataSupplier;if(n){var r=n.request(e,"json");return c.create(function(e,t){r.then(function(t,n){e(n)},function(e){t(e instanceof i?e:x(e))})},function(){n.cancelRequest(r)})}var o=a(e);return c.create(function(e,t){o.then(function(t){e(t.data)},function(e){t(e instanceof i?e:x(e))})},function(){o.cancel()})}function x(e){return new o("","Request for object resource failed: "+e)}function S(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(O.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var i=t.faces;if(i){if(t.vertexAttributes)for(var a in t.vertexAttributes){var o=i[a];o&&o.values?(null!=o.valueType&&"UInt32"!==o.valueType&&(O.warn("Unsupported indexed geometry indices type '"+o.valueType+"', only UInt32 is currently supported"),r=!1),null!=o.valuesPerElement&&1!==o.valuesPerElement&&(O.warn("Unsupported indexed geometry values per element '"+o.valuesPerElement+"', only 1 is currently supported"),r=!1)):(O.warn("Indexed geometry does not specify face indices for '"+a+"' attribute"),r=!1)}}else O.warn("Indexed geometries must specify faces"),r=!1;break;default:O.warn("Unsupported topology '"+n+"'"),r=!1}e.params.material||(O.warn("Geometry requires material"),r=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(O.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function w(e,t){var n=[],i=[],a=[],o=[],l=[],c=u.Version.parse(e.version||"1.0","wosr");R.validate(c);var d="meshsymbol_"+e.model.name,p=e.textureDefinitions,h={};for(var f in p){var b=p[f],_=b.images[0].data;if(_){var x=b.encoding+";base64,"+_,w="/textureDefinitions/"+f,E={noUnpackFlip:!0,wrapClamp:!1};r("enable-feature:jkieboom/alpha-channel-usage")&&(E.wrapClamp=!0);var P=new m(x,d,E);l.push(P),h[w]={engineTexObj:P,alphaChannelUsage:"rgba"===b.channels?b.alphaChannelUsage||"transparency":"none"}}else O.warn("Externally referenced texture data is not yet supported")}for(var T=e.model.geometries,D=e.materialDefinitions,I=0,M=0;M<T.length;M++){var L=T[M];if(S(L)){var V=A(L),F=L.params.vertexAttributes,z={};for(var U in F){var N=F[U],B=N.values;z[U]={data:B,size:N.valuesPerElement}}a.push([]);var j={};if("PerAttributeArray"===L.params.topology){var G=C(z.position.data.length/z.position.size);for(var H in z)j[H]=G}else{var k=L.params.faces;for(var W in k)j[W]=new Uint32Array(k[W].values)}var q=V.texture?h[V.texture]:null,$=o[V.material]?o[V.material][V.texture]:null;if(!$){var X=D[V.material.substring(V.material.lastIndexOf("/")+1)].params;1===X.transparency&&(X.transparency=0);var Y={ambient:X.diffuse,diffuse:X.diffuse,specular:[0,0,0],opacity:1-(X.transparency||0),transparent:X.transparency>0,textureId:q?q.engineTexObj.id:void 0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:X.externalColorMixMode||"tint"};r("enable-feature:jkieboom/alpha-channel-usage")&&(!q||"transparency"!==q.alphaChannelUsage&&"maskAndTransparency"!==q.alphaChannelUsage||(Y.transparent=!0)),t&&t.materialParamsMixin&&s.mixin(Y,t.materialParamsMixin),$=new y(Y,d),o[V.material]||(o[V.material]={}),o[V.material][V.texture]=$,i.push($)}a[M].push($);var Q=new v(new g(z,j),d);I+=j.position?j.position.length:0,n.push(Q)}}return{stageResources:{textures:l,materials:i,geometries:n},materialsByComponent:a,pivotOffset:e.model.pivotOffset,numberOfVertices:I}}function A(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}function C(e){for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=n;return t}Object.defineProperty(t,"__esModule",{value:!0});var O=l.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),R=new u.Version(1,2,"wosr");t.fetch=function(e,t){return _(e,t).then(function(e){return w(e,t)})},t.fetchLod=function(e,t){var n=d.removeFile(e);return _(e,t).then(function(e){return e.lods?c.all(e.lods.map(function(t){return t.href?_(d.makeAbsolute(t.href,n)):e})).then(function(n){return b(n.map(function(e){return w(e,t)}),e)}):b([w(e,t)],e)})},t.computeBoundingBox=function(e){for(var t=e.stageResources[f.ModelContentType.GEOMETRY],n=p.empty(),r=[0,0,0],i=[0,0,0],a=0;a<t.length;a++){var o=t[a].getBoundingInfo();h.vec3d.set(o.getBBMin(),r),h.vec3d.set(o.getBBMax(),i);for(var s=0;s<3;++s)n[s]=Math.min(n[s],r[s]),n[s+3]=Math.max(n[s+3],i[s])}return n},t.createStageResources=w}.apply(null,r))||(e.exports=i)},1703:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(473),n(1518),n(1560)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=n.fromValues(-.5,-.5,-.5,.5,.5,.5),o=n.fromValues(-.5,-.5,0,.5,.5,1),s=n.fromValues(-.5,-.5,0,.5,.5,.5);t.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},t.primitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return a;case"cylinder":case"cone":case"inverted-cone":return o;case"tetrahedron":return s}},t.primitiveGeometryData=function(e){switch(e){case"sphere":return i.createPolySphereGeometry(.5,2,!0);case"cube":return i.createBoxGeometry(1);case"cylinder":return i.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case"cone":return i.cgToGIS(i.createConeGeometry(1,.5,15,!1));case"inverted-cone":return i.cgToGIS(i.createConeGeometry(1,.5,15,!0));case"tetrahedron":return i.cgToGIS(i.createTetrahedronGeometry(1));case"diamond":return i.cgToGIS(i.createDiamondGeometry(1))}},t.primitiveLodResources=function(e,t,n){var a=function(e,a,o){return void 0===o&&(o=!1),{levels:e.map(function(e,s){var l=a(e.tesselation);return o&&i.cgToGIS(l),{components:[{geometry:new r(l,n+"_lod"+s),material:t}],faceCount:l.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})}};switch(e){case"sphere":return a([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:5},{tesselation:2,minScreenSpaceRadius:15}],function(e){return i.createPolySphereGeometry(.5,e,!0)});case"cube":return a([{tesselation:0,minScreenSpaceRadius:0}],function(e){return i.createBoxGeometry(1)});case"cone":return a([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(e){return i.createConeGeometry(1,.5,e,!1)},!0);case"inverted-cone":return a([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(e){return i.createConeGeometry(1,.5,e,!0)},!0);case"cylinder":return a([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:32,minScreenSpaceRadius:20}],function(e){return i.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])});case"tetrahedron":return a([{tesselation:0,minScreenSpaceRadius:0}],function(e){return i.createTetrahedronGeometry(1)},!0);case"diamond":return a([{tesselation:0,minScreenSpaceRadius:0}],function(e){return i.createDiamondGeometry(1)},!0)}}}.apply(null,r))||(e.exports=i)},1704:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(251),n(473)],void 0===(i=function(e,t,n,r){function i(e){var t=[];return e.components.forEach(function(e){t.push(e.geometry)}),n.unique(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.materialsFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.material)})}),n.unique(t)},t.texturesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){e.textures&&t.push.apply(t,e.textures)})}),n.unique(t)},t.geometriesFromLodLevelResources=i,t.geometriesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.geometry)})}),n.unique(t)},t.computeBoundingBox=function(e){var t=r.empty();return i(e).forEach(function(e){var n=e.getBoundingInfo();r.expand(t,n.getBBMin()),r.expand(t,n.getBBMax())}),t},t.computeFaceCount=function(e){var t=0;return i(e).forEach(function(e){t+=e.data.indexCount/3}),t}}.apply(null,r))||(e.exports=i)},1710:function(e,t,n){var r;void 0===(r=function(){"use strict";function e(n,r,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,l=r-i+1,c=Math.log(s),d=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*d*(s-d)/s)*(l-s/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*d/s+u)),Math.min(a,Math.floor(r+(s-l)*d/s+u)),o)}var p=n[r],h=i,f=a;for(t(n,i,r),o(n[a],p)>0&&t(n,i,a);h<f;){for(t(n,h,f),h++,f--;o(n[h],p)<0;)h++;for(;o(n[f],p)>0;)f--}0===o(n[i],p)?t(n,i,f):t(n,++f,a),f<=r&&(i=f+1),r<=f&&(a=f-1)}}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}return function(t,r,i,a,o){e(t,r,i||0,a||t.length-1,o||n)}}.apply(null,[]))||(e.exports=r)},1729:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1513),n(1516),n(7)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=function(e,t,a){return r(this,void 0,void 0,function(){return n(this,function(n){switch(n.label){case 0:return[4,i.eachAlways(e.map(function(e,n){return t.apply(a,[e,n])}))];case 1:return n.sent(),[2]}})})},t.map=function(e,t,a){return r(this,void 0,void 0,function(){return n(this,function(n){switch(n.label){case 0:return[4,i.eachAlways(e.map(function(e,n){return t.apply(a,[e,n])}))];case 1:return[2,n.sent().map(function(e){return e.value})]}})})},t.maybe=function(e){return e.then(function(e){return{ok:!0,value:e}}).catch(function(e){return{ok:!1,error:e}})},t.assertMaybe=function(e){if(!0===e.ok)return e.value;throw e.error},t.cancellable=function(e){var t,n=function(e){return t=e,e};return i.create(function(t,r){e(n).then(t,r)},function(e){return t&&t.cancel(e)})}}.apply(null,r))||(e.exports=i)},1730:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1519),n(1710)],void 0===(i=function(e,t,n,r){function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,n,r,i){i||(i=g(null,!0)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t,o=void 0;a<n;a++)o=e.children[a],s(i,e.leaf?r(o):o);return i}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function d(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function h(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function v(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,t,n,i,a){for(var o=[t,n];o.length;)if(!((n=o.pop())-(t=o.pop())<=i)){var s=t+Math.ceil((n-t)/i/2)*i;r(e,s,t,n,a),o.push(t,s,s,n)}}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=c,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var n=this.data,r=this.toBBox;if(v(e,n))for(b.clear();n;){for(var i=0,a=n.children.length;i<a;i++){var o=n.children[i],s=n.leaf?r(o):o;v(e,s)&&(n.leaf?t(o):f(e,s)?this._all(o,t):b.push(o))}n=b.pop()}},e.prototype.collides=function(e){var t=this.data,n=this.toBBox;if(!v(e,t))return!1;for(b.clear();t;){for(var r=0,i=t.children.length;r<i;r++){var a=t.children[r],o=t.leaf?n(a):a;if(v(e,o)){if(t.leaf||f(e,o))return!0;b.push(a)}}t=b.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var n=0,r=t;n<r;n++)this.insert(e[n]);return this}var i=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var a=this.data;this.data=i,i=a}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=g([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var n,r,a,o,s=this.data,l=this.toBBox(e);for(x.clear(),S.clear();s||x.length;){if(s||(s=x.pop(),n=x.data[x.length-1],r=S.pop(),a=!0),s.leaf&&-1!==(o=i(e,s.children,t)))return s.children.splice(o,1),x.push(s),this._condense(x),this;a||s.leaf||!f(s,l)?n?(r++,s=n.children[r],a=!1):s=null:(x.push(s),S.push(r),r=0,n=s,s=s.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(_.clear();e;){if(!0===e.leaf)for(var n=0,r=e.children;n<r.length;n++){t(r[n])}else _.pushArray(e.children);e=_.pop()}},e.prototype._build=function(e,t,n,r){var i,o=n-t+1,s=this._maxEntries;if(o<=s)return a(i=g(e.slice(t,n+1),!0),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=g([],!1)).height=r;var l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));m(e,t,n,c,this.compareMinX);for(var d=t;d<=n;d+=c){var u=Math.min(d+c-1,n);m(e,d,u,l,this.compareMinY);for(var p=d;p<=u;p+=l){var h=Math.min(p+l-1,u);i.children.push(this._build(e,p,h,r-1))}}return a(i,this.toBBox),i},e.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==n;){for(var i=1/0,a=1/0,o=void 0,s=0,l=t.children.length;s<l;s++){var c=t.children[s],u=d(c),h=p(e,c)-u;h<a?(a=h,i=u<i?u:i,o=c):h===a&&u<i&&(i=u,o=c)}t=o||t.children[0]}return t},e.prototype._insert=function(e,t,n){var r=this.toBBox,i=n?e:r(e);x.clear();var a=this._chooseSubtree(i,this.data,t,x);for(a.children.push(e),s(a,i);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;this._adjustParentBBoxes(i,x,t)},e.prototype._split=function(e,t){var n=e.data[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=g(n.children.splice(o,n.children.length-o),n.leaf);s.height=n.height,a(n,this.toBBox),a(s,this.toBBox),t?e.data[t-1].children.push(s):this._splitRoot(n,s)},e.prototype._splitRoot=function(e,t){this.data=g([e,t],!1),this.data.height=e.height+1,a(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,n){var r,i,a;r=i=1/0;for(var s=t;s<=n-t;s++){var l=o(e,0,s,this.toBBox),c=o(e,s,n,this.toBBox),u=h(l,c),p=d(l)+d(c);u<r?(r=u,a=s,i=p<i?p:i):u===r&&p<i&&(i=p,a=s)}return a},e.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},e.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,a=o(e,0,t,i),l=o(e,n-t,n,i),c=u(a)+u(l),d=t;d<n-t;d++){var p=e.children[d];s(a,e.leaf?i(p):p),c+=u(a)}for(d=n-t-1;d>=t;d--){p=e.children[d];s(l,e.leaf?i(p):p),c+=u(l)}return c},e.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)s(t.data[r],e)},e.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(n=e.data[t-1].children).splice(n.indexOf(e.data[t]),1):this.clear():a(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=y;var b=new n({initialSize:50}),_=new n({initialSize:50}),x=new n({initialSize:10}),S=new n({initialSize:10});t.default=y}.apply(null,r))||(e.exports=i)},1746:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(57),n(4),n(18),n(15),n(7),n(16),n(1),n(30),n(60),n(1696),n(1747),n(1781),n(1782),n(1784),n(1786),n(1787),n(1501),n(1674)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x){var S=function(e){function t(t){var n=e.call(this)||this;return n._handles=new s,n.highlights=new m,n.suspendResumeExtentMode="computed",n.dataExtent=null,n.suspendResumeExtent=null,n}return n(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=!e.queryGraphicUIDsInExtent&&(e.scaleVisibilityEnabled||e.elevationAlignmentEnabled)?new b({spatialReference:e.owner.view.spatialReference}):null,n=e.frustumVisibilityEnabled?new g:null,r=e.scaleVisibilityEnabled?new y:null,i=e.elevationAlignmentEnabled?new v:null,a=new f({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,basemapTerrain:e.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled}),o=e.updateClippingExtent,s=e.queryGraphicUIDsInExtent,l=e.suspendResumeExtentMode,c=e.dataExtent;return{graphicsCore:a,frustumVisibility:n,scaleVisibility:r,elevationAlignment:i,spatialIndex:t,updateClippingExtent:o,suspendResumeExtentMode:l,dataExtent:c,queryGraphicUIDsInExtent:s||function(e,n,r){return t.queryGraphicUIDsInExtent(e,n,r)}}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(){return e.graphicsCore.elevationInfoChange()})),this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(){return e.graphicsCore.updateLabelingInfo()}))),this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.elevationAlignment,this.graphicsCore]},t.prototype.setup=function(){var e=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var t=this.owner.view.basemapTerrain,n=this.owner.view.elevationProvider;return this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,t),this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,this.graphicsCore,n),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex)),this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,labeling:this.labeling,highlights:this.highlights}),this._handles.add([this.layer.watch("renderer",function(t){return e.graphicsCore.rendererChange(t)}),this.owner.watch("fullOpacity",function(){return e.graphicsCore.opacityChange()})]),this._handles.add(this.layer.on("graphic-update",function(t){return e.graphicsCore.graphicUpdateHandler(t)})),this.setupSuspendResumeExtent(),this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return e.needsIdleUpdate()},idleFrame:function(t){return e.idleUpdate(t)}})),this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return e._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():l.resolve()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null),this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null)),this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null)),this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null)),this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null)),this.highlights&&(this.highlights.destroy(),this._set("highlights",null)),this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,n){var r=this;if(e instanceof p){var a=this.highlights.acquireSet(t,n),s=a.set,l=a.handle;return this.owner.queryObjectIds(e).then(function(e){return r.highlights.setObjectIds(s,e)}),l}if("number"==typeof e)return this.highlight([e],t,n);if(e instanceof i)return this.highlight([e],t,n);if(e instanceof o&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof i){var c=e;if(!n||!c[0].attributes||null===x.attributeLookup(c[0].attributes,n)){var d=c.map(function(e){return e.uid}),u=this.highlights.acquireSet(t,null),h=u.set;l=u.handle;return this.highlights.setUids(h,d),l}e=c.map(function(e){return x.attributeLookup(e.attributes,n)})}if("number"==typeof e[0]){var f=e,v=this.highlights.acquireSet(t,n);h=v.set,l=v.handle;return this.highlights.setObjectIds(h,f),l}}return{remove:function(){}}},t.prototype.needsIdleUpdate=function(){for(var e=0,t=this.idleClients;e<t.length;e++){var n=t[e];if(n&&n.needsIdleUpdate())return!0}return!1},t.prototype.idleUpdate=function(e){for(var t=0,n=this.idleClients;t<n.length;t++){var r=n[t];r&&r.idleUpdate(e)}},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(c.init(this,"suspendResumeExtentMode",function(t){switch(e._handles.remove(w),e.suspendResumeExtentMode){case"computed":e._handles.add(c.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),w);break;case"data":e._handles.add(c.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),w);break;default:e.suspendResumeExtentMode}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var n=this.owner.view.spatialReference;if(!e.spatialReference.equals(n)){if(!u.canProject(e,n))return;e=u.project(e,n)}return _.enlargeExtent(e,t,h.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r([d.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r([d.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r([d.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r([d.property({constructOnly:!0})],t.prototype,"queryGraphicUIDsInExtent",void 0),r([d.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r([d.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),r([d.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r([d.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r([d.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r([d.property({readOnly:!0})],t.prototype,"labeling",void 0),r([d.property({readOnly:!0})],t.prototype,"highlights",void 0),r([d.property()],t.prototype,"suspendResumeExtentMode",void 0),r([d.property()],t.prototype,"dataExtent",void 0),r([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],t.prototype,"updating",null),r([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(d.declared(a)),w="suspendResumeExtentMode";return S}.apply(null,r))||(e.exports=i)},1747:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(1513),n(1516),n(26),n(27),n(491),n(151),n(4),n(251),n(8),n(15),n(1529),n(9),n(99),n(1519),n(7),n(16),n(1),n(473),n(56),n(51),n(252),n(496),n(1748),n(488),n(1566),n(1749),n(1550),n(1697),n(1750),n(1751),n(1778),n(1501),n(49),n(80),n(98),n(1779),n(1511),n(1780),n(1672)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A,C,O,R,E,P,T,D,I,M,L,V,F,z,U,N,B,j,G){function H(e){var t=e.elevationInfo&&e.elevationInfo.unit;t&&!E.supportsUnit(t)&&X.warn("elevationInfo.unit","'"+t+"' is not a valid unit")}var k=F.vec3d,W=new s.Point,q=k.create(),$=x.create(),X=v.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),Y=function(e){function t(t){var n=e.call(this)||this;return n.propertiesPool=new N.PropertiesPool({computedExtent:s.Extent},n),n.computedExtent=null,n.symbolCreationContext=new I.Graphics3DSymbolCreationContext,n.graphics={},n.stageLayer=null,n.stage=null,n.graphicsDrapedUids={},n.graphicsBySymbol={},n.graphicsKeys=[],n.symbols={},n.graphicsWithoutSymbol={},n.graphicsWaitingForSymbol=new Set,n.lastFastUpdate=null,n.tilingSchemeHandle=null,n.handles=new h,n.viewSR=null,n.elevationAlignment=null,n.scaleVisibility=null,n.spatialIndex=null,n.labeling=null,n.highlights=null,n.elevationQueryService=null,n.elevationQueryView=null,n.sharedSymbolResourcesOwnerHandle=null,n.whenGraphics3DGraphicRequests={},n.pendingUpdates=new Map,n.pendingUpdatesPool=new m({initialSize:2e3,allocator:function(){return{add:null,remove:null}},deallocator:function(e){e.add=null,e.remove=null}}),n.symbolWarningLogged=!1,n.geometryWarningLogged=!1,n.asyncUpdates=!1,n.elevationFeatureExpressionEnabled=!0,n.owner=null,n.layer=null,n.hasDraped=!1,n.minTotalNumberOfFeatures=2e3,n.numberOfGraphics=0,n._visible=void 0,n}var d;return n(t,e),d=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumberOfFeatures",{get:function(){var e=Math.ceil((this.maxTotalNumberOfVertices||1)/this.maxSymbolNumberOfVertices);return z.clamp(e,this.minTotalNumberOfFeatures,this.maxTotalNumberOfFeatures||1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolNumberOfVertices",{get:function(){var e=0;for(var t in this.symbols){var n=this.symbols[t];n&&(e=Math.max(e,n.numberOfVertices))}return 0===e?this._get("maxSymbolNumberOfVertices")||1:e},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("spatialIndex",e.spatialIndex),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var n=this.owner.view;this.elevationQueryService=new P.ElevationQuery(this.viewSR,function(){return n.map.ground},{maximumAutoTileRequests:4}),this.elevationQueryView=new P.ElevationQueryView(this.viewSR,n.basemapTerrain),this.initializeStage(n,this.layer.uid),this.symbolCreationContext.sharedResources=n.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=n.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.layer.renderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=n.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=n.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=n.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=d.createLocalOriginFactory(),this.symbolCreationContext.elevationProvider=n.elevationProvider,H(this.layer);var r=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=T.createContext(r,this.viewSR,X),n.deconflictor.addGraphicsOwner(this),this.symbolCreationContext.screenSizePerspectiveEnabled=n.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.tilingSchemeHandle=b.when(this.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference,t.recreateAllGraphics())}),this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var i="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add(this.owner.watch(i,function(){var e=n.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())})),this.handles.add(b.on(this.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){t.clearSymbolsAndGraphics(),t.graphicsCollectionChanged({added:t.owner.loadedGraphics.toArray(),removed:[]})})),this.validateRenderer(this.layer.renderer)},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(B.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null},t.prototype.clear=function(){for(var e in this.graphics)this.graphics[e].destroy();for(var t in this.spatialIndex&&this.spatialIndex.clear(),this.graphics={},this.graphicsKeys=null,this.numberOfGraphics=0,this.updateLayerVisibility(),this.symbols){var n=this.symbols[t];n&&n.destroy()}this.symbols={},this.graphicsBySymbol={},this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this._set("hasDraped",!1),this.notifyChange("updating")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new G(t,{isPickable:!this.owner.suspended},t),this.stage.add(B.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;for(var n in this.symbols){var r=this.symbols[n];r&&r.setDrawOrder(e,t)}t.size>0&&this.stage.getDrapedTextureRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.maxNumberOfFeatures*J,n=!e&&!t;n!==this._visible&&(this._visible=n,n?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()))},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics[e]},Object.defineProperty(t.prototype,"graphics3DGraphicsKeys",{get:function(){return null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics)),this.graphicsKeys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){return this.labeling&&this.labeling.labelingInfoChange(e)},t.prototype.updateVisibilityInfo=function(){return this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){if(this.pendingUpdates.size>0)return"unknown";var e=0,t=0;for(var n in this.symbols){var r=this.symbols[n];if(r){var i=r.getFastUpdateStatus();if(i.loading>0)return"unknown";this.graphicsBySymbol[n]&&(t+=i.fast,e+=i.slow)}}return t>=0&&0===e?"fast":e>=0&&0===t?"slow":"mixed"},enumerable:!0,configurable:!0}),t.prototype.needsIdleUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&performance.now()-this.lastFastUpdate>500},t.prototype.idleUpdate=function(e){var t=this.needsIdleUpdate();this._applyPendingUpdates(e),!e.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsIdleUpdate()&&this.notifyChange("updating")},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics[e.uid];if(t)return y.resolve(t);var n=this.whenGraphics3DGraphicRequests[e.uid];return n||(n=new o,this.whenGraphics3DGraphicRequests[e.uid]=n),n.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return a(this,void 0,void 0,function(){var n,r,a,o,s,l,c,d,u,p,h;return i(this,function(i){switch(i.label){case 0:return n=this.owner.view.spatialReference,r=this.owner.view.renderSpatialReference,a=this.owner.view.basemapTerrain.spatialReference,o=function(e,t,i){return U.bufferToBuffer(e,r,t,e,n,t,i)},s=function(e,t,r){return U.bufferToBuffer(e,a,t,e,n,t,r)},l=t&&t.useViewElevation?this.elevationQueryView:this.elevationQueryService,c=null,l&&(c={service:t&&t.useViewElevation?this.elevationQueryView:this.elevationQueryService,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}),[4,e.getProjectedBoundingBox(o,s,c)];case 1:return(d=i.sent())?(u=d.boundingBox,d.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(x.center(u,q),W.x=q[0],W.y=q[1],W.z=void 0,W.spatialReference=n,h=p.getElevation(W)||0,u[2]=Math.min(u[2],h),u[5]=Math.max(u[5],h)),[2,{boundingBox:u,screenSpaceObjects:d.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var n=this;return b.whenOnce(this.owner,"loadedGraphics").then(function(){var t=n.owner.layer&&n.owner.layer.objectIdField,r=n.owner.loadedGraphics.find(function(n){return n===e||t&&n.attributes&&e.attributes&&n.attributes[t]===e.attributes[t]});if(r)return n.whenGraphics3DGraphic(r);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return n.boundsForGraphics3DGraphic(e,t)})},t.prototype.graphicsCollectionChanged=function(e){this.add(e.added),this.remove(e.removed)},t.prototype.graphicUpdateHandler=function(e){if("visible"===e.property){var t=this.graphics[e.graphic.uid];t&&t.setVisibilityFlag(0,e.newValue)&&this.labeling&&(this.lastFastUpdate=performance.now(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}},t.prototype.beginGraphicUpdate=function(e,t){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype.endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")),this._get("symbolsUpdating")&&0===this.graphicsWaitingForSymbol.size&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))},t.prototype.expandComputedExtent=function(e){var t=$,n=e.spatialReference;A.computeAABB(e,t);var r=this.viewSR,i=d.tmpVec;if(n.equals(r)||U.xyzToVector(t[0],t[1],0,n,i,r)&&(t[0]=i[0],t[1]=i[1],U.xyzToVector(t[3],t[4],0,n,i,r),t[3]=i[0],t[4]=i[1]),z.isFinite(t[0])&&z.isFinite(t[3])&&z.isFinite(t[1])&&z.isFinite(t[4])){var a=this.computedExtent,o=null,s=z.isFinite(t[2])&&z.isFinite(t[5]),l=s&&(!a||null==a.zmin||t[2]<a.zmin),c=s&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||l||c)&&((o=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),o.ymin=Math.min(t[1],a.ymin),o.xmax=Math.max(t[3],a.xmax),o.ymax=Math.max(t[4],a.ymax),o.spatialReference=r):((o=this.propertiesPool.get("computedExtent")).xmin=t[0],o.ymin=t[1],o.xmax=t[3],o.ymax=t[4],o.spatialReference=r),o&&(l&&(o.zmin=t[2]),c&&(o.zmax=t[5]),this._set("computedExtent",o))}},t.prototype.updateHasDraped=function(){var e=!1;for(var t in this.graphicsDrapedUids)if(this.graphicsDrapedUids.hasOwnProperty(t)){e=!0;break}this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){H(this.layer);var e=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);for(var t in this.symbolCreationContext.featureExpressionInfoContext=T.createContext(e,this.viewSR,X),this.labeling&&this.labeling.elevationInfoChange(),this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer),this.graphicsBySymbol){var n=this.symbols[t],r=this.graphicsBySymbol[t];if(n&&n.layerPropertyChanged("elevationInfo",r))for(var i in r)for(var a=r[i],o=a.graphic,s=a._labelGraphics,l=0;l<s.length;l++){var c=s[l];c.graphics3DSymbolLayer.updateGraphicElevationContext(o,c)}else this._recreateSymbol(t)}this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.labeling&&this.labeling.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray())},t.prototype._recreateSymbol=function(e){var t=this.graphicsBySymbol[e],n=[],r=[];for(var i in t){var a=t[i];a.isDraped()&&delete this.graphicsDrapedUids[i],this.spatialIndex&&n.push(a),r.push(a.graphic),a.destroy(),this.removeGraphics3DGraphic(i),this.updateLayerVisibility()}n.length>0&&this.spatialIndex.removeMany(n),this.graphicsBySymbol[e]={};var o=this.symbols[e];o&&o.destroy(),delete this.symbols[e],this.updateHasDraped(),this.add(r)},t.prototype.add=function(e){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")):X.error("#add()","Cannot add graphics before terrain surface has been initialized")},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,Q.clear();for(var n=0,r=e;n<r.length;n++){var i=r[n];this._startAddGraphic(i,Q)}Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),this.updateHasDraped(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype._addDelayed=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.uid,a=this.pendingUpdates.get(i);if(a)a.add=r;else{var o=this.pendingUpdatesPool.pushNew();o.add=r,this.pendingUpdates.set(i,o)}}},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],a=this._removeGraphic(i);this.spatialIndex&&a&&t.push(a)}t.length>0&&this.spatialIndex.removeMany(t),this.updateHasDraped(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.uid,a=this.pendingUpdates.get(i);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(i));else{var o=this.pendingUpdatesPool.pushNew();o.remove=r,this.pendingUpdates.set(i,o)}}0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear()},t.prototype._applyPendingUpdates=function(e){var t=this;if(!e.done()){this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var n=[],r=0;Q.clear(),f.forEachUntilMap(this.pendingUpdates,function(i,a){if(e.done())return!1;if(i.remove){var o=t._removeGraphic(i.remove);t.spatialIndex&&o&&n.push(o)}i.add&&t._startAddGraphic(i.add,Q)&&r++,t.pendingUpdates.delete(a),r>1e3&&(Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),r=0)}),Q.forEach(function(e){return t._finishAddGraphics(e)}),Q.clear(),n.length>0&&this.spatialIndex.removeMany(n),0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear(),this.updateHasDraped(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()}},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var n=e.geometry;if(!n)return this.geometryWarningLogged||(this.geometryWarningLogged=!0,X.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),!1;var r=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(e);if(!r||!r.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,X.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),!1;var i=r.symbol,a=this.getOrCreateGraphics3DSymbol(i,r.renderer);if(!a)return!1;var o={graphic:e,renderingInfo:r,layer:this.layer};this.expandComputedExtent(n),this.beginGraphicUpdate(e,a);var s=a.symbol.id,l=t.get(s);if(l)l.graphics.push(o);else{var c=K.acquire();c.clear(),c.push(o),t.set(s,{asyncSymbol:a,graphics:c})}return!0},t.prototype._finishAddGraphics=function(e){var t=this;e.asyncSymbol.then(function(){Z.clear();for(var n=0;n<e.graphics.length;n++){var r=e.graphics.data[n],i=r.graphic;if(t.graphicsWaitingForSymbol.has(i.uid)){var a=t.createGraphics3DGraphic(e.asyncSymbol,r);t.spatialIndex&&a&&Z.push(a)}t.endGraphicUpdate(i)}Z.length>0&&t.spatialIndex.addMany(Z.data,Z.length),Z.clear(),e.graphics.clear(),K.release(e.graphics),t.labeling&&(t.lastFastUpdate=performance.now(),t.owner.view.labeler.setDirty())},function(){for(var n=0;n<e.graphics.length;n++)t.endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),K.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,n=this.graphics[t];if(n){n.isDraped()&&delete this.graphicsDrapedUids[t];var r=n.graphics3DSymbol.symbol.id;n.destroy(),delete this.graphicsBySymbol[r][t],delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t),this.labeling&&this.labeling.removeGraphic(n)}else this.graphicsWaitingForSymbol.delete(t);return n},t.prototype.hasLabelingContext=function(e){if(e instanceof c.LabelSymbol3D||e instanceof c.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof c.LabelSymbol3D&&!this.hasLabelingContext(e)&&(X.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype.createGraphics3DSymbol=function(e,t){var n=this;if(!this.hasValidSymbolCreationContext(e))return null;var r=R.to3D(e,!0,!1,this.hasLabelingContext(e));if(r.symbol){var i=void 0;if(t&&t.backgroundFillSymbol){var a=R.to3D(t.backgroundFillSymbol,!1,!0);a.symbol&&(i=a.symbol.symbolLayers)}var o=M.make(r.symbol,this.symbolCreationContext,i);return o.then(function(){n.notifyChange("maxSymbolNumberOfVertices")}),o}return r.error&&X.error(r.error.message),null},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var n=this,r=this.symbols[e.id];return void 0===r&&(r=e instanceof c.WebStyleSymbol?new L(e,function(e){return n.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols[e.id]=r),r},t.prototype.addGraphics3DGraphic=function(e){this.graphics[e.graphic.uid]=e,this.graphicsKeys=null,this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e){delete this.graphics3DGraphics[e],this.graphicsKeys=null,this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var n=t.graphic;if(delete this.graphicsWithoutSymbol[n.uid],this.symbols[e.symbol.id]){if(!this.graphics[n.uid]){var r=e.createGraphics3DGraphic(t),i=e.symbol.id;this.addGraphics3DGraphic(r),this.graphicsBySymbol[i]||(this.graphicsBySymbol[i]={}),this.graphicsBySymbol[i][n.uid]=r,r.initialize(this.stageLayer,this.stage),r.isDraped()&&(this.graphicsDrapedUids[n.uid]=!0,this._set("hasDraped",!0)),r.centroid=null,"point"!==n.geometry.type&&r instanceof D&&(r.centroid=V.computeCentroid(n.geometry),r.centroid&&V.convertPointSR(r.centroid,this.viewSR));var a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.labeling&&this.labeling.addGraphic(r),a&&this.scaleVisibility.updateGraphicScaleVisibility(r);var o=!!n.visible&&!this.owner.suspended;r.setVisibilityFlag(0,o),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this.layer,r);var s=this.whenGraphics3DGraphicRequests[n.uid];return s&&(delete this.whenGraphics3DGraphicRequests[n.uid],s.resolve(r)),this.highlights&&this.highlights.graphicCreated(r),r}}else this.add([n])},t.prototype.rendererChange=function(e){var t=this.symbolCreationContext.renderer;if(e!==t){this.validateRenderer(e);var n=C.diff(t,e);this.updateUnchangedSymbolMappings(n,e,t),this.symbolCreationContext.renderer=e,n&&("complete"===n.type?this.recreateAllGraphics():"partial"===n.type&&(this.applyRendererDiff(n,e,t)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,n,r){e=e||[],t=t||[];for(var i=[],a=0;a<t.length;a++){var o=t[a],s=this.graphicsBySymbol[o.id];for(var l in s){var c=s[l],d=c.graphic,u=this.layer instanceof w?this.layer:null;o===n.defaultSymbol&&n.getSymbol(A.hydrateGraphic(d,u))===n.defaultSymbol||(c.isDraped()&&delete this.graphicsDrapedUids[l],e.length||n.defaultSymbol?i.push(d):this.graphicsWithoutSymbol[l]=d,c.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[l]),delete s[l],this.removeGraphics3DGraphic(l),this.updateLayerVisibility())}if(void 0===s||0===Object.keys(s).length){delete this.graphicsBySymbol[o.id];var p=this.symbols[o.id];p&&p.destroy(),delete this.symbols[o.id],this.notifyChange("maxSymbolNumberOfVertices")}}if(e.length||i.length){for(var l in this.graphicsWithoutSymbol)i.push(this.graphicsWithoutSymbol[l]);this.graphicsWithoutSymbol={},this.add(i)}this.updateHasDraped(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,n){var r=e.diff.defaultSymbol,i=e.diff.uniqueValueInfos;if(r||i){var a=i?i.added.map(function(e){return e.symbol}):[],o=i?i.removed.map(function(e){return e.symbol}):[];if(i)for(var s=0;s<i.changed.length;s++)a.push(i.changed[s].newValue.symbol),o.push(i.changed[s].oldValue.symbol);return r?(n.defaultSymbol&&o.push(n.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):n.defaultSymbol&&a.length&&o.push(t.defaultSymbol),this.applySymbolSetDiff(a,o,t,n),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,n){if(t instanceof l.UniqueValueRenderer&&n instanceof l.UniqueValueRenderer)if(e){if("partial"===e.type){var r=e.diff,i=r.defaultSymbol,a=r.uniqueValueInfos,o=void 0;return o=a?a.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):n.uniqueValueInfos.map(function(e,n){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[n].symbol.id}}),!i&&n.defaultSymbol&&o.push({oldId:n.defaultSymbol.id,newId:t.defaultSymbol.id}),o}}else if(n&&n.defaultSymbol)return[{oldId:n.defaultSymbol.id,newId:t.defaultSymbol.id}];return[]},t.prototype.updateUnchangedSymbolMappings=function(e,t,n){for(var r=0,i=this.calculateUnchangedSymbolMapping(e,t,n);r<i.length;r++){var a=i[r],o=a.oldId,s=a.newId;if(o&&o!==s){var l=this.graphicsBySymbol[o];delete this.graphicsBySymbol[o],void 0!==l&&(this.graphicsBySymbol[s]=l);var c=this.symbols[o];delete this.symbols[o],void 0!==c&&(this.symbols[s]=c,c.symbol.id=s)}}},t.prototype.applyRendererDiff=function(e,t,n){if(this.diffHasSymbolChange(e))return!1;if(t instanceof l.UniqueValueRenderer&&n instanceof l.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,n)&&0===Object.keys(e.diff).length)return!0;for(var r in this.graphicsBySymbol){var i=this.symbols[r];if(i){var a=this.graphicsBySymbol[r];if(!i.applyRendererDiff(e,t,a))return!1}}return!0},t.prototype.opacityChange=function(){for(var e in this.graphicsBySymbol){var t=this.symbols[e];t&&t.layerPropertyChanged("opacity")}},t.prototype.setClippingExtent=function(e,t){var n=this.symbolCreationContext.clippingExtent,r=S.create();return U.extentToBoundingRect(e,r,t)?this.symbolCreationContext.clippingExtent=[r[0],r[1],-1/0,r[2],r[3],1/0]:this.symbolCreationContext.clippingExtent=null,!u.equals(this.symbolCreationContext.clippingExtent,n)},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var n=!1;this.owner.loadedGraphics.forEach(function(r){var i=t.getGraphics3DGraphicById(r.uid);i&&e(i,r)&&(n=!0)}),n&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.forEachGraphics3DGraphic(function(t,n){var r=t.setVisibilityFlag(0,n.visible),i=!1;return e.scaleVisibility&&(i=e.scaleVisibility.updateGraphicScaleVisibility(t)),r||i})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1)})},t.prototype.validateRenderer=function(e){var t=O.validateTo3D(e);if(t){var n="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";X.warn(n,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now(),this.labeling.clear()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.createLocalOriginFactory=function(){return new j(5e6,16)},t.prototype.snapshotInternals=function(){var e=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:Object.keys(e.graphicsBySymbol[t]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:Object.keys(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},t.tmpVec=F.vec3d.create(),r([_.property({readOnly:!0})],t.prototype,"computedExtent",void 0),r([_.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),r([_.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),r([_.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),r([_.property({readOnly:!0})],t.prototype,"labeling",void 0),r([_.property({readOnly:!0})],t.prototype,"highlights",void 0),r([_.property()],t.prototype,"asyncUpdates",void 0),r([_.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),r([_.property({constructOnly:!0})],t.prototype,"owner",void 0),r([_.property({constructOnly:!0})],t.prototype,"layer",void 0),r([_.property({constructOnly:!0})],t.prototype,"basemapTerrain",void 0),r([_.property({readOnly:!0})],t.prototype,"hasDraped",void 0),r([_.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),r([_.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],t.prototype,"updating",null),r([_.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfVertices"})],t.prototype,"maxTotalNumberOfVertices",void 0),r([_.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures"})],t.prototype,"maxTotalNumberOfFeatures",void 0),r([_.property()],t.prototype,"minTotalNumberOfFeatures",void 0),r([_.property({readOnly:!0,dependsOn:["maxSymbolNumberOfVertices","maxTotalNumberOfVertices","minTotalNumberOfFeatures","maxTotalNumberOfFeatures"]})],t.prototype,"maxNumberOfFeatures",null),r([_.property({readOnly:!0})],t.prototype,"maxSymbolNumberOfVertices",null),d=r([_.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(_.declared(d)),Q=new Map,Z=new m,K=new g(m),J=10;return Y}.apply(null,r))||(e.exports=i)},1748:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(8),n(488)],void 0===(i=function(e,t,n,r){function i(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var i=r.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});i.sort();var a=[];return i.forEach(function(e,t){0!==t&&e===i[t-1]||a.push(e)}),new n("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:r})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return i(e,r.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),n=r.to3D(e.defaultSymbol);return n.error&&t.unshift(n.error),i(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),n=r.to3D(e.defaultSymbol);return n.error&&t.unshift(n.error),i(e,t)}(e):new n("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,r))||(e.exports=i)},1749:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1513),n(1516),n(10),n(26),n(27),n(7),n(58)],void 0===(i=function(e,t,n,r,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){this.spatialReference=e,this.elevationProvider=t,this.point=new o.Point,this.point.spatialReference=e}return e.prototype.queryElevation=function(e,t){return r(this,void 0,void 0,function(){return n(this,function(n){return this.point.x=e,this.point.y=t,[2,s.resolve(this.elevationProvider&&this.elevationProvider.getElevation(this.point)||0)]})})},e}();t.ElevationQueryView=c;var d=function(){function e(e,t,n){this.spatialReference=e,this._getElevationQueryProvider=t,this._queries=[],this._isScheduled=!1,this._queryOptions=i({},n,{ignoreInvisibleLayers:!0})}return e.prototype.queryElevation=function(e,t,i){return void 0===i&&(i=0),r(this,void 0,void 0,function(){var r;return n(this,function(n){return r=new a,this._queries.push({x:e,y:t,minDemResolution:i,result:r}),this._scheduleDoQuery(),[2,r.promise]})})},e.prototype._scheduleDoQuery=function(){var e=this;this._isScheduled||(l.schedule(function(){return e._doQuery()}),this._isScheduled=!0)},e.prototype._doQuery=function(){return r(this,void 0,void 0,function(){var e,t,r,a,s,l,c,d,u;return n(this,function(n){switch(n.label){case 0:if(this._isScheduled=!1,e=this._queries,this._queries=[],t=e.map(function(e){return[e.x,e.y]}),r=e.reduce(function(e,t){return Math.min(e,t.minDemResolution)},1/0),a=new o.Multipoint({points:t,spatialReference:this.spatialReference}),!(s=this._getElevationQueryProvider()))return e.forEach(function(e,t){return e.result.reject()}),[2];c=i({},this._queryOptions,{minDemResolution:r}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s.queryElevation(a,c)];case 2:return l=n.sent(),[3,4];case 3:return d=n.sent(),e.forEach(function(e){return e.result.reject(d)}),[2];case 4:return u=l.geometry.points,e.forEach(function(e,t){return e.result.resolve(u[t][2])}),[2]}})})},e}();t.ElevationQuery=d}.apply(null,r))||(e.exports=i)},1750:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.sharedResources=null,this.streamDataSupplier=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0}}();t.Graphics3DSymbolCreationContext=n}.apply(null,r))||(e.exports=i)},1751:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1752),n(1699)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,i){var a;switch(e.type){case"point-3d":a=n;break;default:a=r}return new a(e,t,i)}}.apply(null,r))||(e.exports=i)},1752:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1753),n(1699)],void 0===(i=function(e,t,n,r,i){return function(e){function t(t,n,i){var a=e.call(this,t,n,i)||this;return a.calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=r.make(a.symbol,n)),a}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createGraphics3DGraphic=function(t,n,r){var i=e.prototype.createGraphics3DGraphic.call(this,t,r);if(this.calloutSymbolLayer){var a=this.createCalloutGraphic(t);a&&i.addAuxiliaryGraphic(a)}return i},t.prototype.layerPropertyChanged=function(t,n){var r=this;if(!e.prototype.layerPropertyChanged.call(this,t,n))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.layerPropertyChanged(t,n,function(e){for(var t=0,n=e._auxiliaryGraphics;t<n.length;t++){var i=n[t];if(i.graphics3DSymbolLayer===r.calloutSymbolLayer)return i}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo;return e.renderingInfo={renderer:t.renderer,symbol:t.symbol,needsOffsetAdjustment:t.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null},this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(i)}.apply(null,r))||(e.exports=i)},1753:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(256),n(1754)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");t.make=function(e,t){if(!r.isCalloutSupport(e))return a.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+e.type+"' does not support callouts"),null;if(!e.callout)return null;var n=o[e.callout.type];return n?new n(e,t):(a.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)};var o={line:i}}.apply(null,r))||(e.exports=i)},1754:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(25),n(32),n(1536),n(1531),n(1520),n(1525),n(1501),n(1511),n(1518),n(1527),n(1487),n(1557)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f){var v,g,m=h.VertexAttrConstants,y=function(e){function t(t,n){var r=e.call(this,t,null,n,!0)||this;return r._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(d.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype._prepareResources=function(){var e=this._getStageIdHint();this._createMaterialsAndAddToStage(this._context.stage,e),this.resolve()},t.prototype.perInstanceMaterialParameters=function(e){var t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t},Object.defineProperty(t.prototype,"materialParameters",{get:function(){var e=this.symbolContainer,t=e.callout,n=r.toUnitRGBA(t.color);n[3]*=this._getLayerOpacity();var a=i.pt2px(t.size||0),o=null;if(e.verticalOffset){var s=e.verticalOffset,l=s.screenLength,c=s.minWorldLength,d=s.maxWorldLength;o={screenLength:i.pt2px(l),minWorldLength:c||0,maxWorldLength:null!=d?d:1/0}}var u=t.border&&t.border.color?r.toUnitRGBA(t.border.color):null,p="object"===e.symbolLayers.getItemAt(0).type,h="label-3d"===e.type,f=!p,v=p?0:void 0,g=h;return{color:n,size:a,verticalOffset:o,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:u,occlusionTest:f,shaderPolygonOffset:v,depthHUDAlignStart:g}},enumerable:!0,configurable:!0}),t.prototype._createMaterialsAndAddToStage=function(e,t){this._material=new f(this.materialParameters,t+"_lineCallout_common"),e.add(d.ModelContentType.MATERIAL,this._material)},t.prototype._defaultElevationInfoNoZ=function(){return S},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,n=e.graphic;null!=t.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=t.needsOffsetAdjustment);var r=this.getGraphicElevationContext(n,t.elevationOffset||0),i=t.symbol,a="on-the-ground"===this._elevationContext.mode&&!i.symbolLayers.some(function(e){return"object"===e.type||"text"===e.type});if("label-3d"!==i.type&&a)return null;var o=c.computeCentroid(n.geometry);if(null==o)return null;var s="graphic"+n.uid;return this._createAs3DShape(n,o,r,t,s,n.uid)},t.prototype.layerPropertyChanged=function(e,t,n){switch(e){case"opacity":return this.layerOpacityChanged(t,n);case"elevationInfo":return this.layerElevationInfoChanged(t,n)}return!1},t.prototype.layerOpacityChanged=function(e,t){return this._material.setParameterValues(this.materialParameters),!0},t.prototype.layerElevationInfoChanged=function(e,t){var n=this._elevationContext.mode;this._updateElevationContext();var r=this._elevationContext.mode;if(n!==r&&("on-the-ground"===n||"on-the-ground"===r))return!1;for(var i in e){var a=e[i],o=t(a);o&&this.updateGraphicElevationContext(a.graphic,o)}return!0},t.prototype.getGraphicElevationContext=function(t,n){void 0===n&&(n=0);var r=e.prototype.getGraphicElevationContext.call(this,t);return r.addOffsetRenderUnits(n),r},t.prototype.updateGraphicElevationContext=function(e,t){var n=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(n),t.needsElevationUpdates=s.needsElevationUpdates2D(n.mode)},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0}),t.prototype.createVertexData=function(e){var t,n=e.translation,r=e.centerOffset;if(!n&&!r)return b;var i=n?{size:3,data:[n[0],n[1],n[2]]}:b[m.POSITION],a=r?{size:4,data:[r[0],r[1],r[2],r[3]]}:b[m.AUXPOS1];return(t={})[m.POSITION]=i,t[m.NORMAL]=b[m.NORMAL],t[m.AUXPOS1]=a,t},t.prototype.getOrCreateMaterial=function(e,t){var n,r=this.perInstanceMaterialParameters(e),i=f.uniqueMaterialIdentifier(r);return i===this._material.uniqueMaterialIdentifier?{material:this._material,isUnique:!1}:e.materialCollection?((n=e.materialCollection.getMaterial(i))||(n=new f(r,t+"_lineCallout_shared"),e.materialCollection.addMaterial(i,n)),{material:n,isUnique:!1}):{material:n=new f(r,t+"_lineCallout_unique"),isUnique:!0}},t.prototype._createAs3DShape=function(e,t,n,r,i,l){var c=new p(this.createVertexData(r),x,p.DefaultOffsets,"point"),d=[new u(c,i)],h=this.getOrCreateMaterial(r,i),f=s.createStageObjectForPoint.call(this,t,d,[[h.material]],null,null,n,i,this._context.layer.uid,l,!0);if(null===f)return null;var v=a.perObjectElevationAligner,g=new o(this,f.object,d,h.isUnique?[h.material]:null,null,v,n);return g.metadata={elevationOffset:r.elevationOffset||0},g.alignedTerrainElevation=f.terrainElevation,g.needsElevationUpdates=s.needsElevationUpdates2D(n.mode),s.extendPointGraphicElevationContext(g,t,this._context.elevationProvider),g},t}(l),b=((v={})[m.POSITION]={size:3,data:[0,0,0]},v[m.NORMAL]={size:3,data:[0,0,1]},v[m.AUXPOS1]={size:4,data:[0,0,0,1]},v),_=new Uint32Array([0]),x=((g={})[m.POSITION]=_,g[m.NORMAL]=_,g[m.AUXPOS1]=_,g),S={mode:"relative-to-ground",offset:0};return y}.apply(null,r))||(e.exports=i)},1755:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(11),n(9),n(1757),n(1758),n(1761),n(1756),n(1762),n(1764),n(1774),n(1775),n(1776)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p){Object.defineProperty(t,"__esModule",{value:!0});var h=r.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");t.make=function(e,t,n,r){var i=v[e.type]&&v[e.type][t.type]||f[t.type];return i?new i(e,t,n,r):(h.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)};var f={icon:a,object:n("enable-feature:skallweit/lod-rendering")?c:l,line:o,path:d,fill:u,extrude:i,text:p},v={"mesh-3d":{fill:s}}}.apply(null,r))||(e.exports=i)},1756:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(25),n(473),n(509),n(30),n(193),n(1536),n(1531),n(1520),n(1525),n(1644),n(1643),n(49),n(1512),n(98),n(1511),n(1518),n(1527),n(1521),n(1549),n(1487),n(1515),n(1700)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A){var C=S.VertexAttrConstants,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._edgeStageObjects=new Set,t._materials={},t._textures={},t}return n(t,e),t.prototype._prepareResources=function(){v.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new A({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new A({color:[0,1,1,1]},"debugFAceNormal")),this.resolve()},t.prototype.destroy=function(){for(var t in e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._materials){var n=this._materials[t];this._context.stage.remove(m.ModelContentType.MATERIAL,n.material.id)}for(var t in this._textures){var r=this._textures[t];this._context.stage.remove(m.ModelContentType.TEXTURE,r.id)}this._materials={},this._textures={}},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("mesh"!==t.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var n="graphic"+t.uid,r=this.getGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,n,t.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._getLayerOpacity();for(var i in this._materials){var a=this._materials[i];a.material.setParameterValues({layerOpacity:r});var o=a.material.getParameterValues();this._setMaterialTransparentParameter(o),a.material.setParameterValues({transparent:o.transparent})}if(this._edgeStageObjects.size>0){var s=this._context.stage.view.getEdgeView(),l=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){s.updateAllComponentOpacities(e,[l])})}return!0}if("elevationInfo"===e){for(var c in this._updateElevationContext(),t){var u=t[c],p=n(u);if(p){var h=u.graphic,f=this.getGraphicElevationContext(h);p.needsElevationUpdates=d.needsElevationUpdates3D(f.mode),p.elevationContext.set(f)}}return!0}return!1},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype._requiresVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._colorUid=function(e){var t=e.material&&e.material.color;if(!t)return"-";if(t)switch(t.type){case"value":return t.value.toHex();case"image":return t.uid}},t.prototype._materialProperties=function(e,t){var n=this._requiresVertexColors();return{hasVertexColors:n,color:t.material&&t.material.color,uid:"vc:"+n+",cmuid:"+this._colorUid(t)}},t.prototype._setInternalColorValueParameters=function(e,t){t.diffuse=r.toUnitRGB(e.value),t.opacity=e.value.a},t.prototype._setInternalColorImageParameters=function(e,t,n){var r=e.url;if(r){var i=this._textures[e.uid];i||(i=new x(r,t+"_"+e.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[e.uid]=i,this._context.stage.add(m.ModelContentType.TEXTURE,i)),n.textureId=i.id}},t.prototype._setInternalMaterialParameters=function(e,t,n){var r=e.material&&e.material.color;if(r)switch(r.type){case"value":this._setInternalColorValueParameters(r,n);break;case"image":this._setInternalColorImageParameters(r,t,n)}},t.prototype._setExternalMaterialParameters=function(e){if(this._isPropertyDriven("color"))e.externalColor=E;else{var t=this.symbol.material?r.toUnitRGBA(this.symbol.material.color):E;e.externalColor=t}var n=this.symbol.material&&this.symbol.material.colorMixMode;n&&(e.colorMixMode=n)},t.prototype._getOrCreateMaterial=function(e,t){var n=this._materialProperties(e,t),r=this._materials[n.uid];if(r)return r.material;var i=this._getStageIdHint(),a={specular:P,symbolColors:n.hasVertexColors,ambient:P,diffuse:R,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity()};this._setInternalMaterialParameters(t,i,a),this._setExternalMaterialParameters(a),this._setMaterialTransparentParameter(a);var o=new w(a,i+"_"+n.uid+"_mat"),s=t.material&&t.material.color&&"value"===t.material.color.type&&t.material.color.value,l=s?s.a:1;return this._materials[n.uid]={geometryOpacity:l,material:o},this._context.stage.add(m.ModelContentType.MATERIAL,o),o},t.prototype._setMaterialTransparentParameter=function(e){this._isPropertyDriven("opacity")&&(e.transparent=!0),e.transparent=e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1},t.prototype._addDebugNormals=function(e,t,n,r){for(var i,a,o,s,l=t.length,c=e.spatialReference.isWGS84?20015077/180:1,d=.1*Math.max(e.extent.width*c,e.extent.height*c,e.extent.zmax-e.extent.zmin),u=[],p=[],h=[],v=[],g=0;g<l;g++)for(var m=t[g],_=m.data.getAttribute(C.POSITION),x=m.data.getAttribute(C.NORMAL),S=m.data.getIndices(C.POSITION),w=m.data.getIndices(C.NORMAL),A=_.data,O=x.data,R=0;R<S.length;R++){for(var E=3*S[R],P=3*w[R],T=0;T<3;T++)u.push(A[E+T]);for(T=0;T<3;T++)u.push(A[E+T]+O[P+T]*d);if(p.push(p.length),p.push(p.length),R%3==0){this._calculateFaceNormal(A,S,R,L),this._getFaceVertices(A,S,R,D,I,M),f.vec3d.add(D,I),f.vec3d.add(D,M),f.vec3d.scale(D,1/3);for(T=0;T<3;T++)h.push(D[T]);for(T=0;T<3;T++)h.push(D[T]+L[T]*d);v.push(v.length),v.push(v.length)}}var V=((i={})[C.POSITION]={data:new Float64Array(u),size:3},i),F=((a={})[C.POSITION]=new Uint32Array(p),a),z=new b(V,F,void 0,"line");(U=new y(z,"debugVertexNormal")).singleUse=!0,t.push(U),n.push([this._debugVertexNormalMaterial]),r.push(f.mat4d.create(r[0]));var U;(o={})[C.POSITION]={data:new Float64Array(h),size:3},V=o,(s={})[C.POSITION]=new Uint32Array(v),F=s,z=new b(V,F,void 0,"line");(U=new y(z,"debugFaceNormal")).singleUse=!0,t.push(U),n.push([this._debugFaceNormalMaterial]),r.push(f.mat4d.create(r[0]))},t.prototype._createAs3DShape=function(e,t,n,r,i){var a=this,o=e.geometry;if("mesh"!==o.type)return null;var s=this._createGeometryInfo(o,t,r);if(!s)return null;var u=s.geometries,h=s.materials,f=s.transformations,g=s.objectTransformation;v.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(o,u,h,f);var m=new _({geometries:u,materials:h,transformations:f,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:i},idHint:r});m.setObjectTransformation(g);var y=function(e){var t=a._context.stage.view.getEdgeView();if(t){t.removeObject(e),a._edgeStageObjects.delete(e);var n=p.createMaterial(t,a.symbol,a._getLayerOpacity());n&&(a._edgeStageObjects.add(e),t.addObject(e,[n],{mergeGeometries:!0}))}};y(m);var b=function(e,t,n,r,i){var a=l.perObjectElevationAligner(e,t,n,r,i);return y(m),a},x=new c(this,m,u,null,null,b,n);x.needsElevationUpdates=d.needsElevationUpdates3D(n.mode);var S=o.extent.center.clone();return S.z=0,x.elevationContext.centerPointInElevationSR=S,x.alignedTerrainElevation=b(x,x.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext),x},t.prototype._createComponentNormals=function(e,t,n,r){switch(n.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,n,r);case"flat":return this._createComponentNormalsFlat(e,n,r);case"smooth":return this._createComponentNormalsSmooth(e,n,r)}},t.prototype._createComponentNormalsSource=function(e,t,n,r){if(!t)return this._createComponentNormalsFlat(e,n,r);for(var i=!1,a=0;a<r.length;a+=3){this._calculateFaceNormal(e,r,a,L);for(var o=0;o<3;o++){var s=3*r[a+o];D[0]=t[s+0],D[1]=t[s+1],D[2]=t[s+2],f.vec3d.dot(L,D)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],i=!0)}}return{normals:t,indices:r,didFlipNormals:i}},t.prototype._createComponentNormalsFlat=function(e,t,n){for(var r=new Float32Array(n.length),i=new Uint32Array(3*n.length),a=0;a<n.length;a+=3)for(var o=this._calculateFaceNormal(e,n,a,L),s=0;s<3;s++)r[a+s]=o[s],i[a+s]=a/3;return{normals:r,indices:i,didFlipNormals:!1}},t.prototype._createComponentNormalsSmooth=function(e,t,n){for(var r={},i=0;i<n.length;i+=3)for(var a=this._calculateFaceNormal(e,n,i,L),o=0;o<3;o++){(d=r[c=n[i+o]])||(d={normal:f.vec3d.create(),count:0},r[c]=d),f.vec3d.add(d.normal,a),d.count++}var s=new Float32Array(3*n.length),l=new Uint32Array(3*n.length);for(i=0;i<n.length;i++){var c,d;1!==(d=r[c=n[i]]).count&&(f.vec3d.normalize(f.vec3d.scale(d.normal,1/d.count)),d.count=1);for(o=0;o<3;o++)s[3*i+o]=d.normal[o];l[i]=i}return{normals:s,indices:l,didFlipNormals:!1}},t.prototype._getFaceVertices=function(e,t,n,r,i,a){var o=3*t[n+0],s=3*t[n+1],l=3*t[n+2];r[0]=e[o+0],r[1]=e[o+1],r[2]=e[o+2],i[0]=e[s+0],i[1]=e[s+1],i[2]=e[s+2],a[0]=e[l+0],a[1]=e[l+1],a[2]=e[l+2]},t.prototype._calculateFaceNormal=function(e,t,n,r){return this._getFaceVertices(e,t,n,D,I,M),f.vec3d.subtract(I,D),f.vec3d.subtract(M,D),f.vec3d.cross(I,M,D),f.vec3d.normalize(D,r),r},t.prototype._getOrCreateComponents=function(e){return e.components?e.components:U},t.prototype._createPositionBuffer=function(e){var t=e.vertexAttributes.position,n=new Float64Array(t.length),r=this._context.renderSpatialReference;return d.reproject(e.vertexAttributes.position,0,e.spatialReference,n,0,r,t.length/3),n},t.prototype._createNormalBuffer=function(e,t){var n=e.vertexAttributes.normal;if(!n)return null;if("local"===this._context.layerView.view.viewingMode)return n;var r=e.vertexAttributes.position,i=new Float32Array(n.length);return s.projectNormalToECEF(n,r,t,e.spatialReference,i)},t.prototype._createColorBuffer=function(e){if(this._requiresVertexColors()){var t=this._getVertexOpacityAndColor(e),n=this.symbol.material&&this.symbol.material.colorMixMode||null,r=new Uint8Array(4);return h.encodeSymbolColor(t,n,r),r}return null},t.prototype._createColorIndices=function(e,t){for(var n=new Uint32Array(t.length),r=0;r<n.length;r++)n[r]=0;return n},t.prototype._createBuffers=function(e,t){var n=e.vertexAttributes&&e.vertexAttributes.position;if(!n)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var r=e.vertexAttributes.normal,i=e.vertexAttributes.uv;if(r&&r.length!==n.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(i&&i.length/2!=n.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var a=this._createPositionBuffer(e),o=this._createColorBuffer(t),s=this._createNormalBuffer(e,a);return{positionBuffer:a,normalBuffer:s,uvBuffer:i,colorBuffer:o,objectTransformation:this._transformCenterLocal(e,a,s)}},t.prototype._transformCenterLocal=function(e,t,n){var r=e.extent.center,i=this._context.renderSpatialReference;T[0]=r.x,T[1]=r.y,T[2]=0;var a=f.mat4d.create();g.computeLinearTransformation(e.spatialReference,T,a,i),f.mat4d.inverse(a,V);for(var o=0;o<t.length;o+=3)D[0]=t[o+0],D[1]=t[o+1],D[2]=t[o+2],f.mat4d.multiplyVec3(V,D),t[o+0]=D[0],t[o+1]=D[1],t[o+2]=D[2];if(n){f.mat4d.toMat3(a,F),f.mat3d.transpose(F,F);for(o=0;o<n.length;o+=3)D[0]=n[o+0],D[1]=n[o+1],D[2]=n[o+2],f.mat3d.multiplyVec3(F,D),n[o+0]=D[0],n[o+1]=D[1],n[o+2]=D[2]}return a},t.prototype._validateFaces=function(e,t){var n=e.vertexAttributes.position.length/3,r=t.faces;if(r){for(var i=-1,a=0;a<r.length;a++){var o=r[a];o>i&&(i=o)}if(n<=i)return this._logWarning("Vertex index "+i+" is out of bounds of the mesh position buffer"),!1}else if(n%3!=0)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0},t.prototype._getOrCreateFaces=function(e,t){if(t.faces)return t.faces;for(var n=new Uint32Array(e.vertexAttributes.position.length/3),r=0;r<n.length;r++)n[r]=r;return n},t.prototype._isOutsideClippingArea=function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var n,r=this._context.elevationProvider.spatialReference,i=t.length/3;return e.spatialReference.equals(r)?n=t:(n=new Float64Array(t.length),d.reproject(e.vertexAttributes.position,0,e.spatialReference,n,0,r,i)),d.computeBoundingBox(n,0,i,z),d.boundingBoxClipped(z,this._context.clippingExtent)},t.prototype._createGeometryInfo=function(e,t,n){var r,i;if(!o.canProject(e,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var a=this._createBuffers(e,t);if(!a)return null;for(var s=a.positionBuffer,l=a.uvBuffer,c=a.colorBuffer,d=a.normalBuffer,u=a.objectTransformation,p=[],h=[],v=[],g=!1,m=0,_=this._getOrCreateComponents(e);m<_.length;m++){var x=_[m];if(!this._validateFaces(e,x))return null;var S=this._getOrCreateFaces(e,x);if(0!==S.length){var w=this._createComponentNormals(s,d,x,S);w.didFlipNormals&&(g=!0);var A=((r={})[C.POSITION]={size:3,data:s},r[C.NORMAL]={size:3,data:w.normals},r),O=((i={})[C.POSITION]=S,i[C.NORMAL]=w.indices,i);c&&(A[C.SYMBOLCOLOR]={size:4,data:c},O[C.SYMBOLCOLOR]=this._createColorIndices(x,S)),e.vertexAttributes.uv&&(A[C.UV0]={size:2,data:l},O[C.UV0]=S);var R=new b(A,O),E=new y(R,n+"_mesh");E.singleUse=!0,p.push(E),h.push(f.mat4d.identity()),v.push([this._getOrCreateMaterial(e,x)])}}return g&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,transformations:h,materials:v,objectTransformation:u}},t}(u),R=[1,1,1],E=[1,1,1,1],P=[0,0,0],T=f.vec3d.create(),D=f.vec3d.create(),I=f.vec3d.create(),M=f.vec3d.create(),L=f.vec3d.create(),V=f.mat4d.create(),F=f.mat3d.create(),z=i.create(),U=[new a];return O}.apply(null,r))||(e.exports=i)},1757:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(483),n(23),n(40),n(252),n(1531),n(1520),n(1525),n(1501),n(1644),n(49),n(98),n(1511),n(1518),n(1527),n(1521),n(1487),n(1515)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b){function _(e,t,n,r,i,a,o,s,l,c,d,u,p,h){var f=n.length/3,v=0;d+=2*r.count,function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g){O.set(v,P);for(var m=f>0?1:-1,y=3*n,b=u,_=3*b,x=u+r,S=3*x,w=0;w<r;++w)g&&(P[0]=e[y+0],P[1]=e[y+1],P[2]=e[y+2],O.normalize(P)),s[_+0]=e[y+0],s[_+1]=e[y+1],s[_+2]=e[y+2],l[_+0]=t[y+0],l[_+1]=t[y+1],l[_+2]=t[y+2],c[_+0]=-m*P[0],c[_+1]=-m*P[1],c[_+2]=-m*P[2],d[b]=0,s[S+0]=e[y+0]+f*P[0],s[S+1]=e[y+1]+f*P[1],s[S+2]=e[y+2]+f*P[2],l[S+0]=t[y+0],l[S+1]=t[y+1],l[S+2]=t[y+2],c[S+0]=m*P[0],c[S+1]=m*P[1],c[S+2]=m*P[2],d[x]=f,_+=3,S+=3,y+=3,b+=1,x+=1;y=3*a,_=3*h,S=3*(h+o),_=3*(h+o),S=3*h;var A=T,C=D;f<0&&(A=D,C=T);for(var w=0;w<o;++w)p[_+0]=i[y+A[0]],p[_+1]=i[y+A[1]],p[_+2]=i[y+A[2]],p[S+0]=i[y+C[0]]+r,p[S+1]=i[y+C[1]]+r,p[S+2]=i[y+C[2]]+r,_+=3,S+=3,y+=3}(e,t,r.index,r.count,n,0,f,i,a,o,s,l,c,d,u,p,h),l+=2*r.count,d+=2*f,d-=2*r.count+2*f,S(i,a,s,o,v,r.pathLengths[0],r.count,l,c,d,u),l+=4*r.pathLengths[0],d+=2*r.pathLengths[0],v+=r.pathLengths[0];for(var g=1;g<r.pathLengths.length;++g)S(i,a,s,o,v,r.pathLengths[g],r.count,l,c,d,u),l+=4*r.pathLengths[g],d+=2*r.pathLengths[g],v+=r.pathLengths[g]}function x(e,t,n,r,i,a,o){r[a]=r[o],o*=3,e[(a*=3)+0]=e[o+0],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a+0]=t[o+0],t[a+1]=t[o+1],t[a+2]=t[o+2],n[a+0]=i[0],n[a+1]=i[1],n[a+2]=i[2]}function S(e,t,n,r,i,a,o,s,l,c,d){var u=i,p=i+1,h=i+o,f=i+o+1,v=s,g=s+1,m=s+2*a,y=s+2*a+1;d<0&&(u=i+o+1,f=i),c*=3;for(var b=0;b<a;++b)b===a-1&&(d>0?(p=i,f=i+o):(p=i,u=i+o)),w(e,u,p,h,V),x(e,t,r,n,V,v,u),x(e,t,r,n,V,g,p),x(e,t,r,n,V,m,h),x(e,t,r,n,V,y,f),l[c++]=v,l[c++]=m,l[c++]=y,l[c++]=v,l[c++]=y,l[c++]=g,u++,p++,h++,f++,v+=2,g+=2,m+=2,y+=2}function w(e,t,n,r,i){t*=3,n*=3,r*=3,O.set3(e[t++],e[t++],e[t++],F),O.set3(e[n++],e[n++],e[n++],z),O.set3(e[r++],e[r++],e[r++],U),O.subtract(z,F,N),O.subtract(U,F,B),O.cross(B,N,i),O.normalize(i,i)}function A(e,t,n,r){var i=r.setAltitude;I.spatialReference=n.spatialReference;for(var a=e.getGeometryRecords(),o=a.length,s="absolute-height"!==t.mode,c=0,d=0;d<o;d++){var u=a[d].geometry,p=a[d].transformation,h=u.getData();G[0]=p[12],G[1]=p[13],G[2]=p[14],u.invalidateBoundingInfo();for(var f=h.getVertexAttr(),v=f[C.POSITION].data,g=f[C.SIZE].data,m=f.mapPos.data,y=v.length/3,b=0,_=0,x=!1,S=0,w=0;w<y;w++){I.x=m[_],I.y=m[_+1],I.z=m[_+2],j[0]=v[b],j[1]=v[b+1],j[2]=v[b+2];var A=l.computeElevation(n,I,t,r,s?M:null);s&&(S+=M.terrainElevation),E[0]=v[b]+G[0],E[1]=v[b+1]+G[1],E[2]=v[b+2]+G[2],i(A+g[b/3],E),v[b]=E[0]-G[0],v[b+1]=E[1]-G[1],v[b+2]=E[2]-G[2];var O=.01/r.unitInMeters;(Math.abs(j[0]-v[b])>O||Math.abs(j[1]-v[b+1])>O||Math.abs(j[2]-v[b+2])>O)&&(x=!0),_+=3,b+=3}x&&e.geometryVertexAttrsUpdated(d),c+=S/y}return c/o}var C=y.VertexAttrConstants,O=p.vec3d,R=p.mat4d,E=O.create(),P=O.create(),T=[0,2,1],D=[0,1,2],I=new i,M={verticalDistanceToGround:0,terrainElevation:0},L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._edgeStageObjects=new Set,t}return n(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=d.validateSymbolLayerSize(this._getSymbolSize());if(e)return this._logWarning(e),void this.reject()}var t=this._getStageIdHint(),n=this._getMaterialOpacityAndColor(),r=O.create(n),i=n[3],a={diffuse:r,ambient:r,opacity:i,transparent:i<1||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new b(a,t+"_3dlinemat"),this._context.stage.add(f.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&this._context.stage.remove(f.ModelContentType.MATERIAL,this._material.id)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,n=e.graphic,r=n.geometry;if("polygon"!==r.type&&"extent"!==r.type)return this._logWarning("unsupported geometry type for extrude symbol: "+r.type),null;if(!this._validateGeometry(r))return null;var i="polygon"===r.type||"extent"===r.type?"rings":"paths",a="graphic"+n.uid,o=this._getVertexOpacityAndColor(t,Float32Array,255),s=this.getGraphicElevationContext(n);return this._createAs3DShape(n,i,t,o,s,a,n.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._getMaterialOpacity(),i=r<1||this._isPropertyDriven("opacity");if(this._material.setParameterValues({opacity:r,transparent:i}),this._edgeStageObjects.size>0){var a=this._context.stage.view.getEdgeView(),o=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){a.updateAllComponentOpacities(e,[o])})}return!0}if("elevationInfo"===e){for(var s in this._updateElevationContext(),t){var c=t[s],d=n(c);if(d){var u=c.graphic,p=this.getGraphicElevationContext(u);d.needsElevationUpdates=l.needsElevationUpdates3D(p.mode),d.elevationContext.set(p)}}return!0}return!1},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype._getExtrusionSize=function(e){return(e.size&&this._isPropertyDriven("size")?l.getSingleSizeDriver(e.size,2):this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){return this.symbol.size||1},t.prototype._createAs3DShape=function(e,t,n,i,c,d,p){var f=this,g=e.geometry;"extent"===g.type&&(g=a.fromExtent(g));var y=g[t],b=[],x=[],S=[],w=O.create(),C=new Array(6),E=this._context.renderSpatialReference===h.SphericalECEFSpatialReference,P=this._getExtrusionSize(n),T=O.create();E||this._context.renderCoordsHelper.worldUpAtPosition(null,T);var D=l.getGeometryVertexData3D(y,o.hasZ(g),g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);if(this._logGeometryCreationWarnings(D,y,t,"ExtrudeSymbol3DLayer"),y.length>0){for(var I=D.geometryData.polygons,M=D.eleVertexData,L=D.vertexData,V=L.length/3,F=new Float64Array(3*V*6),z=new Float64Array(3*V*6),U=new Float64Array(3*V*6),N=new Float64Array(1*V*6),B=0,j=this,G=0;G<I.length;++G)!function(e){var t=I[e],n=t.count,a=t.index;if(j._context.clippingExtent&&(l.computeBoundingBox(M,a,n,C),l.boundingBoxClipped(C,j._context.clippingExtent)))return"continue";var o=new Float64Array(M.buffer,3*a*F.BYTES_PER_ELEMENT,3*n),s=t.holeIndices.map(function(e){return e-a}),c=r(o,s,3);if(c.length>0){l.chooseOrigin(L,a,n,w);var u=3*n*2+2*c.length,p=new Uint32Array(u),h=6*n,f=new Float64Array(F.buffer,3*B*F.BYTES_PER_ELEMENT,3*h),g=new Float64Array(z.buffer,3*B*z.BYTES_PER_ELEMENT,3*h),m=new Float64Array(U.buffer,3*B*U.BYTES_PER_ELEMENT,3*h),y=new Float64Array(N.buffer,1*B*N.BYTES_PER_ELEMENT,1*h);_(L,M,c,t,f,m,g,y,0,p,0,P,T,E),l.subtractCoordinates(f,0,h,w),B+=6*n;var A=j._createExtrudeGeometry(p,{positions:f,elevation:m,normals:g,heights:y},i),O=new v(A,d+"path"+e);O.singleUse=!0,b.push(O),x.push([j._material]);var D=R.identity();R.translate(D,w,D),S.push(D)}}(G);if(b.length>0){var H=new m({geometries:b,materials:x,transformations:S,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:p},idHint:d}),k=function(e){var t=f._context.stage.view.getEdgeView();if(t){t.removeObject(e),f._edgeStageObjects.delete(e);var n=u.createMaterial(t,f.symbol,f._getLayerOpacity());n&&(f._edgeStageObjects.add(e),t.addObject(e,[n]))}};k(H);var W=new s(this,H,b,null,null,function(e,t,n,r){var i=A(e.stageObject,t,n,r);return k(H),i},c);return W.alignedTerrainElevation=D.terrainElevation,W.needsElevationUpdates=l.needsElevationUpdates3D(c.mode),W}return null}return null},t.prototype._createExtrudeGeometry=function(e,t,n){for(var r=e.length,i=e,a=new Uint32Array(r),o=0;o<r;o++)a[o]=0;var s={},l={};return s[C.POSITION]=i,s[C.NORMAL]=i,s[C.COLOR]=a,l[C.POSITION]={size:3,data:t.positions},l[C.NORMAL]={size:3,data:t.normals},l[C.COLOR]={size:4,data:n},l[C.SIZE]={size:1,data:t.heights},t.elevation&&(l.mapPos={size:3,data:t.elevation},s.mapPos=i),new g(l,s)},t}(c),V=O.create(),F=O.create(),z=O.create(),U=O.create(),N=O.create(),B=O.create(),j=O.create(),G=O.create();return L}.apply(null,r))||(e.exports=i)},1758:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(10),n(12),n(123),n(142),n(25),n(8),n(5),n(32),n(82),n(20),n(1759),n(1536),n(1671),n(1531),n(1520),n(1525),n(1501),n(1760),n(1650),n(49),n(98),n(1511),n(1518),n(1560),n(1532),n(1549),n(1526)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w,A,C,O,R,E){function P(e){return"cross"===e||"x"===e}function T(e){var t,n=N,r=n*B;switch("primitive:"===e.substring(0,10)&&(e=e.substring(10)),e){case G.PRIM_CIRCLE:t=b.computeSignedDistancefieldCicle(n,r);break;case G.PRIM_SQUARE:t=b.computeSignedDistancefieldSquare(n,r,!1);break;case G.PRIM_KITE:t=b.computeSignedDistancefieldSquare(n,r,!0);break;case G.PRIM_CROSS:t=b.computeSignedDistancefieldCrossAndX(n,r,!1);break;case G.PRIM_X:t=b.computeSignedDistancefieldCrossAndX(n,r,!0)}return new R(t,"sdf_"+e,{mipmap:!1,wrapClamp:!0,width:N,height:N,components:4})}var D=x.vec3d,I=x.vec4d,M=x.mat4d.identity(),L=[0,0,1],V=[0,0,0,0],F=[0,0,0],z=[1,1,1],U=["center","bottom","top","left","right","bottom-left","bottom-right","top-left","top-right"],N=128,B=.5,j=[B/2,B/2,1-B/2,1-B/2],G={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},H=[N*B,N*B],k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},t}return r(t,e),t.prototype._prepareResources=function(){var e=this.symbol,t=Math.round(null!=e.size?c.pt2px(e.size):16);this._size=null,this._symbolTextureRatio=1,this._primitive=null;var n=this._getStageIdHint();if(!this._isPropertyDriven("size")){var r=y.validateSymbolLayerSize(t);if(r)return this._logWarning(r),void this.reject()}this._isPropertyDriven("size")&&t<64&&(t=64);var i=e.resource||{primitive:"circle",href:void 0},a={anchorPos:this._getAnchorPos(e)},o=this.symbolContainer;if(this._hasVisibleVerticalOffset(o)){var s=o.verticalOffset,l=s.screenLength,d=s.minWorldLength,u=s.maxWorldLength;a.verticalOffset={screenLength:c.pt2px(l),minWorldLength:d||0,maxWorldLength:null!=u?u:1/0}}if(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),i.href)this._outlineSize=this._getOutlineSize(e,null),a.color=this._getFillColor(e,null),a.outlineColor=this._getOutlineColor(e),a.outlineSize=this._outlineSize,a.textureIsSignedDistanceField=!1,this._prepareImageResources(t,a,n);else{var p=i.primitive||"circle",h="primitive:"+p;if(this._primitive=p,this._outlineSize=this._getOutlineSize(e,p),a.color=this._getFillColor(e,p),a.outlineColor=this._getOutlineColor(e),a.outlineSize=this._outlineSize,P(p)&&0===a.outlineSize)return void this.reject();this.texture=this._context.sharedResources.textures.acquire(h,T),this._textureURI=h,a.textureIsSignedDistanceField=!0,a.distanceFieldBoundingBox=j,a.textureId=this.texture.id,this._size=[t,t],this._symbolTextureRatio=1/B,this._createMaterialsAndAddToStage(a,this._context.stage,n),this.resolve()}},t.prototype._getOutlineSize=function(e,t){var n;return n=e.outline&&null!=e.outline.size?c.pt2px(e.outline.size):P(t)?1.5:0,Math.max(n,0)},t.prototype._getOutlineColor=function(e){var t=this._getLayerOpacity();if(e.outline){if(null!=e.outline.color){var n=o.toUnitRGB(e.outline.color),r=e.outline.color.a*t;return[n[0],n[1],n[2],r]}return[0,0,0,t]}return[0,0,0,t]},t.prototype._getFillColor=function(e,t){return P(t)?V:this._getMaterialOpacityAndColor()},t.prototype._getAnchorPos=function(e){return U.indexOf(e.anchor)>-1?e.anchor:"center"},t.prototype._prepareImageResources=function(e,t,n){var r=this,o=p.getIconHref(this.symbolContainer,this.symbol);if(!d("esri-canvas-svg-support")&&u.isSVG(o)){var l="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)";return this._logWarning(l),void this.reject(new s("SVG Not Supported",l))}i(this._context.sharedResources.textures.acquire(o,null,e),function(i){if(!r.isRejected()){var a=i.params,o=a.width/a.height;r._size=e?o>1?[e,Math.round(e/o)]:[Math.round(e*o),e]:[a.width,a.height],t.textureId=i.id,r._createMaterialsAndAddToStage(t,r._context.stage,n),r.resolve()}},function(e){if(e instanceof a)r.reject();else{var t="IconSymbol3DLayer failed to load (Request for icon resource failed: "+o+")";r._logWarning(t),r.reject(new s("Request Failed",t))}}),this._textureURI=o},t.prototype._createMaterialsAndAddToStage=function(e,t,r){this._fastUpdates=_.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&l.mixin(e,this._fastUpdates.materialParameters);var i=n({},e);i.verticalOffset=null,i.screenSizePerspective=null,i.occlusionTest=!1,i.shaderPolygonOffset=0,this._drapedMaterial=new E(i,r+"_iconDraped"),t.add(w.ModelContentType.MATERIAL,this._drapedMaterial),e.occlusionTest=!0,this._material=new E(e,r+"_icon"),t.add(w.ModelContentType.MATERIAL,this._material)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._material.id),this._material=null),this._drapedMaterial&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null),this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)},t.prototype._getScaleFactor=function(e){if(this._isPropertyDriven("size")&&e.size){for(var t=0;t<3;t++){var n=e.size[t];n&&"symbolValue"!==n&&"proportional"!==n&&(e.size[t]=c.pt2px(n))}var r=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,n=e.graphic;if(!this._validateGeometry(n.geometry))return null;var r=g.placePointOnGeometry(n.geometry);if(!r)return this._logWarning("unsupported geometry type for icon symbol: "+n.geometry.type),null;var i="graphic"+n.uid,a=this._getVertexOpacityAndColor(t),o=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(o=this._getScaleFactor(t)),o*=this._symbolTextureRatio;var s=[this._size[0]*o,this._size[1]*o],l=this.getGraphicElevationContext(n);return"on-the-ground"===l.mode?this._createAsOverlay(n,r,a,s,l,i,n.uid):this._createAs3DShape(n,r,a,s,l,i,n.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._getFillColor(this.symbol,this._primitive);this._drapedMaterial.setParameterValues({color:r}),this._material.setParameterValues({color:r});var i=this._getOutlineColor(this.symbol);return this._drapedMaterial.setParameterValues({outlineColor:i}),this._material.setParameterValues({outlineColor:i}),!0}if("elevationInfo"===e){var a=this._elevationContext.mode;this._updateElevationContext();var o=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===o)return!0;if(a!==o&&("on-the-ground"===a||"on-the-ground"===o))return!1;var s=g.needsElevationUpdates2D(o)||"absolute-height"===o;for(var l in t){var c=t[l],d=n(c);if(d&&"object3d"===d.type){var u=c.graphic,p=this.getGraphicElevationContext(u);d.needsElevationUpdates=s,d.elevationContext.set(p)}}return!0}return!1},t.prototype.applyRendererDiff=function(e,t,n,r){for(var i in e.diff)switch(i){case"visualVariables":if(!_.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype.setDrawOrder=function(e,t,n){this.updateSymbolLayerOrder(e,t),this._drapedMaterial&&(this._drapedMaterial.renderPriority=e,n.add(this._drapedMaterial.id))},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0}),t.prototype._defaultElevationInfoNoZ=function(){return W},t.prototype._createAs3DShape=function(e,t,n,r,i,a,o){var s=this,l=this.getFastUpdateAttrValues(e),c=l?function(e){return _.evaluateModelTransform(s._fastUpdates.materialParameters,l,e)}:null,d=C.createPointGeometry(L,null,n,r,q,null,l),u=[new A(d,a)],p=g.createStageObjectForPoint.call(this,t,u,[[this._material]],null,null,i,a,this._context.layer.uid,o,!0,c);if(null===p)return null;var f=h.perObjectElevationAligner,m=new v(this,p.object,u,null,null,f,i);return m.alignedTerrainElevation=p.terrainElevation,m.needsElevationUpdates=g.needsElevationUpdates2D(i.mode)||"absolute-height"===i.mode,m.getScreenSize=this._createScreenSizeGetter(r,c),m.calculateRelativeScreenBounds=function(e){return s._material.calculateRelativeScreenBounds(m.getScreenSize(),1,e)},g.extendPointGraphicElevationContext(m,t,this._context.elevationProvider),m},t.prototype._createAsOverlay=function(e,t,n,r,i,a,o){var s=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;var l=D.create();S.pointToVector(t,l,this._context.overlaySR),l[2]=this._getDrapedZ();var c=this._context.clippingExtent;if(c&&!g.pointInBox2D(l,c))return null;var d=this.getFastUpdateAttrValues(e),u=d?function(e){return _.evaluateModelTransform(s._fastUpdates.materialParameters,d,e)}:null,p=C.createPointGeometry(L,l,n,r,null,null,d),h=new O(p);h.material=this._drapedMaterial,h.center=l,h.bsRadius=0,h.transformation=M,h.name=a,h.uniqueName=a+"#"+p.id;var v=new f(this,[h],null);return v.getScreenSize=this._createScreenSizeGetter(r,u),v.calculateRelativeScreenBounds=function(e){return s._drapedMaterial.calculateRelativeScreenBounds(v.getScreenSize(),1,e)},v},t.prototype._createScreenSizeGetter=function(e,t){var n=this._outlineSize+2;if(this._fastUpdates.enabled){var r=e[0]/this._symbolTextureRatio,i=e[1]/this._symbolTextureRatio;return function(e){void 0===e&&(e=new Array(2));var a=t(M);return e[0]=a[0]*r+n,e[1]=a[5]*i+n,e}}var a=e[0]/this._symbolTextureRatio+n,o=e[1]/this._symbolTextureRatio+n;return function(e){return void 0===e&&(e=new Array(2)),e[0]=a,e[1]=o,e}},t.prototype._supportsShaderVisualVariables=function(){return!0},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=[e,e,e],n=c.px2pt(1),r=e*n;return{modelSize:t,symbolSize:[r,r,r],unitInMeters:n,transformation:{anchor:F,scale:z,rotation:F}}},t.prototype._hasVisibleVerticalOffset=function(e){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()},t.PRIMITIVE_SIZE=H,t.VALID_ANCHOR_STRINGS=U,t}(m),W={mode:"relative-to-ground",offset:0},q=I.createFrom(0,0,0,1);return k}.apply(null,r))||(e.exports=i)},1759:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(82)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isVolumetricSymbol=function(e){var t=e&&e.symbolLayers;return!!t&&t.some(function(e){var t=e.type;return"object"===t||"path"===t||"extrude"===t})},t.getIconHref=function(e,t){var i=t.resource.href;return!n("esri-canvas-svg-support")&&e.styleOrigin&&r.test(i)?i.replace(r,"/resource/png/$1.png"):i};var r=/\/resource\/(.*?)\.svg$/}.apply(null,r))||(e.exports=i)},1760:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1487)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.computeSignedDistancefieldCicle=function(e,t){for(var r=e,i=new Uint8Array(4*r*r),a=r/2-.5,o=t/2,s=0;s<r;s++)for(var l=0;l<r;l++){var c=l+r*s,d=l-a,u=s-a,p=Math.sqrt(d*d+u*u)-o;p=p/e+.5,n.packFloatRGBA(p,i,4*c)}return i},t.computeSignedDistancefieldSquare=function(e,t,r){r&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*(e-.5),l=a-.5*(e-.5),c=a*e+o;if(r){var d=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=d}var u=Math.max(Math.abs(s),Math.abs(l))-.5*t;u=u/e+.5,n.packFloatRGBA(u,i,4*c)}return i},t.computeSignedDistancefieldCrossAndX=function(e,t,r){r&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,c=o-.5*e,d=o*e+s;if(r){var u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}var p=void 0;p=(p=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,n.packFloatRGBA(p,a,4*d)}return a}}.apply(null,r))||(e.exports=i)},1761:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(32),n(40),n(473),n(252),n(1536),n(1671),n(1531),n(1520),n(1525),n(1501),n(1701),n(49),n(1511),n(1518),n(1521),n(1532)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y){var b=f.vec3d,_=f.mat4d;return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._prepareResources=function(){var e=this.symbol,t=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),n={idHint:this._getStageIdHint(),width:this._getWidth(e),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var r=p.validateSymbolLayerSize(n.width);if(r)return this._logWarning(r),void this.reject()}if(t||n.width>=1.5)this._isPropertyDriven("size")&&(n.width=0),this._material=h.createRibbonMaterial(n);else{if(!(n.width>0))return void this.reject();this._material=h.createNativeMaterial(n)}this._context.stage.add(v.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype._getWidth=function(e){return null!=e.size?r.pt2px(e.size):1},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(v.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,n=e.graphic,i=n.geometry;if("polyline"!==i.type&&"polygon"!==i.type&&"extent"!==i.type)return this._logWarning("unsupported geometry type for line symbol: "+i.type),null;if(!this._validateGeometry(i))return null;var a="polygon"===i.type||"extent"===i.type?"rings":"paths",o="graphic"+n.uid,s=this._getVertexOpacityAndColor(t,Float32Array,255),l=0;t.size&&this._isPropertyDriven("size")&&(l=d.getSingleSizeDriver(t.size),l=r.pt2px(l));var c=this.getGraphicElevationContext(n);return"on-the-ground"===c.mode?this._createAsOverlay(n,a,s,l,c,o):this._createAs3DShape(n,a,s,l,c,o,n.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._material.getColor();return this._material.setColor([r[0],r[1],r[2],this._getMaterialOpacity()]),!0}if("elevationInfo"===e){var i=this._elevationContext.mode;this._updateElevationContext();var a=this._elevationContext.mode;if(null==i||null==a)return!1;if("on-the-ground"===i&&"on-the-ground"===a)return!0;if(i!==a&&("on-the-ground"===i||"on-the-ground"===a))return!1;var o=d.needsElevationUpdates2D(a);for(var s in t){var l=t[s],c=n(l);if(c&&"object3d"===c.type){var u=l.graphic;c.needsElevationUpdates=o,c.elevationContext.set(this.getGraphicElevationContext(u))}}return!0}return!1},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getGeometry=function(e){var t=e.geometry;return"extent"===t.type&&(t=i.fromExtent(t)),t},t.prototype._createAs3DShape=function(e,t,n,r,i,a,l){var u=this._getGeometry(e),p=u[t],f=this._getOutlineGeometry(u,p),v=[],y=[],x=[],S=b.create(),w=new Array(6),A=d.getGeometryVertexData3D(f,o.hasZ(u),u.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,i);if(this._logGeometryCreationWarnings(A,p,t,"LineSymbol3DLayer"),f.length>0){for(var C=A.geometryData.outlines,O=A.eleVertexData,R=A.vertexData,E=0;E<C.length;++E){var P=C[E];if(!(P.count<=1)){var T=P.index,D=P.count;if(!this._context.clippingExtent||(d.computeBoundingBox(O,T,D,w),!d.boundingBoxClipped(w,this._context.clippingExtent))){d.chooseOrigin(R,T,D,S),d.subtractCoordinates(R,T,D,S);var I=new Float64Array(O.buffer,3*T*O.BYTES_PER_ELEMENT,3*D),M=new Float64Array(R.buffer,3*T*R.BYTES_PER_ELEMENT,3*D),L=h.createPolylineGeometry(M,I,"rings"===t,n,r),V=new g(L,a+"path"+E);V.singleUse=!0,v.push(V),y.push([this._material]);var F=_.identity();_.translate(F,S,F),x.push(F)}}}if(v.length>0){var z=new m({geometries:v,materials:y,transformations:x,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:l},idHint:a}),U=s.perVertexElevationAligner,N=new c(this,z,v,null,null,U,i);return N.alignedTerrainElevation=A.terrainElevation,N.needsElevationUpdates=d.needsElevationUpdates2D(i.mode),N}}return null},t.prototype._createAsOverlay=function(e,t,n,r,i,o){var s=this._getGeometry(e);this._material.renderPriority=this._symbolLayerOrder;var c=s[t],u=this._getOutlineGeometry(s,c),p=[],f=new Array(6),v=a.empty(),g=b.create(),m=d.getGeometryVertexDataDraped(u,s.spatialReference,this._context.overlaySR);if(this._logGeometryCreationWarnings(m,c,t,"LineSymbol3DLayer"),u.length>0){for(var x=m.vertexData,S=m.geometryData.outlines,w=0;w<S.length;++w){var A=S[w],C=A.index,O=A.count;if(d.computeBoundingBox(x,C,O,f),!d.boundingBoxClipped(f,this._context.clippingExtent)){a.expand(v,f),d.chooseOrigin(x,C,O,g),d.subtractCoordinates(x,C,O,g),d.setZ(x,C,O,this._getDrapedZ());var R=new Float64Array(x.buffer,3*C*x.BYTES_PER_ELEMENT,3*O),E=_.identity();_.translate(E,g,E);var P=h.createPolylineGeometry(R,null,"rings"===t,n,r),T=new y(P);T.material=this._material,T.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0],T.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1])),T.transformation=E,T.name=o,T.uniqueName=o+"#"+P.id,p.push(T)}}return new l(this,p,v)}return null},t}(u)}.apply(null,r))||(e.exports=i)},1762:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(142),n(25),n(5),n(32),n(473),n(146),n(1536),n(1531),n(1520),n(1525),n(1501),n(1702),n(1703),n(1650),n(49),n(1511),n(1518),n(1487),n(1515)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x){var S=m.mat4d,w=m.vec3d,A=[y.ModelContentType.MATERIAL,y.ModelContentType.TEXTURE,y.ModelContentType.GEOMETRY],C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._prepareResources=function(){var e=this.symbol,t=this._getStageIdHint();if(!this._isPropertyDriven("size")){var n=h.validateSymbolLayerSize(this.symbol);if(n)return this._logWarning(n),void this.reject()}if(e.resource&&e.resource.href)this._prepareModelResources(e.resource.href,t);else{var r=e.resource?e.resource.primitive:"sphere";this._preparePrimitiveResources(r,t)}},t.prototype._preparePrimitiveResources=function(e,t){if(!v.isValidPrimitive(e))return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();var n=this.symbol;this._geometry=new b(v.primitiveGeometryData(e),t),this._context.stage.add(y.ModelContentType.GEOMETRY,this._geometry),this._resourceBoundingBox=v.primitiveBoundingBox(e),this._resourceSize=s.size(this._resourceBoundingBox),this._symbolSize=h.computeSizeWithResourceSize(this._resourceSize,n);var r=this._getMaterialOpacity(),l={specular:[0,0,0],opacity:r,transparent:r<1||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:O,diffuse:O},c=this.symbolContainer;if("point-3d"===c.type&&c.verticalOffset){var d=c.verticalOffset,u=d.screenLength,p=d.minWorldLength,f=d.maxWorldLength;l.verticalOffset={screenLength:o.pt2px(u),minWorldLength:p||0,maxWorldLength:null!=f?f:1/0},l.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._isPropertyDriven("color"))l.externalColor=R;else{var m=n.material?i.toUnitRGBA(n.material.color):R;l.externalColor=m}this._fastUpdates=g.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(a.mixin(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&l.instanced.push("color"),this._material=new x(l,t+"_objectmat"),this._context.stage.add(y.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype._prepareModelResources=function(e,t){var n=this,i=["transformation"],l={materialParamsMixin:{instanced:i},idHint:t,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=g.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(a.mixin(l.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute")):this._hasPerInstanceColor()&&i.push("color");var c=this.symbolContainer;if("point-3d"===c.type&&c.verticalOffset){var d=c.verticalOffset,u=d.screenLength,p=d.minWorldLength,v=d.maxWorldLength;l.materialParamsMixin.verticalOffset={screenLength:o.pt2px(u),minWorldLength:p||0,maxWorldLength:null!=v?v:1/0},l.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=f.fetch(e,l),this._symbolLoaderPromise.then(function(e){if(n._symbolLoaderPromise=null,!n.isRejected()){var t=n._context,r=e.stageResources,i=t.stage,a=n.symbol.material,o=n._getExternalColorParameters(a),l=n._getMaterialOpacity(),c=n._isPropertyDriven("opacity"),d=r[y.ModelContentType.MATERIAL];e.originalMaterialOpacities=new Array(d.length),d.forEach(function(n,r){var i=n.getParameterValues();n.setParameterValues(o),e.originalMaterialOpacities[r]=i.opacity;var a=i.opacity*l,s=a<1||c||i.transparent;n.setParameterValues({opacity:a,transparent:s}),t.screenSizePerspectiveEnabled&&n.setParameterValues({screenSizePerspective:t.sharedResources.screenSizePerspectiveSettings})}),A.forEach(function(e){for(var t=r[e],n=0;t&&n<t.length;n++)i.add(e,t[n])}),n._resourceBoundingBox=f.computeBoundingBox(e),n._resourceSize=s.size(n._resourceBoundingBox),n._pivotOffset=e.pivotOffset,n._symbolSize=h.computeSizeWithResourceSize(n._resourceSize,n.symbol),n._i3sModel=e,g.updateFastSymbolUpdatesState(n._fastUpdates,n._context.renderer,n._fastVisualVariableConvertOptions())&&d.forEach(function(e){return e.setParameterValues(n._fastUpdates.materialParameters)}),n.resolve()}},function(e){if(n._symbolLoaderPromise=null,!n.isFulfilled()){if(!(e instanceof r)){var t="ObjectSymbol3DLayer failed to load";e&&e.message&&(t+=" ("+e.message+")"),n._logWarning(t)}n.reject()}})},t.prototype._forEachMaterial=function(e){this._i3sModel?this._i3sModel.stageResources[y.ModelContentType.MATERIAL].forEach(e):e(this._material)},t.prototype._getExternalColorParameters=function(e){var t={};return this._isPropertyDriven("color")?t.externalColor=R:e&&e.color?t.externalColor=i.toUnitRGBA(e.color):(t.externalColor=R,t.colorMixMode="ignore"),t},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var t=this._context.stage;if(this._i3sModel){var n=this._i3sModel.stageResources;A.forEach(function(e){for(var r=n[e],i=0;r&&i<r.length;i++)t.remove(e,r[i].id)})}else this._material&&t.remove(y.ModelContentType.MATERIAL,this._material.id),this._geometry&&t.remove(y.ModelContentType.GEOMETRY,this._geometry.id)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var n=u.placePointOnGeometry(t.geometry);if(!n)return this._logWarning("unsupported geometry type for icon symbol: "+t.geometry.type),null;var r="graphic"+t.uid,i=this.getGraphicElevationContext(t),a=e.renderingInfo;return this._createAs3DShape(t,n,a,i,r,t.uid)},t.prototype.layerPropertyChanged=function(e,t,n){var r=this;if("opacity"===e){var i=this._isPropertyDriven("opacity");if(this._i3sModel){var a=this._getMaterialOpacity();this._i3sModel.stageResources[y.ModelContentType.MATERIAL].forEach(function(e,t){var n=r._i3sModel.originalMaterialOpacities[t]*a;e.setParameterValues({opacity:n,transparent:n<1||i})})}else{var o=this._getMaterialOpacity();this._material.setParameterValues({opacity:o,transparent:o<1||i})}return!0}if("elevationInfo"===e){for(var s in this._updateElevationContext(),t){var l=t[s],c=n(l);if(c){var d=l.graphic,p=this.getGraphicElevationContext(d);c.needsElevationUpdates=u.needsElevationUpdates3D(p.mode),c.elevationContext.set(p)}}return!0}return!1},t.prototype.applyRendererDiff=function(e,t,n,r){var i=this;for(var a in e.diff)switch(a){case"visualVariables":if(!g.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._forEachMaterial(function(e){return e.setParameterValues(i._fastUpdates.materialParameters)});break;default:return!1}return!0},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return this._i3sModel?this._i3sModel.numberOfVertices:this._geometry.data.getIndices(_.VertexAttrConstants.POSITION).length},enumerable:!0,configurable:!0}),t.prototype._createAs3DShape=function(e,t,n,r,i,a){var o,s=this,l=null,p=null,f=this.getFastUpdateAttrValues(e);f&&(l={featureAttribute:f},p=function(e){return g.evaluateModelTransform(s._fastUpdates.materialParameters,f,e)}),!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&((l=l||{}).color=h.mixinColorAndOpacity(n.color,n.opacity));var v=this._context.layer.uid,m=S.identity();if(this._applyObjectRotation(n,m),this._applyObjectRotation(this.symbol,m),this._applyObjectScale(n,m),this._applyAnchor(m),this._i3sModel){for(var b=this._i3sModel.stageResources[y.ModelContentType.GEOMETRY],_=this._i3sModel.materialsByComponent,x=new Array(b.length),w=0;w<x.length;w++)x[w]=m;o=u.createStageObjectForPoint.call(this,t,b,_,x,l,r,i,v,a,null,p)}else o=u.createStageObjectForPoint.call(this,t,[this._geometry],[[this._material]],[m],l,r,i,v,a,null,p);if(null===o)return null;if(this._fastUpdates.enabled){var A=g.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());this._forEachMaterial(function(e){return e.setParameterValues(A)})}o.object.setCastShadow(!0);var C=c.perObjectElevationAligner,O=new d(this,o.object,null,null,null,C,r,d.VisibilityModes.REMOVE_OBJECT);return O.alignedTerrainElevation=o.terrainElevation,O.needsElevationUpdates=u.needsElevationUpdates3D(r.mode),u.extendPointGraphicElevationContext(O,t,this._context.elevationProvider),O},t.prototype._applyObjectScale=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var n=this._isPropertyDriven("size")&&e.size?e.size:this._symbolSize,r=h.computeObjectScale(n,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters);1===r[0]&&1===r[1]&&1===r[2]||S.scale(t,r)}},t.prototype._applyObjectRotation=function(e,t){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&e instanceof l))return h.computeObjectRotation(e.heading,e.tilt,e.roll,t)},t.prototype._computeAnchor=function(){switch(this.symbol.anchor){case"center":return w.scale(s.center(this._resourceBoundingBox),-1);case"top":return[-(e=s.center(this._resourceBoundingBox))[0],-e[1],-this._resourceBoundingBox[5]];case"bottom":var e;return[-(e=s.center(this._resourceBoundingBox))[0],-e[1],-this._resourceBoundingBox[2]];case"origin":default:return this._pivotOffset?w.scale(this._pivotOffset,-1,new Array(3)):E}},t.prototype._applyAnchor=function(e){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var t=this._computeAnchor();t&&S.translate(e,t)}},t.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._supportsShaderVisualVariables=function(){return!!this._context.stage.has("instancedRendering")},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._resourceBoundingBox?s.size(this._resourceBoundingBox):O,t=this._resourceBoundingBox?this._computeAnchor():E,n=this._context.renderCoordsHelper.unitInMeters,r=h.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,n),i=[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0];return{modelSize:e,symbolSize:this._symbolSize||O,unitInMeters:n,transformation:{anchor:t,scale:r,rotation:i}}},t}(p),O=[1,1,1],R=[1,1,1,1],E=[0,0,0];return C}.apply(null,r))||(e.exports=i)},1763:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(8)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){void 0===n&&(n=""),this.major=e,this.minor=t,this._context=n}return e.prototype.lessThan=function(e,t){return this.major<e||e===this.major&&this.minor<t},e.prototype.since=function(e,t){return!this.lessThan(e,t)},e.prototype.validate=function(e){if(this.major!==e.major){var t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new n(t+"unsupported-version","Required major "+r+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:e})}},e.prototype.clone=function(){return new e(this.major,this.minor,this._context)},e.parse=function(t,r){void 0===r&&(r="");var i=t.split("."),a=i[0],o=i[1],s=/^\s*\d+\s*$/;if(!a||!a.match||!a.match(s))throw new n((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!o||!o.match||!o.match(s))throw new n((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});return new e(parseInt(a,10),parseInt(o,10),r)},e}();t.Version=r}.apply(null,r))||(e.exports=i)},1764:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(142),n(25),n(5),n(32),n(473),n(146),n(1536),n(1765),n(1520),n(1525),n(1501),n(1766),n(1703),n(1650),n(49),n(98),n(1511),n(1487),n(1767),n(1704),n(1515)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w){var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._instanceIndexToGraphicUid={},t}return n(t,e),Object.defineProperty(t.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0}),t.prototype._prepareResources=function(){var e=this.symbol,t=this._getStageIdHint();if(this._optionalFields=[],!this._isPropertyDriven("size")){var n=h.validateSymbolLayerSize(this.symbol);if(n)return this._logWarning(n),void this.reject()}if(e.resource&&e.resource.href)this._prepareModelResources(e.resource.href,t);else{var r=e.resource?e.resource.primitive:"sphere";this._preparePrimitiveResources(r,t)}},t.prototype._preparePrimitiveResources=function(e,t){if(!v.isValidPrimitive(e))return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();var n=this.symbol,r=this._getMaterialOpacity(),l={specular:[0,0,0],opacity:r,transparent:r<1||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:C,diffuse:C},c=this.symbolContainer;if("point-3d"===c.type&&c.verticalOffset){var d=c.verticalOffset,u=d.screenLength,p=d.minWorldLength,f=d.maxWorldLength;l.verticalOffset={screenLength:o.pt2px(u),minWorldLength:p||0,maxWorldLength:null!=f?f:1/0},l.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._isPropertyDriven("color"))l.externalColor=O;else{var m=n.material?i.toUnitRGBA(n.material.color):O;l.externalColor=m}this._fastUpdates=g.initFastSymbolUpdatesState(this._context.renderer,!0,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(a.mixin(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(l.instanced.push("color"),this._optionalFields.push("color"));var y=new w(l,t+"_objectmat");if(this._lodResources=v.primitiveLodResources(e,y,t),!this._lodResources)return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();this._resourceBoundingBox=s.create(v.primitiveBoundingBox(e)),this._resourceSize=s.size(this._resourceBoundingBox),this._symbolSize=h.computeSizeWithResourceSize(this._resourceSize,n),this.finalizeSymbolResources(),this.initializeLodRenderer(),this.resolve()},t.prototype._prepareModelResources=function(e,t){var n=this,i=["transformation"],l={materialParamsMixin:{instanced:i},idHint:t,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=g.initFastSymbolUpdatesState(this._context.renderer,!0,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(a.mixin(l.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));var c=this.symbolContainer;if("point-3d"===c.type&&c.verticalOffset){var d=c.verticalOffset,u=d.screenLength,p=d.minWorldLength,v=d.maxWorldLength;l.materialParamsMixin.verticalOffset={screenLength:o.pt2px(u),minWorldLength:p||0,maxWorldLength:null!=v?v:1/0},l.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=f.fetchObjectLodResources(e,l),this._symbolLoaderPromise.then(function(e){if(n._symbolLoaderPromise=null,!n.isRejected()){f.fillEstimatedMinScreenSpaceRadius(e),n._lodResources=e;var t=n._context,r=n.symbol.material,i=n._getExternalColorParameters(r),a=n._getMaterialOpacity(),o=n._isPropertyDriven("opacity"),l=S.materialsFromLodResources(n._lodResources);n._originalOpacities=l.map(function(e){return e.getParameterValues().opacity||1}),l.forEach(function(e){var n=e.getParameterValues();e.setParameterValues(i);var r=n.opacity*a,s=r<1||o||n.transparent;e.setParameterValues({opacity:r,transparent:s}),t.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:t.sharedResources.screenSizePerspectiveSettings})}),n._resourceBoundingBox=S.computeBoundingBox(n._lodResources.levels[0]),n._resourceSize=s.size(n._resourceBoundingBox),n._pivotOffset=n._lodResources.levels[0].pivotOffset,n._symbolSize=h.computeSizeWithResourceSize(n._resourceSize,n.symbol),n.finalizeSymbolResources(),n.initializeLodRenderer(),g.updateFastSymbolUpdatesState(n._fastUpdates,n._context.renderer,n._fastVisualVariableConvertOptions())&&n._materials.forEach(function(e){return e.setParameterValues(n._fastUpdates.materialParameters)}),n.resolve()}},function(e){if(n._symbolLoaderPromise=null,!n.isFulfilled()){if(!(e instanceof r)){var t="ObjectSymbol3DLayer failed to load";e&&e.message&&(t+=" ("+e.message+")"),n._logWarning(t)}n.reject()}})},t.prototype.finalizeSymbolResources=function(){var e=this._context.stage;this._materials=S.materialsFromLodResources(this._lodResources),this._originalOpacities||(this._originalOpacities=this._materials.map(function(e){return e.getParameterValues().opacity||1})),this._materials.forEach(function(t){e.add(b.ModelContentType.MATERIAL,t)}),this._textures=S.texturesFromLodResources(this._lodResources),this._textures.forEach(function(t){e.add(b.ModelContentType.TEXTURE,t)}),this._geometries=S.geometriesFromLodResources(this._lodResources),this._geometries.forEach(function(t){e.add(b.ModelContentType.GEOMETRY,t)})},t.prototype.initializeLodRenderer=function(){var e=this,t=this._context.stage;this._lodRenderer=new x.LodRenderer(this._lodResources,this._optionalFields,function(t){return{layerUid:e._context.layer.uid,graphicUid:e._instanceIndexToGraphicUid[t]}}),t.addExternalRenderer(this._lodRenderer.slots,this._lodRenderer)},t.prototype._getExternalColorParameters=function(e){var t={};return this._isPropertyDriven("color")?t.externalColor=O:e&&e.color?t.externalColor=i.toUnitRGBA(e.color):(t.externalColor=O,t.colorMixMode="ignore"),t},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var t=this._context.stage;this._lodRenderer&&(t.removeExternalRenderer(this._lodRenderer),this._lodRenderer.destroy()),this._materials&&this._materials.forEach(function(e){return t.remove(b.ModelContentType.MATERIAL,e.id)}),this._textures&&this._textures.forEach(function(e){return t.remove(b.ModelContentType.TEXTURE,e.id)}),this._geometries&&this._geometries.forEach(function(e){return t.remove(b.ModelContentType.GEOMETRY,e.id)})},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var n=u.placePointOnGeometry(t.geometry);if(!n)return this._logWarning("unsupported geometry type for icon symbol: "+t.geometry.type),null;var r="graphic"+t.uid,i=this.getGraphicElevationContext(t),a=e.renderingInfo;return this._createAs3DShape(t,n,a,i,r,t.uid)},t.prototype.notifyDestroyGraphicLayer=function(e){delete this._instanceIndexToGraphicUid[e.instanceIndex]},t.prototype.graphicLayerToGraphicId=function(e){return 0},t.prototype.layerPropertyChanged=function(e,t,n){var r=this;if("opacity"===e){var i=this._isPropertyDriven("opacity");return this._materials.forEach(function(e,t){var n=r._getMaterialOpacity()*r._originalOpacities[t];e.setParameterValues({opacity:n,transparent:n<1||i})}),!0}if("elevationInfo"===e){for(var a in this._updateElevationContext(),t){var o=t[a],s=n(o);if(s){var l=o.graphic,c=this.getGraphicElevationContext(l);s.needsElevationUpdates=u.needsElevationUpdates3D(c.mode),s.elevationContext.set(c)}}return!0}return!1},t.prototype.applyRendererDiff=function(e,t,n,r){var i=this;for(var a in e.diff)switch(a){case"visualVariables":if(!g.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._materials.forEach(function(e){return e.setParameterValues(i._fastUpdates.materialParameters)});break;default:return!1}return!0},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return S.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(e,t){return e+t.data.getIndices(_.VertexAttrConstants.POSITION).length},0)},enumerable:!0,configurable:!0}),t.prototype._createAs3DShape=function(e,t,n,r,i,a){var o=this.getFastUpdateAttrValues(e),s=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?h.mixinColorAndOpacity(n.color,n.opacity):null,l=this._context.clippingExtent;if(y.pointToVector(t,E,this._context.elevationProvider.spatialReference),l&&!u.pointInBox2D(E,l))return null;y.pointToVector(t,E,this._context.renderSpatialReference);var p="absolute-height"!==r.mode,f=u.computeElevation(this._context.elevationProvider,t,r,this._context.renderCoordsHelper,p?D:null),v=P,g=T;m.mat4d.identity(P),this._applyObjectRotation(n,v),this._applyObjectRotation(this.symbol,v),this._applyObjectScale(n,v),this._applyAnchor(v),E[0]=t.x,E[1]=t.y,E[2]=f,y.computeLinearTransformation(t.spatialReference,E,g,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");var b=this._lodRenderer.instanceData;m.mat4d.multiply(g,v,g);var _=b.addInstance();this._instanceIndexToGraphicUid[_]=a,b.setTransform(_,g),o&&b.setFeatureAttribute(_,o),s&&b.setColor(_,s);var x=c.perLodInstanceElevationAligner,S=new d(this,_,x,r);return p&&(S.alignedTerrainElevation=D.terrainElevation),S.needsElevationUpdates=u.needsElevationUpdates3D(r.mode),u.extendPointGraphicElevationContext(S,t,this._context.elevationProvider),S},t.prototype._applyObjectScale=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var n=this._isPropertyDriven("size")&&e.size?e.size:this._symbolSize,r=h.computeObjectScale(n,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters);1===r[0]&&1===r[1]&&1===r[2]||m.mat4d.scale(t,r)}},t.prototype._applyObjectRotation=function(e,t){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&e instanceof l))return h.computeObjectRotation(e.heading,e.tilt,e.roll,t)},t.prototype._computeAnchor=function(){switch(this.symbol.anchor){case"center":return m.vec3d.scale(s.center(this._resourceBoundingBox),-1);case"top":return[-(e=s.center(this._resourceBoundingBox))[0],-e[1],-this._resourceBoundingBox[5]];case"bottom":var e;return[-(e=s.center(this._resourceBoundingBox))[0],-e[1],-this._resourceBoundingBox[2]];case"origin":default:return this._pivotOffset?m.vec3d.scale(this._pivotOffset,-1,new Array(3)):R}},t.prototype._applyAnchor=function(e){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var t=this._computeAnchor();t&&m.mat4d.translate(e,t)}},t.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._resourceBoundingBox?s.size(this._resourceBoundingBox):C,t=this._resourceBoundingBox?this._computeAnchor():R,n=this._context.renderCoordsHelper.unitInMeters,r=h.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,n),i=[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0];return{modelSize:e,symbolSize:this._symbolSize||C,unitInMeters:n,transformation:{anchor:t,scale:r,rotation:i}}},t}(p),C=[1,1,1],O=[1,1,1,1],R=[0,0,0],E=m.vec3d.create(),P=m.mat4d.create(),T=m.mat4d.create(),D={verticalDistanceToGround:0,terrainElevation:0};return A}.apply(null,r))||(e.exports=i)},1765:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1513),n(1516),n(473),n(1550),n(1698),n(1501),n(49),n(1530)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){var u=function(){function e(e,t,n,r){this.type="lod-instance",this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=n,this.elevationContext=new s(r)}return e.prototype.initialize=function(e,t){},e.prototype.setVisibility=function(e){var t=this.lodRenderer.instanceData;return e!==t.getVisible(this.instanceIndex)&&(t.setVisible(this.instanceIndex,e),!0)},e.prototype.destroy=function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))},e.prototype.alignWithElevation=function(e,t,n){if(this.elevationAligner){o.setContextFeature(this.elevationContext.featureExpressionInfoContext,n);var r=this.elevationAligner(this,this.elevationContext,e,t);null!=r&&(this.alignedTerrainElevation=r)}},e.prototype.getBSRadius=function(){var e=this.lodRenderer;return e.baseBoundingSphere.radius*e.instanceData.getScaleFactor(this.instanceIndex)},e.prototype.getCenterObjectSpace=function(){return this.lodRenderer.baseBoundingSphere.center},e.prototype.getBoundingBoxObjectSpace=function(e){return e=e||a.create(),a.set(e,this.lodRenderer.baseBoundingBox),e},e.prototype.getProjectedBoundingBox=function(e,t,n,o){return i(this,void 0,void 0,function(){var i,s,d,u,m,y,b,_,x;return r(this,function(r){switch(r.label){case 0:for(i=this.getBoundingBoxObjectSpace(n),s=v,d=a.isPoint(i)?1:s.length,this.lodRenderer.instanceData.getTransform(this.instanceIndex,g),y=0;y<d;y++)u=s[y],h[0]=i[u[0]],h[1]=i[u[1]],h[2]=i[u[2]],c.mat4d.multiplyVec3(g,h),p[3*y+0]=h[0],p[3*y+1]=h[1],p[3*y+2]=h[2];if(!e(p,0,d))return[2,null];for(a.empty(i),m=null,this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds()),y=0;y<3*d;y+=3){for(b=0;b<3;b++)i[b]=Math.min(i[b],p[y+b]),i[b+3]=Math.max(i[b+3],p[y+b]);m&&o.push({location:p.slice(y,y+3),screenSpaceBoundingRect:m})}if(!t)return[3,5];if(a.center(i,f),"absolute-height"===this.elevationContext.mode)return[3,5];_=void 0,x=l.demResolutionForBoundingBox(i,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.service.queryElevation(f[0],f[1],x)];case 2:return _=r.sent(),[3,4];case 3:return r.sent(),_=null,[3,4];case 4:null!=_&&a.offset(i,0,0,-this.alignedTerrainElevation+_),r.label=5;case 5:return[2,i]}})})},e.prototype.addHighlight=function(e,t){var n=this;this.highlightId=d.generateHighlightId(),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0),e.addExternal(function(e){n.lodRenderer.instanceData.setHighlight(n.instanceIndex,!1),n.highlightId=null},this.highlightId)},e.prototype.removeHighlight=function(e){this.highlightId&&e.remove(this.highlightId)},Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0}),e}(),p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=c.vec3d.create(),f=c.vec3d.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],g=c.mat4d.create();return u}.apply(null,r))||(e.exports=i)},1766:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1702),n(1704)],void 0===(i=function(e,t,n,r){function i(e){var t=[];return e.stageResources.geometries.forEach(function(n,r){var i=e.materialsByComponent[r][0],a=e.stageResources.textures;t.push({material:i,geometry:n,textures:a})}),{components:t,faceCount:e.lodMetrics?e.lodMetrics.faceCount:null,minScreenSpaceRadius:null,pivotOffset:e.pivotOffset}}function a(e){return{levels:e.map(function(e){return i(e)})}}function o(e,t){void 0===t&&(t=s);var n=r.computeFaceCount(e);return Math.sqrt(n/(t*Math.PI))}Object.defineProperty(t,"__esModule",{value:!0}),t.makeLodLevelResources=i,t.makeLodResources=a,t.fetchObjectLodResources=function(e,t){return n.fetchLod(e,t).then(function(e){return a(e)})},t.estimateMinScreenSpaceRadius=o,t.fillEstimatedMinScreenSpaceRadius=function(e){e.levels.forEach(function(e){e.minScreenSpaceRadius=o(e)}),e.levels[0].minScreenSpaceRadius=Math.min(2,e.levels[0].minScreenSpaceRadius)};var s=.05}.apply(null,r))||(e.exports=i)},1767:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(473),n(1517),n(1492),n(1488),n(1491),n(1769),n(1768),n(1770),n(1771),n(1773),n(1515),n(1497),n(1489),n(1496)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g){function m(e,t,n,r){p.encodeDoubleVec3(e.modelOrigin,t,n.modelOriginHi,n.modelOriginLo,r),e.model.getMat(t,A),n.model.setMat(r,A),e.modelNormal.getMat(t,A),n.modelNormal.setMat(r,A),e.color&&n.color&&(e.color.getVec(t,w),n.color.setVec(r,w)),e.featureAttribute&&n.featureAttribute&&(e.featureAttribute.getVec(t,w),n.featureAttribute.setVec(r,w))}Object.defineProperty(t,"__esModule",{value:!0});var y=v.assert,b=function(){function e(e,t){this.glMaterials={};var n=e.rctx,r=t.geometry,i=t.material,o=r.data.toRenderData();this.materialRep=e.materialRep,i.setParameterValues({instancedDoublePrecision:!0});var s=i.getVertexBufferLayout(),l=s[0].stride/4,c=o.indices.position.length,d=new Float32Array(c*l);i.fillInterleaved(o,void 0,void 0,void 0,d,0),this.geometry=r,this.material=i,this.glMaterials=p.acquireGLMaterials(i,this.materialRep),this.vertexBufferLayout=s,this.vbo=f.createVertex(n,35044,d),this.vao=new g(n,a.Default3D,{geometry:s},{geometry:this.vbo}),this.vertexCount=c}return e.prototype.destroy=function(){p.releaseGLMaterials(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()},Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return this.geometry.getBoundingInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0}),e.prototype.intersect=function(e,t,n,r,i){var a=this.geometry.id,o=r.toString();this.material.intersect(this.geometry,null,R,e,t,n,function(t,n,s,l,c,d){if(t>=0){var u={type:"external",metadata:i(r)};(null==e.minResult.priority||l>=e.minResult.priority)&&(null==e.minResult.dist||t<e.minResult.dist)&&(e.minResult.set(u,o,t,n,l,null,a,s),e.minResult.setIntersector("LodRenderer")),(null==e.maxResult.priority||l>=e.maxResult.priority)&&(null==e.maxResult.dist||t>e.maxResult.dist)&&(e.maxResult.set(u,o,t,n,l,null,a,s),e.minResult.setIntersector("LodRenderer"))}},null)},e}();t.LodComponentData=b;var _=function(){function e(e,t){var n=this;this.components=[],this.minScreenSpaceRadius=t.minScreenSpaceRadius,t.components.forEach(function(t){n.components.push(new b(e,t))})}return e.prototype.destroy=function(){this.components.forEach(function(e){e.destroy()})},e.prototype.intersect=function(e,t,n,r,i){this.components.forEach(function(a){a.intersect(e,t,n,r,i)})},Object.defineProperty(e.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var e=r.empty();this.components.forEach(function(t){r.expand(e,t.boundingInfo.bbMin),r.expand(e,t.boundingInfo.bbMax)}),this._boundingBox=e}return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var e=this.boundingBox,t=o.vec3d.create();r.center(e,t),this._boundingSphere={center:t,radius:.5*r.diameter(e)}}return this._boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.components.reduce(function(e,t){return e+t.triangleCount},0)},enumerable:!0,configurable:!0}),e}();t.LodLevelData=_;var x=function(){function e(e,n,r){var a=this;this._levels=[],this._renderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._lastCamera=new i,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.didRender=!1,this._symbol=e,this._optionalFields=n,this._instanceToMetadata=r,this._instanceBufferLayout=h.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:n}),this._instanceData=new l.InstanceData(this._optionalFields),this._instanceData.on("instance-added",function(e){a.resetUpdateCycle()}),this._instanceData.on("instance-removed",function(e){a.resetUpdateCycle()}),this._instanceData.on("instance-transform-changed",function(e){a.resetUpdateCycle()}),this._instanceData.on("instance-visibility-changed",function(e){a.resetUpdateCycle(),a.requestFullCycle()}),this._instanceData.on("instance-highlight-changed",function(e){a.resetUpdateCycle(),a.requestFullCycle()}),t.lodRenderers.push(this),window.lodRenderer=this}return e.prototype.destroy=function(){t.lodRenderers.splice(t.lodRenderers.indexOf(this),1)},Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[0].boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[0].boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var e={cpu:0,gpu:0};return this._renderInstanceData.forEach(function(t){var n=t.memoryUsage;e.cpu+=n.cpu,e.gpu+=n.gpu}),this._highlightRenderInstanceData.forEach(function(t){var n=t.memoryUsage;e.cpu+=n.cpu,e.gpu+=n.gpu}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderStats",{get:function(){var e=this,t=this._instanceData.size,n=[];return this._levels.forEach(function(t,r){var i=e._renderInstanceData[r],a=e._highlightRenderInstanceData[r],o=i.size+a.size,s=t.triangleCount;n.push({renderedInstances:o,renderedTriangles:o*s,trianglesPerInstance:s})}),{totalInstances:t,renderedInstances:n.reduce(function(e,t){return e+t.renderedInstances},0),renderedTriangles:n.reduce(function(e,t){return e+t.renderedTriangles},0),levels:n}},enumerable:!0,configurable:!0}),e.prototype.initializeRenderContext=function(e){var t=this,n=e.rctx;this._symbol.levels.forEach(function(r){t._levels.push(new _(e,r)),t._renderInstanceData.push(new u.RenderInstanceData(n,t._optionalFields,t._instanceBufferLayout)),t._highlightRenderInstanceData.push(new u.RenderInstanceData(n,t._optionalFields,t._instanceBufferLayout))});var r=this._levels[0].boundingSphere.radius,i=this._levels.map(function(e){return e.minScreenSpaceRadius});this._levelSelector=new d.LevelSelector(r,i),this._octree=new c.InstanceOctree(this._instanceData,this._levels[0].boundingSphere)},e.prototype.uninitializeRenderContext=function(e){this._levels.forEach(function(e){e.destroy()}),this._renderInstanceData.forEach(function(e){e.destroy()}),this._highlightRenderInstanceData.forEach(function(e){e.destroy()})},Object.defineProperty(e.prototype,"slots",{get:function(){return[s.OPAQUE_EXTERNAL,s.TRANSPARENT_EXTERNAL]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this._highlightRenderInstanceData.reduce(function(e,t){return e+t.size},0)>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._updateCyclesWithStaticCamera<1},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)},e.prototype.prepareRender=function(e){var t=e.equivalent(this._lastCamera);this._lastCamera.copyFrom(e),t||this.resetUpdateCycle();var n=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(e,n)},e.prototype.render=function(e){var t=e.rctx,n=e.slot===s.OPAQUE_EXTERNAL?s.OPAQUE_MATERIAL:e.slot===s.TRANSPARENT_EXTERNAL?s.TRANSPARENT_MATERIAL:null;if(n){var r={view:e.camera.viewMatrix,proj:e.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:e.camera.viewInverseTransposeMatrix,lightingData:e.lightingData,viewport:e.camera.viewport,fovY:e.camera.fovY,nearFar:[e.camera.near,e.camera.far],framebufferTex:e.offscreenRenderingHelper?e.offscreenRenderingHelper.colorTexture:null,shadowMap:e.shadowMap,shadowMappingEnabled:!!e.shadowMap&&e.shadowMap.enabled,ssaoEnabled:!!e.ssaoHelper&&e.ssaoHelper.enabled,pixelRatio:e.pixelRatio,cameraAboveGround:e.camera.aboveGround,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null};if(t.bindVAO(),e.isHighlightPass)for(var i=0;i<this._levels.length;++i)this.renderLevel(e,n,r,this._highlightRenderInstanceData[i],this._levels[i]);else for(i=0;i<this._levels.length;++i)this.renderLevel(e,n,r,this._renderInstanceData[i],this._levels[i]);return!0}},e.prototype.intersect=function(e,t,n,r){var i=this,a=o.vec3d.create();o.vec3d.subtract(n,t,a),this._octree.forEachAlongRay(t,a,function(r){i._instanceData.getTranslation(r,S),i._instanceData.getModel(r,A),o.vec3d.subtract(t,S,C),o.vec3d.subtract(n,S,O),o.mat3d.inverse(A,A),o.mat3d.multiplyVec3(A,C),o.mat3d.multiplyVec3(A,O);var a=i._instanceData.getState(r),s=i._instanceData.getLodLevel(r);y(a&l.StateFlags.ACTIVE,"invalid instance state"),y(s>=0&&s<i._levels.length,"invaid lod level"),i._levels[s].intersect(e,C,O,r,i._instanceToMetadata)})},e.prototype.queryDepthRange=function(e){return this.queryDepthRangeOctree(e)},e.prototype.queryDepthRangeOctree=function(e){var t=e.eye,n=e.viewForward,r=this._octree.findClosest(n,"front-to-back",e.frustumPlanes),i=this._octree.findClosest(n,"back-to-front",e.frustumPlanes);if(null!=r&&null!=i){this._instanceData.view.boundingSphere.getVec(r,w),o.vec3d.subtract(w,t);var a=o.vec3d.dot(w,n)-w[3];this._instanceData.view.boundingSphere.getVec(i,w),o.vec3d.subtract(w,t);var s=o.vec3d.dot(w,n)+w[3];return{near:Math.max(e.near,a),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}},e.prototype.updateInstances=function(e,t){var n=this._levelSelector;n.updateCamera(e),this._renderInstanceData.forEach(function(e){e.beginUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.beginUpdate()});var r=this._instanceData,i=this._instanceData.view,a=r.size,o=r.capacity,s=this._instanceIndex;t=Math.min(a,t);for(var c=0;c<t;++c){0===s&&this.startUpdateCycle();var d=i.state.get(s),u=0;if(d&l.StateFlags.ALLOCATED){var p=i.lodLevel.get(s);if(d&l.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail(),d&l.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail(),d&l.StateFlags.REMOVE)r.notifyRemoved(s);else if(d&l.StateFlags.VISIBLE){i.modelOrigin.getVec(s,S);var h=n.selectLevel(S,i.modelScaleFactor.get(s));if(u=d&~(l.StateFlags.ACTIVE|l.StateFlags.HIGHLIGHT_ACTIVE|l.StateFlags.TRANSFORM_CHANGED),h>=0){var f=this._renderInstanceData[h],v=f.allocateHead();if(m(i,s,f.view,v),u|=l.StateFlags.ACTIVE,d&l.StateFlags.HIGHLIGHT){var g=this._highlightRenderInstanceData[h],y=g.allocateHead();m(i,s,g.view,y),u|=l.StateFlags.HIGHLIGHT_ACTIVE}}i.state.set(s,u),i.lodLevel.set(s,h)}else u=d&~(l.StateFlags.ACTIVE|l.StateFlags.HIGHLIGHT_ACTIVE|l.StateFlags.TRANSFORM_CHANGED),i.state.set(s,u);var b=!!(d&l.StateFlags.ACTIVE),_=!!(u&l.StateFlags.ACTIVE);!b&&_?this._octree.addInstance(s):b&&!_?this._octree.removeInstance(s):b&&_&&d&l.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(s),this._octree.addInstance(s)),s=(s+1)%o}else s=(s+1)%o,t++}this._instanceIndex=s,this._renderInstanceData.forEach(function(e){e.endUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.endUpdate()})},e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++,this._renderInstanceData.forEach(function(e){e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(function(e){e.startUpdateCylce()})},e.prototype.resetUpdateCycle=function(){this._updateCyclesWithStaticCamera=-1},e.prototype.requestFullCycle=function(){this._needFullCycle=!0},e.prototype.renderLevel=function(e,t,n,r,i){var a=this;i.components.forEach(function(i){a.renderComponent(e,t,n,r,i)})},e.prototype.renderComponent=function(e,t,n,r,i){var o=i.glMaterials[e.pass];if(o&&o.beginSlot(t)&&o.isVisible&&0!==r.size){var l=e.rctx,c=l.capabilities.instancing,d=o.getDrawMode(l);n.origin=[0,0,0],t===s.STENCIL_MATERIAL&&(e.stencilRenderingHelper.enabled=!0,e.stencilRenderingHelper.prepareStencilWritePass()),o.bind(l,n),l.bindVAO(i.vao);var u=o.getProgram();if(v.assertCompatibleVertexAttributeLocations(i.vao,u),e.isHighlightPass){var p=e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null;l.bindTexture(p,5),u.setUniform1i("depthTex",5),u.setUniform4f("highlightViewportPixelSz",0,0,1/n.viewport[2],1/n.viewport[3])}o.bindView(l,n);var h=r.capacity,f=r.headIndex,g=r.tailIndex,m=r.firstIndex,b=this._instanceBufferLayout,_=function(e,t){v.bindVertexBufferLayout(l,a.Default3D,r.buffer,b,e),c.drawArraysInstanced(d,0,i.vertexCount,t-e),v.unbindVertexBufferLayout(l,a.Default3D,r.buffer,b)};i.material.getParams().transparent&&null!=m?f>g?(y(m>=g&&m<=f,"invalid firstIndex"),_(m,f),_(g,m)):f<g&&(m<=f?(y(m>=0&&m<=f,"invalid firstIndex"),_(m,f),_(g,h),_(0,m)):(y(m>=g&&m<=h,"invalid firstIndex"),_(m,h),_(0,f),_(g,m))):f>g?_(g,f):f<g&&(_(0,f),_(g,h)),l.bindVAO(null),o.release(l,n)}},e}();t.LodRenderer=x,t.lodRenderers=[];var S=o.vec3d.create(),w=o.vec4d.create(),A=o.mat3d.create(),C=o.vec3d.create(),O=o.vec3d.create(),R=o.mat4d.identity()}.apply(null,r))||(e.exports=i)},1768:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1488),n(1645)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var i=e.call(this,[0,0,0],1,{getCenter:function(e){var t=i._instanceData.view.boundingSphere,n=i._tmpCenter;return n[0]=t.get(e,0),n[1]=t.get(e,1),n[2]=t.get(e,2),n},getRadius:function(e){return i._instanceData.view.boundingSphere.get(e,3)}},{maximumDepth:25})||this;return i._instanceData=t,i._boundingSphere=n,i._tmpCenter=r.vec3d.create(),i._tmpTranslation=r.vec3d.create(),i._tmpModel=r.mat3d.create(),i}return n(t,e),t.prototype.addInstance=function(e){var t=this._instanceData.view.boundingSphere,n=this._tmpCenter;this._instanceData.getModel(e,this._tmpModel),r.mat3d.multiplyVec3(this._tmpModel,this._boundingSphere.center,n),this._instanceData.getTranslation(e,this._tmpTranslation),r.vec3d.add(n,this._tmpTranslation);var i=this._boundingSphere.radius*this._instanceData.getScaleFactor(e);t.set(e,0,n[0]),t.set(e,1,n[1]),t.set(e,2,n[2]),t.set(e,3,i),this.add(e)},t.prototype.removeInstance=function(e){this.remove(e)},t}(i);t.InstanceOctree=a}.apply(null,r))||(e.exports=i)},1769:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1653),n(1535),n(1488),n(1489)],void 0===(i=function(e,t,n,r,i,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s,l=o.assert;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.ACTIVE=2]="ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"}(s=t.StateFlags||(t.StateFlags={}));var c=function(){return function(e,t,n){var r=0;this.modelOrigin=new i.BufferViewVec3f64(e,r,n),r+=24,this.model=new i.BufferViewMat3f(e,r,n),r+=36,this.modelNormal=new i.BufferViewMat3f(e,r,n),r+=36,this.modelScaleFactor=new i.BufferViewFloat(e,r,n),r+=4,this.boundingSphere=new i.BufferViewVec4f(e,r,n),r+=16,t.indexOf("color")>=0&&(this.color=new i.BufferViewVec4f(e,r,n),r+=16),t.indexOf("featureAttribute")>=0&&(this.featureAttribute=new i.BufferViewVec4f(e,r,n),r+=16),this.state=new i.BufferViewUint8(e,r,n),r+=1,this.lodLevel=new i.BufferViewUint8(e,r,n)}}();t.View=c;var d=function(e){function t(n){var r=e.call(this)||this;return r._capacity=0,r._size=0,r._next=0,r._optionalFields=n,r._elementSize=t.BASE_ELEMENT_SIZE,r._optionalFields.indexOf("color")>=0&&(r._elementSize+=16),r._optionalFields.indexOf("featureAttribute")>=0&&(r._elementSize+=16),r}return n(t,e),Object.defineProperty(t.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),t.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var e=this.findSlot();return this._view.state.set(e,s.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e},t.prototype.removeInstance=function(e){var t=this._view.state;l(e>=0&&e<this._capacity&&t.get(e)&s.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,s.ACTIVE)?this.setStateFlags(e,s.REMOVE):this.notifyRemoved(e)},t.prototype.notifyRemoved=function(e){var t=this._view.state;l(e>=0&&e<this._capacity&&t.get(e)&s.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--,this.emit("instance-removed",{index:e})},t.prototype.setTransform=function(e,t){var n=this._view,r=h,i=f;a.vec3d.set3(t[12],t[13],t[14],r),n.modelOrigin.setVec(e,r),a.mat4d.toMat3(t,i),n.model.setMat(e,i),n.modelScaleFactor.set(e,a.mat4d.maxScale(t)),a.mat3d.inverse(i,i),a.mat3d.transpose(i,i),n.modelNormal.setMat(e,i),this.setStateFlags(e,s.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})},t.prototype.getTransform=function(e,t){var n=this._view;n.model.getMat(e,f),n.modelOrigin.getVec(e,h),t[0]=f[0],t[1]=f[1],t[2]=f[2],t[3]=0,t[4]=f[3],t[5]=f[4],t[6]=f[5],t[7]=0,t[8]=f[6],t[9]=f[7],t[10]=f[8],t[11]=0,t[12]=h[0],t[13]=h[1],t[14]=h[2],t[15]=0},t.prototype.setTranslation=function(e,t){this._view.modelOrigin.setVec(e,t),this.emit("instance-transform-changed",{index:e})},t.prototype.getTranslation=function(e,t){this._view.modelOrigin.getVec(e,t)},t.prototype.getModel=function(e,t){this._view.model.getMat(e,t)},t.prototype.getScaleFactor=function(e){return this._view.modelScaleFactor.get(e)},t.prototype.setFeatureAttribute=function(e,t){this._view.featureAttribute.setVec(e,t)},t.prototype.setColor=function(e,t){this._view.color.setVec(e,t)},t.prototype.getColor=function(e,t){this._view.color.getVec(e,t)},t.prototype.getFeatureAttribute=function(e,t){this._view.featureAttribute.getVec(e,t)},t.prototype.setVisible=function(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,s.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))},t.prototype.getVisible=function(e){return this.getStateFlag(e,s.VISIBLE)},t.prototype.setHighlight=function(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,s.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))},t.prototype.getHighlight=function(e){return this.getStateFlag(e,s.HIGHLIGHT)},t.prototype.getState=function(e){return this._view.state.get(e)},t.prototype.getLodLevel=function(e){return this._view.lodLevel.get(e)},t.prototype.countFlags=function(e){for(var t=0,n=0;n<this._capacity;++n)this.getState(n)&e&&++t;return t},t.prototype.setStateFlags=function(e,t){var n=this._view.state;t=n.get(e)|t,n.set(e,t)},t.prototype.clearStateFlags=function(e,t){var n=this._view.state;t=n.get(e)&~t,n.set(e,t)},t.prototype.setStateFlag=function(e,t,n){n?this.setStateFlags(e,t):this.clearStateFlags(e,t)},t.prototype.getStateFlag=function(e,t){return!!(this._view.state.get(e)&t)},t.prototype.grow=function(){var e=Math.max(u,Math.floor(this._capacity*p)),t=new ArrayBuffer(e*this.elementSize);if(this._buffer){var n=new Uint8Array(this._buffer);new Uint8Array(t).set(n)}this._capacity=e,this._buffer=t,this._view=new c(this._buffer,this._optionalFields,this.elementSize)},t.prototype.findSlot=function(){for(var e=this._view.state,t=this._next;e.get(t)&s.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t},t.BASE_ELEMENT_SIZE=120,t}(r.Evented);t.InstanceData=d;var u=1024,p=2,h=a.vec3d.create(),f=a.mat3d.create()}.apply(null,r))||(e.exports=i)},1770:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1517)],void 0===(i=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._camera=new n,this._worldSpaceRadius=e,this._thresholds=t.map(function(e){return e})}return e.prototype.updateCamera=function(e){this._camera.copyFrom(e)},e.prototype.selectLevel=function(e,t){for(var n=this._camera.computePixelSizeAt(e),r=this._worldSpaceRadius*t/n,i=this._thresholds,a=-1,o=0;o<i.length;++o)r>=i[o]&&(a=o);return a},e}();t.LevelSelector=r}.apply(null,r))||(e.exports=i)},1771:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1535),n(1772),n(1489)],void 0===(i=function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a=i.assert,o=function(){return function(e,t,r){var i=0;this.modelOriginHi=new n.BufferViewVec3f(e,i,r),i+=12,this.modelOriginLo=new n.BufferViewVec3f(e,i,r),i+=12,this.model=new n.BufferViewMat3f(e,i,r),i+=36,this.modelNormal=new n.BufferViewMat3f(e,i,r),i+=36,t.indexOf("color")>=0&&(this.color=new n.BufferViewVec4f(e,i,r),i+=16),t.indexOf("featureAttribute")>=0&&(this.featureAttribute=new n.BufferViewVec4f(e,i,r),i+=16)}}();t.View=o;var s=function(){function e(e,t,n){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._optionalFields=t,this._elementSize=n[0].stride,this._capacity=1}return e.prototype.destroy=function(){this._buffer&&this._buffer.destroy()},Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null},e.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0},e.prototype.beginUpdate=function(){a(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex},e.prototype.endUpdate=function(){a(this._updating,"not updating"),this.size<d*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1},e.prototype.allocateHead=function(){a(this._updating,"not updating"),this.isFull&&this.grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),a(this._headIndex!==this._tailIndex,"invalid pointers"),e},e.prototype.freeTail=function(){a(this._updating,"not updating"),a(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)},e.prototype.grow=function(){var e=Math.max(l,Math.floor(this._capacity*c));this.resize(e)},e.prototype.shrink=function(){if(p){var e=Math.max(l,Math.floor(this._capacity*u));this.resize(e)}},e.prototype.resize=function(e){if(a(this._updating,"not updating"),e!==this._capacity){var t=new r(this._rctx,34962,35044,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var n=this.size,i=this.compactInstances(t);a(i===n,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new o(this._buffer.array,this._optionalFields,this._elementSize)}},e.prototype.compactInstances=function(e){var t=this._headIndex,n=this._tailIndex;return n<t?(this._buffer.copyRange(n,t,e),t-n):n>t?(this._buffer.copyRange(n,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-n),t+(this._capacity-n)):0},e.prototype.incrementHead=function(e){void 0===e&&(e=1),this._headIndex=(this._headIndex+e)%this._capacity},e.prototype.incrementTail=function(e){void 0===e&&(e=1),this._tailIndex=(this._tailIndex+e)%this._capacity},e.prototype.transferRange=function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))},e}();t.RenderInstanceData=s;var l=1024,c=2,d=.3,u=.5,p=!0}.apply(null,r))||(e.exports=i)},1772:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1497)],void 0===(i=function(e,t,n){return function(){function e(e,t,r,i,a){this._elementSize=i,this._buffer=new n(e,t,r),this.resize(a)}return e.prototype.destroy=function(){this._buffer.dispose()},Object.defineProperty(e.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0}),e.prototype.copyRange=function(e,t,n,r){void 0===r&&(r=0);var i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(n.array,r*this.elementSize).set(i)},e.prototype.transferAll=function(){this._buffer.setData(this._array)},e.prototype.transferRange=function(e,t){var n=e*this._elementSize,r=t*this._elementSize;this._buffer.setSubData(this._array,n,n,r)},e.prototype.resize=function(e){var t=e*this._elementSize,n=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(n).set(new Uint8Array(this._array)):new Uint8Array(n).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=n,this._buffer.setData(t),this._capacity=e},e}()}.apply(null,r))||(e.exports=i)},1773:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1555),n(1507)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),t.acquireGLMaterials=function(e,t){var n={};return n[r.MATERIAL]=t.aquire(e),n[r.MATERIAL_DEPTH_SHADOWMAP]=t.aquireDepthShadowMap(e),n[r.MATERIAL_NORMAL]=t.aquireNormal(e),n[r.MATERIAL_DEPTH]=t.aquireDepth(e),n[r.MATERIAL_HIGHLIGHT]=t.aquireHighlight(e),n},t.releaseGLMaterials=function(e,t){t.release(e.id),t.releaseDepthShadowMap(e.id),t.releaseNormal(e.id),t.releaseDepth(e.id),t.releaseHighlight(e.id)},t.encodeDoubleVec3=function(e,t,r,o,s){i[0]=e.get(t,0),i[1]=e.get(t,1),i[2]=e.get(t,2),n.encodeDoubleArray(i,a,3),r.set(s,0,a[0]),o.set(s,0,a[1]),r.set(s,1,a[2]),o.set(s,1,a[3]),r.set(s,2,a[4]),o.set(s,2,a[5])};var i=new Float64Array(3),a=new Float32Array(6)}.apply(null,r))||(e.exports=i)},1774:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(23),n(252),n(1531),n(1520),n(1525),n(1501),n(49),n(98),n(1511),n(1518),n(1560),n(1521),n(1487),n(1515)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g){function m(e,t,n,r){for(var i=e.stageObject,a=i.getGeometryRecords(),s=a.length,l="absolute-height"!==t.mode,c=0,d=0;d<s;d++){var u=a[d].geometry,p=[a[d].transformation[12],a[d].transformation[13],a[d].transformation[14]],h=u.getData().getVertexAttr(),f=h[S.POSITION].data,v=h.zOffset.data,g=h.mapPos.data,m=g.length/3;_(f.length/3==m*O+2,"unexpected tube geometry");var y=0,b=0;A.spatialReference=n.spatialReference;for(var x=0,R=0;R<m;R++){A.x=g[3*R],A.y=g[3*R+1],A.z=g[3*R+2];var E=o.computeElevation(n,A,t,r,l?C:null);l&&(x+=C.terrainElevation);var P=O;0!==R&&R!==m-1||P++;for(var T=0;T<P;T++)w[0]=f[y]+p[0],w[1]=f[y+1]+p[1],w[2]=f[y+2]+p[2],r.setAltitude(E+v[b],w),f[y]=w[0]-p[0],f[y+1]=w[1]-p[1],f[y+2]=w[2]-p[2],y+=3,b+=1;u.invalidateBoundingInfo()}i.geometryVertexAttrsUpdated(d),c+=x/m}return c/s}var y=c.vec3d,b=c.mat4d,_=v.assert,x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=l.validateSymbolLayerSize(this._getSymbolSize());if(e)return this._logWarning(e),void this.reject()}var t=this._getStageIdHint(),n=this._getMaterialOpacityAndColor(),r=y.create(n),i=n[3],a={diffuse:r,ambient:r,opacity:i,transparent:i<1||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new g(a,t+"_3dlinemat"),this._context.stage.add(u.ModelContentType.MATERIAL,this._material),this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(u.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("polyline"!==t.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var n="graphic"+t.uid,r=this.getGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,n,t.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._getMaterialOpacity(),i=r<1||this._isPropertyDriven("opacity");return this._material.setParameterValues({opacity:r,transparent:i}),!0}if("elevationInfo"===e){for(var a in this._updateElevationContext(),t){var s=t[a],l=n(s);if(l){var c=s.graphic,d=this.getGraphicElevationContext(c);l.needsElevationUpdates=o.needsElevationUpdates3D(d.mode),l.elevationContext.set(d)}}return!0}return!1},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype._getPathSize=function(e){return(e.size&&this._isPropertyDriven("size")?o.getSingleSizeDriver(e.size):this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){return this.symbol.size||1},t.prototype._createAs3DShape=function(e,t,n,r,s){var l=e.geometry,c=l.paths,u=[],v=[],g=[],_=y.create(),x=this._context.renderSpatialReference===d.SphericalECEFSpatialReference,S=new Array(6),w=this._getPathSize(t),A=o.getGeometryVertexData3D(c,i.hasZ(l),l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,n);if(this._logGeometryCreationWarnings(A,c,"paths","PathSymbol3DLayer"),c.length>0){for(var C=A.geometryData.outlines,R=A.eleVertexData,E=A.vertexData,P=0;P<C.length;++P){var T=C[P];if(!(T.count<=1)){var D=T.index,I=T.count;if(!this._context.clippingExtent||(o.computeBoundingBox(R,D,I,S),!o.boundingBoxClipped(S,this._context.clippingExtent))){o.chooseOrigin(E,D,I,_),o.subtractCoordinates(E,D,I,_);var M=new Float64Array(R.buffer,3*D*R.BYTES_PER_ELEMENT,3*I),L=o.flatArrayToArrayOfArrays(E,D,I),V=h.createTubeGeometry(L,.5*w,O,x,_);if(V.getVertexAttr().mapPos={size:3,data:M,offsetIdx:0,strideIdx:3},this._material.getParams().vertexColors){var F=this._getVertexOpacityAndColor(t);V=h.addVertexColors(V,F)}var z=new p(V,r+"path"+P);z.singleUse=!0,u.push(z),v.push([this._material]);var U=b.identity();b.translate(U,_,U),g.push(U)}}}if(u.length>0){var N=new f({geometries:u,materials:v,transformations:g,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:s},idHint:r}),B=new a(this,N,u,null,null,m,n);return B.alignedTerrainElevation=A.terrainElevation,B.needsElevationUpdates=o.needsElevationUpdates3D(n.mode),B}}return null},t}(s),S=v.VertexAttrConstants,w=y.create(),A=new r,C={verticalDistanceToGround:0,terrainElevation:0},O=10;return x}.apply(null,r))||(e.exports=i)},1775:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(25),n(32),n(483),n(40),n(473),n(252),n(1536),n(1671),n(1531),n(1520),n(1525),n(1501),n(1701),n(49),n(1511),n(1518),n(1527),n(1521),n(1532),n(1487),n(1556)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g,m,y,b,_,x,S,w){var A=S.VertexAttrConstants,C=g.vec3d,O=g.mat4d,R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},t}return n(t,e),t.prototype._prepareResources=function(){this._prepareFillResources(),this._prepareOutlineResources(),this.resolve()},t.prototype._prepareFillResources=function(){var e=this._getStageIdHint(),t=this._getMaterialOpacityAndColor(),n={color:t,transparent:t[3]<1||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new w(n,e+"_colormat"),this._context.stage.add(m.ModelContentType.MATERIAL,this._material)},t.prototype._prepareOutlineResources=function(){var e=this.symbol.outline;if(this._hasOutline=!!(e&&e.size&&e.size>0&&e.color),this._hasOutline){var t={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:i.pt2px(e.size)};this._outlineMaterial=t.width>=1.5?v.createRibbonMaterial(t):v.createNativeMaterial(t),this._context.stage.add(m.ModelContentType.MATERIAL,this._outlineMaterial)}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(m.ModelContentType.MATERIAL,this._material.id),this._material=null),this._outlineMaterial&&(this._context.stage.remove(m.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic,n=t.geometry.type;if("polyline"!==n&&"polygon"!==n&&"extent"!==n)return this._logWarning("unsupported geometry type for fill symbol: "+n),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,i=this._getVertexOpacityAndColor(e.renderingInfo,Uint8Array,255),a=this.getGraphicElevationContext(t);return"on-the-ground"===a.mode?this._createAsOverlay(t,i,a,r):this._createAs3DShape(t,i,a,r,t.uid)},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e){var r=this._material.getColor(),i=this._getMaterialOpacity();if(this._material.setColor([r[0],r[1],r[2],i]),this._material.setTransparent(i<1),this._outlineMaterial){var a=this._outlineMaterial.getColor();this._outlineMaterial.setColor([a[0],a[1],a[2],this._getOutlineOpacity()])}return!0}if("elevationInfo"===e){var o=this._elevationContext.mode;this._updateElevationContext();var s=this._elevationContext.mode;if(null==o||null==s)return!1;if("on-the-ground"===o&&"on-the-ground"===s)return!0;if(o!==s&&("on-the-ground"===o||"on-the-ground"===s))return!1;var l=p.needsElevationUpdates2D(s);for(var c in t){var d=t[c],u=n(d);if(u&&"object3d"===u.type){var h=d.graphic;u.needsElevationUpdates=l,u.elevationContext.set(this.getGraphicElevationContext(h))}}return!0}return!1},t.prototype.setDrawOrder=function(e,t,n){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e+t/2,n.add(this._material.id)),this._outlineMaterial&&(this._outlineMaterial.renderPriority=e,n.add(this._outlineMaterial.id))},t.prototype._createAs3DShape=function(e,t,n,r,i){var a,o=this._getPolyGeometry(e),s=o.rings,d=this._getOutlineGeometry(o,s),h=p.getGeometryVertexData3D(d,l.hasZ(o),o.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,n);if(D.idHint=r,D.color=t,D.data=h,this._hasOutline&&(a=new(0,h.vertexData.constructor)(h.vertexData)),D.outNum=0,D.outGeometries=[],D.outTransforms=[],D.outMaterials=[],this._createAs3DShapeFill(D),D.data.vertexData=a,this._createAs3DShapeOutline(D),this._logGeometryCreationWarnings(D.data,s,"rings","FillSymbol3DLayer"),0===D.outNum)return null;var f=new _({geometries:D.outGeometries,materials:D.outMaterials,transformations:D.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i},idHint:r}),v=c.perVertexElevationAligner,g=new u(this,f,D.outGeometries,null,null,v,n);return g.alignedTerrainElevation=h.terrainElevation,g.needsElevationUpdates=p.needsElevationUpdates2D(n.mode),g},t.prototype._createAs3DShapeFill=function(e){for(var t=e.data.geometryData.polygons,n=e.data.eleVertexData,r=e.data.vertexData,i=this,o=0;o<t.length;++o)!function(o){var s=t[o],l=s.count,c=s.index;if(i._context.clippingExtent&&(p.computeBoundingBox(n,c,l,E),p.boundingBoxClipped(E,i._context.clippingExtent)))return"continue";var d=new Float64Array(n.buffer,3*c*n.BYTES_PER_ELEMENT,3*l),u=new Float64Array(r.buffer,3*c*r.BYTES_PER_ELEMENT,3*l),h=s.holeIndices.map(function(e){return e-c}),f=a(d,h,3);if(0===f.length)return"continue";p.chooseOrigin(r,c,l,P),p.subtractCoordinates(r,c,l,P);var v=i._createFillGeometry(f,0,u,d,e.color),g=new y(v,e.idHint);g.singleUse=!0;var m=O.identity();O.translate(m,P,m),e.outGeometries.push(g),e.outMaterials.push([i._material]),e.outTransforms.push(m),e.outNum++}(o)},t.prototype._createAs3DShapeOutline=function(e){if(this._hasOutline)for(var t=e.data.geometryData.outlines,n=e.data.eleVertexData,r=e.data.vertexData,i=0;i<t.length;++i){var a=t[i],o=a.index,s=a.count;if(!this._context.clippingExtent||(p.computeBoundingBox(n,o,s,E),!p.boundingBoxClipped(E,this._context.clippingExtent))){p.chooseOrigin(r,o,s,P),p.subtractCoordinates(r,o,s,P);var l=new Float64Array(n.buffer,3*o*n.BYTES_PER_ELEMENT,3*s),c=new Float64Array(r.buffer,3*o*r.BYTES_PER_ELEMENT,3*s),d=v.createPolylineGeometry(c,l,e.isRings,T,0),u=new y(d,e.idHint+"outline"+i);u.singleUse=!0;var h=O.identity();O.translate(h,P,h),e.outGeometries.push(u),e.outMaterials.push([this._outlineMaterial]),e.outTransforms.push(h),e.outNum++}}},t.prototype._createAsOverlay=function(e,t,n,r){var i=this._getPolyGeometry(e),a=i.rings,o=this._getOutlineGeometry(i,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2,this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);var l,c=p.getGeometryVertexDataDraped(o,i.spatialReference,this._context.overlaySR);return D.idHint=r,D.color=t,D.data=c,this._hasOutline&&(l=new(0,c.vertexData.constructor)(c.vertexData)),D.outNum=0,D.outGeometries=[],D.outBoundingBox=s.empty(),this._createAsOverlayFill(D),D.data.vertexData=l,this._createAsOverlayOutline(D),this._logGeometryCreationWarnings(D.data,a,"rings","FillSymbol3DLayer"),D.outNum>0?new d(this,D.outGeometries,D.outBoundingBox):null},t.prototype._createAsOverlayFill=function(e){for(var t=e.data.vertexData,n=e.data.geometryData.polygons,r=this,i=0;i<n.length;++i)!function(i){var o=n[i],l=o.count,c=o.index,d=new Float64Array(t.buffer,3*c*t.BYTES_PER_ELEMENT,3*l),u=o.holeIndices.map(function(e){return e-c}),h=a(d,u,3);if(0===h.length)return"continue";if(p.computeBoundingBox(t,c,l,E),p.boundingBoxClipped(E,r._context.clippingExtent))return"continue";s.expand(e.outBoundingBox,E),p.chooseOrigin(t,c,l,P),p.subtractCoordinates(t,c,l,P),p.setZ(t,c,l,r._getDrapedZ());var f=O.identity();O.translate(f,P,f);var v=r._createFillGeometry(h,c,t,null,e.color),g=new x(v);g.material=r._material;var m=E;g.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0],g.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1])),g.transformation=f,g.name=e.idHint,g.uniqueName=e.idHint+"#"+v.id,e.outGeometries.push(g),e.outNum++}(i)},t.prototype._createAsOverlayOutline=function(e){if(this._hasOutline)for(var t=e.data.vertexData,n=e.data.geometryData.outlines,r=0;r<n.length;++r){var i=n[r],a=i.index,o=i.count;if(p.computeBoundingBox(t,a,o,E),!p.boundingBoxClipped(E,this._context.clippingExtent)){s.expand(e.outBoundingBox,E),p.chooseOrigin(t,a,o,P),p.subtractCoordinates(t,a,o,P),p.setZ(t,a,o,this._getDrapedZ());var l=new Float64Array(t.buffer,3*a*t.BYTES_PER_ELEMENT,3*o),c=O.identity();O.translate(c,P,c);var d=v.createPolylineGeometry(l,null,!0,T,0),u=new x(d);u.material=this._outlineMaterial;var h=E;u.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0],u.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1])),u.transformation=c,u.name=e.idHint+"outline",u.uniqueName=e.idHint+"outline#"+d.id,e.outGeometries.push(u),e.outNum++}}},t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a},t.prototype._getOutlineColor=function(){var e=this.symbol.outline.color,t=this._getOutlineOpacity();return f.mixinColorAndOpacity(r.toUnitRGB(e),t)},t.prototype._getPolyGeometry=function(e){var t=e.geometry;return"extent"===t.type?o.fromExtent(t):t},t.prototype._createFillGeometry=function(e,t,n,r,i){for(var a=e.length,o=new Uint32Array(a),s=new Uint32Array(a),l=0;l<a;l++)o[l]=e[l]+t,s[l]=0;var c={},d={};return c[A.POSITION]=o,c[A.COLOR]=s,d[A.POSITION]={size:3,data:n},d[A.COLOR]={size:4,data:i},r&&(d.mapPos={size:3,data:r},c.mapPos=o),new b(d,c)},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0}),t}(h),E=s.create(),P=C.create(),T=new Float32Array([255,255,255,255]),D={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return R}.apply(null,r))||(e.exports=i)},1776:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(25),n(32),n(256),n(1536),n(1531),n(1520),n(1525),n(1501),n(1518),n(1560),n(1777),n(1526)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f){var v=[1,1,1,1],g=[0,0,1],m={mode:"relative-to-ground",offset:0},y=[0,0,0,1];return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},t}return n(t,e),t.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var e=d.validateSymbolLayerSize(this._getTextSize());if(e)return this._logWarning(e),void this.reject()}this._anchor="center",this.resolve()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject()},t.prototype.createGraphics3DGraphic=function(e,t,n,r){void 0===t&&(t={});var i=e.graphic,a=l.placePointOnGeometry(i.geometry);if(!a)return this._logWarning("unsupported geometry type for text symbol: "+i.geometry.type),null;var o=t.text||this.symbol.text;if(!o||o.length<1)return null;null!=t.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=t.needsOffsetAdjustment);var s=this.getGraphicElevationContext(i,t.elevationOffset||0),c=this._context.layer.id+"_label_"+i.uid,d="polyline"===i.geometry.type;return this._createAs3DShape(this.symbol,a,o,s,c,i.uid,t,n,r,d)},t.prototype.getGraphicElevationContext=function(t,n){void 0===n&&(n=0);var r=e.prototype.getGraphicElevationContext.call(this,t);return r.addOffsetRenderUnits(n),r},t.prototype.layerPropertyChanged=function(e,t,n){if("opacity"===e)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===e){if(this._updateElevationContext(),t)for(var r in t){var i=t[r],a=n(i);a&&this.updateGraphicElevationContext(i.graphic,a)}return!0}return!1},t.prototype.updateGraphicElevationContext=function(e,t){var n=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(n),t.needsElevationUpdates=l.needsElevationUpdates2D(n.mode)||"absolute-height"===n.mode},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0}),t.prototype._defaultElevationInfoNoZ=function(){return m},t.prototype._createAs3DShape=function(e,t,n,c,d,m,b,_,x,S){var w=b.centerOffset||y,A=b.screenOffset||[0,0],C=b.debugDrawBorder||!1,O=b.translation||[0,0,0],R=b.anchor||this._anchor||"center";this._anchor=R;var E,P=e.material?r.toUnitRGBA(e.material.color):v,T=e.halo&&e.halo.color&&e.halo.size>0,D=T?r.toUnitRGBA(e.halo.color):v,I=T?i.pt2px(e.halo.size):0,M=this._getTextSize(e),L=new h(n,{size:M,color:P,font:{family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"},halo:{size:I,color:D}},d);_?E=b:a.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(E=this.symbolContainer);var V={textureId:x?x.textureId:L.id,texCoordScale:x?[1,1]:L.texcoordScale,occlusionTest:!0,screenOffset:A,anchorPos:R,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:b.centerOffsetUnits,debugDrawBorder:C,drawInSecondSlot:!0};if(E&&E.verticalOffset){var F=E.verticalOffset,z=F.screenLength,U=F.minWorldLength,N=F.maxWorldLength;V.verticalOffset={screenLength:i.pt2px(z),minWorldLength:U||0,maxWorldLength:null!=N?N:1/0}}if(this._context.screenSizePerspectiveEnabled){var B=this._context.sharedResources,j=B.screenSizePerspectiveSettings,G=B.screenSizePerspectiveSettingsLabels;V.screenSizePerspective=G.overridePadding(I),V.screenSizePerspectiveAlignment=j}S&&(V.shaderPolygonOffset=1e-4);var H=null,k=JSON.stringify(V);null!=_?null==(H=_.getMaterial(k))&&(H=new f(V,d),_.addMaterial(k,H)):H=new f(V,d);var W=[H],q=p.createPointGeometry(g,O,void 0,x?[0,0]:[L.textWidth,L.textHeight],w,x?[0,0]:null),$=[new u(q,d)],X=this._context.layer.uid,Y=l.createStageObjectForPoint.call(this,t,$,[W],null,null,c,d,X,m,!0);if(null===Y)return null;var Q=o.perObjectElevationAligner,Z=new s(this,Y.object,$,null==_?W:null,x?null:[L],Q,c);return Z.alignedTerrainElevation=Y.terrainElevation,Z.needsElevationUpdates=l.needsElevationUpdates2D(c.mode)||"absolute-height"===c.mode,Z.getScreenSize=function(e){return void 0===e&&(e=new Array(2)),e[0]=x?L.textWidth:L.width,e[1]=x?L.textHeight:L.height,e},Z.metadata={labelText:n,elevationOffset:b.elevationOffset||0},l.extendPointGraphicElevationContext(Z,t,this._context.elevationProvider),Z},t.prototype._getTextSize=function(e){return i.pt2px((e||this.symbol).size)||12},t}(c)}.apply(null,r))||(e.exports=i)},1777:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1549),n(1487),n(1490)],void 0===(i=function(e,t,n,r,i){function a(){var e=document.createElement("canvas");return e.width=s,e.height=s,e}function o(){return c}for(var s=512,l=function(){function e(e,t,n,r){void 0===r&&(r=!0),this._idHint=n,this._text=e,this._textLines=e.split(/\r?\n/),this._params=t;var i=this._params.halo.size;this._haloSize=Math.round(i),this._autoScale=r}return Object.defineProperty(e.prototype,"id",{get:function(){return null==this._id&&(this._id=n.idGen.gen(this._idHint)),this._id},enumerable:!0,configurable:!0}),e.prototype.getParams=function(){return this._params},e.prototype.getText=function(){return this._text},e.prototype.deferredLoading=function(){return!1},Object.defineProperty(e.prototype,"width",{get:function(){return this._width||(this._width=r.nextHighestPowerOfTwo(this.renderedWidth)),this._width},enumerable:!0,configurable:!0}),e.prototype.getWidth=function(){return this.width},Object.defineProperty(e.prototype,"height",{get:function(){return this._height||(this._height=r.nextHighestPowerOfTwo(this.renderedHeight)),this._height},enumerable:!0,configurable:!0}),e.prototype.getHeight=function(){return this.height},Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight||(this._lineHeight=this._computeLineHeight()),this._lineHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this._textWidth||(this._textWidth=this._computeTextWidth()),this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this._textHeight||(this._textHeight=this._computeTextHeight()),this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedWidth",{get:function(){return this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor)),this._renderedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHeight",{get:function(){return this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor)),this._renderedHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor||(this._autoScale?this._scaleFactor=Math.min(1,Math.min(2048/this.textWidth,2048/this.textHeight)):this._scaleFactor=1,this._autoScale&&r.assert(this.renderedWidth<=2048&&this.renderedHeight<=2048)),this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/this.height]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillStyle",{get:function(){return this._fillStyle||(this._fillStyle=function(e){return"rgba("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+","+e[3]+")"}(this._params.color)),this._fillStyle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"haloStyle",{get:function(){return this._haloStyle||(this._haloStyle=function(e){return"rgb("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+")"}(this._params.halo.color)),this._haloStyle},enumerable:!0,configurable:!0}),e.prototype.initializeThroughRender=function(e,t){var n=this._getTextCanvas();n.width=this._width,n.height=this._height;var r=n.getContext("2d");r.save(),t.samplingMode=9987,t.wrapMode=33071,t.flipped=!0,t.preMultiplyAlpha=!0,t.hasMipmap=!0,this.renderText(this._renderedWidth,this._renderedHeight,r,0,this._height-this._renderedHeight);var a=new i(e,t,n);return r.restore(),a},e.prototype.setUnloadFunc=function(e){this._unloadFunc=e},e.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)},e.prototype.renderText=function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var a=this.lineHeight*this.scaleFactor,l=this._haloSize,c=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(n.textAlign,e)+l,d=l;n.save();var u=l<3;if(l>0){var p=d,h=this._getHaloCanvas();h.width=Math.max(s,this.renderedWidth),h.height=Math.max(s,this.renderedHeight);var f=h.getContext("2d");if(f.clearRect(0,0,h.width,h.height),this._setFontProperties(f,this._params.size*this.scaleFactor),f.fillStyle=this.haloStyle,f.strokeStyle=this.haloStyle,f.lineJoin=u?"miter":"round",u)for(var v=0,g=this._textLines;v<g.length;v++){for(var m=g[v],y=0,b=o();y<b.length;y++){var _=b[y],x=_[0],S=_[1];f.fillText(m,c+l*x,d+l*S)}p+=a}else for(var w=0,A=this._textLines;w<A.length;w++){m=A[w];for(var C=2*l,O=0;O<5;O++){var R=.6+.1*O;f.lineWidth=R*C,f.strokeText(m,c,p)}p+=a}n.globalAlpha=this._params.halo.color[3],n.drawImage(h,r,i),h.width=s,h.height=s,n.globalAlpha=1}this._setFontProperties(n,this._params.size*this._scaleFactor);p=i+d;for(var E=0,P=this._textLines;E<P.length;E++){m=P[E];n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(m,r+c,p),n.globalCompositeOperation="source-over",n.fillStyle=this.fillStyle,n.fillText(m,r+c,p),p+=a}n.restore()},e.preferredAtlasSize=function(){return s},e.prototype._getTextCanvas=function(){return null==e._textCanvas2D&&(e._textCanvas2D=a()),e._textCanvas2D},e.prototype._getHaloCanvas=function(){return null==e._haloCanvas2D&&(e._haloCanvas2D=a()),e._haloCanvas2D},e.prototype._setFontProperties=function(e,t){var n=this._params.font,r=n.style+" "+n.weight+" "+t+"px "+n.family;e.font=r,e.textAlign="left",e.textBaseline="top"},e.prototype._computeTextWidth=function(){var e=this._getTextCanvas().getContext("2d");this._setFontProperties(e,this._params.size);for(var t=0,n=0,r=this._textLines;n<r.length;n++){var i=r[n],a=e.measureText(i).width;a>t&&(t=a)}var o=this._params.font;return("italic"===o.style||"oblique"===o.style||"string"==typeof o.weight&&("bold"===o.weight||"bolder"===o.weight)||"number"==typeof o.weight&&o.weight>600)&&(t+=.3*e.measureText("A").width),t+=2*this._haloSize,Math.round(t)},e.prototype._computeLineHeight=function(){var e=1.275*this._params.size;return Math.floor(e+2*this._haloSize)},e.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length},e}(),c=[],d=0;d<360;d+=22.5)c.push([Math.cos(Math.PI*d/180),Math.sin(Math.PI*d/180)]);return l}.apply(null,r))||(e.exports=i)},1778:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(12),n(1652)],void 0===(i=function(e,t,n,r){return function(e){function t(t,n){var r=e.call(this)||this;return r.symbol=t,r.graphics3DSymbol=null,t.fetchSymbol().then(function(e){if(r.isRejected())throw new Error;e.id=r.symbol.id,r.graphics3DSymbol=n(e)}).then(function(){if(r.isRejected())throw new Error;r.graphics3DSymbol.then(function(){r.isRejected()||r.resolve()},function(e){r.isRejected()||r.reject(e)})}).catch(function(e){r.isRejected()||r.reject(e)}),r}return n(t,e),t.prototype.createGraphics3DGraphic=function(e){return this.graphics3DSymbol.createGraphics3DGraphic(e,this)},Object.defineProperty(t.prototype,"numberOfVertices",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.numberOfVertices:0},enumerable:!0,configurable:!0}),t.prototype.layerPropertyChanged=function(e,t){return this.graphics3DSymbol.layerPropertyChanged(e,t)},t.prototype.applyRendererDiff=function(e,t,n){return this.graphics3DSymbol.applyRendererDiff(e,t,n)},t.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}},t.prototype.setDrawOrder=function(e,t){if(this.graphics3DSymbol)return this.graphics3DSymbol.setDrawOrder(e,t)},t.prototype.destroy=function(){this.isFulfilled()||this.reject(),this.graphics3DSymbol&&this.graphics3DSymbol.destroy()},t}(r.Promise)}.apply(null,r))||(e.exports=i)},1779:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(99),n(508)],void 0===(i=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;for(var a in this.owner=t,this.properties={},this.afterDispatchHandle=null,e){var o=e[a],s=new n(o,null,null,2,2);this.properties[a]={pool:s,acquired:[]}}this.afterDispatchHandle=r.afterDispatch(function(){return i.release()})}return e.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.owner=null},e.prototype.get=function(e){var t=this.owner._get(e),n=this.properties[e],r=n.pool.acquire();for(n.acquired.push(r);r===t;)n.acquired.push(r),r=n.pool.acquire();return r},e.prototype.release=function(){for(var e in this.properties){for(var t=this.properties[e],n=0,i=0,a=t.acquired;i<a.length;i++){var o=a[i];r.isValueInUse(o)?t.acquired[n++]=o:t.pool.release(o)}t.acquired.length=n}},e}();t.PropertiesPool=i,t.default=i}.apply(null,r))||(e.exports=i)},1780:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1488)],void 0===(i=function(e,t,n){var r=n.vec3d,i=function(){function e(e,t){this._origins=[],this._boxSize=e,this._maxNumOrigins=t}return e.prototype.getOrigin=function(t){for(var n,i=this._origins.length,o=!1,s=Number.MAX_VALUE,l=0;l<i;l++){var c=(u=this._origins[l]).vec3;r.subtract(t,c,a),a[0]=Math.abs(a[0]),a[1]=Math.abs(a[1]),a[2]=Math.abs(a[2]);var d=a[0]+a[1]+a[2];d<s&&(n=u,s=d,o=a[0]<this._boxSize&&a[1]<this._boxSize&&a[2]<this._boxSize)}if(!o&&(!n||null==this._maxNumOrigins||this._origins.length<this._maxNumOrigins)){var u,p=e.OFFSET;n={vec3:u=[t[0]+p,t[1]+p,t[2]+p],id:this.getOriginId(u)},this._origins.push(n)}return n},e.prototype.getOriginId=function(t){return""+e.ORIGIN_PREFIX+t[0]+"/"+t[1]+"/"+t[2]},e.OFFSET=1.11,e.ORIGIN_PREFIX="fb_",e}(),a=r.create();return i}.apply(null,r))||(e.exports=i)},1781:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(1519),n(1),n(56)],void 0===(i=function(e,t,n,r,i,a,o,s){var l=function(){function e(){this.extents=new a({initialSize:32,allocator:function(){return s.create()}}),this.tempExtent=s.create()}return Object.defineProperty(e.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){var e=0;return this.extents.forEach(function(t){e+=s.area(t)}),e},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),s.set(this.extents.pushNew(),e))},e.prototype.pop=function(){return this.extents.pop()},e.prototype.forEach=function(e){this.extents.forEach(function(t){return e(t)})},e.prototype.mergeAll=function(){for(;this.extents.length>1;){var e=this.extents.length-1;s.expand(this.extents.data[e-1],this.extents.data[e]),this.extents.pop()}},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,n=!1;!n;){n=!0;for(var r=0;r<e.length;++r)if(function(n){for(var r=e.data[n],i=s.area(r),a=!1,o=e.length-1;o>n;--o){var l=e.data[o],c=s.area(l);s.expand(r,l,t);var d=i+c;(s.area(t)-d)/d<.05&&(s.set(r,t),i=s.area(r),e.swapElements(o,e.length-1),e.pop(),a=!0)}return a}(r)){n=!1;break}}},e.prototype.toArray=function(){return this.extents.toArray()},e.prototype.contains=function(e){return this.extents.some(function(t){return s.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)s.contains(e,this.extents.data[t])&&(this.extents.swapElements(t,this.extents.length-1),this.extents.pop())},e}();return function(e){function t(){var t=e.call(this)||this;return t.dirtyExtents=new l,t.globalDirty=!1,t.dirtyGraphicsQueue=new a,t.elevationUpdateEventHandle=null,t.eventHandles=[],t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t}return n(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,n,r){var i=this;this.layerView=e,this.graphicsCore=n,this.elevationProvider=r,this.queryGraphicUIDsInExtent=t,this.elevationUpdateEventHandle=r.on("elevation-change",function(e){return i.elevationUpdateHandler(e)}),this.eventHandles.push(this.layerView.watch("suspended",function(){return i.suspendedChange()}))},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null),this.eventHandles.forEach(function(e){return e.remove()}),this.eventHandles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()},t.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()},t.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()},t.prototype.idleUpdate=function(e){var t=this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var n=this.layerView.view,r=this.graphicsCore.stageLayer.id,i=this.graphicsCore.labelsEnabled?n.labeler.labelStageLayerId:null,a=!1;this.hasPendingOperations()&&!e.done();){for(;this.dirtyGraphicsQueue.length>0&&!e.done();){for(var o=Math.min(this.dirtyGraphicsQueue.length,100),s=0;s<o;s++){var l=this.dirtyGraphicsQueue.pop(),c=this.graphicsCore.graphics[l];c&&c.alignWithElevation(this.elevationProvider,n.renderCoordsHelper)}n._stage.processDirtyLayer(r),null!=i&&n._stage.processDirtyLayer(i)}for(;this.dirtyExtents.count>0&&this.dirtyGraphicsQueue.length<100&&!e.done();){a||(this.dirtyExtents.mergeTight(),a=!0);var d=this.dirtyExtents.pop();this.queryGraphicUIDsInExtent(d,this.spatialReference,function(e){var n=t.graphicsCore.graphics[e];n&&n.needsElevationUpdates()&&t.dirtyGraphicsQueue.push(e)})}}n.deconflictor.setDirty(),n.labeler.setDirty(),this.notifyChange("updating")},t.prototype.markAllGraphicsElevationDirty=function(){for(var e in this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics)this.dirtyGraphicsQueue.push(+e);this.notifyChange("updating")},t.prototype.hasPendingOperations=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.count>0||this.globalDirty},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var n=this.graphicsCore.computedExtent;n&&t[2]>n.xmin&&t[0]<n.xmax&&t[3]>n.ymin&&t[1]<n.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},r([o.property({readOnly:!0})],t.prototype,"updating",null),r([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(o.declared(i))}.apply(null,r))||(e.exports=i)},1782:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(15),n(16),n(1),n(486),n(1783)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c){var d=-.3*l.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!0,t._frustumVisibilityDirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new a,t.layerView=null,t}return n(t,e),Object.defineProperty(t.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(e){e!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new c.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var n=e.view,r=n.basemapTerrain;this.handles.add([n.on("resize",function(){return t.viewChange()}),n.state.watch("camera",function(){return t.viewChange()},!0),r.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===n.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(o.init(r,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=r.isSeeThrough()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.frustumVisibilityDirty=!0},t.prototype.viewChange=function(){this.frustumVisibilityDirty=!0},t.prototype.elevationBoundsChange=function(){this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.idleUpdate=function(e){e.done()||this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1)},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=d;else{var n=t.basemapTerrain.getElevationBounds(),r=n[0],i=n[1];e=r-Math.max(1,(i-r)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r([s.property({readOnly:!0})],t.prototype,"suspended",void 0),r([s.property({readOnly:!0})],t.prototype,"updating",null),r([s.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(s.declared(i))}.apply(null,r))||(e.exports=i)},1783:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(473),n(56),n(49),n(486),n(1510),n(1559),n(80),n(98)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var d=.5*Math.PI,u=d/Math.PI*180,p=d*a.earthRadius,h=.9*a.earthRadius,f=function(){function e(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:i.vec3d.create(),direction:i.vec3d.create()};for(var t=0;t<4;t++)this.extent[t]={origin:i.vec3d.create(),direction:i.vec3d.create(),cap:{next:null,direction:i.vec3d.create()}},this.planes[t]=o.plane.create();this.planes[4]=o.plane.create(),this.planes[5]=o.plane.create(),this.planesWithoutFar=this.planes.slice(0,5)}return e.prototype.update=function(e,t,n,r){void 0===r&&(r=!0);var a=this.extent;this.toRenderBoundingExtent(e,t,n),i.vec3d.add(a[0].origin,a[2].origin,this.center.origin),i.vec3d.scale(this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||i.vec3d.scale(this.center.direction,-1);for(var s=0;s<4;s++){var l=a[s];this.renderCoordsHelper.worldUpAtPosition(l.origin,l.direction);var c=a[3===s?0:s+1];l.cap.next=c.origin,i.vec3d.direction(c.origin,l.origin,l.cap.direction),o.plane.fromVectorsAndPoint(l.direction,l.cap.direction,l.origin,this.planes[s]),r||i.vec3d.scale(l.direction,-1)}o.plane.fromVectorsAndPoint(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[4]),r?o.plane.negate(this.planes[4],this.planes[5]):(o.plane.set(this.planes[5],this.planes[4]),o.plane.negate(this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t},e.prototype.isVisibleInFrustum=function(e,t){if(void 0===t&&(t=!1),"global"===this.renderCoordsHelper.type){var n=this.maxSpanSpatialReference.isWGS84?u:p;if(this.maxSpan>n)return!0;if(e.altitude>=h)return this.isVisibleInFrustumGlobal(e)}for(var r=0;r<this.extent.length;r++){var i=this.extent[r];if(!t&&e.intersectsRay(i.origin,null,i.direction))return!0;if(e.intersectsLineSegment(i.origin,i.cap.next,i.cap.direction))return!0}var a=t?this.planes:this.planesWithoutFar;for(r=0;r<e.lines.length;r++){var o=e.lines[r];if(s.frustumLineSegment(a,o.origin,o.endpoint,o.direction))return!0}return!1},e.prototype.toRenderBoundingExtentGlobal=function(e,t,a){r.center(e,g),g[2]=a,c.computeLinearTransformation(t,g,m,this.renderCoordsHelper.spatialReference),i.mat4d.inverse(m,y),n.empty(b);for(var o=0,s=v;o<s.length;o++)for(var d=s[o],u=d.x0,p=d.x1,h=d.y0,f=d.y1,_=0;_<5;_++){var x=_/4;g[0]=l.lerp(e[u],e[p],x),g[1]=l.lerp(e[h],e[f],x),g[2]=a,c.vectorToVector(g,t,g,this.renderCoordsHelper.spatialReference),i.mat4d.multiplyVec3(y,g),n.expandPointInPlace(b,g)}i.mat4d.multiplyVec3(m,i.vec3d.set3(b[0],b[1],b[2],this.extent[0].origin)),i.mat4d.multiplyVec3(m,i.vec3d.set3(b[3],b[1],b[2],this.extent[1].origin)),i.mat4d.multiplyVec3(m,i.vec3d.set3(b[3],b[4],b[2],this.extent[2].origin)),i.mat4d.multiplyVec3(m,i.vec3d.set3(b[0],b[4],b[2],this.extent[3].origin))},e.prototype.toRenderBoundingExtentLocal=function(e,t,n){i.vec3d.set3(e[0],e[1],n,this.extent[0].origin),i.vec3d.set3(e[2],e[1],n,this.extent[1].origin),i.vec3d.set3(e[2],e[3],n,this.extent[2].origin),i.vec3d.set3(e[0],e[3],n,this.extent[3].origin)},e.prototype.toRenderBoundingExtent=function(e,t,n){switch(this.renderCoordsHelper.type){case"global":this.toRenderBoundingExtentGlobal(e,t,n);break;case"local":this.toRenderBoundingExtentLocal(e,t,n);break;default:this.renderCoordsHelper.type}},e.prototype.isVisibleInFrustumGlobal=function(e){if(i.vec3d.dot(this.center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var n=this.extent[t];if(i.vec3d.dot(n.direction,e.direction)<0)return!0}return!1},e}();t.FrustumExtentIntersection=f;var v=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],g=i.vec3d.create(),m=i.mat4d.create(),y=i.mat4d.create(),b=n.create();t.default=f}.apply(null,r))||(e.exports=i)},1784:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1785)],void 0===(i=function(e,t,n){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var r=this,i=new n(e,t);return this.highlights.push(i),{set:i,handle:{remove:function(){return r.releaseSet(i)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){var n=this.graphicsCore.graphics;t.forEach(function(t){e.ids.add(t);var r=n[t];r&&r.addHighlight(e.highlightSet,e.options)})},e.prototype.setObjectIds=function(e,t){var n=this.graphicsCore.graphics;for(var r in t.forEach(function(t){return e.ids.add(t)}),n){var i=n[r];i&&e.hasGraphic(i)&&i.addHighlight(e.highlightSet,e.options)}},e.prototype.graphicCreated=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.graphicDeleted=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,r))||(e.exports=i)},1785:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(1673)],void 0===(i=function(e,t,n){return function(){function e(e,t){this.highlightSet=new n,this.ids=new Set,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,r))||(e.exports=i)},1786:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(1)],void 0===(i=function(e,t,n,r,i,a){function o(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return n(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,n,r,i){this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=n,this.graphicsCore=r,this.basemapTerrain=i,this.updateScaleRangeActive()},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.idleUpdate=function(e){this.layerView.view.basemapTerrain&&(e.done()||this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1))},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,n=!1;t.labelingInfo&&(n=n||t.labelingInfo.some(function(e){return e&&o(e.minScale,e.maxScale)})),n=n||o(t.minScale,t.maxScale);var r=this._scaleRangeActive!==n;return this._scaleRangeActive=n,n&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!n&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),r},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtScale=function(e,t,n){return null==e||e>n&&(!t||e<t)},t.prototype.visibleAtLayerScale=function(e){return this.visibleAtScale(e,this.layer.minScale,this.layer.maxScale)},t.prototype.visibleAtLabelScale=function(e,t){return this.visibleAtScale(e,t.minScale,t.maxScale)},t.prototype.graphicScale=function(e){var t;return e.centroid?t=e.centroid:"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateGraphicScaleVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),n=this.updateLabelScaleVisibility(e,t);return n&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),n},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var n=e._labelGraphics[0]._labelClass;if(n&&null!=n.minScale&&null!=n.maxScale){var r=this.visibleAtLabelScale(t,n);if(e.setVisibilityFlag(1,r,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var n=e.extent,r=e.scale,i=this.visibleAtLayerScale(r),a=!1;this.queryGraphicUIDsInExtent(n,e.spatialReference,function(e){var o=t.graphicsCore.getGraphics3DGraphicById(e);if(o){var s=o.centroid;if(s&&(n[0]>s.x||n[1]>s.y||n[2]<s.x||n[3]<s.y))return;var l=!1;o.setVisibilityFlag(1,i)&&(l=!0),t.updateLabelScaleVisibility(o,r)&&(l=!0),l&&(a=!0)}}),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(1,void 0)})),this.layerScaleRangeVisibilityDirty=!0},r([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r([a.property({readOnly:!0})],t.prototype,"updating",null),r([a.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(a.declared(i))}.apply(null,r))||(e.exports=i)},1787:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(1519),n(82),n(1),n(1730)],void 0===(i=function(e,t,n,r,i,a,o,s,l){var c=function(e){function t(t){var n=e.call(this)||this;return n.index=new l.default(9,o("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),n.spatialReference=null,n}return n(t,e),t.prototype.destroy=function(){this.index.clear(),this.index=null},t.prototype.queryGraphicUIDsInExtent=function(e,t,n){t.equals(this.spatialReference)&&(u.minX=e[0],u.minY=e[1],u.maxX=e[2],u.maxY=e[3],this.index.search(u,function(e){n(e.graphic.uid)}))},t.prototype.add=function(e){!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(this.index.insert(e),e.addedToSpatialIndex=!0)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length),d.clear();for(var n=0;n<t;n++){var r=e[n];!r.addedToSpatialIndex&&r.computeExtent(this.spatialReference)&&(d.push(r),r.addedToSpatialIndex=!0)}this.index.load(d.data,d.length)},t.prototype.remove=function(e){e.addedToSpatialIndex&&(e.addedToSpatialIndex=!1,this.index.remove(e))},t.prototype.removeMany=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.remove(r)}},t.prototype.clear=function(){this.index.clear()},r([s.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),r([s.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],t)}(s.declared(i)),d=new a({initialSize:50}),u={minX:0,minY:0,maxX:0,maxY:0};return c}.apply(null,r))||(e.exports=i)},1842:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(1513),n(1516),n(8),n(7),n(16),n(1),n(252),n(505),n(1651),n(1534),n(1746),n(1843),n(1688)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d,u,p,h,f,v,g){return function(e){function t(t){var n=e.call(this)||this;return n.controller=null,n.asyncGraphicsUpdates=!1,n.suspendResumeExtentMode="computed",n.supportsDraping=!0,n.overlayUpdating=!1,n.fullExtentInLocalViewSpatialReference=null,n.suspendResumeExtent=null,n._queryEngine=null,n._controllerCreated=!1,n._controllerClientSideFiltering=!1,n.clippingExtent=null,n.supportsHeightUnitConversion=!0,n}return n(t,e),t.prototype.initialize=function(){var e=this;this._set("graphics3d",new f({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.handles.add([this.watch("asyncGraphicsUpdates",function(t){e.graphics3d.graphicsCore.asyncUpdates=t}),this.watch("suspendResumeExtentMode",function(t){e.graphics3d.suspendResumeExtentMode=t})]),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(this.graphics3d.setup().then(function(){return e.validateGeometryType()}).then(function(){return g.toViewIfLocal(e)}).then(function(t){e.fullExtentInLocalViewSpatialReference=t}).then(function(){return e.initializeController()})),this.notifyChange("updating")},t.prototype.destroy=function(){this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.loadedGraphics=null},Object.defineProperty(t.prototype,"drawingOrder",{set:function(e){this.graphics3d.graphicsCore.setDrawingOrder(e),this._set("drawingOrder",e)},enumerable:!0,configurable:!0}),t.prototype.getRenderingInfo=function(e){var t=p.getRenderingInfo(e,{renderer:this.layer.renderer});if(t&&t.color){var n=t.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return t},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,n=null;return this.loadedGraphics&&this.loadedGraphics.some(function(r){return r.uid===e&&(n=d.hydrateGraphic(r,t.layer),!0)}),s.create(function(e,t){null!==n?e(n):t()})},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsKeys:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.queryFeatures=function(e){return this._queryEngine?this._queryEngine.queryFeatures(e):this._rejectQuery()},t.prototype.queryObjectIds=function(e){return this._queryEngine?this._queryEngine.queryObjectIds(e):this._rejectQuery()},t.prototype.queryFeatureCount=function(e){return this._queryEngine?this._queryEngine.queryFeatureCount(e):this._rejectQuery()},t.prototype.queryExtent=function(e){return this._queryEngine?this._queryEngine.queryExtent(e):this._rejectQuery()},t.prototype.highlight=function(e,t){return this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.getStats=function(){var e=v.stats(this,this.graphics3d.graphicsCore);return e.elevationUpdating=this.graphics3d.elevationAlignment.updating,e.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended,e.visibilityScale=!this.graphics3d.scaleVisibility.suspended,e},t.prototype.canResume=function(){return!(!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed)&&(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready)||this.graphics3d.updating)},t.prototype.initializeController=function(){return a(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return[4,(e=t.sent()).when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}})})},t.prototype.setControllerWhenInitialized=function(e){return a(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,l.whenTrueOnce(this.view,"basemapTerrain.ready")]:[2];case 4:return t.sent(),this.controller=e,this.loadedGraphics=e.graphics,this._queryEngine=new u({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"memory":case"stream":return!1;case"snapshot":return!this._controllerClientSideFiltering&&(this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0,!0):(this.controller.extent=e,!0));case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){var e=this.layer;switch(e.geometryType){case"multipatch":case"multipoint":return s.reject(new o("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:e.geometryType}))}},t.prototype._rejectQuery=function(){return s.reject(new o("featurelayerview3d:query","Not ready to execute query"))},r([c.property()],t.prototype,"loadedGraphics",void 0),r([c.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),r([c.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],t.prototype,"updating",void 0),r([c.property()],t.prototype,"controller",void 0),r([c.property()],t.prototype,"graphics3d",void 0),r([c.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r([c.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),r([c.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r([c.property({readOnly:!0,type:Boolean})],t.prototype,"supportsDraping",void 0),r([c.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),r([c.property()],t.prototype,"drawingOrder",null),r([c.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(c.declared(h))}.apply(null,r))||(e.exports=i)},1843:function(e,t,n){var r,i;r=[n.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.stats=function(e,t){var n=t.graphics3DGraphics,r="null",i=e.suspendResumeExtent;i&&(r=[i[0],i[1],i[2],i[3]].map(function(e){return e.toPrecision(4)}).join(", "));var a="null",o=t.computedExtent;return o&&(a=[o.xmin,o.ymin,o.xmax,o.ymax].map(function(e){return e.toPrecision(4)}).join(", ")),{numCollection:e.loadedGraphics.length,numGraphics:Object.keys(n).length,graphicsUpdating:t.updating,resumeExtent:r,computedExtent:a,updating:e.updating,suspended:e.suspended}}}.apply(null,r))||(e.exports=i)},1878:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(4),n(8),n(29),n(15),n(7),n(16),n(1)],void 0===(i=function(e,t,n,r,i,a,o,s,l,c,d){return function(e){function t(){var t=e.call(this)||this;return t._handles=new s,t.connectionError=null,t.connectionStatus="disconnected",t.filter=null,t._handles.add(c.on(t,"controller","data-received",function(e){t.emit("data-received",e)})),t}return n(t,e),t.prototype.connect=function(){return this.controller.connection.connect()},t.prototype.disconnect=function(){this.controller.connection.disconnect()},t.prototype.updateFilter=function(e){return"connected"!==this.connectionStatus?l.reject(new a("stream-layer-view: updateFilter","Cannot update filter. The connection with the stream service is closed")):this.controller.updateFilter(e).then(function(e){return e}).catch(function(e){throw e})},r([d.property({aliasOf:"controller.connection.connectionError",readOnly:!0})],t.prototype,"connectionError",void 0),r([d.property({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),r([d.property()],t.prototype,"controller",void 0),r([d.property({aliasOf:"controller.filter",readOnly:!0})],t.prototype,"filter",void 0),r([d.subclass("esri.views.layers.StreamLayerView")],t)}(d.declared(i,o))}.apply(null,r))||(e.exports=i)},2310:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(2),n(0),n(1513),n(1516),n(57),n(18),n(7),n(1),n(1842),n(1878)],void 0===(i=function(e,t,r,i,a,o,s,l,c,d,u,p){return function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.createController=function(){return o(this,void 0,void 0,function(){var e,t,r;return a(this,function(i){switch(i.label){case 0:return e=l.ofType(s),[4,c.create(function(e){n.e(20).then(function(){var t=[n(1943)];e.apply(null,t)}.bind(this)).catch(n.oe)})];case 1:return t=i.sent(),[4,(r=new t({layer:this.layer,layerView:this,graphics:new e})).when()];case 2:return i.sent(),[2,r]}})})},i([d.property()],t.prototype,"controller",void 0),i([d.property({aliasOf:"controller.graphics",readOnly:!0})],t.prototype,"graphics",void 0),i([d.subclass("esri.views.3d.layers.StreamLayerView3D")],t)}(d.declared(p,u))}.apply(null,r))||(e.exports=i)}}]);