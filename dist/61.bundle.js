(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/HandleOwner":1602,"esri/views/2d/layers/features/processors/BaseProcessor":2016,"esri/views/2d/engine/webgl/rendererInfoUtils":2017,"esri/views/2d/layers/features/processors/SymbolProcessor":2486,"esri/views/2d/engine/webgl/collisions/CollisionGrid":2487})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{1602:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(13),r(1)],void 0===(i=function(e,t,r,n,i,o,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.call(this)||this;return n.handles=new o,n}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},n([s.property({readOnly:!0})],t.prototype,"handles",void 0),n([s.subclass("esri.core.HandleOwner")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},2016:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(1602),r(1),r(1750)],void 0===(i=function(e,t,r,n,i,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),n([s.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([s.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),n([s.property({constructOnly:!0})],t.prototype,"service",void 0),n([s.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),n([s.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),n([s.property({constructOnly:!0})],t.prototype,"tileStore",void 0),n([s.subclass()],t)}(s.declared(i,o,l.default));t.default=a}.apply(null,n))||(e.exports=i)},2017:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(50),r(100),r(53),r(1582),r(1850)],void 0===(i=function(e,t,r,n,i,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var a=new i;function u(e,t,r){if(!e)return null;var i=0,s={},l=e.clone(),u=l.visualVariables,c=null;if("simple"!==l.type){var p=l.field,f=l.valueExpression;if(!p&&f){var d="$$fake"+i++,y=o.createFunction(f);s[d]=function(e,n){return a.repurposeFromGraphicLikeObject(e.geometry,e.attributes,r),o.executeFunction(y,{vars:{$feature:a,$view:o.getViewInfo(n)},spatialReference:t})},l.field=d,l.valueExpression=null,c=function(e,t){return t.attributes[d]=s[d](t),e.valueExpression?e.getSymbol(n.fromJSON(t)):e.getSymbol(t)}}}return u&&(l.visualVariables=u.map(function(e){var n="size"===e.type&&e.valueExpression&&"$view.scale"===e.valueExpression;if(e.normalizationField){var l=e.field,u=e.normalizationField,c="$$fake"+i++;return s[c]=function(e,t){return e.attributes[l]/e.attributes[u]},(p=e.clone()).field=c,p.normalizationField=null,p}if(!e.valueExpression||n)return e;var p,f=e.valueExpression,d=(c="$$fake"+i++,o.createFunction(f));return s[c]=function(e,n){return a.repurposeFromGraphicLikeObject(e.geometry,e.attributes,r),o.executeFunction(d,{vars:{$feature:a,$view:o.getViewInfo(n)},spatialReference:t})},(p=e.clone()).field=c,p.valueExpression=null,p})),{renderer:l,normalizingFunctions:s,getSymbolFunction:c}}t.createRendererInfo=function(e,t,r){var n=u(e,t,r)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},i=n&&n.normalizingFunctions,o=n&&n.getSymbolFunction;e=n&&n.renderer||e;var s=l.convertVisualVariables(e.visualVariables);return{renderer:e,vvFields:s.vvFields,vvRanges:s.vvRanges,getValue:function(e,t){var r=i[t];return r?r(e):e.attributes[t]},getSymbol:function(e){return o?o(this.renderer,e):this.renderer.getSymbol?this.renderer.getSymbol.call(this.renderer,e):null}}},t.getNormalizedRenderer=function(e,t,r){var n=u(e,t,r)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null};return n&&n.renderer||e},t.getSymbol=function(e,t){return e.getSymbol(t)},t.isRendererWebGLCompatible=function(e){if(!e)return!1;if(-1===["simple","class-breaks","unique-value","heatmap"].indexOf(e.type))return!1;if("visualVariables"in e&&e.visualVariables)for(var t=0,r=e.visualVariables;t<r.length;t++){var n=r[t];switch(n.type){case"color":case"opacity":if(n.stops&&8<n.stops.length)return!1;break;case"size":if(l.getTypeOfSizeVisualVariable(n)===s.WGLVVFlag.SIZE_FIELD_STOPS&&n.stops&&6<n.stops.length)return!1}}return!0}}.apply(null,n))||(e.exports=i)},2486:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(10),r(124),r(8),r(9),r(1880),r(7),r(1),r(20),r(159),r(149),r(1606),r(2017),r(1579),r(2487),r(1881),r(1730),r(1882),r(1883),r(1841),r(2016)],void 0===(i=function(e,t,r,n,i,o,s,l,a,u,c,p,f,d,y,h,g,m,v,b,_,S,I,O){function w(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return function(e){return e&&("unique-value"===e.type||"class-breaks"===e.type)&&null!==e.backgroundFillSymbol}(e)||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return x.error(new s("mapview-invalid-type",e+" is not supported")),!1}}function P(e,t,r){r.has(e)||r.set(e,new Set);for(var n=r.get(e),i=t.length,o=0;o<i;o++){var s=t.charCodeAt(o);n.add(s)}}Object.defineProperty(t,"__esModule",{value:!0});var x=l.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.destroy=function(){this._visualSetPromises.forEach(function(e,t){e.cancel()}),this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return this.configuration&&this.configuration.labelingInfo?this.configuration.labelingInfo.map(function(e){return f.fromJSON(e)}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?this.labelingInfo.map(function(t){return{labelOptions:t.getOptions(e.spatialReference),labelExpression:t.getLabelExpression(),labelClass:t}}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hydrate",{get:function(){return g.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factory",{get:function(){var e=this;if(!this.configuration)return null;var t=this.service,r=t.geometryType,n=t.objectIdField,i=t.fields,o=this.configuration,s=o.devicePixelRatio,l=o.hasGeometryExpr,a=p.fromJSON(this.spatialReference),u={hasGeometryExpr:l,geometryType:r,fields:i,spatialReference:a},c=new b.default,f=new S.default(function(t){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t)},s);return this._matcher=v.createMatcher(this.renderer,c,f,u),new _.default(r,n,this.renderer.visualVariables,u,s,a,c,f,this.labelingInfo,this.tileStore.tileScheme.tileInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=this.configuration,t=e.renderer,r=e.definitionExpression,n=e.outFields,i=e.gdbVersion,o=e.historicMoment,s=this.service.geometryType,l=this._getReturnCentroid(this.rendererInfo.renderer),a=w(s,this.rendererInfo.renderer),u="esriGeometryPoint"===s||"esriGeometryMultipoint"===s||l?20:0,c=null,p=t.visualVariables;return p&&p.some(function(e){if("size"===e.type&&e.field&&!e.normalizationField)return c=[e.field+" DESC"],!0}),{definitionExpression:r,orderByFields:c,outFields:n,pixelBuffer:u,returnCentroid:l,returnGeometry:a,gdbVersion:i,historicMoment:o}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.configuration?d.fromJSON(this.configuration.renderer):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererInfo",{get:function(){return this.configuration?h.createRendererInfo(d.fromJSON(this.configuration.renderer),this.tileStore.tileScheme.spatialReference,{fields:this.service.fields}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.service.fields},enumerable:!0,configurable:!0}),t.prototype.onTileData=function(e,t){var r=this,n=t.addOrUpdate,i=t.remove,o=t.clear,s=(n&&n.length?this._processFeatures(e,n,t.transformParams):u.resolve()).then(function(t){var n=t&&t.message||null,s=t&&t.transferList||null;return r.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{addOrUpdate:n,remove:i,clear:o}},{transferList:s})}).catch(function(t){return r._handleError(e,t)});return this._visualSetPromises.set(e,s),s.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),s},t.prototype.onTileError=function(e,t){var r=this,n=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t});return this._visualSetPromises.set(e,n),n.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),n},t.prototype.onTileUpdate=function(e){for(var t=0,r=e.removed;t<r.length;t++){var n=r[t],i=this._visualSetPromises;if(!i.has(n))return;i.get(n).cancel(),i.delete(n),this.notifyChange("updating")}},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._processFeatures=function(e,t,r){var n=this;if(!t||!t.length)return u.resolve(null);var i=this.factory,o={viewingMode:"",scale:e.scale};return i.analyze(t,this._matcher,r,o).then(function(t){return n._getLabelMosaicItems(e,t,r).then(function(o){return n._writeFeatures(e,t,r,o,i)})})},t.prototype._writeFeatures=function(e,t,r,n,i){for(var o=i.createMeshData(t.length),s={viewingMode:"",scale:e.scale},l=this._symbolToMosaicItemMap,a=0,u=t;a<u.length;a++){var c=u[a];i.write(o,c,r,s,e.level,n,l)}return this._encodeDisplayData(o)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t){if(t&&"cancel"!==t.dojoType)return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message})},t.prototype._getReturnCentroid=function(e){function t(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t}if("esriGeometryPolygon"===this.service.geometryType&&this.labelingInfo)return!0;if("esriGeometryPolygon"!==this.service.geometryType)return!1;switch(e.type){case"simple":return t(e.symbol);case"unique-value":return t(e.defaultSymbol)||e.uniqueValueInfos.some(function(e){return t(e.symbol)});case"class-breaks":return t(e.defaultSymbol)||e.classBreakInfos.some(function(e){return t(e.symbol)});default:return!0}},t.prototype._getLabelMosaicItems=function(e,t,r){var n=a.acquire(),i=this._createLabelFeatures(e.scale,t,n,r),o=this._symbolToMosaicItemMap,s=a.acquire(),l=[],c=0;return n.forEach(function(e,t){if(o.has(t.id)){var r=o.get(t.id).glyphMosaicItems,n=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(n[e]=e)}),n.length>0&&(s.set(c,t),l.push({symbol:t.toJSON(),id:c,glyphIds:n}),c++)}else{s.set(c,t);var i=[];e.forEach(function(e){return i.push(e)}),l.push({symbol:t.toJSON(),id:c,glyphIds:i}),c++}}),l.length>0?this.remoteClient.invoke("tileRenderer.getMaterialItems",l).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],l=s.get(n.id);if(l)if(g.isTextSymbol(l))if(o.has(l.id)){var u=o.get(l.id).glyphMosaicItems,c=n.mosaicItem.glyphMosaicItems;if(c)for(var p=0;p<c.length;p++)null!=c[p]&&(u[p]=c[p])}else o.set(l.id,n.mosaicItem);else o.set(l.id,n.mosaicItem)}return a.release(s),i}):(a.release(n),u.resolve(i))},t.prototype._getLabelClassInfos=function(e){return this.labelClassInfos.map(function(e,t){return{id:t,labelClassInfo:e}}).filter(function(t){var r=t.labelClassInfo;return(!r.labelClass.minScale||r.labelClass.minScale>=e||0===r.labelClass.minScale)&&(!r.labelClass.maxScale||r.labelClass.maxScale<=e||0===r.labelClass.maxScale)})},t.prototype._createLabelFeatures=function(e,t,r,n){if(!this.labelingInfo||!t||0===t.length)return null;var s=new o({viewingMode:"",scale:e}),l=this._getLabelClassInfos(e);if(0===l.length)return null;for(var u=a.acquire(),c=new m.default(y.COLLISION_EARLY_REJECT_BUCKET_SIZE),f=0,d=t;f<d.length;f++){var h=d[f],g=this.service.geometryType,v=0,b=0;if("esriGeometryPoint"===g||"esriGeometryPolygon"===g){if("esriGeometryPoint"===g){var _=h.geometry;v=_.x,b=_.y}else v=h.centroid.x,b=h.centroid.y;if(c.checkOverlap(v,b))continue}for(var S=h.attributes[this.service.objectIdField],O=new Array,w=0;w<l.length;w++){var E=l[w],C=E.labelClassInfo,F=E.id,M=h;if(this.configuration.hasGeometryExpr){if(!n)return void x.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found");var T=n.transform,L=n.hasZ,R=n.hasM,j=this.hydrate(h.geometry,T,L,R),k=i({},h,{geometry:j});j.spatialReference=p.fromJSON(this.spatialReference),M=k}var G=I.bidiText(this._evaluateLabelExpression(M,C,s)),V=G[0],z=G[1];if(y.DEBUG_LABELS){var J="-"+S;V=V.substring(0,V.length-J.length)+J}V&&V.length&&(P(C.labelClass.symbol,V,r),O.push({text:V,rtl:z,id:F}))}u.set(S,O)}return u},t.prototype._evaluateLabelExpression=function(e,t,r){if(!t.labelClass.symbol)return"";if(!f.evaluateWhere(t.labelClass.where,e.attributes))return"";if(!t.labelExpression.expression)return"";var n=i({view:r},t.labelOptions);return f.buildLabelText(t.labelExpression.expression,e,this.fields,n)},n([c.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),n([c.property()],t.prototype,"configuration",void 0),n([c.property({dependsOn:["configuration"]})],t.prototype,"labelingInfo",null),n([c.property({dependsOn:["labelingInfo"]})],t.prototype,"labelClassInfos",null),n([c.property({dependsOn:["service"]})],t.prototype,"hydrate",null),n([c.property({dependsOn:["configuration","service","fields","tileStore"]})],t.prototype,"factory",null),n([c.property({constructOnly:!0})],t.prototype,"queryInfo",null),n([c.property({dependsOn:["configuration"]})],t.prototype,"renderer",null),n([c.property({dependsOn:["configuration"]})],t.prototype,"rendererInfo",null),n([c.property({readOnly:!0})],t.prototype,"updating",null),n([c.property({dependsOn:["service"]})],t.prototype,"fields",null),n([c.subclass()],t)}(c.declared(O.default));t.default=E}.apply(null,n))||(e.exports=i)},2487:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1606)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._bucketSize=e,this._rowsLength=r.TILE_SIZE/e,this._colsLength=r.TILE_SIZE/e,this._grid=this._initGrid()}return e.prototype.checkOverlap=function(e,t){var r=Math.floor(e/this._bucketSize),n=Math.floor(t/this._bucketSize);return r<0||r>=this._rowsLength||n<0||n>=this._colsLength||!!this._grid[n][r]||!(this._grid[n][r]=!0)},e.prototype.reset=function(){this._grid=this._initGrid()},e.prototype._initGrid=function(){for(var e=[],t=0;t<this._rowsLength;t++)e.push(new Array(this._colsLength));return e},e}();t.default=n}.apply(null,n))||(e.exports=i)}}]);