(function(){(this||window).webpackJsonp.registerAbsMids({"esri/geometry/support/quantizationUtils":1620,"esri/views/2d/layers/features/controllers/MemoryController":2082})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{1620:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(59)],void 0===(i=function(e,t,r){function n(e){return e&&"upperLeft"===e.originPosition}function i(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function o(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function u(e,t,r){for(var n,u,a,s,l=[],c=0;c<r.length;c++){var p=r[c];c>0?(a=i(e,p[0]),s=o(e,p[1]),a===n&&s===u||(l.push(t(p,a-n,s-u)),n=a,u=s)):(n=i(e,p[0]),u=o(e,p[1]),l.push(t(p,n,u)))}return l.length>0?l:null}function a(e,t,r,n){return u(e,r?n?q:w:n?w:z,t)}function s(e,t,r,n){for(var i=[],o=r?n?q:w:n?w:z,a=0;a<t.length;a++){var s=u(e,o,t[a]);s&&s.length>=3&&i.push(s)}return i.length?i:null}function l(e,t,r,n){for(var i=[],o=r?n?q:w:n?w:z,a=0;a<t.length;a++){var s=u(e,o,t[a]);s&&s.length>=2&&i.push(s)}return i.length?i:null}function c(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function p(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function f(e,t,r){var n=new Array(r.length);if(!r.length)return n;var i=e.scale,o=i[0],u=i[1],a=c(e,r[0][0]),s=p(e,r[0][1]);n[0]=t(r[0],a,s);for(var l=1;l<r.length;l++){var f=r[l];a+=f[0]*o,s-=f[1]*u,n[l]=t(f,a,s)}return n}function h(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=f(e,t,r[i]);return n}function y(e,t,r,n){return f(e,r?n?q:w:n?w:z,t)}function m(e,t,r,n){return h(e,r?n?q:w:n?w:z,t)}function d(e,t,r,n){return h(e,r?n?q:w:n?w:z,t)}function g(e,t,r){for(var n=r[0],i=n[0],o=n[1],u=Math.min(i,t[0]),a=Math.min(o,t[1]),s=Math.max(i,t[2]),l=Math.max(o,t[3]),c=1;c<r.length;c++){var p=r[c],f=p[0],h=p[1];i+=f,o+=h,f<0&&(u=Math.min(u,i)),f>0&&(s=Math.max(s,i)),h<0?a=Math.min(a,o):h>0&&(l=Math.max(l,o))}return e[0]=u,e[1]=a,e[2]=s,e[3]=l,e}function x(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)g(e,e,t[r]);return e}function v(e,t,r,n,u){return t.xmin=i(e,r.xmin),t.ymin=o(e,r.ymin),t.xmax=i(e,r.xmax),t.ymax=o(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),u&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function _(e,t,r,n,i){return t.points=a(e,r.points,n,i),t}function P(e,t,r,n,u){return t.x=i(e,r.x),t.y=o(e,r.y),t!==r&&(n&&(t.z=r.z),u&&(t.m=r.m)),t}function I(e,t,r,n,i){var o=s(e,r.rings,n,i);return o?(t.rings=o,t):null}function b(e,t,r,n,i){var o=l(e,r.paths,n,i);return o?(t.paths=o,t):null}Object.defineProperty(t,"__esModule",{value:!0});var z=function(e,t,r){return[t,r]},w=function(e,t,r){return[t,r,e[2]]},q=function(e,t,r){return[t,r,e[2],e[3]]};t.toTransform=function(e){return e?{originPosition:"upperLeft",scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(n(e)?(r=e.translate[0],i=e.translate[1],o=e.scale[0]):(r=e.extent.xmin,i=e.extent.ymax,o=e.tolerance),n(t)?(u=t.translate[0],a=t.translate[1],s=t.scale[0]):(u=t.extent.xmin,a=t.extent.ymax,s=t.tolerance),r===u&&i===a&&o===s);var r,i,o,u,a,s},t.quantizeX=i,t.quantizeY=o,t.quantizeBounds=function(e,t,r){return t[0]=i(e,r[0]),t[3]=o(e,r[1]),t[2]=i(e,r[2]),t[1]=o(e,r[3]),t},t.quantizePoints=a,t.quantizeRings=s,t.quantizePaths=l,t.hydrateX=c,t.hydrateY=p,t.hydrateCoordsArray=f,t.hydrateCoordsArrayArray=h,t.hydrateBounds=function(e,t,r){return r?(t[0]=c(e,r[0]),t[1]=p(e,r[3]),t[2]=c(e,r[2]),t[3]=p(e,r[1]),t):[c(e,t[0]),p(e,t[3]),c(e,t[2]),p(e,t[1])]},t.hydratePoints=y,t.hydratePaths=m,t.hydrateRings=d,t.getQuantizedBoundsCoordsArray=g,t.getQuantizedBoundsCoordsArrayArray=x,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return g(t,t,e)},t.getQuantizedBoundsPaths=function(e){return x([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return x([0,0,0,0],e)},t.quantizeExtent=v,t.quantizeMultipoint=_,t.quantizePoint=P,t.quantizePolygon=I,t.quantizePolyline=b,t.quantizeGeometry=function(e,t){return e&&t?r.isPoint(t)?P(e,{},t,!1,!1):r.isPolyline(t)?b(e,{},t,!1,!1):r.isPolygon(t)?I(e,{},t,!1,!1):r.isMultipoint(t)?_(e,{},t,!1,!1):r.isExtent(t)?v(e,{},t,!1,!1):null:null},t.hydrateExtent=function(e,t,r,n,i){return t.xmin=c(e,r.xmin),t.ymin=p(e,r.ymin),t.xmax=c(e,r.xmax),t.ymax=p(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,n,i){return t.points=y(e,r.points,n,i),t},t.hydratePoint=function(e,t,r,n,i){return t.x=c(e,r.x),t.y=p(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,n,i){return t.rings=d(e,r.rings,n,i),t},t.hydratePolyline=function(e,t,r,n,i){return t.paths=m(e,r.paths,n,i),t}}.apply(null,n))||(e.exports=i)},2082:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(10),r(30),r(8),r(9),r(7),r(141),r(1),r(66),r(555),r(524),r(52),r(1579),r(1958),r(2083)],void 0===(i=function(e,t,r,n,i,o,u,a,s,l,c,p,f,h,y,m,d,g){Object.defineProperty(t,"__esModule",{value:!0});var x=a.getLogger("esri.views.2d.layers.features.controllers.MemoryController"),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="memory",t._processingInMainThread=!1,t}return r(t,e),t.prototype.initialize=function(){var e=this;this._tileQueue=new g.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchFeatureSet(t,r)}}),this._memorySource=l.open(this.service.source,{client:this}),this.handles.add(this.watch("processor",this._switchProcessor.bind(this)))},t.prototype.destroy=function(){this._tileQueue.clear(),this._tileQueue.pause()},Object.defineProperty(t.prototype,"processing",{get:function(){return f.fromWorker(this.configuration.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tileQueue.updating},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){this.refresh()},t.prototype.queryFeatures=function(e){return this._memorySource.invoke("queryFeatures",e)},t.prototype.queryFeatureCount=function(e){return this._memorySource.invoke("queryFeatureCount",e)},t.prototype.queryObjectIds=function(e){return this._memorySource.invoke("queryObjectIds",e)},t.prototype.queryExtent=function(e){return this._memorySource.invoke("queryExtent",e)},t.prototype.redraw=function(){this.refresh()},t.prototype.refresh=function(){this._tileQueue.refresh();for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._tileQueue.push(r.id,r.updateTimestamp)}},t.prototype.setViewState=function(e){this._tileQueue.state=e},t.prototype.onTileUpdate=function(e){this._tileQueue.pause();for(var t=0,r=e.removed;t<r.length;t++){var n=r[t];this._tileQueue.cancel(n.id)}for(var i=0,o=e.added;i<o.length;i++){n=o[i];this._tileQueue.push(n.id,n.updateTimestamp)}this.processor&&this._tileQueue.resume()},t.prototype._switchProcessor=function(e,t){this.refresh(),e&&this._tileQueue.resume()},t.prototype._fetchFeatureSet=function(e,t){var r=this,n=this.tileStore.get(e),i=this.processor.queryInfo;return this._query(n,i).then(function(e){return r._wrapPoints(e,i)}).then(function(e){return r._sortFeatures(e,i)}).then(function(e){return e.features.length?e:null}).then(function(e){return n.updateTimestamp=t,r.processor.onTileData(n,{addOrUpdate:e&&e.features,clear:!0,transformParams:e&&m.getTransformParams(e)})}).catch(function(e){return n.updateTimestamp=t,"cancel"!==e.dojoType&&(r.processor.onTileError(n,e.message),x.error("query-error",{error:e})),s.reject(e)})},t.prototype._query=function(e,t){var r=this,n=new y,i=this._getQuantizationParameters(e),u=t.pixelBuffer*e.resolution,a=e.bounds.slice();return a[0]-=u,a[1]-=u,a[2]+=u,a[3]+=u,n.outFields=this.processor.queryInfo.outFields,n.where=this.processor.queryInfo.definitionExpression||"1=1",n.geometry=new o.Extent({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:this.spatialReference}),this.service.capabilities.query.supportsQuantization?(n.quantizationParameters=i,"esriGeometryPolyline"===this.service.geometryType&&(n.maxAllowableOffset=i.tolerance)):n.maxAllowableOffset=i.tolerance,n.resultType="tile",n.returnExceededLimitFeatures=!1,n.returnGeometry=!0,n.returnCentroid=t.returnCentroid,n.orderByFields=t.orderByFields,this.queryFeatures(n.toJSON()).then(function(e){return r._applyProcessing(e)})},t.prototype._applyProcessing=function(e){var t=this.processing;if(!t)return e;if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e});try{return t.process(e,t.options)||s.reject(new u("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(t){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e})}},t.prototype._getQuantizationParameters=function(e){return new h.default({mode:"view",originPosition:"lower-left",tolerance:e.resolution,extent:new o.Extent({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference})})},t.prototype._wrapPoints=function(e,t){if(0===e.features.length)return e;var r=t.returnCentroid,n=t.pixelBuffer,o=e.geometryType,u=e.spatialReference,a=e.transform;if("esriGeometryPoint"!==o&&"esriGeometryMultipoint"!==o&&!r||!p.isWrappable(u))return e;var s=e.features,l=p.getInfo(u),c=Math.round((l.valid[1]-l.valid[0])/a.scale[0]);if(512===c){for(var f=[],h=0,y=s;h<y.length;h++){var m=y[h],d=m.geometry,g=m.attributes;if(d)if(d.x<n){(x={geometry:i({},d),attributes:g}).geometry.x+=c,f.push(x)}else if(d.x>512-n){var x;(x={geometry:i({},d),attributes:g}).geometry.x-=c,f.push(x)}}s.push.apply(s,f)}else for(var v=0,_=s;v<_.length;v++){(d=_[v].geometry)&&(d.x<-n?d.x+=c:d.x>512+n&&(d.x-=c))}return e},t.prototype._sortFeatures=function(e,t){var r=t.orderByFields;if(r){var n=r[0].split(" "),i=n[0];"DESC"===n[1]&&e.features.sort(function(e,t){return t.attributes[i]-e.attributes[i]})}return e},n([c.property()],t.prototype,"_tileQueue",void 0),n([c.property()],t.prototype,"configuration",void 0),n([c.property({readOnly:!0,dependsOn:["configuration"]})],t.prototype,"processing",null),n([c.property({dependsOn:["_tileQueue.updating"]})],t.prototype,"updating",null),n([c.subclass()],t)}(c.declared(d.default));t.default=v}.apply(null,n))||(e.exports=i)}}]);